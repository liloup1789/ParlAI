<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParlAI: stack_rank_evals.run Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ParlAI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../db/dd8/namespacestack__rank__evals.html">stack_rank_evals</a></li><li class="navelem"><a class="el" href="../../db/d8c/namespacestack__rank__evals_1_1run.html">run</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">stack_rank_evals.run Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5e968ebe737f4f8e703b5be5bec893bf"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d8c/namespacestack__rank__evals_1_1run.html#a5e968ebe737f4f8e703b5be5bec893bf">main</a> ()</td></tr>
<tr class="separator:a5e968ebe737f4f8e703b5be5bec893bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a7da608ae54872ed1fb55c4c87600cf99"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d8c/namespacestack__rank__evals_1_1run.html#a7da608ae54872ed1fb55c4c87600cf99">round_choices</a></td></tr>
<tr class="separator:a7da608ae54872ed1fb55c4c87600cf99"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a5e968ebe737f4f8e703b5be5bec893bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e968ebe737f4f8e703b5be5bec893bf">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def stack_rank_evals.run.main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Human Evaluation of various responses to comments on images.

A turker is shown an image and some dialog history. Then, the
turker is asked to choose which response they think is more engaging.

If no `--eval-data-path` is given, the data from the original
Image-Chat dataset is used.

To use your own data, please specify `--eval-data-path`, a path to an
appropriate json file with a list of examples, where each example
has the following structure:
    {
        'image_hash': &lt;hash of image&gt;,
        'dialog': [(personality, text), ...] - list of personality, text tuples
        'personality': &lt;personality of responses to compare&gt;
        '&lt;compare_key_1&gt;': &lt;first response to compare&gt;,
        '&lt;compare_key_2&gt;': &lt;second option to compare&gt;,
        .
        .
        .
    }
Note that compare_key_1 and compare_key_2 can be any field, as long as they
map to a string response.

Example Scenario:
    Suppose you have the original Image-Chat dataset, and
    you would like to compare the outputs of your model called `model`.

    Your data may look like the following:
    [{
        'image_hash': hashforimageofcat,
        'dialog': [
            ('Sweet', 'What a cute cat!'),
            ('Neutral', 'Just looks like a plain cat to me')
        ]
        'personality': 'Sweet',
        'comment': 'It really is adorable if you look!', # Human Comment
        'model_comment': 'You'll love it if you pet it!' # Model Comment
    }, ...]

    Thus, you would specify `-ck1 comment -ck2 model_comment` to evaluate
    the outputs of the model vs. the human comments from Personality-Captions
</pre><pre class="fragment">Human Evaluation of various image captions/comments.

A turker is shown an image and two possible comments/captions, and
optionally the personality used to create these captions. Then, the
turker is asked to choose which caption they think is more engaging.

In this example, we will just be comparing the original comment twice
(this is just to demonstrate the task for future use).

To use your own data, please specify `--eval-data-path` to an
appropriate json file with a list of examples, where each example
has the following structure:
    {
        'image_hash': &lt;hash of image&gt;,
        'personality': &lt;personality, if applicable&gt;,
        '&lt;compare_key_1&gt;': &lt;first option to compare&gt;,
        '&lt;compare_key_2&gt;': &lt;second option to compare&gt;,
        .
        .
        .
    }
Note that compare_key_1 and compare_key_2 can be any field, as long as they
map to a string comment/caption.

Example Scenario:
    Suppose you have the original Personality-Captions dataset, and
    you would like to compare the outputs of your model called `model`.

    Your data may look like the following:
    [{
        'image_hash': hashforimageofcat,
        'personality': 'Sweet',
        'comment': 'Look at the cute cat!', # Human Comment
        'model_comment': 'That's a weird looking dog' # Model Comment
    }, ...]

    Thus, you would specify `-ck1 comment -ck2 model_comment` to evaluate
    the outputs of the model vs. the human comments from Personality-Captions
</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d46/parlai_2mturk_2tasks_2image__chat_2stack__rank__evals_2run_8py_source.html#l00022">22</a> of file <a class="el" href="../../de/d46/parlai_2mturk_2tasks_2image__chat_2stack__rank__evals_2run_8py_source.html">run.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">def </span><a class="code" href="../../db/d07/namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run.html#ad3ab2c71f8083c3112815c0b363d316b">main</a>():</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="stringliteral">    Human Evaluation of various responses to comments on images.</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="stringliteral">    A turker is shown an image and some dialog history. Then, the</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="stringliteral">    turker is asked to choose which response they think is more engaging.</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="stringliteral">    If no `--eval-data-path` is given, the data from the original</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="stringliteral">    Image-Chat dataset is used.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">    To use your own data, please specify `--eval-data-path`, a path to an</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="stringliteral">    appropriate json file with a list of examples, where each example</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="stringliteral">    has the following structure:</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="stringliteral">        {</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="stringliteral">            &#39;image_hash&#39;: &lt;hash of image&gt;,</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="stringliteral">            &#39;dialog&#39;: [(personality, text), ...] - list of personality, text tuples</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="stringliteral">            &#39;personality&#39;: &lt;personality of responses to compare&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="stringliteral">            &#39;&lt;compare_key_1&gt;&#39;: &lt;first response to compare&gt;,</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="stringliteral">            &#39;&lt;compare_key_2&gt;&#39;: &lt;second option to compare&gt;,</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="stringliteral">            .</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="stringliteral">            .</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="stringliteral">            .</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="stringliteral">        }</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="stringliteral">    Note that compare_key_1 and compare_key_2 can be any field, as long as they</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="stringliteral">    map to a string response.</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="stringliteral">    Example Scenario:</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="stringliteral">        Suppose you have the original Image-Chat dataset, and</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="stringliteral">        you would like to compare the outputs of your model called `model`.</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="stringliteral">        Your data may look like the following:</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="stringliteral">        [{</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="stringliteral">            &#39;image_hash&#39;: hashforimageofcat,</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="stringliteral">            &#39;dialog&#39;: [</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="stringliteral">                (&#39;Sweet&#39;, &#39;What a cute cat!&#39;),</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="stringliteral">                (&#39;Neutral&#39;, &#39;Just looks like a plain cat to me&#39;)</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="stringliteral">            ]</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="stringliteral">            &#39;personality&#39;: &#39;Sweet&#39;,</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="stringliteral">            &#39;comment&#39;: &#39;It really is adorable if you look!&#39;, # Human Comment</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral">            &#39;model_comment&#39;: &#39;You&#39;ll love it if you pet it!&#39; # Model Comment</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="stringliteral">        }, ...]</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="stringliteral">        Thus, you would specify `-ck1 comment -ck2 model_comment` to evaluate</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="stringliteral">        the outputs of the model vs. the human comments from Personality-Captions</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    argparser = ParlaiParser(<span class="keyword">False</span>, <span class="keyword">False</span>)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    argparser.add_parlai_data_path()</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    argparser.add_mturk_args()</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="stringliteral">&#39;-min_t&#39;</span>, <span class="stringliteral">&#39;--min_turns&#39;</span>, default=3, type=int, help=<span class="stringliteral">&#39;minimum number of turns&#39;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    )</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="stringliteral">&#39;-mt&#39;</span>, <span class="stringliteral">&#39;--max_turns&#39;</span>, default=5, type=int, help=<span class="stringliteral">&#39;maximal number of chat turns&#39;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    )</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="stringliteral">&#39;-mx_rsp_time&#39;</span>,</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="stringliteral">&#39;--max_resp_time&#39;</span>,</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        default=1800,</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        type=int,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        help=<span class="stringliteral">&#39;time limit for entering a dialog message&#39;</span>,</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    )</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="stringliteral">&#39;-mx_onb_time&#39;</span>,</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="stringliteral">&#39;--max_onboard_time&#39;</span>,</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        type=int,</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        default=300,</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        help=<span class="stringliteral">&#39;time limit for turker&#39;</span> <span class="stringliteral">&#39;in onboarding&#39;</span>,</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    )</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="stringliteral">&#39;-ni&#39;</span>,</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="stringliteral">&#39;--num_images&#39;</span>,</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        type=int,</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        default=10,</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        help=<span class="stringliteral">&#39;number of images to show \</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="stringliteral">                           to turker&#39;</span>,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    )</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="stringliteral">&#39;--auto-approve-delay&#39;</span>,</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        type=int,</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        default=3600 * 24,</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        help=<span class="stringliteral">&#39;how long to wait for  \</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="stringliteral">                           auto approval&#39;</span>,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    )</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="stringliteral">&#39;--data-path&#39;</span>, type=str, default=<span class="stringliteral">&#39;&#39;</span>, help=<span class="stringliteral">&#39;where to save data&#39;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    )</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="stringliteral">&#39;--eval-data-path&#39;</span>,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        type=str,</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        default=<span class="stringliteral">&#39;&#39;</span>,</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        help=<span class="stringliteral">&#39;where to load data to rank from. Leave &#39;</span> <span class="stringliteral">&#39;blank to use Image-Chat data&#39;</span>,</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    )</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="stringliteral">&#39;-ck1&#39;</span>,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="stringliteral">&#39;--compare-key-1&#39;</span>,</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        type=str,</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        default=<span class="stringliteral">&#39;comment&#39;</span>,</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        help=<span class="stringliteral">&#39;key of first comparable&#39;</span>,</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    )</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="stringliteral">&#39;-ck2&#39;</span>,</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="stringliteral">&#39;--compare-key-2&#39;</span>,</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        type=str,</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        default=<span class="stringliteral">&#39;comment&#39;</span>,</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        help=<span class="stringliteral">&#39;key of first comparable&#39;</span>,</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    )</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="stringliteral">&#39;-rnd&#39;</span>,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="stringliteral">&#39;--dialog-round&#39;</span>,</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        type=str,</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        default=<span class="stringliteral">&#39;first_response&#39;</span>,</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        choices=round_choices,</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        help=<span class="stringliteral">&#39;which dialog round to show&#39;</span>,</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    )</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="stringliteral">&#39;--show-personality&#39;</span>,</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        default=<span class="keyword">True</span>,</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        type=<span class="stringliteral">&#39;bool&#39;</span>,</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        help=<span class="stringliteral">&#39;whether to show the personality&#39;</span>,</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    )</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    ImageChatTeacher.add_cmdline_args(argparser)</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    opt = argparser.parse_args()</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    build_ic(opt)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    directory_path = os.path.dirname(os.path.abspath(__file__))</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    opt[<span class="stringliteral">&#39;task&#39;</span>] = os.path.basename(directory_path)</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> <span class="stringliteral">&#39;data_path&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> opt <span class="keywordflow">or</span> opt[<span class="stringliteral">&#39;data_path&#39;</span>] == <span class="stringliteral">&#39;&#39;</span>:</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        opt[<span class="stringliteral">&#39;data_path&#39;</span>] = os.getcwd() + <span class="stringliteral">&#39;/data/&#39;</span> + opt[<span class="stringliteral">&#39;task&#39;</span>]</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span> opt.get(<span class="stringliteral">&#39;eval_data_path&#39;</span>) == <span class="stringliteral">&#39;&#39;</span>:</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        opt[<span class="stringliteral">&#39;eval_data_path&#39;</span>] = os.path.join(opt[<span class="stringliteral">&#39;datapath&#39;</span>], <span class="stringliteral">&#39;image_chat/test.json&#39;</span>)</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    config = config_first <span class="keywordflow">if</span> opt[<span class="stringliteral">&#39;dialog_round&#39;</span>] == <span class="stringliteral">&#39;first_response&#39;</span> <span class="keywordflow">else</span> config_second</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    opt.update(config)</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    mturk_agent_ids = [CHOOSER]</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    mturk_manager = MTurkManager(opt=opt, mturk_agent_ids=mturk_agent_ids)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    example_generator = ExampleGenerator(opt)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    mturk_manager.setup_server(task_directory_path=directory_path)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        mturk_manager.start_new_run()</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keyword">def </span>run_onboard(worker):</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            worker.example_generator = example_generator</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            world = RoleOnboardWorld(opt, worker)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            world.parley()</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            world.shutdown()</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        mturk_manager.set_onboard_function(onboard_function=run_onboard)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        mturk_manager.ready_to_accept_workers()</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        mturk_manager.create_hits()</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keyword">def </span>check_worker_eligibility(worker):</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keyword">def </span>assign_worker_roles(workers):</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="keywordflow">for</span> w <span class="keywordflow">in</span> workers:</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                w.id = mturk_agent_ids[0]</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keyword">def </span>run_conversation(mturk_manager, opt, workers):</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            agents = workers[:]</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            conv_idx = mturk_manager.conversation_index</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            world = MTurkImageChatStackRankWorld(</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                opt, agents=agents, world_tag=<span class="stringliteral">&#39;conversation t_{}&#39;</span>.<a class="code" href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">format</a>(conv_idx)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            )</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="keywordflow">while</span> <span class="keywordflow">not</span> world.episode_done():</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                world.parley()</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            world.save_data()</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            world.shutdown()</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            world.review_work()</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        mturk_manager.start_task(</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            eligibility_function=check_worker_eligibility,</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            assign_role_function=assign_worker_roles,</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            task_function=run_conversation,</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        )</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">except</span> BaseException:</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">raise</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">finally</span>:</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        mturk_manager.expire_all_unassigned_hits()</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        mturk_manager.shutdown()</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="ttc" id="namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run_html_ad3ab2c71f8083c3112815c0b363d316b"><div class="ttname"><a href="../../db/d07/namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run.html#ad3ab2c71f8083c3112815c0b363d316b">projects.wizard_of_wikipedia.mturk_evaluation_task.run.main</a></div><div class="ttdeci">def main()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfd/projects_2wizard__of__wikipedia_2mturk__evaluation__task_2run_8py_source.html#l00032">run.py:32</a></div></div>
<div class="ttc" id="namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_html_a32e2e2022b824fbaf80c747160b52a76"><div class="ttname"><a href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">parlai.chat_service.services.messenger.shared_utils.format</a></div><div class="ttdeci">format</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/chat__service_2services_2messenger_2shared__utils_8py_source.html#l00029">shared_utils.py:29</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a7da608ae54872ed1fb55c4c87600cf99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7da608ae54872ed1fb55c4c87600cf99">&#9670;&nbsp;</a></span>round_choices</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">stack_rank_evals.run.round_choices</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d46/parlai_2mturk_2tasks_2image__chat_2stack__rank__evals_2run_8py_source.html#l00019">19</a> of file <a class="el" href="../../de/d46/parlai_2mturk_2tasks_2image__chat_2stack__rank__evals_2run_8py_source.html">run.py</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
