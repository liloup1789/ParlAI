<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParlAI: parlai.mturk.tasks.wizard_of_wikipedia.run Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ParlAI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d5/d22/namespaceparlai.html">parlai</a></li><li class="navelem"><a class="el" href="../../df/de1/namespaceparlai_1_1mturk.html">mturk</a></li><li class="navelem"><a class="el" href="../../dd/dab/namespaceparlai_1_1mturk_1_1tasks.html">tasks</a></li><li class="navelem"><a class="el" href="../../d2/d2d/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia.html">wizard_of_wikipedia</a></li><li class="navelem"><a class="el" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html">run</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">parlai.mturk.tasks.wizard_of_wikipedia.run Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a22eb017ecd8f1a211fc5aac511d3102e"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a22eb017ecd8f1a211fc5aac511d3102e">setup_retriever</a> (opt)</td></tr>
<tr class="separator:a22eb017ecd8f1a211fc5aac511d3102e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59836c3be93d4b491fa9ddecbb4e83c0"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a59836c3be93d4b491fa9ddecbb4e83c0">setup_title_to_passage</a> (opt)</td></tr>
<tr class="separator:a59836c3be93d4b491fa9ddecbb4e83c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c16caa932230f93c418facd793be473"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a5c16caa932230f93c418facd793be473">setup_personas_with_wiki_links</a> (opt)</td></tr>
<tr class="separator:a5c16caa932230f93c418facd793be473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2292712790bc7b0c052359562a4f0943"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a2292712790bc7b0c052359562a4f0943">main</a> ()</td></tr>
<tr class="separator:a2292712790bc7b0c052359562a4f0943"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a2292712790bc7b0c052359562a4f0943"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2292712790bc7b0c052359562a4f0943">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.mturk.tasks.wizard_of_wikipedia.run.main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Wizard of Wikipedia Data Collection Task.

The task involves two people holding a conversation. One dialog partner
chooses a topic to discuss, and then dialog proceeds.

One partner is the Wizard, who has access to retrieved external
information conditioned on the last two utterances, as well as
information regarding the chosen topic.

The other partner is the Apprentice, who assumes the role of someone
eager to learn about the chosen topic.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html#l00091">91</a> of file <a class="el" href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html">run.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">def </span><a class="code" href="../../db/d07/namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run.html#ad3ab2c71f8083c3112815c0b363d316b">main</a>():</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="stringliteral">    Wizard of Wikipedia Data Collection Task.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="stringliteral">    The task involves two people holding a conversation. One dialog partner</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="stringliteral">    chooses a topic to discuss, and then dialog proceeds.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="stringliteral">    One partner is the Wizard, who has access to retrieved external</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="stringliteral">    information conditioned on the last two utterances, as well as</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="stringliteral">    information regarding the chosen topic.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="stringliteral">    The other partner is the Apprentice, who assumes the role of someone</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="stringliteral">    eager to learn about the chosen topic.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    argparser = ParlaiParser(<span class="keyword">False</span>, <span class="keyword">False</span>)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    DictionaryAgent.add_cmdline_args(argparser)</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    argparser.add_parlai_data_path()</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    argparser.add_mturk_args()</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="stringliteral">&#39;-min_t&#39;</span>, <span class="stringliteral">&#39;--min_turns&#39;</span>, default=3, type=int, help=<span class="stringliteral">&#39;minimum number of turns&#39;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    )</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="stringliteral">&#39;-max_t&#39;</span>,</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="stringliteral">&#39;--max_turns&#39;</span>,</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        default=5,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        type=int,</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        help=<span class="stringliteral">&#39;maximal number of chat turns&#39;</span>,</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    )</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="stringliteral">&#39;-mx_rsp_time&#39;</span>,</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="stringliteral">&#39;--max_resp_time&#39;</span>,</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        default=120,</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        type=int,</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        help=<span class="stringliteral">&#39;time limit for entering a dialog message&#39;</span>,</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    )</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="stringliteral">&#39;-mx_onb_time&#39;</span>,</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="stringliteral">&#39;--max_onboard_time&#39;</span>,</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        type=int,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        default=300,</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        help=<span class="stringliteral">&#39;time limit for turker&#39;</span> <span class="stringliteral">&#39;in onboarding&#39;</span>,</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    )</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="stringliteral">&#39;--persona-type&#39;</span>,</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        default=<span class="stringliteral">&#39;both&#39;</span>,</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        type=str,</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        choices=[<span class="stringliteral">&#39;both&#39;</span>, <span class="stringliteral">&#39;self&#39;</span>, <span class="stringliteral">&#39;other&#39;</span>],</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        help=<span class="stringliteral">&#39;Which personas to load from personachat&#39;</span>,</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    )</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="stringliteral">&#39;--auto-approve-delay&#39;</span>,</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        type=int,</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        default=3600 * 24 * 1,</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        help=<span class="stringliteral">&#39;how long to wait for  \</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="stringliteral">                           auto approval&#39;</span>,</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    )</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="stringliteral">&#39;--word-overlap-threshold&#39;</span>,</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        type=int,</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        default=2,</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        help=<span class="stringliteral">&#39;How much word overlap we want between message \</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral">                           and checked sentence&#39;</span>,</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    )</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="stringliteral">&#39;--num-good-sentence-threshold&#39;</span>,</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        type=int,</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        default=2,</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        help=<span class="stringliteral">&#39;How many good sentences with sufficient overlap \</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">                           are necessary for turker to be considered good.&#39;</span>,</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    )</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    argparser.add_argument(</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="stringliteral">&#39;--num-passages-retrieved&#39;</span>,</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        type=int,</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        default=7,</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        help=<span class="stringliteral">&#39;How many passages to retrieve per dialog \</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="stringliteral">                           message&#39;</span>,</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    )</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    opt = argparser.parse_args()</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    directory_path = os.path.dirname(os.path.abspath(__file__))</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    opt[<span class="stringliteral">&#39;task&#39;</span>] = os.path.basename(directory_path)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> <span class="stringliteral">&#39;data_path&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> opt:</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        opt[<span class="stringliteral">&#39;data_path&#39;</span>] = os.getcwd() + <span class="stringliteral">&#39;/data/&#39;</span> + opt[<span class="stringliteral">&#39;task&#39;</span>]</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        opt[<span class="stringliteral">&#39;current_working_dir&#39;</span>] = os.getcwd()</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    opt.update(task_config)</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    mturk_agent_ids = [APPRENTICE, WIZARD]</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    opt[<span class="stringliteral">&#39;min_messages&#39;</span>] = 2</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    mturk_manager = MTurkManager(opt=opt, mturk_agent_ids=mturk_agent_ids)</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a5c16caa932230f93c418facd793be473">setup_personas_with_wiki_links</a>(opt)</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    ir_agent, task = <a class="code" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a22eb017ecd8f1a211fc5aac511d3102e">setup_retriever</a>(opt)</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    persona_generator = PersonasGenerator(opt)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    wiki_title_to_passage = <a class="code" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a59836c3be93d4b491fa9ddecbb4e83c0">setup_title_to_passage</a>(opt)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    mturk_manager.setup_server(task_directory_path=directory_path)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    worker_roles = {}</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    connect_counter = AttrDict(value=0)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        mturk_manager.start_new_run()</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> opt[<span class="stringliteral">&#39;is_sandbox&#39;</span>]:</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            with open(os.path.join(opt[<span class="stringliteral">&#39;current_working_dir&#39;</span>], <span class="stringliteral">&#39;mtdont.txt&#39;</span>)) <span class="keyword">as</span> f:</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                lines = [l.replace(<span class="stringliteral">&#39;\n&#39;</span>, <span class="stringliteral">&#39;&#39;</span>) <span class="keywordflow">for</span> l <span class="keywordflow">in</span> f.readlines()]</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                <span class="keywordflow">for</span> w <span class="keywordflow">in</span> lines:</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                    mturk_manager.soft_block_worker(w)</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keyword">def </span>run_onboard(worker):</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            role = mturk_agent_ids[connect_counter.value % len(mturk_agent_ids)]</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            connect_counter.value += 1</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            worker_roles[worker.worker_id] = role</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            worker.persona_generator = persona_generator</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            world = RoleOnboardWorld(opt, worker, role)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            world.parley()</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            world.shutdown()</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        mturk_manager.set_onboard_function(onboard_function=run_onboard)</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        mturk_manager.ready_to_accept_workers()</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        mturk_manager.create_hits()</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keyword">def </span>check_workers_eligibility(workers):</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="keywordflow">if</span> opt[<span class="stringliteral">&#39;is_sandbox&#39;</span>]:</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                <span class="keywordflow">return</span> workers</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            valid_workers = {}</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="keywordflow">for</span> worker <span class="keywordflow">in</span> workers:</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                worker_id = worker.worker_id</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                <span class="keywordflow">if</span> worker_id <span class="keywordflow">not</span> <span class="keywordflow">in</span> worker_roles:</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="stringliteral">                    Something went wrong...</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="stringliteral">                    &quot;&quot;&quot;</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                    <span class="keywordflow">continue</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                role = worker_roles[worker_id]</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                <span class="keywordflow">if</span> role <span class="keywordflow">not</span> <span class="keywordflow">in</span> valid_workers:</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                    valid_workers[role] = worker</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keywordflow">if</span> len(valid_workers) == 2:</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                    <span class="keywordflow">break</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">return</span> valid_workers.values() <span class="keywordflow">if</span> len(valid_workers) == 2 <span class="keywordflow">else</span> []</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        eligibility_function = {<span class="stringliteral">&#39;func&#39;</span>: check_workers_eligibility, <span class="stringliteral">&#39;multiple&#39;</span>: <span class="keyword">True</span>}</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keyword">def </span>assign_worker_roles(workers):</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordflow">if</span> opt[<span class="stringliteral">&#39;is_sandbox&#39;</span>]:</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="keywordflow">for</span> i, worker <span class="keywordflow">in</span> enumerate(workers):</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                    worker.id = mturk_agent_ids[i % len(mturk_agent_ids)]</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="keywordflow">for</span> worker <span class="keywordflow">in</span> workers:</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    worker.id = worker_roles[worker.worker_id]</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keyword">def </span>run_conversation(mturk_manager, opt, workers):</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            agents = workers[:]</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> opt[<span class="stringliteral">&#39;is_sandbox&#39;</span>]:</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">for</span> agent <span class="keywordflow">in</span> agents:</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    worker_roles.pop(agent.worker_id)</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            conv_idx = mturk_manager.conversation_index</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            world = MTurkWizardOfWikipediaWorld(</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                opt,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                agents=agents,</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                world_tag=<span class="stringliteral">&#39;conversation t_{}&#39;</span>.<a class="code" href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">format</a>(conv_idx),</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                ir_agent=ir_agent,</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                wiki_title_to_passage=wiki_title_to_passage,</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                task=task,</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            )</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            world.reset_random()</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">while</span> <span class="keywordflow">not</span> world.episode_done():</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                world.parley()</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            world.save_data()</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">if</span> world.convo_finished <span class="keywordflow">and</span> <span class="keywordflow">not</span> world.good_wiz <span class="keywordflow">and</span> <span class="keywordflow">not</span> opt[<span class="stringliteral">&#39;is_sandbox&#39;</span>]:</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                mturk_manager.soft_block_worker(world.wizard_worker)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            world.shutdown()</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            world.review_work()</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        mturk_manager.start_task(</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            eligibility_function=eligibility_function,</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            assign_role_function=assign_worker_roles,</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            task_function=run_conversation,</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        )</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">except</span> BaseException:</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">raise</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">finally</span>:</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        mturk_manager.expire_all_unassigned_hits()</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        mturk_manager.shutdown()</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_html_a59836c3be93d4b491fa9ddecbb4e83c0"><div class="ttname"><a href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a59836c3be93d4b491fa9ddecbb4e83c0">parlai.mturk.tasks.wizard_of_wikipedia.run.setup_title_to_passage</a></div><div class="ttdeci">def setup_title_to_passage(opt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html#l00038">run.py:38</a></div></div>
<div class="ttc" id="namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run_html_ad3ab2c71f8083c3112815c0b363d316b"><div class="ttname"><a href="../../db/d07/namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run.html#ad3ab2c71f8083c3112815c0b363d316b">projects.wizard_of_wikipedia.mturk_evaluation_task.run.main</a></div><div class="ttdeci">def main()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfd/projects_2wizard__of__wikipedia_2mturk__evaluation__task_2run_8py_source.html#l00032">run.py:32</a></div></div>
<div class="ttc" id="namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_html_a22eb017ecd8f1a211fc5aac511d3102e"><div class="ttname"><a href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a22eb017ecd8f1a211fc5aac511d3102e">parlai.mturk.tasks.wizard_of_wikipedia.run.setup_retriever</a></div><div class="ttdeci">def setup_retriever(opt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html#l00026">run.py:26</a></div></div>
<div class="ttc" id="namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_html_a32e2e2022b824fbaf80c747160b52a76"><div class="ttname"><a href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">parlai.chat_service.services.messenger.shared_utils.format</a></div><div class="ttdeci">format</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/chat__service_2services_2messenger_2shared__utils_8py_source.html#l00029">shared_utils.py:29</a></div></div>
<div class="ttc" id="namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_html_a5c16caa932230f93c418facd793be473"><div class="ttname"><a href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a5c16caa932230f93c418facd793be473">parlai.mturk.tasks.wizard_of_wikipedia.run.setup_personas_with_wiki_links</a></div><div class="ttdeci">def setup_personas_with_wiki_links(opt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html#l00083">run.py:83</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5c16caa932230f93c418facd793be473"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c16caa932230f93c418facd793be473">&#9670;&nbsp;</a></span>setup_personas_with_wiki_links()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.mturk.tasks.wizard_of_wikipedia.run.setup_personas_with_wiki_links </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>opt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html#l00083">83</a> of file <a class="el" href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html">run.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keyword">def </span><a class="code" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a5c16caa932230f93c418facd793be473">setup_personas_with_wiki_links</a>(opt):</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    fname = <span class="stringliteral">&#39;personas_with_wiki_links.txt&#39;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    file_path = <span class="stringliteral">&#39;{}/{}&#39;</span>.<a class="code" href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">format</a>(os.getcwd(), fname)</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(file_path):</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        url = <span class="stringliteral">&#39;http://parl.ai/downloads/wizard_of_wikipedia/&#39;</span> + fname</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        build_data.download(url, os.getcwd(), fname)</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_html_a32e2e2022b824fbaf80c747160b52a76"><div class="ttname"><a href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">parlai.chat_service.services.messenger.shared_utils.format</a></div><div class="ttdeci">format</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/chat__service_2services_2messenger_2shared__utils_8py_source.html#l00029">shared_utils.py:29</a></div></div>
<div class="ttc" id="namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_html_a5c16caa932230f93c418facd793be473"><div class="ttname"><a href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a5c16caa932230f93c418facd793be473">parlai.mturk.tasks.wizard_of_wikipedia.run.setup_personas_with_wiki_links</a></div><div class="ttdeci">def setup_personas_with_wiki_links(opt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html#l00083">run.py:83</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a22eb017ecd8f1a211fc5aac511d3102e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22eb017ecd8f1a211fc5aac511d3102e">&#9670;&nbsp;</a></span>setup_retriever()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.mturk.tasks.wizard_of_wikipedia.run.setup_retriever </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>opt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html#l00026">26</a> of file <a class="el" href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html">run.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">def </span><a class="code" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a22eb017ecd8f1a211fc5aac511d3102e">setup_retriever</a>(opt):</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    print(<span class="stringliteral">&#39;[ Setting up Retriever ]&#39;</span>)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    task = <span class="stringliteral">&#39;wikipedia:full&#39;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    ret_opt = copy.deepcopy(opt)</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    ret_opt[<span class="stringliteral">&#39;model_file&#39;</span>] = <span class="stringliteral">&#39;models:wikipedia_full/tfidf_retriever/model&#39;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    ret_opt[<span class="stringliteral">&#39;retriever_num_retrieved&#39;</span>] = opt.get(<span class="stringliteral">&#39;num_passages_retrieved&#39;</span>, 7)</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    ret_opt[<span class="stringliteral">&#39;retriever_mode&#39;</span>] = <span class="stringliteral">&#39;keys&#39;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    ret_opt[<span class="stringliteral">&#39;override&#39;</span>] = {<span class="stringliteral">&#39;remove_title&#39;</span>: <span class="keyword">False</span>}</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    ir_agent = <a class="code" href="../../db/dcf/namespaceparlai_1_1core_1_1agents.html#a00d77a7e26fb89e8bd900f7b2a02982a">create_agent</a>(ret_opt)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">return</span> ir_agent, task</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1core_1_1agents_html_a00d77a7e26fb89e8bd900f7b2a02982a"><div class="ttname"><a href="../../db/dcf/namespaceparlai_1_1core_1_1agents.html#a00d77a7e26fb89e8bd900f7b2a02982a">parlai.core.agents.create_agent</a></div><div class="ttdeci">def create_agent</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d5a/parlai_2core_2agents_8py_source.html#l00588">agents.py:588</a></div></div>
<div class="ttc" id="namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_html_a22eb017ecd8f1a211fc5aac511d3102e"><div class="ttname"><a href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a22eb017ecd8f1a211fc5aac511d3102e">parlai.mturk.tasks.wizard_of_wikipedia.run.setup_retriever</a></div><div class="ttdeci">def setup_retriever(opt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html#l00026">run.py:26</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a59836c3be93d4b491fa9ddecbb4e83c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59836c3be93d4b491fa9ddecbb4e83c0">&#9670;&nbsp;</a></span>setup_title_to_passage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.mturk.tasks.wizard_of_wikipedia.run.setup_title_to_passage </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>opt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html#l00038">38</a> of file <a class="el" href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html">run.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">def </span><a class="code" href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a59836c3be93d4b491fa9ddecbb4e83c0">setup_title_to_passage</a>(opt):</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    print(<span class="stringliteral">&#39;[ Setting up Title to Passage Dict ]&#39;</span>)</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    saved_dp = os.path.join(os.getcwd() + <span class="stringliteral">&#39;/data/&#39;</span>, <span class="stringliteral">&#39;title_to_passage.pkl&#39;</span>)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> os.path.exists(saved_dp):</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        print(<span class="stringliteral">&#39;[ Loading from saved location, {} ]&#39;</span>.<a class="code" href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">format</a>(saved_dp))</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        with open(saved_dp, <span class="stringliteral">&#39;rb&#39;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            title_to_passage = pickle.load(f)</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            <span class="keywordflow">return</span> title_to_passage</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    topics_path = <span class="stringliteral">&#39;{}/personas_with_wiki_links.txt&#39;</span>.<a class="code" href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">format</a>(os.getcwd())</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    topics = []</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    with open(topics_path) <span class="keyword">as</span> f:</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        text = f.read()</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        personas = text.split(<span class="stringliteral">&#39;\n\n&#39;</span>)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keywordflow">for</span> persona <span class="keywordflow">in</span> personas:</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            persona = persona.split(<span class="stringliteral">&#39;\n&#39;</span>)</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, len(persona)):</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                p_i = persona[i]</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                <span class="keywordflow">if</span> <span class="stringliteral">&#39;https&#39;</span> <span class="keywordflow">in</span> p_i:</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                    topic = unquote(p_i[p_i.rfind(<span class="stringliteral">&#39;/&#39;</span>) + 1 :]).replace(<span class="stringliteral">&#39;_&#39;</span>, <span class="stringliteral">&#39; &#39;</span>)</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                    topics.append(topic)</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    ordered_opt = opt.copy()</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    ordered_opt[<span class="stringliteral">&#39;datatype&#39;</span>] = <span class="stringliteral">&#39;train:ordered:stream&#39;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    ordered_opt[<span class="stringliteral">&#39;batchsize&#39;</span>] = 1</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    ordered_opt[<span class="stringliteral">&#39;numthreads&#39;</span>] = 1</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    ordered_opt[<span class="stringliteral">&#39;task&#39;</span>] = <span class="stringliteral">&#39;wikipedia:full:key-value&#39;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    teacher = <a class="code" href="../../db/dcf/namespaceparlai_1_1core_1_1agents.html#a76269fb567532a8fb7f29edcc20a6e47">create_task_agent_from_taskname</a>(ordered_opt)[0]</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    title_to_passage = {}</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    i = 0</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    length = teacher.num_episodes()</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    pbar = tqdm.tqdm(total=length)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">while</span> <span class="keywordflow">not</span> teacher.epoch_done():</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        pbar.update(1)</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        i += 1</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        action = teacher.act()</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        title = action[<span class="stringliteral">&#39;text&#39;</span>]</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">if</span> title <span class="keywordflow">in</span> topics:</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            text = action[<span class="stringliteral">&#39;labels&#39;</span>][0]</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            title_to_passage[title] = text</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    pbar.close()</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    print(<span class="stringliteral">&#39;[ Finished Building Title to Passage dict; saving now]&#39;</span>)</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    with open(saved_dp, <span class="stringliteral">&#39;wb&#39;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        pickle.dump(title_to_passage, f)</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">return</span> title_to_passage</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_html_a59836c3be93d4b491fa9ddecbb4e83c0"><div class="ttname"><a href="../../dc/d08/namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run.html#a59836c3be93d4b491fa9ddecbb4e83c0">parlai.mturk.tasks.wizard_of_wikipedia.run.setup_title_to_passage</a></div><div class="ttdeci">def setup_title_to_passage(opt)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d84/parlai_2mturk_2tasks_2wizard__of__wikipedia_2run_8py_source.html#l00038">run.py:38</a></div></div>
<div class="ttc" id="namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_html_a32e2e2022b824fbaf80c747160b52a76"><div class="ttname"><a href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">parlai.chat_service.services.messenger.shared_utils.format</a></div><div class="ttdeci">format</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/chat__service_2services_2messenger_2shared__utils_8py_source.html#l00029">shared_utils.py:29</a></div></div>
<div class="ttc" id="namespaceparlai_1_1core_1_1agents_html_a76269fb567532a8fb7f29edcc20a6e47"><div class="ttname"><a href="../../db/dcf/namespaceparlai_1_1core_1_1agents.html#a76269fb567532a8fb7f29edcc20a6e47">parlai.core.agents.create_task_agent_from_taskname</a></div><div class="ttdeci">def create_task_agent_from_taskname</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d5a/parlai_2core_2agents_8py_source.html#l00696">agents.py:696</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
