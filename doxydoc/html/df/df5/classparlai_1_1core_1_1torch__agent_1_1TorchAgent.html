<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParlAI: parlai.core.torch_agent.TorchAgent Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ParlAI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d5/d22/namespaceparlai.html">parlai</a></li><li class="navelem"><a class="el" href="../../d1/d43/namespaceparlai_1_1core.html">core</a></li><li class="navelem"><a class="el" href="../../d3/d36/namespaceparlai_1_1core_1_1torch__agent.html">torch_agent</a></li><li class="navelem"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html">TorchAgent</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="../../d4/d7e/classparlai_1_1core_1_1torch__agent_1_1TorchAgent-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">parlai.core.torch_agent.TorchAgent Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for parlai.core.torch_agent.TorchAgent:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d92/classparlai_1_1core_1_1torch__agent_1_1TorchAgent__inherit__graph.png" border="0" usemap="#parlai_8core_8torch__agent_8TorchAgent_inherit__map" alt="Inheritance graph"/></div>
<map name="parlai_8core_8torch__agent_8TorchAgent_inherit__map" id="parlai_8core_8torch__agent_8TorchAgent_inherit__map">
<area shape="rect" id="node5" href="../../d7/d5d/classparlai_1_1agents_1_1bert__ranker_1_1bert__ranker_1_1BertRankerAgent.html" title="parlai.agents.bert\l_ranker.bert_ranker.BertRanker\lAgent" alt="" coords="536,5,740,61"/>
<area shape="rect" id="node6" href="../../db/d93/classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent.html" title="parlai.agents.bert\l_ranker.both_encoder\l_ranker.BothEncoderRankerAgent" alt="" coords="528,85,748,141"/>
<area shape="rect" id="node7" href="../../d6/d25/classparlai_1_1agents_1_1test__agents_1_1dummy__torch__agent_1_1MockTorchAgent.html" title="parlai.agents.test\l_agents.dummy_torch\l_agent.MockTorchAgent" alt="" coords="556,165,720,221"/>
<area shape="rect" id="node8" href="../../de/da8/classparlai_1_1core_1_1torch__classifier__agent_1_1TorchClassifierAgent.html" title="parlai.core.torch_classifier\l_agent.TorchClassifierAgent" alt="" coords="545,246,731,287"/>
<area shape="rect" id="node11" href="../../d9/d5c/classparlai_1_1core_1_1torch__generator__agent_1_1TorchGeneratorAgent.html" title="parlai.core.torch_generator\l_agent.TorchGeneratorAgent" alt="" coords="543,311,733,353"/>
<area shape="rect" id="node20" href="../../d1/d2e/classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent.html" title="parlai.core.torch_ranker\l_agent.TorchRankerAgent" alt="" coords="551,534,725,575"/>
<area shape="rect" id="node33" href="../../d6/d9d/classparrot_1_1ParrotAgent.html" title="parrot.ParrotAgent" alt="" coords="574,600,702,627"/>
<area shape="rect" id="node34" href="../../d3/d24/classprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controllable__seq2seq_1_1ControllableSeq2seqAgent.html" title="projects.controllable\l_dialogue.controllable\l_seq2seq.controllable_seq2seq.\lControllableSeq2seqAgent" alt="" coords="534,651,742,722"/>
<area shape="rect" id="node3" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html" title="parlai.core.agents.Agent" alt="" coords="111,312,273,339"/>
<area shape="rect" id="node9" href="../../db/d02/classparlai_1_1agents_1_1bert__classifier_1_1bert__classifier_1_1BertClassifierAgent.html" title="parlai.agents.bert\l_classifier.bert_classifier.\lBertClassifierAgent" alt="" coords="837,67,1007,123"/>
<area shape="rect" id="node10" href="../../dd/df3/classparlai_1_1agents_1_1transformer_1_1transformer_1_1TransformerClassifierAgent.html" title="parlai.agents.transformer.transformer.\lTransformerClassifierAgent" alt="" coords="802,147,1042,189"/>
<area shape="rect" id="node12" href="../../d6/db2/classparlai_1_1agents_1_1seq2seq_1_1seq2seq_1_1Seq2seqAgent.html" title="parlai.agents.seq2seq.seq2seq.\lSeq2seqAgent" alt="" coords="819,213,1025,254"/>
<area shape="rect" id="node13" href="../../d5/d4a/classparlai_1_1agents_1_1transformer_1_1transformer_1_1TransformerGeneratorAgent.html" title="parlai.agents.transformer.transformer.\lTransformerGeneratorAgent" alt="" coords="802,278,1042,319"/>
<area shape="rect" id="node18" href="../../d2/d60/classtests_1_1test__ta__inheritence_1_1SubClassA.html" title="tests.test_ta_inheritence.\lSubClassA" alt="" coords="837,343,1007,385"/>
<area shape="rect" id="node14" href="../../d9/d0e/classparlai_1_1agents_1_1image__seq2seq_1_1image__seq2seq_1_1ImageSeq2seqAgent.html" title="parlai.agents.image\l_seq2seq.image_seq2seq.Image\lSeq2seqAgent" alt="" coords="1117,191,1331,247"/>
<area shape="rect" id="node15" href="../../d6/d18/classprojects_1_1wizard__of__wikipedia_1_1generator_1_1agents_1_1__GenericWizardAgent.html" title="projects.wizard_of\l_wikipedia.generator.agents.\l_GenericWizardAgent" alt="" coords="1130,271,1318,327"/>
<area shape="rect" id="node16" href="../../d0/d6a/classprojects_1_1wizard__of__wikipedia_1_1generator_1_1agents_1_1EndToEndAgent.html" title="projects.wizard_of\l_wikipedia.generator.agents.\lEndToEndAgent" alt="" coords="1421,231,1609,287"/>
<area shape="rect" id="node17" href="../../d8/d61/classprojects_1_1wizard__of__wikipedia_1_1generator_1_1agents_1_1TwoStageAgent.html" title="projects.wizard_of\l_wikipedia.generator.agents.\lTwoStageAgent" alt="" coords="1421,311,1609,367"/>
<area shape="rect" id="node19" href="../../d1/dd5/classtests_1_1test__ta__inheritence_1_1SubClassB.html" title="tests.test_ta_inheritence.\lSubClassB" alt="" coords="1139,351,1309,393"/>
<area shape="rect" id="node21" href="../../d7/db9/classparlai_1_1agents_1_1bert__ranker_1_1bi__encoder__ranker_1_1BiEncoderRankerAgent.html" title="parlai.agents.bert\l_ranker.bi_encoder_ranker.\lBiEncoderRankerAgent" alt="" coords="833,409,1011,465"/>
<area shape="rect" id="node22" href="../../da/dd7/classparlai_1_1agents_1_1bert__ranker_1_1cross__encoder__ranker_1_1CrossEncoderRankerAgent.html" title="parlai.agents.bert\l_ranker.cross_encoder\l_ranker.CrossEncoderRankerAgent" alt="" coords="808,489,1036,545"/>
<area shape="rect" id="node23" href="../../d4/d7a/classparlai_1_1agents_1_1memnn_1_1memnn_1_1MemnnAgent.html" title="parlai.agents.memnn.memnn.\lMemnnAgent" alt="" coords="825,570,1019,611"/>
<area shape="rect" id="node24" href="../../d3/db8/classparlai_1_1agents_1_1transformer_1_1biencoder_1_1AddLabelFixedCandsTRA.html" title="parlai.agents.transformer.biencoder.\lAddLabelFixedCandsTRA" alt="" coords="807,635,1037,677"/>
<area shape="rect" id="node27" href="../../db/dd9/classparlai_1_1agents_1_1transformer_1_1crossencoder_1_1CrossencoderAgent.html" title="parlai.agents.transformer.crossencoder.\lCrossencoderAgent" alt="" coords="796,701,1048,742"/>
<area shape="rect" id="node28" href="../../d0/df1/classparlai_1_1agents_1_1transformer_1_1polyencoder_1_1PolyencoderAgent.html" title="parlai.agents.transformer.polyencoder.\lPolyencoderAgent" alt="" coords="800,766,1044,807"/>
<area shape="rect" id="node29" href="../../d9/d8b/classparlai_1_1agents_1_1transformer_1_1transformer_1_1TransformerRankerAgent.html" title="parlai.agents.transformer.transformer.\lTransformerRankerAgent" alt="" coords="802,831,1042,873"/>
<area shape="rect" id="node25" href="../../d4/d8e/classparlai_1_1agents_1_1transformer_1_1biencoder_1_1IRFriendlyBiencoderAgent.html" title="parlai.agents.transformer.biencoder.\lIRFriendlyBiencoderAgent" alt="" coords="1400,698,1631,739"/>
<area shape="rect" id="node26" href="../../d1/d2d/classparlai_1_1agents_1_1transformer_1_1polyencoder_1_1IRFriendlyPolyencoderAgent.html" title="parlai.agents.transformer.polyencoder.\lIRFriendlyPolyencoderAgent" alt="" coords="1102,695,1346,737"/>
<area shape="rect" id="node30" href="../../d2/d76/classparlai_1_1agents_1_1transformer_1_1biencoder_1_1BiencoderAgent.html" title="parlai.agents.transformer.biencoder.\lBiencoderAgent" alt="" coords="1109,762,1339,803"/>
<area shape="rect" id="node31" href="../../d3/d7d/classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent.html" title="projects.self_feeding.self\l_feeding_agent.SelfFeedingAgent" alt="" coords="1115,830,1333,871"/>
<area shape="rect" id="node32" href="../../dc/dfb/classprojects_1_1wizard__of__wikipedia_1_1wizard__transformer__ranker_1_1wizard__transformer__rad02f16524e5e0423aa3e2c69e1330ee1.html" title="projects.wizard_of\l_wikipedia.wizard_transformer\l_ranker.wizard_transformer\l_ranker.WizardTransformerRankerAgent" alt="" coords="1096,895,1352,966"/>
</map>
<center><span class="legend">[<a href="../../graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for parlai.core.torch_agent.TorchAgent:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d85/classparlai_1_1core_1_1torch__agent_1_1TorchAgent__coll__graph.png" border="0" usemap="#parlai_8core_8torch__agent_8TorchAgent_coll__map" alt="Collaboration graph"/></div>
<map name="parlai_8core_8torch__agent_8TorchAgent_coll__map" id="parlai_8core_8torch__agent_8TorchAgent_coll__map">
<area shape="rect" id="node3" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html" title="parlai.core.agents.Agent" alt="" coords="80,80,243,107"/>
</map>
<center><span class="legend">[<a href="../../graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9c622b8ed5a811841f30fe98cc297cde"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a9c622b8ed5a811841f30fe98cc297cde">optim_opts</a> (self)</td></tr>
<tr class="separator:a9c622b8ed5a811841f30fe98cc297cde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bd9118252c602bb9d5a596ecae16717"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a0bd9118252c602bb9d5a596ecae16717">history_class</a> (cls)</td></tr>
<tr class="separator:a0bd9118252c602bb9d5a596ecae16717"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a72bdd07d2cb5ce402d0058140cad0d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a4a72bdd07d2cb5ce402d0058140cad0d">add_cmdline_args</a> (cls, argparser)</td></tr>
<tr class="separator:a4a72bdd07d2cb5ce402d0058140cad0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc9c818413b776a498c2bcc0bfe3c6f7"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#afc9c818413b776a498c2bcc0bfe3c6f7">__init__</a></td></tr>
<tr class="separator:afc9c818413b776a498c2bcc0bfe3c6f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab22f61f153b522f429210c61eed2d5af"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#ab22f61f153b522f429210c61eed2d5af">build_history</a> (self)</td></tr>
<tr class="separator:ab22f61f153b522f429210c61eed2d5af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a233316f9ec2805dd6a08fbf07f3a078a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a233316f9ec2805dd6a08fbf07f3a078a">build_dictionary</a> (self)</td></tr>
<tr class="separator:a233316f9ec2805dd6a08fbf07f3a078a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a21fa33fa5b2b928024fbc67826f233"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a9a21fa33fa5b2b928024fbc67826f233">build_model</a> (self)</td></tr>
<tr class="separator:a9a21fa33fa5b2b928024fbc67826f233"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3784f1ddaa6ffad009716910f3f36dd4"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a3784f1ddaa6ffad009716910f3f36dd4">init_optim</a> (self, params, optim_states=None, saved_optim_type=None)</td></tr>
<tr class="separator:a3784f1ddaa6ffad009716910f3f36dd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa51ac42dc34e3d2281a01cba78a96151"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#aa51ac42dc34e3d2281a01cba78a96151">build_lr_scheduler</a> (self, states=None, hard_reset=False)</td></tr>
<tr class="separator:aa51ac42dc34e3d2281a01cba78a96151"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac694770cd4022eb047bf6fbb8f46035c"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#ac694770cd4022eb047bf6fbb8f46035c">report</a> (self)</td></tr>
<tr class="separator:ac694770cd4022eb047bf6fbb8f46035c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02beaaedfa30463f9d0a97ea590b516f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a02beaaedfa30463f9d0a97ea590b516f">receive_metrics</a> (self, metrics_dict)</td></tr>
<tr class="separator:a02beaaedfa30463f9d0a97ea590b516f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a373f0e276bf7c9d914a4e3363e9c2712"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a373f0e276bf7c9d914a4e3363e9c2712">share</a> (self)</td></tr>
<tr class="separator:a373f0e276bf7c9d914a4e3363e9c2712"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48bb9b153353a0565ab7253dc1daef99"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a48bb9b153353a0565ab7253dc1daef99">vectorize</a> (self, obs, <a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a0484b0246f0a930adc575899cdef033c">history</a>, add_start=True, add_end=True, <a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#ae3a69ecb5f20ce4f8a09c05c5f6f4376">text_truncate</a>=None, <a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#adbdd7cf2deb2c43d982c57852b83e685">label_truncate</a>=None)</td></tr>
<tr class="separator:a48bb9b153353a0565ab7253dc1daef99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa491bf2384b017711ad722b5341b405"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#afa491bf2384b017711ad722b5341b405">is_valid</a> (self, obs)</td></tr>
<tr class="separator:afa491bf2384b017711ad722b5341b405"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c5824776df0c6cf995984a5e7a3f433"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a4c5824776df0c6cf995984a5e7a3f433">batchify</a> (self, obs_batch, sort=False)</td></tr>
<tr class="separator:a4c5824776df0c6cf995984a5e7a3f433"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba56b961d929e5c5b5da9cf8bd331502"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#aba56b961d929e5c5b5da9cf8bd331502">match_batch</a> (self, batch_reply, valid_inds, output=None)</td></tr>
<tr class="separator:aba56b961d929e5c5b5da9cf8bd331502"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87b18f0d6ab11be3c49375af072d0d33"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a87b18f0d6ab11be3c49375af072d0d33">observe</a> (self, <a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a4bc525b20568822a042b3bbfa3da3a69">observation</a>)</td></tr>
<tr class="separator:a87b18f0d6ab11be3c49375af072d0d33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a663cb0d6a276495d03aacdb8b9c79fb0"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a663cb0d6a276495d03aacdb8b9c79fb0">self_observe</a></td></tr>
<tr class="separator:a663cb0d6a276495d03aacdb8b9c79fb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f89e606931a4622a5c6a6f6b832235c"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a9f89e606931a4622a5c6a6f6b832235c">state_dict</a> (self)</td></tr>
<tr class="separator:a9f89e606931a4622a5c6a6f6b832235c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adac7ee3db855786e8414e9f35fcb6e46"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#adac7ee3db855786e8414e9f35fcb6e46">save</a> (self, path=None)</td></tr>
<tr class="separator:adac7ee3db855786e8414e9f35fcb6e46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dcfca62a677f8de97f09ce993258f84"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a5dcfca62a677f8de97f09ce993258f84">load_state_dict</a> (self, <a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a9f89e606931a4622a5c6a6f6b832235c">state_dict</a>)</td></tr>
<tr class="separator:a5dcfca62a677f8de97f09ce993258f84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac345f2da892d35d9f4921e0acf5594c8"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#ac345f2da892d35d9f4921e0acf5594c8">load</a></td></tr>
<tr class="separator:ac345f2da892d35d9f4921e0acf5594c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f568650dd8e245a274671680ebb7587"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a6f568650dd8e245a274671680ebb7587">reset</a> (self)</td></tr>
<tr class="separator:a6f568650dd8e245a274671680ebb7587"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03e18955cfd44dd019d0847bc7a46893"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a03e18955cfd44dd019d0847bc7a46893">reset_metrics</a> (self)</td></tr>
<tr class="separator:a03e18955cfd44dd019d0847bc7a46893"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51174dfa508970e3392246b02d0d94b5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a51174dfa508970e3392246b02d0d94b5">act</a> (self)</td></tr>
<tr class="separator:a51174dfa508970e3392246b02d0d94b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7754a74d6c87590f46e71ec486c285a8"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a7754a74d6c87590f46e71ec486c285a8">batch_act</a> (self, observations)</td></tr>
<tr class="separator:a7754a74d6c87590f46e71ec486c285a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ba9d535736c0af100d00c5e7b02b61b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a8ba9d535736c0af100d00c5e7b02b61b">train_step</a> (self, batch)</td></tr>
<tr class="separator:a8ba9d535736c0af100d00c5e7b02b61b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18de0a52aeec4ef721aedbdd6ac06cad"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a18de0a52aeec4ef721aedbdd6ac06cad">eval_step</a> (self, batch)</td></tr>
<tr class="separator:a18de0a52aeec4ef721aedbdd6ac06cad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a7aff29231816a0f3cade9c72409dfc"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a6a7aff29231816a0f3cade9c72409dfc">set_interactive_mode</a> (self, mode, shared)</td></tr>
<tr class="separator:a6a7aff29231816a0f3cade9c72409dfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8df662b1258ec67752b4fc0ad45733f9"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a8df662b1258ec67752b4fc0ad45733f9">backward</a> (self, loss)</td></tr>
<tr class="separator:a8df662b1258ec67752b4fc0ad45733f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e2c9e180887397daa6229a0f9700b1c"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a7e2c9e180887397daa6229a0f9700b1c">update_params</a> (self)</td></tr>
<tr class="separator:a7e2c9e180887397daa6229a0f9700b1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91c163f3e2d39b380095b7083f673b6e"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a91c163f3e2d39b380095b7083f673b6e">zero_grad</a> (self)</td></tr>
<tr class="separator:a91c163f3e2d39b380095b7083f673b6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classparlai_1_1core_1_1agents_1_1Agent')"><img src="../../closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html">parlai.core.agents.Agent</a></td></tr>
<tr class="memitem:ade454c86dc623c46d218ca5544d49596 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#ade454c86dc623c46d218ca5544d49596">__init__</a></td></tr>
<tr class="separator:ade454c86dc623c46d218ca5544d49596 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98041e2d186aa81bd5e1649a91f623bc inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#a98041e2d186aa81bd5e1649a91f623bc">observe</a> (self, <a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#aedbecc4b4aa7af7413882a0429e0f1db">observation</a>)</td></tr>
<tr class="separator:a98041e2d186aa81bd5e1649a91f623bc inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a8abe0a98dd59bc39c9f12b163072db inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#a6a8abe0a98dd59bc39c9f12b163072db">act</a> (self)</td></tr>
<tr class="separator:a6a8abe0a98dd59bc39c9f12b163072db inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29e1cdd729ac4236f8bae90b2e66fa04 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#a29e1cdd729ac4236f8bae90b2e66fa04">getID</a> (self)</td></tr>
<tr class="separator:a29e1cdd729ac4236f8bae90b2e66fa04 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40157e237ea85d75ebc3fd248c7a1a1b inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#a40157e237ea85d75ebc3fd248c7a1a1b">epoch_done</a> (self)</td></tr>
<tr class="separator:a40157e237ea85d75ebc3fd248c7a1a1b inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27cb8206372681605b00dc28b81a7c39 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#a27cb8206372681605b00dc28b81a7c39">reset</a> (self)</td></tr>
<tr class="separator:a27cb8206372681605b00dc28b81a7c39 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaefcbd7c61d319b368b3ee13997c8c99 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#aaefcbd7c61d319b368b3ee13997c8c99">reset_metrics</a> (self)</td></tr>
<tr class="separator:aaefcbd7c61d319b368b3ee13997c8c99 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51e706e3e5389c9b48c7a1589d97ec99 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#a51e706e3e5389c9b48c7a1589d97ec99">save</a> (self, path=None)</td></tr>
<tr class="separator:a51e706e3e5389c9b48c7a1589d97ec99 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2525db5bdd19a3bf5b0669bfa158f9ff inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#a2525db5bdd19a3bf5b0669bfa158f9ff">clone</a> (self)</td></tr>
<tr class="separator:a2525db5bdd19a3bf5b0669bfa158f9ff inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbbb06bf0f46ff927c8b186726a68b47 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#afbbb06bf0f46ff927c8b186726a68b47">share</a> (self)</td></tr>
<tr class="separator:afbbb06bf0f46ff927c8b186726a68b47 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a801e5ca2a5e8e96a72f0c04549008e8f inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#a801e5ca2a5e8e96a72f0c04549008e8f">shutdown</a> (self)</td></tr>
<tr class="separator:a801e5ca2a5e8e96a72f0c04549008e8f inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6e5ea0357c43169d97b329566a33ee5 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#ad6e5ea0357c43169d97b329566a33ee5">upgrade_opt</a></td></tr>
<tr class="separator:ad6e5ea0357c43169d97b329566a33ee5 inherit pub_methods_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:aea8849fa69a3f5dbd3216c8b06f180ea"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#aea8849fa69a3f5dbd3216c8b06f180ea">dictionary_class</a> ()</td></tr>
<tr class="separator:aea8849fa69a3f5dbd3216c8b06f180ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a10b8d2605e619d5d3dc9f67777cb190a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a10b8d2605e619d5d3dc9f67777cb190a">use_cuda</a></td></tr>
<tr class="separator:a10b8d2605e619d5d3dc9f67777cb190a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6f916e01d876679b529a893ad4f52f6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#aa6f916e01d876679b529a893ad4f52f6">fp16</a></td></tr>
<tr class="separator:aa6f916e01d876679b529a893ad4f52f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abebf29c0bb956bbc5ccc02777d2af3dd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#abebf29c0bb956bbc5ccc02777d2af3dd">dict</a></td></tr>
<tr class="separator:abebf29c0bb956bbc5ccc02777d2af3dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a785bb920cf8c8afc3e9bf6a8b77e335a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a785bb920cf8c8afc3e9bf6a8b77e335a">opt</a></td></tr>
<tr class="separator:a785bb920cf8c8afc3e9bf6a8b77e335a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe40410d2e3b2565ecd27441266011fc"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#afe40410d2e3b2565ecd27441266011fc">model</a></td></tr>
<tr class="separator:afe40410d2e3b2565ecd27441266011fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13d46ae8aed6052679b62c3961a4de62"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a13d46ae8aed6052679b62c3961a4de62">criterion</a></td></tr>
<tr class="separator:a13d46ae8aed6052679b62c3961a4de62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a392ed66573001dfa2846d5042e8fc5a5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a392ed66573001dfa2846d5042e8fc5a5">metrics</a></td></tr>
<tr class="separator:a392ed66573001dfa2846d5042e8fc5a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ac66a09c1c164ea08f4b257c61c38a0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a4ac66a09c1c164ea08f4b257c61c38a0">id</a></td></tr>
<tr class="separator:a4ac66a09c1c164ea08f4b257c61c38a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a80083f0e34d8abc15b50123efec884"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a3a80083f0e34d8abc15b50123efec884">EMPTY</a></td></tr>
<tr class="separator:a3a80083f0e34d8abc15b50123efec884"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95cedd561757c9fc10dbf3a956e7f912"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a95cedd561757c9fc10dbf3a956e7f912">NULL_IDX</a></td></tr>
<tr class="separator:a95cedd561757c9fc10dbf3a956e7f912"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2018afae9938937f80b61475314012cd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a2018afae9938937f80b61475314012cd">START_IDX</a></td></tr>
<tr class="separator:a2018afae9938937f80b61475314012cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31bb7c8bf380660ee4e3822756563599"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a31bb7c8bf380660ee4e3822756563599">END_IDX</a></td></tr>
<tr class="separator:a31bb7c8bf380660ee4e3822756563599"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ca476189900643fab04d1ac0ebfc719"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a1ca476189900643fab04d1ac0ebfc719">random</a></td></tr>
<tr class="separator:a1ca476189900643fab04d1ac0ebfc719"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15cbb1f743c1d341d914ade47e49071b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a15cbb1f743c1d341d914ade47e49071b">histsz</a></td></tr>
<tr class="separator:a15cbb1f743c1d341d914ade47e49071b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ae27e9fe68d255a960bcb5180f48a65"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a3ae27e9fe68d255a960bcb5180f48a65">truncate</a></td></tr>
<tr class="separator:a3ae27e9fe68d255a960bcb5180f48a65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3a69ecb5f20ce4f8a09c05c5f6f4376"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#ae3a69ecb5f20ce4f8a09c05c5f6f4376">text_truncate</a></td></tr>
<tr class="separator:ae3a69ecb5f20ce4f8a09c05c5f6f4376"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbdd7cf2deb2c43d982c57852b83e685"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#adbdd7cf2deb2c43d982c57852b83e685">label_truncate</a></td></tr>
<tr class="separator:adbdd7cf2deb2c43d982c57852b83e685"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0484b0246f0a930adc575899cdef033c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a0484b0246f0a930adc575899cdef033c">history</a></td></tr>
<tr class="separator:a0484b0246f0a930adc575899cdef033c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0bd6456c94dfd9afae73b86f05016cf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#ab0bd6456c94dfd9afae73b86f05016cf">is_training</a></td></tr>
<tr class="separator:ab0bd6456c94dfd9afae73b86f05016cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6355b9b0c0ccb24ffe1b5e3d89903cc3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a6355b9b0c0ccb24ffe1b5e3d89903cc3">rank_candidates</a></td></tr>
<tr class="separator:a6355b9b0c0ccb24ffe1b5e3d89903cc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63011fa9bd927de8acc9ffa676caa73a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a63011fa9bd927de8acc9ffa676caa73a">add_person_tokens</a></td></tr>
<tr class="separator:a63011fa9bd927de8acc9ffa676caa73a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9533344de40049bf13209739bc92199d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a9533344de40049bf13209739bc92199d">optimizer</a></td></tr>
<tr class="separator:a9533344de40049bf13209739bc92199d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54d8632c546ab621c93c34f13c964726"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a54d8632c546ab621c93c34f13c964726">warmup_scheduler</a></td></tr>
<tr class="separator:a54d8632c546ab621c93c34f13c964726"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0affe6b199275c182a27c9aa07393347"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a0affe6b199275c182a27c9aa07393347">scheduler</a></td></tr>
<tr class="separator:a0affe6b199275c182a27c9aa07393347"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a805a9e47552d54d56f5b232ab4d5121f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a805a9e47552d54d56f5b232ab4d5121f">proj_rp</a></td></tr>
<tr class="separator:a805a9e47552d54d56f5b232ab4d5121f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bc525b20568822a042b3bbfa3da3a69"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a4bc525b20568822a042b3bbfa3da3a69">observation</a></td></tr>
<tr class="separator:a4bc525b20568822a042b3bbfa3da3a69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_attribs_classparlai_1_1core_1_1agents_1_1Agent"><td colspan="2" onclick="javascript:toggleInherit('pub_attribs_classparlai_1_1core_1_1agents_1_1Agent')"><img src="../../closed.png" alt="-"/>&#160;Public Attributes inherited from <a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html">parlai.core.agents.Agent</a></td></tr>
<tr class="memitem:ac00c13f4c7dd1263bf9203fa96dd2366 inherit pub_attribs_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#ac00c13f4c7dd1263bf9203fa96dd2366">id</a></td></tr>
<tr class="separator:ac00c13f4c7dd1263bf9203fa96dd2366 inherit pub_attribs_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3b45d2754244608c75d4068b90cd051 inherit pub_attribs_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#ab3b45d2754244608c75d4068b90cd051">opt</a></td></tr>
<tr class="separator:ab3b45d2754244608c75d4068b90cd051 inherit pub_attribs_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedbecc4b4aa7af7413882a0429e0f1db inherit pub_attribs_classparlai_1_1core_1_1agents_1_1Agent"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d4b/classparlai_1_1core_1_1agents_1_1Agent.html#aedbecc4b4aa7af7413882a0429e0f1db">observation</a></td></tr>
<tr class="separator:aedbecc4b4aa7af7413882a0429e0f1db inherit pub_attribs_classparlai_1_1core_1_1agents_1_1Agent"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a292c402279f706390ffed9a7af868abf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a292c402279f706390ffed9a7af868abf">P1_TOKEN</a></td></tr>
<tr class="separator:a292c402279f706390ffed9a7af868abf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81b5bf5acfa70764e3601c14a8afae85"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/df5/classparlai_1_1core_1_1torch__agent_1_1TorchAgent.html#a81b5bf5acfa70764e3601c14a8afae85">P2_TOKEN</a></td></tr>
<tr class="separator:a81b5bf5acfa70764e3601c14a8afae85"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">A provided abstract base agent for any model that wants to use Torch.

Exists to make it easier to implement a new agent.
Not necessary, but reduces duplicated code.

Many methods are intended to be either used as is when the default is
acceptable, or to be overriden and called with super(), with the extra
functionality added to the initial result. See the method comment for
recommended behavior.

This agent serves as a common framework for all ParlAI models which want
to use PyTorch.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00314">314</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="afc9c818413b776a498c2bcc0bfe3c6f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc9c818413b776a498c2bcc0bfe3c6f7">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>opt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00644">644</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keyword">def </span>__init__(self, opt: Opt, shared=<span class="keywordtype">None</span>):</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="stringliteral">        Initialize agent.</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        super().__init__(opt, shared)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        opt = self.opt</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="comment"># Safety checkers to ensure TorchAgent assumptions aren&#39;t being violated.</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        self.__expecting_clear_history = <span class="keyword">False</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        self.__expecting_to_reply = <span class="keyword">False</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="comment"># check for cuda</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        self.use_cuda = <span class="keywordflow">not</span> opt[<span class="stringliteral">&#39;no_cuda&#39;</span>] <span class="keywordflow">and</span> torch.cuda.is_available()</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">if</span> self.use_cuda:</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> shared:</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                print(<span class="stringliteral">&#39;[ Using CUDA ]&#39;</span>)</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> shared <span class="keywordflow">and</span> opt[<span class="stringliteral">&#39;gpu&#39;</span>] != -1:</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                torch.cuda.set_device(opt[<span class="stringliteral">&#39;gpu&#39;</span>])</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="comment"># indicate whether using fp16</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        self.fp16 = self.use_cuda <span class="keywordflow">and</span> self.opt.get(<span class="stringliteral">&#39;fp16&#39;</span>, <span class="keyword">False</span>)</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">if</span> shared <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            <span class="comment"># intitialize any important structures from scratch</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            self.dict = self.build_dictionary()</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            <span class="keywordflow">if</span> opt.get(<span class="stringliteral">&#39;fp16&#39;</span>):</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                <span class="comment"># Volta cores revert to FP32 hardware if tensors are not multiples</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                <span class="comment"># of 8 in all dimensions. This INCLUDES the embeddings layer! As</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <span class="comment"># such, we need some extra magic to ensure the dictionary is padded</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                <span class="comment"># with extra tokens to make it a multiple of 8.</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="keywordflow">if</span> len(self.dict) % 8 != 0:</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(8 - len(self.dict) % 8):</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                        self.dict[<span class="stringliteral">&#39;__FP16_PAD_{}__&#39;</span>.<a class="code" href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">format</a>(i)] = 1</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            self.metrics: Dict[str, Any] = {}</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            <span class="comment"># gradient norms</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            self.metrics[<span class="stringliteral">&#39;gnorm&#39;</span>] = 0.0</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <span class="comment"># gradient clipping rate</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            self.metrics[<span class="stringliteral">&#39;clip&#39;</span>] = 0.0</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="comment"># number of calls to optimizer.step()</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            self.metrics[<span class="stringliteral">&#39;updates&#39;</span>] = 0</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <span class="comment"># copy initialized data from shared table</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            self.opt = shared[<span class="stringliteral">&#39;opt&#39;</span>]</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            self.dict = shared[<span class="stringliteral">&#39;dict&#39;</span>]</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            self.model = shared[<span class="stringliteral">&#39;model&#39;</span>]</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            self.criterion = shared[<span class="stringliteral">&#39;criterion&#39;</span>]</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            self.metrics = shared[<span class="stringliteral">&#39;metrics&#39;</span>]</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">if</span> opt.get(<span class="stringliteral">&#39;numthreads&#39;</span>, 1) &gt; 1:</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            torch.set_num_threads(1)</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="comment"># Default to the class name, sans &quot;Agent&quot;. child can override</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        self.id = <a class="code" href="../../d4/da3/namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf.html#ad5dfae268e23f506da084a9efb72f619">type</a>(self).__name__.replace(<span class="stringliteral">&quot;Agent&quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="comment"># now set up any fields that all instances may need</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        self.EMPTY = torch.zeros(0, dtype=torch.long)</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        self.NULL_IDX = self.dict[self.dict.null_token]</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        self.START_IDX = self.dict[self.dict.start_token]</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        self.END_IDX = self.dict[self.dict.end_token]</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="comment"># for gradient acumulation</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        self._number_grad_accum = 0</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="comment"># for the LR scheduler</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        self._number_training_updates = 0</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="comment"># fixed random seed</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        self.random = random.Random(42)</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="comment"># can remember as few as zero utterances if desired</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        self.histsz = opt[<span class="stringliteral">&#39;history_size&#39;</span>]</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="comment"># truncate == 0 might give funny behavior</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        self.truncate = opt[<span class="stringliteral">&#39;truncate&#39;</span>] <span class="keywordflow">if</span> opt[<span class="stringliteral">&#39;truncate&#39;</span>] &gt;= 0 <span class="keywordflow">else</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        text_truncate = opt.get(<span class="stringliteral">&#39;text_truncate&#39;</span>) <span class="keywordflow">or</span> opt[<span class="stringliteral">&#39;truncate&#39;</span>]</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        self.text_truncate = text_truncate <span class="keywordflow">if</span> text_truncate &gt;= 0 <span class="keywordflow">else</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        label_truncate = opt.get(<span class="stringliteral">&#39;label_truncate&#39;</span>) <span class="keywordflow">or</span> opt[<span class="stringliteral">&#39;truncate&#39;</span>]</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        self.label_truncate = label_truncate <span class="keywordflow">if</span> label_truncate &gt;= 0 <span class="keywordflow">else</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="comment"># stores up to hist_utt past observations within current dialog</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        self.history = self.build_history()</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        self.is_training = <span class="keyword">False</span>  <span class="comment"># track whether model is training</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        self.rank_candidates = opt[<span class="stringliteral">&#39;rank_candidates&#39;</span>]</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        self.add_person_tokens = opt.get(<span class="stringliteral">&#39;person_tokens&#39;</span>, <span class="keyword">False</span>)</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="comment"># set interactive mode or not according to options.</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        self.set_interactive_mode(opt[<span class="stringliteral">&#39;interactive_mode&#39;</span>], shared)</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_html_ad5dfae268e23f506da084a9efb72f619"><div class="ttname"><a href="../../d4/da3/namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf.html#ad5dfae268e23f506da084a9efb72f619">parlai.agents.tfidf_retriever.build_tfidf.type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition:</b> <a href="../../df/de8/build__tfidf_8py_source.html#l00339">build_tfidf.py:339</a></div></div>
<div class="ttc" id="namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_html_a32e2e2022b824fbaf80c747160b52a76"><div class="ttname"><a href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">parlai.chat_service.services.messenger.shared_utils.format</a></div><div class="ttdeci">format</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/chat__service_2services_2messenger_2shared__utils_8py_source.html#l00029">shared_utils.py:29</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a51174dfa508970e3392246b02d0d94b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51174dfa508970e3392246b02d0d94b5">&#9670;&nbsp;</a></span>act()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.act </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Call batch_act with the singleton batch.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01798">1798</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <span class="keyword">def </span>act(self):</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="stringliteral">        Call batch_act with the singleton batch.</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        <span class="comment"># BatchWorld handles calling self_observe, but we&#39;re in a Hogwild or Interactive</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        <span class="comment"># world, so we need to handle this ourselves.</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        response = self.batch_act([self.observation])[0]</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        self.self_observe(response)</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="keywordflow">return</span> response</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a4a72bdd07d2cb5ce402d0058140cad0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a72bdd07d2cb5ce402d0058140cad0d">&#9670;&nbsp;</a></span>add_cmdline_args()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.add_cmdline_args </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>cls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>argparser</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Add the default commandline args we expect most agents to want.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00387">387</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keyword">def </span><a class="code" href="../../d3/d7d/namespaceparlai_1_1agents_1_1drqa_1_1config.html#a62fdd5554f1da6be0cba185271058320">add_cmdline_args</a>(cls, argparser):</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="stringliteral">        Add the default commandline args we expect most agents to want.</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        agent = argparser.add_argument_group(<span class="stringliteral">&#39;TorchAgent Arguments&#39;</span>)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <span class="stringliteral">&#39;-i&#39;</span>,</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="stringliteral">&#39;--interactive-mode&#39;</span>,</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            type=<span class="stringliteral">&#39;bool&#39;</span>,</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            default=<span class="keyword">False</span>,</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            help=<span class="stringliteral">&#39;Whether in full interactive mode or not,  which means generating text or&#39;</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="stringliteral">&#39; retrieving from a full set of candidates, which is necessary to actually&#39;</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="stringliteral">&#39; do full dialogue. However, during training or quick validation (e.g. PPL for&#39;</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="stringliteral">&#39; generation or ranking a few candidates for ranking models) you might want these&#39;</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="stringliteral">&#39; set to off.&#39;</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="stringliteral">&#39; Typically, scripts can set their preferred default behavior at the start,&#39;</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="stringliteral">&#39; e.g. eval scripts.&#39;</span>,</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        )</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="comment"># pretrained embedding arguments</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <span class="stringliteral">&#39;-emb&#39;</span>,</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="stringliteral">&#39;--embedding-type&#39;</span>,</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            default=<span class="stringliteral">&#39;random&#39;</span>,</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            choices=[</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                <span class="stringliteral">&#39;random&#39;</span>,</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                <span class="stringliteral">&#39;glove&#39;</span>,</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                <span class="stringliteral">&#39;glove-fixed&#39;</span>,</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                <span class="stringliteral">&#39;glove-twitter-fixed&#39;</span>,</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                <span class="stringliteral">&#39;fasttext&#39;</span>,</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <span class="stringliteral">&#39;fasttext-fixed&#39;</span>,</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                <span class="stringliteral">&#39;fasttext_cc&#39;</span>,</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                <span class="stringliteral">&#39;fasttext_cc-fixed&#39;</span>,</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            ],</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            help=<span class="stringliteral">&#39;Choose between different strategies for initializing word &#39;</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="stringliteral">&#39;embeddings. Default is random, but can also preinitialize &#39;</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="stringliteral">&#39;from Glove or Fasttext. Preinitialized embeddings can also &#39;</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="stringliteral">&#39;be fixed so they are not updated during training.&#39;</span>,</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        )</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="stringliteral">&#39;-embp&#39;</span>,</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="stringliteral">&#39;--embedding-projection&#39;</span>,</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            default=<span class="stringliteral">&#39;random&#39;</span>,</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            help=<span class="stringliteral">&#39;If pretrained embeddings have a different dimensionality &#39;</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="stringliteral">&#39;than your embedding size, strategy for projecting to the &#39;</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="stringliteral">&#39;correct size. If the dimensions are the same, this is &#39;</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <span class="stringliteral">&#39;ignored unless you append &quot;-force&quot; to your choice.&#39;</span>,</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        )</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="stringliteral">&#39;--fp16&#39;</span>, type=<span class="stringliteral">&#39;bool&#39;</span>, default=<span class="keyword">False</span>, help=<span class="stringliteral">&#39;Use fp16 computations.&#39;</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        )</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="comment"># optimizer arguments</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        optim_group = agent.add_argument_group(<span class="stringliteral">&#39;Optimizer Arguments&#39;</span>)</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        optim_group.add_argument(</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="stringliteral">&#39;-opt&#39;</span>,</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <span class="stringliteral">&#39;--optimizer&#39;</span>,</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            default=<span class="stringliteral">&#39;sgd&#39;</span>,</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            choices=cls.optim_opts(),</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            help=<span class="stringliteral">&#39;Choose between pytorch optimizers. Any member of torch.optim&#39;</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <span class="stringliteral">&#39; should be valid.&#39;</span>,</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        )</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        optim_group.add_argument(</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="stringliteral">&#39;-lr&#39;</span>, <span class="stringliteral">&#39;--learningrate&#39;</span>, type=float, default=1, help=<span class="stringliteral">&#39;Learning rate&#39;</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        )</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        optim_group.add_argument(</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <span class="stringliteral">&#39;-clip&#39;</span>,</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="stringliteral">&#39;--gradient-clip&#39;</span>,</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            type=float,</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            default=0.1,</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            help=<span class="stringliteral">&#39;gradient clipping using l2 norm&#39;</span>,</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        )</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        optim_group.add_argument(</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="stringliteral">&#39;--adam-eps&#39;</span>,</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            type=float,</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            default=1e-8,</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            hidden=<span class="keyword">True</span>,</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            help=<span class="stringliteral">&#39;Epsilon value for Adam optimizers. Set to 1e-6 if your &#39;</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <span class="stringliteral">&#39;large model has stability issues, but prefer the default.&#39;</span>,</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        )</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        optim_group.add_argument(</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="stringliteral">&#39;-mom&#39;</span>,</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="stringliteral">&#39;--momentum&#39;</span>,</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            default=0,</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            type=float,</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            help=<span class="stringliteral">&#39;if applicable, momentum value for optimizer.&#39;</span>,</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        )</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        optim_group.add_argument(</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="stringliteral">&#39;--nesterov&#39;</span>,</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            default=<span class="keyword">True</span>,</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            type=<span class="stringliteral">&#39;bool&#39;</span>,</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            help=<span class="stringliteral">&#39;if applicable, whether to use nesterov momentum.&#39;</span>,</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        )</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        optim_group.add_argument(</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="stringliteral">&#39;-nu&#39;</span>,</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <span class="stringliteral">&#39;--nus&#39;</span>,</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            default=<span class="stringliteral">&#39;0.7&#39;</span>,</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            type=<span class="stringliteral">&#39;floats&#39;</span>,</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            help=<span class="stringliteral">&#39;if applicable, nu value(s) for optimizer. can use a single &#39;</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="stringliteral">&#39;value like 0.7 or a comma-separated tuple like 0.7,1.0&#39;</span>,</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        )</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        optim_group.add_argument(</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="stringliteral">&#39;-beta&#39;</span>,</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="stringliteral">&#39;--betas&#39;</span>,</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            default=<span class="stringliteral">&#39;0.9,0.999&#39;</span>,</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            type=<span class="stringliteral">&#39;floats&#39;</span>,</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            help=<span class="stringliteral">&#39;if applicable, beta value(s) for optimizer. can use a single &#39;</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="stringliteral">&#39;value like 0.9 or a comma-separated tuple like 0.9,0.999&#39;</span>,</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        )</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        optim_group.add_argument(</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="stringliteral">&#39;-wdecay&#39;</span>,</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            <span class="stringliteral">&#39;--weight-decay&#39;</span>,</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            type=float,</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            default=<span class="keywordtype">None</span>,</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            help=<span class="stringliteral">&#39;Weight decay on the weights.&#39;</span>,</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        )</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="comment"># lr scheduler</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        lr_group = agent.add_argument_group(<span class="stringliteral">&#39;Learning Rate Scheduler&#39;</span>)</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        lr_group.add_argument(</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <span class="stringliteral">&#39;--lr-scheduler&#39;</span>,</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            type=str,</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            default=<span class="stringliteral">&#39;reduceonplateau&#39;</span>,</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            choices=[<span class="stringliteral">&#39;reduceonplateau&#39;</span>, <span class="stringliteral">&#39;none&#39;</span>, <span class="stringliteral">&#39;fixed&#39;</span>, <span class="stringliteral">&#39;invsqrt&#39;</span>],</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            help=<span class="stringliteral">&#39;Learning rate scheduler.&#39;</span>,</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        )</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        lr_group.add_argument(</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <span class="stringliteral">&#39;--lr-scheduler-patience&#39;</span>,</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            type=int,</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            default=3,</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            help=<span class="stringliteral">&#39;LR scheduler patience. In number of validation runs. If using &#39;</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="stringliteral">&#39;fixed scheduler, LR is decayed every &lt;patience&gt; validations.&#39;</span>,</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        )</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        lr_group.add_argument(</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <span class="stringliteral">&#39;--lr-scheduler-decay&#39;</span>,</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            type=float,</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            default=0.5,</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            help=<span class="stringliteral">&#39;Decay factor for LR scheduler, or how much LR is multiplied by &#39;</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="stringliteral">&#39;when it is lowered.&#39;</span>,</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        )</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        lr_group.add_argument(</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="stringliteral">&#39;--warmup-updates&#39;</span>,</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            type=int,</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            default=-1,</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            hidden=<span class="keyword">True</span>,</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            help=<span class="stringliteral">&#39;Learning rate warmup period, in number of SGD updates. &#39;</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="stringliteral">&#39;Linearly scales up LR over period. Only enabled if &gt; 0.&#39;</span>,</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        )</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        lr_group.add_argument(</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="stringliteral">&#39;--warmup-rate&#39;</span>,</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            type=float,</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            default=1e-4,</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            hidden=<span class="keyword">True</span>,</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            help=<span class="stringliteral">&#39;Warmup learning rate *multiplier*. Initial LR is multiplied by &#39;</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="stringliteral">&#39;this value. Linearly adjusted up to 1.0 across --warmup-updates &#39;</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <span class="stringliteral">&#39;steps.&#39;</span>,</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        )</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        lr_group.add_argument(</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="stringliteral">&#39;--update-freq&#39;</span>,</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            type=int,</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            default=1,</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            hidden=<span class="keyword">True</span>,</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            help=<span class="stringliteral">&#39;Accumulate gradients N times before performing an optimizer.step().&#39;</span>,</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        )</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="comment"># preprocessing arguments</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <span class="stringliteral">&#39;-rc&#39;</span>,</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <span class="stringliteral">&#39;--rank-candidates&#39;</span>,</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            type=<span class="stringliteral">&#39;bool&#39;</span>,</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            default=<span class="keyword">False</span>,</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            help=<span class="stringliteral">&#39;Whether the model should parse candidates for ranking.&#39;</span>,</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        )</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="stringliteral">&#39;-tr&#39;</span>,</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            <span class="stringliteral">&#39;--truncate&#39;</span>,</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            default=-1,</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            type=int,</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            help=<span class="stringliteral">&#39;Truncate input lengths to increase speed / use less memory.&#39;</span>,</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        )</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <span class="stringliteral">&#39;--text-truncate&#39;</span>,</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            type=int,</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            help=<span class="stringliteral">&#39;Text input truncation length: if not specified, this will &#39;</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <span class="stringliteral">&#39;default to `truncate`&#39;</span>,</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        )</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <span class="stringliteral">&#39;--label-truncate&#39;</span>,</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            type=int,</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            help=<span class="stringliteral">&#39;Label truncation length: if not specified, this will default &#39;</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="stringliteral">&#39;to `truncate`&#39;</span>,</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        )</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="stringliteral">&#39;-histsz&#39;</span>,</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="stringliteral">&#39;--history-size&#39;</span>,</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            default=-1,</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            type=int,</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            help=<span class="stringliteral">&#39;Number of past dialog utterances to remember.&#39;</span>,</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        )</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <span class="stringliteral">&#39;-pt&#39;</span>,</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <span class="stringliteral">&#39;--person-tokens&#39;</span>,</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            type=<span class="stringliteral">&#39;bool&#39;</span>,</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            default=<span class="keyword">False</span>,</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            help=<span class="stringliteral">&#39;add person tokens to history. adds __p1__ in front of input &#39;</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="stringliteral">&#39;text and __p2__ in front of past labels when available or &#39;</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            <span class="stringliteral">&#39;past utterances generated by the model. these are added to &#39;</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            <span class="stringliteral">&#39;the dictionary during initialization.&#39;</span>,</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        )</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="stringliteral">&#39;--split-lines&#39;</span>,</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            type=<span class="stringliteral">&#39;bool&#39;</span>,</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            default=<span class="keyword">False</span>,</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            help=<span class="stringliteral">&#39;split the dialogue history on newlines and save in separate &#39;</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <span class="stringliteral">&#39;vectors&#39;</span>,</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        )</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="stringliteral">&#39;--use-reply&#39;</span>,</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            default=<span class="stringliteral">&#39;label&#39;</span>,</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            hidden=<span class="keyword">True</span>,</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            choices=[<span class="stringliteral">&#39;label&#39;</span>, <span class="stringliteral">&#39;model&#39;</span>, <span class="stringliteral">&#39;none&#39;</span>],</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            help=<span class="stringliteral">&#39;Which previous replies to use as history. If label, use &#39;</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="stringliteral">&#39;gold dataset replies. If model, use model\&#39;s own replies. &#39;</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            <span class="stringliteral">&#39;If none, do not track replies in history.&#39;</span>,</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        )</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="stringliteral">&#39;--add-p1-after-newln&#39;</span>,</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            type=<span class="stringliteral">&#39;bool&#39;</span>,</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            default=<span class="keyword">False</span>,</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            hidden=<span class="keyword">True</span>,</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            help=<span class="stringliteral">&#39;Add the other speaker token before the last newline in the &#39;</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="stringliteral">&#39;input instead of at the beginning of the input. this is &#39;</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="stringliteral">&#39;useful for tasks that include some kind of context before &#39;</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <span class="stringliteral">&#39;the actual utterance (e.g. squad, babi, personachat).&#39;</span>,</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        )</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        agent.add_argument(</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="stringliteral">&#39;--delimiter&#39;</span>,</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            type=str,</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            default=<span class="stringliteral">&#39;\n&#39;</span>,</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            help=<span class="stringliteral">&#39;Join history lines with this token, defaults to newline&#39;</span>,</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        )</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="comment"># GPU arguments</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="comment"># these gpu options are all mutually exclusive, and should error if the</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="comment"># user tries to present multiple of them</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        gpugroup = agent.add_mutually_exclusive_group()</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        gpugroup.add_argument(</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="stringliteral">&#39;-gpu&#39;</span>, <span class="stringliteral">&#39;--gpu&#39;</span>, type=int, default=-1, help=<span class="stringliteral">&#39;which GPU to use&#39;</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        )</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        gpugroup.add_argument(</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="stringliteral">&#39;--no-cuda&#39;</span>,</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            default=<span class="keyword">False</span>,</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            action=<span class="stringliteral">&#39;store_true&#39;</span>,</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            dest=<span class="stringliteral">&#39;no_cuda&#39;</span>,</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            help=<span class="stringliteral">&#39;disable GPUs even if available. otherwise, will use GPUs if &#39;</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="stringliteral">&#39;available on the device.&#39;</span>,</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        )</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        cls.dictionary_class().<a class="code" href="../../d3/d7d/namespaceparlai_1_1agents_1_1drqa_1_1config.html#a62fdd5554f1da6be0cba185271058320">add_cmdline_args</a>(argparser)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1agents_1_1drqa_1_1config_html_a62fdd5554f1da6be0cba185271058320"><div class="ttname"><a href="../../d3/d7d/namespaceparlai_1_1agents_1_1drqa_1_1config.html#a62fdd5554f1da6be0cba185271058320">parlai.agents.drqa.config.add_cmdline_args</a></div><div class="ttdeci">def add_cmdline_args(parser)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/deb/config_8py_source.html#l00010">config.py:10</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8df662b1258ec67752b4fc0ad45733f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8df662b1258ec67752b4fc0ad45733f9">&#9670;&nbsp;</a></span>backward()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.backward </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>loss</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Perform a backward pass.

It is recommended you use this instead of loss.backward(), for integration with
distributed training and FP16 training.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01868">1868</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <span class="keyword">def </span>backward(self, loss):</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="stringliteral">        Perform a backward pass.</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="stringliteral">        It is recommended you use this instead of loss.backward(), for integration with</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="stringliteral">        distributed training and FP16 training.</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <span class="keywordflow">if</span> self.opt.get(<span class="stringliteral">&#39;update_freq&#39;</span>, 1) &gt; 1:</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;            <span class="comment"># gradient accumulation, but still need to average across the minibatches</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;            loss = loss / self.opt[<span class="stringliteral">&#39;update_freq&#39;</span>]</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        <span class="keywordflow">if</span> self.fp16:</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;            self.optimizer.backward(loss, update_master_grads=<span class="keyword">False</span>)</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;            loss.backward()</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a7754a74d6c87590f46e71ec486c285a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7754a74d6c87590f46e71ec486c285a8">&#9670;&nbsp;</a></span>batch_act()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.batch_act </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>observations</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Process a batch of observations (batchsize list of message dicts).

These observations have been preprocessed by the observe method.

Subclasses can override this for special functionality, but if the
default behaviors are fine then just override the ``train_step`` and
``eval_step`` methods instead. The former is called when labels are
present in the observations batch; otherwise, the latter is called.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01808">1808</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="keyword">def </span>batch_act(self, observations):</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="stringliteral">        Process a batch of observations (batchsize list of message dicts).</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="stringliteral">        These observations have been preprocessed by the observe method.</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="stringliteral">        Subclasses can override this for special functionality, but if the</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="stringliteral">        default behaviors are fine then just override the ``train_step`` and</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="stringliteral">        ``eval_step`` methods instead. The former is called when labels are</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="stringliteral">        present in the observations batch; otherwise, the latter is called.</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        batch_size = len(observations)</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        <span class="comment"># initialize a list of replies with this agent&#39;s id</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        batch_reply = [</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;            Message({<span class="stringliteral">&#39;id&#39;</span>: self.getID(), <span class="stringliteral">&#39;episode_done&#39;</span>: <span class="keyword">False</span>})</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;            <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(batch_size)</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        ]</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        <span class="comment"># check if there are any labels available, if so we will train on them</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        self.is_training = any(<span class="stringliteral">&#39;labels&#39;</span> <span class="keywordflow">in</span> obs <span class="keywordflow">for</span> obs <span class="keywordflow">in</span> observations)</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        <span class="comment"># create a batch from the vectors</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        batch = self.batchify(observations)</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        <span class="keywordflow">if</span> self.is_training:</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;            output = self.train_step(batch)</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;            with torch.no_grad():</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;                <span class="comment"># save memory and compute by disabling autograd.</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                <span class="comment"># use `with torch.enable_grad()` to gain back graidients.</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                output = self.eval_step(batch)</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        <span class="keywordflow">if</span> output <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;            <span class="keywordflow">return</span> batch_reply</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        self.match_batch(batch_reply, batch.valid_indices, output)</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        <span class="keywordflow">return</span> batch_reply</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a4c5824776df0c6cf995984a5e7a3f433"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c5824776df0c6cf995984a5e7a3f433">&#9670;&nbsp;</a></span>batchify()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.batchify </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>obs_batch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sort</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Create a batch of valid observations from an unchecked batch.

A valid observation is one that passes the lambda provided to the
function, which defaults to checking if the preprocessed 'text_vec'
field is present which would have been set by this agent's 'vectorize'
function.

Returns a namedtuple Batch. See original definition above for in-depth
explanation of each field.

If you want to include additonal fields in the batch, you can subclass
this function and return your own "Batch" namedtuple: copy the Batch
namedtuple at the top of this class, and then add whatever additional
fields that you want to be able to access. You can then call
super().batchify(...) to set up the original fields and then set up the
additional fields in your subclass and return that batch instead.

:param obs_batch:
    List of vectorized observations

:param sort:
    Default False, orders the observations by length of vectors. Set to
    true when using torch.nn.utils.rnn.pack_padded_sequence.  Uses the text
    vectors if available, otherwise uses the label vectors if available.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01422">1422</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keyword">def </span><a class="code" href="../../d6/d5b/namespaceparlai_1_1agents_1_1drqa_1_1utils.html#aca22dd97c5b6dcda2a7479c1cb22ef1e">batchify</a>(self, obs_batch, sort=False):</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="stringliteral">        Create a batch of valid observations from an unchecked batch.</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="stringliteral">        A valid observation is one that passes the lambda provided to the</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="stringliteral">        function, which defaults to checking if the preprocessed &#39;text_vec&#39;</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="stringliteral">        field is present which would have been set by this agent&#39;s &#39;vectorize&#39;</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="stringliteral">        function.</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="stringliteral">        Returns a namedtuple Batch. See original definition above for in-depth</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="stringliteral">        explanation of each field.</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="stringliteral">        If you want to include additonal fields in the batch, you can subclass</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="stringliteral">        this function and return your own &quot;Batch&quot; namedtuple: copy the Batch</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="stringliteral">        namedtuple at the top of this class, and then add whatever additional</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="stringliteral">        fields that you want to be able to access. You can then call</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="stringliteral">        super().batchify(...) to set up the original fields and then set up the</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="stringliteral">        additional fields in your subclass and return that batch instead.</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="stringliteral">        :param obs_batch:</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="stringliteral">            List of vectorized observations</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="stringliteral">        :param sort:</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="stringliteral">            Default False, orders the observations by length of vectors. Set to</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="stringliteral">            true when using torch.nn.utils.rnn.pack_padded_sequence.  Uses the text</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="stringliteral">            vectors if available, otherwise uses the label vectors if available.</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <span class="keywordflow">if</span> len(obs_batch) == 0:</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../db/d30/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1.html#a74cfde390a2b9861179ac0fcd59da28c">Batch</a>()</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        valid_obs = [(i, ex) <span class="keywordflow">for</span> i, ex <span class="keywordflow">in</span> enumerate(obs_batch) <span class="keywordflow">if</span> self.is_valid(ex)]</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        <span class="keywordflow">if</span> len(valid_obs) == 0:</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../db/d30/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1.html#a74cfde390a2b9861179ac0fcd59da28c">Batch</a>()</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        valid_inds, exs = zip(*valid_obs)</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        <span class="comment"># TEXT</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        xs, x_lens = <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        <span class="keywordflow">if</span> any(ex.get(<span class="stringliteral">&#39;text_vec&#39;</span>) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs):</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;            _xs = [ex.get(<span class="stringliteral">&#39;text_vec&#39;</span>, self.EMPTY) <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs]</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;            xs, x_lens = <a class="code" href="../../d7/d87/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1.html#adb5a414ae439f14c54e8c760b91cc4c8">padded_tensor</a>(</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                _xs, self.NULL_IDX, self.use_cuda, fp16friendly=self.opt.get(<span class="stringliteral">&#39;fp16&#39;</span>)</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            )</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;            <span class="keywordflow">if</span> sort:</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                sort = <span class="keyword">False</span>  <span class="comment"># now we won&#39;t sort on labels</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                xs, x_lens, valid_inds, exs = <a class="code" href="../../d7/d87/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1.html#a1521e559b740f741ebb47b8755202bb2">argsort</a>(</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                    x_lens, xs, x_lens, valid_inds, exs, descending=<span class="keyword">True</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                )</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        <span class="comment"># LABELS</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        labels_avail = any(<span class="stringliteral">&#39;labels_vec&#39;</span> <span class="keywordflow">in</span> ex <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs)</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        some_labels_avail = labels_avail <span class="keywordflow">or</span> any(<span class="stringliteral">&#39;eval_labels_vec&#39;</span> <span class="keywordflow">in</span> ex <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs)</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        ys, y_lens, labels = <span class="keywordtype">None</span>, <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <span class="keywordflow">if</span> some_labels_avail:</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;            field = <span class="stringliteral">&#39;labels&#39;</span> <span class="keywordflow">if</span> labels_avail <span class="keywordflow">else</span> <span class="stringliteral">&#39;eval_labels&#39;</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            label_vecs = [ex.get(field + <span class="stringliteral">&#39;_vec&#39;</span>, self.EMPTY) <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs]</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            labels = [ex.get(field + <span class="stringliteral">&#39;_choice&#39;</span>) <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs]</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;            y_lens = [y.shape[0] <span class="keywordflow">for</span> y <span class="keywordflow">in</span> label_vecs]</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;            ys, y_lens = <a class="code" href="../../d7/d87/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1.html#adb5a414ae439f14c54e8c760b91cc4c8">padded_tensor</a>(</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                label_vecs,</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                self.NULL_IDX,</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                self.use_cuda,</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                fp16friendly=self.opt.get(<span class="stringliteral">&#39;fp16&#39;</span>),</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            )</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            <span class="keywordflow">if</span> sort <span class="keywordflow">and</span> xs <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;                ys, valid_inds, label_vecs, labels, y_lens = <a class="code" href="../../d7/d87/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1.html#a1521e559b740f741ebb47b8755202bb2">argsort</a>(</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                    y_lens, ys, valid_inds, label_vecs, labels, y_lens, descending=<span class="keyword">True</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                )</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        <span class="comment"># LABEL_CANDIDATES</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        cands, cand_vecs = <span class="keywordtype">None</span>, <span class="keywordtype">None</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <span class="keywordflow">if</span> any(<span class="stringliteral">&#39;label_candidates_vecs&#39;</span> <span class="keywordflow">in</span> ex <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs):</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            cands = [ex.get(<span class="stringliteral">&#39;label_candidates&#39;</span>, <span class="keywordtype">None</span>) <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs]</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            cand_vecs = [ex.get(<span class="stringliteral">&#39;label_candidates_vecs&#39;</span>, <span class="keywordtype">None</span>) <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs]</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        <span class="comment"># IMAGE</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        imgs = <span class="keywordtype">None</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        <span class="keywordflow">if</span> any(<span class="stringliteral">&#39;image&#39;</span> <span class="keywordflow">in</span> ex <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs):</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;            imgs = [ex.get(<span class="stringliteral">&#39;image&#39;</span>, <span class="keywordtype">None</span>) <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> exs]</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../db/d30/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1.html#a74cfde390a2b9861179ac0fcd59da28c">Batch</a>(</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;            text_vec=xs,</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;            text_lengths=x_lens,</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;            label_vec=ys,</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;            label_lengths=y_lens,</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;            labels=labels,</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;            valid_indices=valid_inds,</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;            candidates=cands,</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;            candidate_vecs=cand_vecs,</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            image=imgs,</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;            observations=exs,</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        )</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1_html_a1521e559b740f741ebb47b8755202bb2"><div class="ttname"><a href="../../d7/d87/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1.html#a1521e559b740f741ebb47b8755202bb2">parlai.agents.legacy_agents.seq2seq.utils_v1.argsort</a></div><div class="ttdeci">def argsort(keys, lists, descending=False)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd4/utils__v1_8py_source.html#l00105">utils_v1.py:105</a></div></div>
<div class="ttc" id="namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1_html_adb5a414ae439f14c54e8c760b91cc4c8"><div class="ttname"><a href="../../d7/d87/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1.html#adb5a414ae439f14c54e8c760b91cc4c8">parlai.agents.legacy_agents.seq2seq.utils_v1.padded_tensor</a></div><div class="ttdeci">def padded_tensor(items, pad_idx=0, use_cuda=False, left_padded=False, max_len=None)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd4/utils__v1_8py_source.html#l00041">utils_v1.py:41</a></div></div>
<div class="ttc" id="namespaceparlai_1_1agents_1_1drqa_1_1utils_html_aca22dd97c5b6dcda2a7479c1cb22ef1e"><div class="ttname"><a href="../../d6/d5b/namespaceparlai_1_1agents_1_1drqa_1_1utils.html#aca22dd97c5b6dcda2a7479c1cb22ef1e">parlai.agents.drqa.utils.batchify</a></div><div class="ttdeci">def batchify(batch, null=0, cuda=False)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/parlai_2agents_2drqa_2utils_8py_source.html#l00124">utils.py:124</a></div></div>
<div class="ttc" id="namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_html_a74cfde390a2b9861179ac0fcd59da28c"><div class="ttname"><a href="../../db/d30/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1.html#a74cfde390a2b9861179ac0fcd59da28c">parlai.agents.legacy_agents.seq2seq.torch_agent_v1.Batch</a></div><div class="ttdeci">Batch</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddc/torch__agent__v1_8py_source.html#l00077">torch_agent_v1.py:77</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a233316f9ec2805dd6a08fbf07f3a078a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a233316f9ec2805dd6a08fbf07f3a078a">&#9670;&nbsp;</a></span>build_dictionary()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.build_dictionary </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return the constructed dictionary, which will be set to self.dict.

If you need to add additional tokens to the dictionary, this is likely the right
place to do it.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00741">741</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keyword">def </span>build_dictionary(self):</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="stringliteral">        Return the constructed dictionary, which will be set to self.dict.</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="stringliteral">        If you need to add additional tokens to the dictionary, this is likely the right</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="stringliteral">        place to do it.</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        d = self.dictionary_class()(self.opt)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span> self.opt.get(<span class="stringliteral">&#39;person_tokens&#39;</span>):</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            d[self.P1_TOKEN] = 999_999_999</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            d[self.P2_TOKEN] = 999_999_998</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">return</span> d</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="ab22f61f153b522f429210c61eed2d5af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab22f61f153b522f429210c61eed2d5af">&#9670;&nbsp;</a></span>build_history()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.build_history </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return the constructed history object.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00728">728</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keyword">def </span>build_history(self):</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="stringliteral">        Return the constructed history object.</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">return</span> self.history_class()(</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            self.opt,</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            maxlen=self.text_truncate,</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            size=self.histsz,</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            p1_token=self.P1_TOKEN,</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            p2_token=self.P2_TOKEN,</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            dict_agent=self.dict,</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        )</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="aa51ac42dc34e3d2281a01cba78a96151"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa51ac42dc34e3d2281a01cba78a96151">&#9670;&nbsp;</a></span>build_lr_scheduler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.build_lr_scheduler </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>states</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>hard_reset</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Create the learning rate scheduler, and assign it to self.scheduler.

This scheduler will be updated upon a call to receive_metrics.
May also create self.warmup_scheduler, if appropriate.

:param state_dict states: Possible state_dict provided by model
    checkpoint, for restoring LR state

:param bool hard_reset: If true, the LR scheduler should ignore the
    state dictionary.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00884">884</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keyword">def </span>build_lr_scheduler(self, states=None, hard_reset=False):</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="stringliteral">        Create the learning rate scheduler, and assign it to self.scheduler.</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="stringliteral">        This scheduler will be updated upon a call to receive_metrics.</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="stringliteral">        May also create self.warmup_scheduler, if appropriate.</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="stringliteral">        :param state_dict states: Possible state_dict provided by model</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="stringliteral">            checkpoint, for restoring LR state</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="stringliteral">        :param bool hard_reset: If true, the LR scheduler should ignore the</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="stringliteral">            state dictionary.</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="comment"># first make sure there are no null pointers</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="keywordflow">if</span> states <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            states = {}</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        optimizer = self.optimizer</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="keywordflow">if</span> self.fp16:</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            <span class="comment"># lr schedulers don&#39;t work with apex, they expect the &quot;real&quot; optimizer</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            optimizer = optimizer.optimizer</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        warmup_updates = self.opt.get(<span class="stringliteral">&#39;warmup_updates&#39;</span>, -1)</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        updates_so_far = states.get(<span class="stringliteral">&#39;number_training_updates&#39;</span>, 0)</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">if</span> warmup_updates &gt; 0 <span class="keywordflow">and</span> (updates_so_far &lt; warmup_updates <span class="keywordflow">or</span> hard_reset):</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            <span class="keyword">def </span>_warmup_lr(step):</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                start = self.opt[<span class="stringliteral">&#39;warmup_rate&#39;</span>]</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                end = 1.0</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                progress = min(1.0, step / self.opt[<span class="stringliteral">&#39;warmup_updates&#39;</span>])</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                lr_mult = start + (end - start) * progress</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                <span class="keywordflow">return</span> lr_mult</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            self.warmup_scheduler = optim.lr_scheduler.LambdaLR(optimizer, _warmup_lr)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            self.warmup_scheduler = <span class="keywordtype">None</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        patience = self.opt.get(<span class="stringliteral">&#39;lr_scheduler_patience&#39;</span>, 3)</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        decay = self.opt.get(<span class="stringliteral">&#39;lr_scheduler_decay&#39;</span>, 0.5)</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="keywordflow">if</span> self.opt.get(<span class="stringliteral">&#39;lr_scheduler&#39;</span>) == <span class="stringliteral">&#39;none&#39;</span>:</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            self.scheduler = <span class="keywordtype">None</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="keywordflow">elif</span> decay == 1.0:</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <a class="code" href="../../d7/db6/namespaceparlai_1_1utils_1_1misc.html#a884a3aefa90581f53bc592fa6a78dc43">warn_once</a>(</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                <span class="stringliteral">&quot;Your LR decay is set to 1.0. Assuming you meant you wanted &quot;</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                <span class="stringliteral">&quot;to disable learning rate scheduling. Adjust --lr-scheduler-decay &quot;</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                <span class="stringliteral">&quot;if this is not correct.&quot;</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            )</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            self.scheduler = <span class="keywordtype">None</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">elif</span> self.opt.get(<span class="stringliteral">&#39;lr_scheduler&#39;</span>) == <span class="stringliteral">&#39;reduceonplateau&#39;</span>:</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            self.scheduler = optim.lr_scheduler.ReduceLROnPlateau(</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                optimizer, <span class="stringliteral">&#39;min&#39;</span>, factor=decay, patience=patience, verbose=<span class="keyword">True</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            )</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        <span class="keywordflow">elif</span> self.opt.get(<span class="stringliteral">&#39;lr_scheduler&#39;</span>) == <span class="stringliteral">&#39;fixed&#39;</span>:</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            self.scheduler = optim.lr_scheduler.StepLR(optimizer, patience, gamma=decay)</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="keywordflow">elif</span> self.opt.get(<span class="stringliteral">&#39;lr_scheduler&#39;</span>) == <span class="stringliteral">&#39;invsqrt&#39;</span>:</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="keywordflow">if</span> self.opt.get(<span class="stringliteral">&#39;warmup_updates&#39;</span>, -1) &lt;= 0:</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                <span class="keywordflow">raise</span> ValueError(</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                    <span class="stringliteral">&#39;--lr-scheduler invsqrt requires setting --warmup-updates&#39;</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                )</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            warmup_updates = self.opt[<span class="stringliteral">&#39;warmup_updates&#39;</span>]</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            decay_factor = np.sqrt(max(1, warmup_updates))</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            <span class="keyword">def </span>_invsqrt_lr(step):</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                <span class="keywordflow">return</span> decay_factor / np.sqrt(max(1, step))</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            self.scheduler = optim.lr_scheduler.LambdaLR(optimizer, _invsqrt_lr)</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <span class="keywordflow">raise</span> ValueError(</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                <span class="stringliteral">&quot;Don&#39;t know what to do with lr_scheduler &#39;{}&#39;&quot;</span>.<a class="code" href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">format</a>(</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                    self.opt.get(<span class="stringliteral">&#39;lr_scheduler&#39;</span>)</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                )</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            )</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="comment"># time to load LR state from the checkpoint, if possible.</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="keywordflow">if</span> (</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            <span class="comment"># there is already an old LR scheduler saved on disk</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            states</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <span class="keywordflow">and</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <span class="comment"># and the old LR scheduler is different</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            states.get(<span class="stringliteral">&#39;lr_scheduler_type&#39;</span>) != self.opt[<span class="stringliteral">&#39;lr_scheduler&#39;</span>]</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            <span class="keywordflow">and</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            <span class="comment"># and we&#39;re not already using a fresh scheduler</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            <span class="keywordflow">not</span> hard_reset</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        ):</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            <span class="comment"># the LR scheduler changed, start things fresh</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <a class="code" href="../../d7/db6/namespaceparlai_1_1utils_1_1misc.html#a884a3aefa90581f53bc592fa6a78dc43">warn_once</a>(<span class="stringliteral">&quot;LR scheduler is different from saved. Starting fresh!&quot;</span>)</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            hard_reset = <span class="keyword">True</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordflow">if</span> hard_reset:</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            <span class="comment"># We&#39;re not going to use the LR schedule, let&#39;s just exit</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="comment"># do the actual loading (if possible)</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;number_training_updates&#39;</span> <span class="keywordflow">in</span> states:</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            self._number_training_updates = states[<span class="stringliteral">&#39;number_training_updates&#39;</span>]</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="keywordflow">if</span> self.scheduler <span class="keywordflow">and</span> <span class="stringliteral">&#39;lr_scheduler&#39;</span> <span class="keywordflow">in</span> states:</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            self.scheduler.load_state_dict(states[<span class="stringliteral">&#39;lr_scheduler&#39;</span>])</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="keywordflow">if</span> states.get(<span class="stringliteral">&#39;warmup_scheduler&#39;</span>) <span class="keywordflow">and</span> getattr(self, <span class="stringliteral">&#39;warmup_scheduler&#39;</span>, <span class="keywordtype">None</span>):</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            self.warmup_scheduler.load_state_dict(states[<span class="stringliteral">&#39;warmup_scheduler&#39;</span>])</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1utils_1_1misc_html_a884a3aefa90581f53bc592fa6a78dc43"><div class="ttname"><a href="../../d7/db6/namespaceparlai_1_1utils_1_1misc.html#a884a3aefa90581f53bc592fa6a78dc43">parlai.utils.misc.warn_once</a></div><div class="ttdeci">def warn_once</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d02/misc_8py_source.html#l00813">misc.py:813</a></div></div>
<div class="ttc" id="namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_html_a32e2e2022b824fbaf80c747160b52a76"><div class="ttname"><a href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">parlai.chat_service.services.messenger.shared_utils.format</a></div><div class="ttdeci">format</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/chat__service_2services_2messenger_2shared__utils_8py_source.html#l00029">shared_utils.py:29</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9a21fa33fa5b2b928024fbc67826f233"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a21fa33fa5b2b928024fbc67826f233">&#9670;&nbsp;</a></span>build_model()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.build_model </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Construct the model and return it.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00793">793</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keyword">def </span>build_model(self):</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="stringliteral">        Construct the model and return it.</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">raise</span> NotImplementedError(<span class="stringliteral">&#39;not implemented for this class&#39;</span>)</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="aea8849fa69a3f5dbd3216c8b06f180ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea8849fa69a3f5dbd3216c8b06f180ea">&#9670;&nbsp;</a></span>dictionary_class()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.dictionary_class </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Return the dictionary class that this agent expects to use.

Can be overriden if a more complex dictionary is required.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00369">369</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keyword">def </span>dictionary_class():</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="stringliteral">        Return the dictionary class that this agent expects to use.</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="stringliteral">        Can be overriden if a more complex dictionary is required.</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordflow">return</span> DictionaryAgent</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a18de0a52aeec4ef721aedbdd6ac06cad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18de0a52aeec4ef721aedbdd6ac06cad">&#9670;&nbsp;</a></span>eval_step()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.eval_step </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>batch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">[Abstract] Process one batch but do not train on it.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01854">1854</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    <span class="keyword">def </span>eval_step(self, batch):</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="stringliteral">        [Abstract] Process one batch but do not train on it.</span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        <span class="keywordflow">pass</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a0bd9118252c602bb9d5a596ecae16717"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bd9118252c602bb9d5a596ecae16717">&#9670;&nbsp;</a></span>history_class()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.history_class </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>cls</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return the history class that this agent expects to use.

Can be overriden if a more complex history is required.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00378">378</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keyword">def </span>history_class(cls):</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="stringliteral">        Return the history class that this agent expects to use.</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="stringliteral">        Can be overriden if a more complex history is required.</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">return</span> History</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a3784f1ddaa6ffad009716910f3f36dd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3784f1ddaa6ffad009716910f3f36dd4">&#9670;&nbsp;</a></span>init_optim()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.init_optim </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>optim_states</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>saved_optim_type</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Initialize optimizer with model parameters.

:param params:
    parameters from the model

:param optim_states:
    optional argument providing states of optimizer to load

:param saved_optim_type:
    type of optimizer being loaded, if changed will skip loading
    optimizer states
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00799">799</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keyword">def </span>init_optim(self, params, optim_states=None, saved_optim_type=None):</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="stringliteral">        Initialize optimizer with model parameters.</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="stringliteral">        :param params:</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="stringliteral">            parameters from the model</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="stringliteral">        :param optim_states:</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="stringliteral">            optional argument providing states of optimizer to load</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="stringliteral">        :param saved_optim_type:</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="stringliteral">            type of optimizer being loaded, if changed will skip loading</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="stringliteral">            optimizer states</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        opt = self.opt</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="comment"># set up optimizer args</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        lr = opt[<span class="stringliteral">&#39;learningrate&#39;</span>]</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        kwargs = {<span class="stringliteral">&#39;lr&#39;</span>: lr}</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">if</span> opt.get(<span class="stringliteral">&#39;weight_decay&#39;</span>):</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            kwargs[<span class="stringliteral">&#39;weight_decay&#39;</span>] = opt[<span class="stringliteral">&#39;weight_decay&#39;</span>]</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="keywordflow">if</span> opt.get(<span class="stringliteral">&#39;momentum&#39;</span>) &gt; 0 <span class="keywordflow">and</span> opt[<span class="stringliteral">&#39;optimizer&#39;</span>] <span class="keywordflow">in</span> [<span class="stringliteral">&#39;sgd&#39;</span>, <span class="stringliteral">&#39;rmsprop&#39;</span>, <span class="stringliteral">&#39;qhm&#39;</span>]:</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <span class="comment"># turn on momentum for optimizers that use it</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            kwargs[<span class="stringliteral">&#39;momentum&#39;</span>] = opt[<span class="stringliteral">&#39;momentum&#39;</span>]</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            <span class="keywordflow">if</span> opt[<span class="stringliteral">&#39;optimizer&#39;</span>] == <span class="stringliteral">&#39;sgd&#39;</span> <span class="keywordflow">and</span> opt.get(<span class="stringliteral">&#39;nesterov&#39;</span>, <span class="keyword">True</span>):</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                <span class="comment"># for sgd, maybe nesterov</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                kwargs[<span class="stringliteral">&#39;nesterov&#39;</span>] = opt.get(<span class="stringliteral">&#39;nesterov&#39;</span>, <span class="keyword">True</span>)</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <span class="keywordflow">elif</span> opt[<span class="stringliteral">&#39;optimizer&#39;</span>] == <span class="stringliteral">&#39;qhm&#39;</span>:</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                <span class="comment"># qhm needs a nu</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                kwargs[<span class="stringliteral">&#39;nu&#39;</span>] = opt.get(<span class="stringliteral">&#39;nus&#39;</span>, (0.7,))[0]</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keywordflow">elif</span> opt[<span class="stringliteral">&#39;optimizer&#39;</span>] == <span class="stringliteral">&#39;adam&#39;</span>:</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <span class="comment"># turn on amsgrad for adam</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            <span class="comment"># amsgrad paper: https://openreview.net/forum?id=ryQu7f-RZ</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            kwargs[<span class="stringliteral">&#39;amsgrad&#39;</span>] = <span class="keyword">True</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">elif</span> opt[<span class="stringliteral">&#39;optimizer&#39;</span>] == <span class="stringliteral">&#39;qhadam&#39;</span>:</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <span class="comment"># set nus for qhadam</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            kwargs[<span class="stringliteral">&#39;nus&#39;</span>] = opt.get(<span class="stringliteral">&#39;nus&#39;</span>, (0.7, 1.0))</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="keywordflow">if</span> opt[<span class="stringliteral">&#39;optimizer&#39;</span>] <span class="keywordflow">in</span> [<span class="stringliteral">&#39;adam&#39;</span>, <span class="stringliteral">&#39;sparseadam&#39;</span>, <span class="stringliteral">&#39;fused_adam&#39;</span>, <span class="stringliteral">&#39;adamax&#39;</span>, <span class="stringliteral">&#39;qhadam&#39;</span>]:</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            <span class="comment"># set betas for optims that use it</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            kwargs[<span class="stringliteral">&#39;betas&#39;</span>] = opt.get(<span class="stringliteral">&#39;betas&#39;</span>, (0.9, 0.999))</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            <span class="comment"># set adam optimizer, but only if user specified it</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <span class="keywordflow">if</span> opt.get(<span class="stringliteral">&#39;adam_eps&#39;</span>):</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                kwargs[<span class="stringliteral">&#39;eps&#39;</span>] = opt[<span class="stringliteral">&#39;adam_eps&#39;</span>]</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        optim_class = self.optim_opts()[opt[<span class="stringliteral">&#39;optimizer&#39;</span>]]</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        self.optimizer = optim_class(params, **kwargs)</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keywordflow">if</span> self.fp16:</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            self.optimizer = <a class="code" href="../../da/dd4/namespaceparlai_1_1utils_1_1torch.html#acd34433af9f43b196920120e6009494e">fp16_optimizer_wrapper</a>(self.optimizer)</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="comment"># TODO: we might want to hard reset optimizers here in the</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="comment"># case of fine tuning. Some rudimentary experiments seemed to</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="comment"># indicate that keeping adam weights around was desirable, so this</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="comment"># will remain the behavior for the time being.</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="keywordflow">if</span> optim_states <span class="keywordflow">and</span> saved_optim_type != opt[<span class="stringliteral">&#39;optimizer&#39;</span>]:</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            <span class="comment"># we changed from adam to adamax, or sgd to adam, or similar</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            print(<span class="stringliteral">&#39;WARNING: not loading optim state since optim class changed.&#39;</span>)</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">elif</span> optim_states:</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <span class="comment"># check for any fp16/fp32 conversions we need to do</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            optimstate_fp16 = <span class="stringliteral">&#39;loss_scaler&#39;</span> <span class="keywordflow">in</span> optim_states</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <span class="keywordflow">if</span> self.fp16 <span class="keywordflow">and</span> optimstate_fp16:</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                <span class="comment"># previously trained in fp16, now we&#39;re training in fp16.</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                <span class="comment"># ideally no action needed, but APEX broke backwards</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                <span class="comment"># compatibility and this is the hack around it.</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                optim_states[<span class="stringliteral">&#39;loss_scaler&#39;</span>] = self.optimizer.state_dict()[<span class="stringliteral">&#39;loss_scaler&#39;</span>]</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="keywordflow">elif</span> optimstate_fp16 <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.fp16:</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                <span class="comment"># old optimizer was fp16 but now we&#39;re doing fp32,</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                <span class="comment"># drop the fp16 wrapper from the state_dict and just load</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                <span class="comment"># the fp16 weights into the fp32 tensors</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                optim_states = optim_states[<span class="stringliteral">&#39;optimizer_state_dict&#39;</span>]</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <span class="keywordflow">elif</span> <span class="keywordflow">not</span> optimstate_fp16 <span class="keywordflow">and</span> self.fp16:</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                <span class="comment"># old optimizer was fp32, but now we&#39;re doing fp16.</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <span class="comment"># this is a bit clunky, but alternatives are worse</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                self.optimizer.optimizer.load_state_dict(optim_states)</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                <span class="keywordflow">return</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                <span class="comment"># previously trained in fp32, loading in fp32.</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                <span class="comment"># no special treatment needed.</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                <span class="keywordflow">pass</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            <span class="comment"># finally, try to actually load the optimizer state</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                self.optimizer.load_state_dict(optim_states)</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            <span class="keywordflow">except</span> ValueError:</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                print(<span class="stringliteral">&#39;WARNING: not loading optim state since model params changed.&#39;</span>)</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1utils_1_1torch_html_acd34433af9f43b196920120e6009494e"><div class="ttname"><a href="../../da/dd4/namespaceparlai_1_1utils_1_1torch.html#acd34433af9f43b196920120e6009494e">parlai.utils.torch.fp16_optimizer_wrapper</a></div><div class="ttdeci">def fp16_optimizer_wrapper</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d80/torch_8py_source.html#l00182">torch.py:182</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afa491bf2384b017711ad722b5341b405"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa491bf2384b017711ad722b5341b405">&#9670;&nbsp;</a></span>is_valid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.is_valid </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>obs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Determine if an observation is valid or not.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01416">1416</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="keyword">def </span>is_valid(self, obs):</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="stringliteral">        Determine if an observation is valid or not.</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;text_vec&#39;</span> <span class="keywordflow">in</span> obs <span class="keywordflow">or</span> <span class="stringliteral">&#39;image&#39;</span> <span class="keywordflow">in</span> obs</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="ac345f2da892d35d9f4921e0acf5594c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac345f2da892d35d9f4921e0acf5594c8">&#9670;&nbsp;</a></span>load()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.load </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01764">1764</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="keyword">def </span>load(self, path: str) -&gt; Dict[str, Any]:</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="stringliteral">        Return opt and model states.</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="stringliteral">        Override this method for more specific loading.</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;        states = torch.load(path, map_location=<span class="keyword">lambda</span> cpu, _: cpu)</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;model&#39;</span> <span class="keywordflow">in</span> states:</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;            self.load_state_dict(states[<span class="stringliteral">&#39;model&#39;</span>])</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;optimizer&#39;</span> <span class="keywordflow">in</span> states <span class="keywordflow">and</span> hasattr(self, <span class="stringliteral">&#39;optimizer&#39;</span>):</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;            self.optimizer.load_state_dict(states[<span class="stringliteral">&#39;optimizer&#39;</span>])</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        <span class="keywordflow">return</span> states</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a5dcfca62a677f8de97f09ce993258f84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dcfca62a677f8de97f09ce993258f84">&#9670;&nbsp;</a></span>load_state_dict()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.load_state_dict </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>state_dict</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Load the state dict into model.

This is easily overridable to facilitate transfer of state dicts.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01756">1756</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="keyword">def </span>load_state_dict(self, state_dict):</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="stringliteral">        Load the state dict into model.</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="stringliteral">        This is easily overridable to facilitate transfer of state dicts.</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        self.model.load_state_dict(state_dict)</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="aba56b961d929e5c5b5da9cf8bd331502"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba56b961d929e5c5b5da9cf8bd331502">&#9670;&nbsp;</a></span>match_batch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.match_batch </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>batch_reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>valid_inds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>output</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Match sub-batch of predictions to the original batch indices.

Batches may be only partially filled (i.e when completing the remainder
at the end of the validation or test set), or we may want to sort by
e.g the length of the input sequences if using pack_padded_sequence.

This matches rows back with their original row in the batch for
calculating metrics like accuracy.

If output is None (model choosing not to provide any predictions), we
will just return the batch of replies.

Otherwise, output should be a parlai.core.torch_agent.Output object.
This is a namedtuple, which can provide text predictions and/or
text_candidates predictions. If you would like to map additional
fields into the batch_reply, you can override this method as well as
providing your own namedtuple with additional fields.

:param batch_reply:
    Full-batchsize list of message dictionaries to put responses into.

:param valid_inds:
    Original indices of the predictions.

:param output:
    Output namedtuple which contains sub-batchsize list of text outputs
    from model. May be None (default) if model chooses not to answer.
    This method will check for ``text`` and ``text_candidates`` fields.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01519">1519</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <span class="keyword">def </span>match_batch(self, batch_reply, valid_inds, output=None):</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="stringliteral">        Match sub-batch of predictions to the original batch indices.</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="stringliteral">        Batches may be only partially filled (i.e when completing the remainder</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="stringliteral">        at the end of the validation or test set), or we may want to sort by</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="stringliteral">        e.g the length of the input sequences if using pack_padded_sequence.</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="stringliteral">        This matches rows back with their original row in the batch for</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="stringliteral">        calculating metrics like accuracy.</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="stringliteral">        If output is None (model choosing not to provide any predictions), we</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="stringliteral">        will just return the batch of replies.</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="stringliteral">        Otherwise, output should be a parlai.core.torch_agent.Output object.</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="stringliteral">        This is a namedtuple, which can provide text predictions and/or</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="stringliteral">        text_candidates predictions. If you would like to map additional</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="stringliteral">        fields into the batch_reply, you can override this method as well as</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="stringliteral">        providing your own namedtuple with additional fields.</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="stringliteral">        :param batch_reply:</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="stringliteral">            Full-batchsize list of message dictionaries to put responses into.</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="stringliteral">        :param valid_inds:</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="stringliteral">            Original indices of the predictions.</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="stringliteral">        :param output:</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="stringliteral">            Output namedtuple which contains sub-batchsize list of text outputs</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="stringliteral">            from model. May be None (default) if model chooses not to answer.</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="stringliteral">            This method will check for ``text`` and ``text_candidates`` fields.</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        <span class="keywordflow">if</span> output <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;            <span class="keywordflow">return</span> batch_reply</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> output.items():</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;            <span class="keywordflow">if</span> v <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                <span class="keywordflow">continue</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            <span class="keywordflow">for</span> i, sub_val <span class="keywordflow">in</span> zip(valid_inds, v):</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                batch_reply[i][k] = sub_val</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <span class="keywordflow">return</span> batch_reply</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a87b18f0d6ab11be3c49375af072d0d33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87b18f0d6ab11be3c49375af072d0d33">&#9670;&nbsp;</a></span>observe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.observe </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>observation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Process incoming message in preparation for producing a response.

This includes remembering the past history of the conversation.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01559">1559</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="keyword">def </span>observe(self, observation):</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="stringliteral">        Process incoming message in preparation for producing a response.</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="stringliteral">        This includes remembering the past history of the conversation.</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        <span class="comment"># TODO: Migration plan: TorchAgent currently supports being passed</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        <span class="comment"># observations as vanilla dicts for legacy interop; eventually we</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <span class="comment"># want to remove this behavior and demand that teachers return Messages</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        observation = Message(observation)</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        <span class="comment"># Sanity check everything is in order</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        self._validate_observe_invariants()</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        <span class="keywordflow">if</span> observation.get(<span class="stringliteral">&#39;episode_done&#39;</span>):</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;            self.__expecting_clear_history = <span class="keyword">True</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        <span class="keywordflow">elif</span> <span class="stringliteral">&#39;labels&#39;</span> <span class="keywordflow">in</span> observation <span class="keywordflow">or</span> <span class="stringliteral">&#39;eval_labels&#39;</span> <span class="keywordflow">in</span> observation:</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;            <span class="comment"># make sure we note that we&#39;re expecting a reply in the future</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;            self.__expecting_to_reply = <span class="keyword">True</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;        self.observation = observation</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;        <span class="comment"># update the history using the observation</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        self.history.update_history(observation)</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        <span class="keywordflow">return</span> self.vectorize(</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;            observation,</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;            self.history,</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;            text_truncate=self.text_truncate,</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;            label_truncate=self.label_truncate,</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        )</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a9c622b8ed5a811841f30fe98cc297cde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c622b8ed5a811841f30fe98cc297cde">&#9670;&nbsp;</a></span>optim_opts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.optim_opts </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Fetch optimizer selection.

By default, collects everything in torch.optim, as well as importing:
- qhm / qhmadam if installed from github.com/facebookresearch/qhoptim

Override this (and probably call super()) to add your own optimizers.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00334">334</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keyword">def </span>optim_opts(self):</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="stringliteral">        Fetch optimizer selection.</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="stringliteral">        By default, collects everything in torch.optim, as well as importing:</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="stringliteral">        - qhm / qhmadam if installed from github.com/facebookresearch/qhoptim</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="stringliteral">        Override this (and probably call super()) to add your own optimizers.</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="comment"># first pull torch.optim in</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        optims = {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            k.lower(): v</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> optim.__dict__.items()</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> k.startswith(<span class="stringliteral">&#39;__&#39;</span>) <span class="keywordflow">and</span> k[0].isupper()</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keyword">import</span> apex.optimizers.fused_adam <span class="keyword">as</span> fused_adam</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            optims[<span class="stringliteral">&#39;fused_adam&#39;</span>] = fused_adam.FusedAdam</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">except</span> ImportError:</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordflow">pass</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="comment"># https://openreview.net/pdf?id=S1fUpoR5FQ</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="keyword">from</span> qhoptim.pyt <span class="keyword">import</span> QHM, QHAdam</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            optims[<span class="stringliteral">&#39;qhm&#39;</span>] = QHM</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            optims[<span class="stringliteral">&#39;qhadam&#39;</span>] = QHAdam</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">except</span> ImportError:</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <span class="comment"># no QHM installed</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">pass</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">return</span> optims</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a02beaaedfa30463f9d0a97ea590b516f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02beaaedfa30463f9d0a97ea590b516f">&#9670;&nbsp;</a></span>receive_metrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.receive_metrics </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>metrics_dict</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Use the metrics to decide when to adjust LR schedule.

This uses the loss as the validation metric if present, if not this
function does nothing. Note that the model must be reporting loss for
this to work.

Override this to override the behavior.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01044">1044</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keyword">def </span>receive_metrics(self, metrics_dict):</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="stringliteral">        Use the metrics to decide when to adjust LR schedule.</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="stringliteral">        This uses the loss as the validation metric if present, if not this</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="stringliteral">        function does nothing. Note that the model must be reporting loss for</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="stringliteral">        this to work.</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="stringliteral">        Override this to override the behavior.</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;scheduler&#39;</span>) <span class="keywordflow">or</span> self.scheduler <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keywordflow">if</span> self._is_lr_warming_up():</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;            <span class="comment"># we&#39;re not done warming up, so don&#39;t start using validation</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;            <span class="comment"># metrics to adjust schedule</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="keywordflow">if</span> self.opt[<span class="stringliteral">&#39;lr_scheduler&#39;</span>] == <span class="stringliteral">&#39;none&#39;</span>:</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            <span class="comment"># no scheduler, nothing to adjust here</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;            <span class="keywordflow">pass</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="keywordflow">elif</span> self.opt[<span class="stringliteral">&#39;lr_scheduler&#39;</span>] == <span class="stringliteral">&#39;reduceonplateau&#39;</span>:</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;loss&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> metrics_dict:</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                <span class="comment"># nothing to step on, just skip</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                <a class="code" href="../../d7/db6/namespaceparlai_1_1utils_1_1misc.html#a884a3aefa90581f53bc592fa6a78dc43">warn_once</a>(<span class="stringliteral">&quot;LR scheduler expected to see loss metric, but didn&#39;t.&quot;</span>)</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                <span class="keywordflow">return</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            self.scheduler.step(metrics_dict[<span class="stringliteral">&#39;loss&#39;</span>])</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">elif</span> self.opt[<span class="stringliteral">&#39;lr_scheduler&#39;</span>] == <span class="stringliteral">&#39;fixed&#39;</span>:</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            self.scheduler.step()</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        <span class="keywordflow">elif</span> self.opt[<span class="stringliteral">&#39;lr_scheduler&#39;</span>] == <span class="stringliteral">&#39;invsqrt&#39;</span>:</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            <span class="comment"># this is a training step lr scheduler, nothing to adjust in validation</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            <span class="keywordflow">pass</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            <span class="keywordflow">raise</span> ValueError(</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                <span class="stringliteral">&quot;Don&#39;t know how to work with lr scheduler &#39;{}&#39;&quot;</span>.<a class="code" href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">format</a>(</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                    self.opt[<span class="stringliteral">&#39;lr_scheduler&#39;</span>]</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                )</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            )</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1utils_1_1misc_html_a884a3aefa90581f53bc592fa6a78dc43"><div class="ttname"><a href="../../d7/db6/namespaceparlai_1_1utils_1_1misc.html#a884a3aefa90581f53bc592fa6a78dc43">parlai.utils.misc.warn_once</a></div><div class="ttdeci">def warn_once</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d02/misc_8py_source.html#l00813">misc.py:813</a></div></div>
<div class="ttc" id="namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_html_a32e2e2022b824fbaf80c747160b52a76"><div class="ttname"><a href="../../d4/d94/namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils.html#a32e2e2022b824fbaf80c747160b52a76">parlai.chat_service.services.messenger.shared_utils.format</a></div><div class="ttdeci">format</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/chat__service_2services_2messenger_2shared__utils_8py_source.html#l00029">shared_utils.py:29</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac694770cd4022eb047bf6fbb8f46035c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac694770cd4022eb047bf6fbb8f46035c">&#9670;&nbsp;</a></span>report()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.report </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Report metrics.

Report includes learning rate and number of training updates.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00984">984</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keyword">def </span><a class="code" href="../../db/d1c/namespaceprojects_1_1convai2_1_1eval__f1.html#a01a47b9c08dad189837a51f085defc45">report</a>(self):</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="stringliteral">        Report metrics.</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="stringliteral">        Report includes learning rate and number of training updates.</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        metrics = {}</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="comment"># only report LR if we have a scheduler</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;scheduler&#39;</span>) <span class="keywordflow">and</span> self.scheduler <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            current_lr = <a class="code" href="../../d5/dbb/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0.html#af377ec61bfc0423461e7b409ffc883b9">round_sigfigs</a>(self.optimizer.param_groups[0][<span class="stringliteral">&#39;lr&#39;</span>], 4)</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            metrics[<span class="stringliteral">&#39;lr&#39;</span>] = <a class="code" href="../../d5/dbb/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0.html#af377ec61bfc0423461e7b409ffc883b9">round_sigfigs</a>(current_lr, 4)</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        metrics[<span class="stringliteral">&#39;total_train_updates&#39;</span>] = self._number_training_updates</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        steps = self.metrics[<span class="stringliteral">&#39;updates&#39;</span>]</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordflow">if</span> steps &gt; 0 <span class="keywordflow">and</span> self.opt.get(<span class="stringliteral">&#39;gradient_clip&#39;</span>, -1) &gt; 0:</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            metrics[<span class="stringliteral">&#39;gnorm&#39;</span>] = <a class="code" href="../../d5/dbb/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0.html#af377ec61bfc0423461e7b409ffc883b9">round_sigfigs</a>(self.metrics[<span class="stringliteral">&#39;gnorm&#39;</span>] / steps, 4)</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            metrics[<span class="stringliteral">&#39;clip&#39;</span>] = <a class="code" href="../../d5/dbb/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0.html#af377ec61bfc0423461e7b409ffc883b9">round_sigfigs</a>(self.metrics[<span class="stringliteral">&#39;clip&#39;</span>] / steps, 2)</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="keywordflow">if</span> self.use_cuda:</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            metrics[<span class="stringliteral">&#39;gpu_mem_percent&#39;</span>] = <a class="code" href="../../d5/dbb/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0.html#af377ec61bfc0423461e7b409ffc883b9">round_sigfigs</a>(self._gpu_usage(), sigfigs=3)</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordflow">return</span> metrics</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="ttc" id="namespaceprojects_1_1convai2_1_1eval__f1_html_a01a47b9c08dad189837a51f085defc45"><div class="ttname"><a href="../../db/d1c/namespaceprojects_1_1convai2_1_1eval__f1.html#a01a47b9c08dad189837a51f085defc45">projects.convai2.eval_f1.report</a></div><div class="ttdeci">report</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d61/convai2_2eval__f1_8py_source.html#l00039">eval_f1.py:39</a></div></div>
<div class="ttc" id="namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_html_af377ec61bfc0423461e7b409ffc883b9"><div class="ttname"><a href="../../d5/dbb/namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0.html#af377ec61bfc0423461e7b409ffc883b9">parlai.agents.legacy_agents.seq2seq.utils_v0.round_sigfigs</a></div><div class="ttdeci">def round_sigfigs(x, sigfigs=4)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd3/utils__v0_8py_source.html#l00396">utils_v0.py:396</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6f568650dd8e245a274671680ebb7587"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f568650dd8e245a274671680ebb7587">&#9670;&nbsp;</a></span>reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.reset </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Clear internal states.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01777">1777</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keyword">def </span>reset(self):</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="stringliteral">        Clear internal states.</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        <span class="comment"># assumption violation trackers</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        self.__expecting_clear_history = <span class="keyword">False</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        self.__expecting_to_reply = <span class="keyword">False</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;        self.observation = <span class="keywordtype">None</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        self.history.reset()</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        self.reset_metrics()</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a03e18955cfd44dd019d0847bc7a46893"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03e18955cfd44dd019d0847bc7a46893">&#9670;&nbsp;</a></span>reset_metrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.reset_metrics </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Reset all TorchAgentMetrics.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01789">1789</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="keyword">def </span>reset_metrics(self):</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="stringliteral">        Reset all TorchAgentMetrics.</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        super().reset_metrics()</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        self.metrics[<span class="stringliteral">&#39;gnorm&#39;</span>] = 0.0</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        self.metrics[<span class="stringliteral">&#39;clip&#39;</span>] = 0.0</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        self.metrics[<span class="stringliteral">&#39;updates&#39;</span>] = 0</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="adac7ee3db855786e8414e9f35fcb6e46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adac7ee3db855786e8414e9f35fcb6e46">&#9670;&nbsp;</a></span>save()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.save </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>path</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Save model parameters to path (or default to model_file arg).

Please try to refrain from overriding this function, and instead override
`state_dict(self)` for more specific saving.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01722">1722</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keyword">def </span>save(self, path=None):</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="stringliteral">        Save model parameters to path (or default to model_file arg).</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="stringliteral">        Please try to refrain from overriding this function, and instead override</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="stringliteral">        `state_dict(self)` for more specific saving.</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        path = self.opt.get(<span class="stringliteral">&#39;model_file&#39;</span>, <span class="keywordtype">None</span>) <span class="keywordflow">if</span> path <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> path</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="keywordflow">if</span> path:</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            model_dict_path = path + <span class="stringliteral">&#39;.dict&#39;</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;dict&#39;</span>) <span class="keywordflow">and</span> <span class="keywordflow">not</span> os.path.exists(</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                model_dict_path</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;            ):  <span class="comment"># force save dictionary</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                <span class="comment"># TODO: Look into possibly overriding opt(&#39;dict_file&#39;) with new path</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                self.dict.save(model_dict_path, sort=<span class="keyword">False</span>)</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            states = self.state_dict()</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            <span class="keywordflow">if</span> states:  <span class="comment"># anything found to save?</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;                with open(path, <span class="stringliteral">&#39;wb&#39;</span>) <span class="keyword">as</span> write:</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                    torch.save(states, write)</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                <span class="comment"># save opt file</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                with open(path + <span class="stringliteral">&#39;.opt&#39;</span>, <span class="stringliteral">&#39;w&#39;</span>, encoding=<span class="stringliteral">&#39;utf-8&#39;</span>) <span class="keyword">as</span> handle:</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                    <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;model_version&#39;</span>):</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                        self.opt[<span class="stringliteral">&#39;model_version&#39;</span>] = self.model_version()</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                    saved_opts = deepcopy(self.opt)</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                    <span class="keywordflow">if</span> <span class="stringliteral">&#39;interactive_mode&#39;</span> <span class="keywordflow">in</span> saved_opts:</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;                        <span class="comment"># We do not save the state of interactive mode, it is only decided</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;                        <span class="comment"># by scripts or command line.</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                        del saved_opts[<span class="stringliteral">&#39;interactive_mode&#39;</span>]</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                    json.dump(saved_opts, handle, indent=4)</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;                    <span class="comment"># for convenience of working with jq, make sure there&#39;s a newline</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                    handle.write(<span class="stringliteral">&#39;\n&#39;</span>)</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a663cb0d6a276495d03aacdb8b9c79fb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a663cb0d6a276495d03aacdb8b9c79fb0">&#9670;&nbsp;</a></span>self_observe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.self_observe </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self_message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01589">1589</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <span class="keyword">def </span>self_observe(self, self_message: Message) -&gt; <span class="keywordtype">None</span>:</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="stringliteral">        Observe one&#39;s own utterance.</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="stringliteral">        This is used so that the agent can incorporate its own response into</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="stringliteral">        the dialogue history after a batch_act. Failure to implement this will</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="stringliteral">        result in an agent that cannot hear itself speak.</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="stringliteral">        :param self_message:</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="stringliteral">            The message corresponding to the output from batch_act.</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        use_reply = self.opt.get(<span class="stringliteral">&#39;use_reply&#39;</span>, <span class="stringliteral">&#39;label&#39;</span>)</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        <span class="comment"># quick check everything is in order</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        self._validate_self_observe_invariants()</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        <span class="keyword">assert</span> self.observation <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        <span class="keywordflow">if</span> self.observation[<span class="stringliteral">&#39;episode_done&#39;</span>]:</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;            <span class="comment"># oh this was the last example in the episode. reset the history</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            self.history.reset()</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;            <span class="comment"># additionally mark the last observation as invalid</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;            self.observation = <span class="keywordtype">None</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;            <span class="comment"># and clear the safety check</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            self.__expecting_clear_history = <span class="keyword">False</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <span class="comment"># We did reply! Safety check is good next round.</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        self.__expecting_to_reply = <span class="keyword">False</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <span class="comment"># actually ingest the label</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        <span class="keywordflow">if</span> use_reply == <span class="stringliteral">&#39;none&#39;</span>:</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            <span class="comment"># we&#39;re not including our own responses anyway.</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        <span class="keywordflow">elif</span> use_reply == <span class="stringliteral">&#39;label&#39;</span>:</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;            <span class="comment"># first look for the true label</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            label_key = (</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                <span class="stringliteral">&#39;labels&#39;</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                <span class="keywordflow">if</span> <span class="stringliteral">&#39;labels&#39;</span> <span class="keywordflow">in</span> self.observation</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                <span class="keywordflow">else</span> <span class="stringliteral">&#39;eval_labels&#39;</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                <span class="keywordflow">if</span> <span class="stringliteral">&#39;eval_labels&#39;</span> <span class="keywordflow">in</span> self.observation</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                <span class="keywordflow">else</span> <span class="keywordtype">None</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;            )</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;            <span class="keywordflow">if</span> label_key <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                lbls = self.observation[label_key]</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                last_reply = lbls[0] <span class="keywordflow">if</span> len(lbls) == 1 <span class="keywordflow">else</span> self.random.choice(lbls)</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                self.history.add_reply(last_reply)</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                <span class="keywordflow">return</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;            <span class="comment"># you might expect a hard failure here, but in interactive mode we&#39;ll</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            <span class="comment"># never get a label</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        <span class="comment"># otherwise, we use the last output the model generated</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        <span class="keywordflow">if</span> self_message <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;            last_reply = self_message[<span class="stringliteral">&#39;text&#39;</span>]</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;            self.history.add_reply(last_reply)</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&quot;Unexpected case in self_observe.&quot;</span>)</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a6a7aff29231816a0f3cade9c72409dfc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a7aff29231816a0f3cade9c72409dfc">&#9670;&nbsp;</a></span>set_interactive_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.set_interactive_mode </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shared</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Set interactive mode on or off.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01860">1860</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="keyword">def </span>set_interactive_mode(self, mode, shared):</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="stringliteral">        Set interactive mode on or off.</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        <span class="keywordflow">if</span> shared <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> mode:</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;            <span class="comment"># Only print in the non-shared version.</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            print(<span class="stringliteral">&quot;[&quot;</span> + self.id + <span class="stringliteral">&#39;: full interactive mode on.&#39;</span> + <span class="stringliteral">&#39;]&#39;</span>)</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a373f0e276bf7c9d914a4e3363e9c2712"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a373f0e276bf7c9d914a4e3363e9c2712">&#9670;&nbsp;</a></span>share()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.share </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Share fields from parent as well as useful objects in this class.

Subclasses will likely want to share their model as well.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01188">1188</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keyword">def </span>share(self):</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="stringliteral">        Share fields from parent as well as useful objects in this class.</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="stringliteral">        Subclasses will likely want to share their model as well.</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        shared = super().share()</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keywordflow">if</span> self.opt.get(<span class="stringliteral">&#39;numthreads&#39;</span>, 1) &gt; 1 <span class="keywordflow">and</span> isinstance(self.metrics, dict):</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            <span class="comment"># move metrics and model to shared memory</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            self.metrics = SharedTable(self.metrics)</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            self.model.share_memory()</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        shared[<span class="stringliteral">&#39;metrics&#39;</span>] = self.metrics</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        shared[<span class="stringliteral">&#39;dict&#39;</span>] = self.dict</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        shared[<span class="stringliteral">&#39;model&#39;</span>] = self.model</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        shared[<span class="stringliteral">&#39;criterion&#39;</span>] = self.criterion</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        shared[<span class="stringliteral">&#39;opt&#39;</span>] = self.opt</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="keywordflow">return</span> shared</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a9f89e606931a4622a5c6a6f6b832235c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f89e606931a4622a5c6a6f6b832235c">&#9670;&nbsp;</a></span>state_dict()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.state_dict </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Get the state dict for saving.

Override this method for more specific saving.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01688">1688</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="keyword">def </span>state_dict(self):</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="stringliteral">        Get the state dict for saving.</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="stringliteral">        Override this method for more specific saving.</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        states = {}</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;model&#39;</span>):  <span class="comment"># save model params</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;            <span class="keywordflow">if</span> hasattr(self.model, <span class="stringliteral">&#39;module&#39;</span>):</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                <span class="comment"># did we wrap in a DistributedDataParallel</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                states[<span class="stringliteral">&#39;model&#39;</span>] = self.model.module.state_dict()</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;                states[<span class="stringliteral">&#39;model&#39;</span>] = self.model.state_dict()</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;optimizer&#39;</span>):</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;            <span class="comment"># save optimizer params</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;            states[<span class="stringliteral">&#39;optimizer&#39;</span>] = self.optimizer.state_dict()</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;            states[<span class="stringliteral">&#39;optimizer_type&#39;</span>] = self.opt[<span class="stringliteral">&#39;optimizer&#39;</span>]</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        <span class="comment"># lr scheduler</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        <span class="keywordflow">if</span> torch.__version__.startswith(<span class="stringliteral">&#39;0.&#39;</span>):</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;            <a class="code" href="../../d7/db6/namespaceparlai_1_1utils_1_1misc.html#a884a3aefa90581f53bc592fa6a78dc43">warn_once</a>(</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                <span class="stringliteral">&quot;Must upgrade to Pytorch 1.0 to save the state of your &quot;</span> <span class="stringliteral">&quot;LR scheduler.&quot;</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;            )</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;            states[<span class="stringliteral">&#39;number_training_updates&#39;</span>] = self._number_training_updates</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;            <span class="keywordflow">if</span> getattr(self, <span class="stringliteral">&#39;scheduler&#39;</span>, <span class="keywordtype">None</span>):</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                states[<span class="stringliteral">&#39;lr_scheduler&#39;</span>] = self.scheduler.state_dict()</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                states[<span class="stringliteral">&#39;lr_scheduler_type&#39;</span>] = self.opt[<span class="stringliteral">&#39;lr_scheduler&#39;</span>]</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;            <span class="keywordflow">if</span> getattr(self, <span class="stringliteral">&#39;warmup_scheduler&#39;</span>, <span class="keywordtype">None</span>):</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;                states[<span class="stringliteral">&#39;warmup_scheduler&#39;</span>] = self.warmup_scheduler.state_dict()</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        <span class="keywordflow">return</span> states</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;</div><div class="ttc" id="namespaceparlai_1_1utils_1_1misc_html_a884a3aefa90581f53bc592fa6a78dc43"><div class="ttname"><a href="../../d7/db6/namespaceparlai_1_1utils_1_1misc.html#a884a3aefa90581f53bc592fa6a78dc43">parlai.utils.misc.warn_once</a></div><div class="ttdeci">def warn_once</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d02/misc_8py_source.html#l00813">misc.py:813</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ba9d535736c0af100d00c5e7b02b61b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ba9d535736c0af100d00c5e7b02b61b">&#9670;&nbsp;</a></span>train_step()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.train_step </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>batch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">[Abstract] Process one batch with training labels.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01847">1847</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keyword">def </span>train_step(self, batch):</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="stringliteral">        [Abstract] Process one batch with training labels.</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        <span class="keywordflow">pass</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a7e2c9e180887397daa6229a0f9700b1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e2c9e180887397daa6229a0f9700b1c">&#9670;&nbsp;</a></span>update_params()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.update_params </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Perform step of optimization.

Handles clipping gradients and adjusting LR schedule if needed.
Gradient accumulation is also performed if agent is called with
--update-freq.

It is recommended (but not forced) that you call this in train_step.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01884">1884</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keyword">def </span>update_params(self):</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="stringliteral">        Perform step of optimization.</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="stringliteral">        Handles clipping gradients and adjusting LR schedule if needed.</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="stringliteral">        Gradient accumulation is also performed if agent is called with</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="stringliteral">        --update-freq.</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="stringliteral">        It is recommended (but not forced) that you call this in train_step.</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        update_freq = self.opt.get(<span class="stringliteral">&#39;update_freq&#39;</span>, 1)</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        <span class="keywordflow">if</span> update_freq &gt; 1:</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;            <span class="comment"># we&#39;re doing gradient accumulation, so we don&#39;t only want to step</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            <span class="comment"># every N updates instead</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;            self._number_grad_accum = (self._number_grad_accum + 1) % update_freq</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;            <span class="keywordflow">if</span> self._number_grad_accum != 0:</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                <span class="keywordflow">return</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        <span class="keywordflow">if</span> self.fp16:</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;            <span class="comment"># we&#39;ve been accumulating grads in fp16 and delaying the fp32 copy update.</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;            <span class="comment"># finally time to perform the update.</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;            self.optimizer.update_master_grads()</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        <span class="keywordflow">if</span> self.opt.get(<span class="stringliteral">&#39;gradient_clip&#39;</span>, -1) &gt; 0:</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;            <span class="keywordflow">if</span> self.fp16:</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                grad_norm = self.optimizer.clip_master_grads(self.opt[<span class="stringliteral">&#39;gradient_clip&#39;</span>])</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                grad_norm = torch.nn.utils.clip_grad_norm_(</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                    self.model.parameters(), self.opt[<span class="stringliteral">&#39;gradient_clip&#39;</span>]</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                )</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;            self.metrics[<span class="stringliteral">&#39;gnorm&#39;</span>] += grad_norm</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;            self.metrics[<span class="stringliteral">&#39;clip&#39;</span>] += <a class="code" href="../../d7/dc3/namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset.html#aa2b7207688c641dbc094ab44eca27113">float</a>(grad_norm &gt; self.opt[<span class="stringliteral">&#39;gradient_clip&#39;</span>])</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        self.metrics[<span class="stringliteral">&#39;updates&#39;</span>] += 1</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        self.optimizer.step()</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;        <span class="comment"># keep track up number of steps, compute warmup factor</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        self._number_training_updates += 1</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        <span class="comment"># compute warmup adjustment if needed</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        <span class="keywordflow">if</span> self.opt.get(<span class="stringliteral">&#39;warmup_updates&#39;</span>, -1) &gt; 0:</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;warmup_scheduler&#39;</span>):</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&#39;Looks like you forgot to call build_lr_scheduler&#39;</span>)</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;            <span class="keywordflow">if</span> self._is_lr_warming_up():</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                self.warmup_scheduler.step(epoch=self._number_training_updates)</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        <span class="keywordflow">if</span> self.opt.get(<span class="stringliteral">&#39;lr_scheduler&#39;</span>) == <span class="stringliteral">&#39;invsqrt&#39;</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> self._is_lr_warming_up():</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;            <span class="comment"># training step scheduler</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;            self.scheduler.step(self._number_training_updates)</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div><div class="ttc" id="namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_html_aa2b7207688c641dbc094ab44eca27113"><div class="ttname"><a href="../../d7/dc3/namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset.html#aa2b7207688c641dbc094ab44eca27113">projects.controllable_dialogue.make_control_dataset.float</a></div><div class="ttdeci">float</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d82/make__control__dataset_8py_source.html#l00117">make_control_dataset.py:117</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a48bb9b153353a0565ab7253dc1daef99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48bb9b153353a0565ab7253dc1daef99">&#9670;&nbsp;</a></span>vectorize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.vectorize </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>obs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>history</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>add_start</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>add_end</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>text_truncate</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>label_truncate</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Make vectors out of observation fields and store in the observation.

In particular, the 'text' and 'labels'/'eval_labels' fields are
processed and a new field is added to the observation with the suffix
'_vec'.

If you want to use additional fields on your subclass, you can override
this function, call super().vectorize(...) to process the text and
labels, and then process the other fields in your subclass.

Additionally, if you want to override some of these default parameters,
then we recommend using a pattern like:

.. code-block:: python

  def vectorize(self, *args, **kwargs):
      kwargs['add_start'] = False
      return super().vectorize(*args, **kwargs)


:param obs:
    Single observation from observe function.

:param add_start:
    default True, adds the start token to each label.

:param add_end:
    default True, adds the end token to each label.

:param text_truncate:
    default None, if set truncates text vectors to the specified
    length.

:param label_truncate:
    default None, if set truncates label vectors to the specified
    length.

:return:
    the input observation, with 'text_vec', 'label_vec', and
    'cands_vec' fields added.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01368">1368</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    ):</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="stringliteral">        Make vectors out of observation fields and store in the observation.</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="stringliteral">        In particular, the &#39;text&#39; and &#39;labels&#39;/&#39;eval_labels&#39; fields are</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="stringliteral">        processed and a new field is added to the observation with the suffix</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="stringliteral">        &#39;_vec&#39;.</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="stringliteral">        If you want to use additional fields on your subclass, you can override</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="stringliteral">        this function, call super().vectorize(...) to process the text and</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="stringliteral">        labels, and then process the other fields in your subclass.</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="stringliteral">        Additionally, if you want to override some of these default parameters,</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="stringliteral">        then we recommend using a pattern like:</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="stringliteral">        .. code-block:: python</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="stringliteral">          def vectorize(self, *args, **kwargs):</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="stringliteral">              kwargs[&#39;add_start&#39;] = False</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="stringliteral">              return super().vectorize(*args, **kwargs)</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="stringliteral">        :param obs:</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="stringliteral">            Single observation from observe function.</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="stringliteral">        :param add_start:</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="stringliteral">            default True, adds the start token to each label.</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="stringliteral">        :param add_end:</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="stringliteral">            default True, adds the end token to each label.</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="stringliteral">        :param text_truncate:</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="stringliteral">            default None, if set truncates text vectors to the specified</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="stringliteral">            length.</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="stringliteral">        :param label_truncate:</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="stringliteral">            default None, if set truncates label vectors to the specified</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="stringliteral">            length.</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="stringliteral">        :return:</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="stringliteral">            the input observation, with &#39;text_vec&#39;, &#39;label_vec&#39;, and</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="stringliteral">            &#39;cands_vec&#39; fields added.</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        self._set_text_vec(obs, history, text_truncate)</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        self._set_label_vec(obs, add_start, add_end, label_truncate)</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        self._set_label_cands_vec(obs, add_start, add_end, label_truncate)</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <span class="keywordflow">return</span> obs</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a91c163f3e2d39b380095b7083f673b6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91c163f3e2d39b380095b7083f673b6e">&#9670;&nbsp;</a></span>zero_grad()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def parlai.core.torch_agent.TorchAgent.zero_grad </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Zero out optimizer.

It is recommended you call this in train_step. It automatically handles gradient
accumulation if agent is called with --update-freq.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01934">1934</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="keyword">def </span>zero_grad(self):</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="stringliteral">        Zero out optimizer.</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="stringliteral">        It is recommended you call this in train_step. It automatically handles gradient</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="stringliteral">        accumulation if agent is called with --update-freq.</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        <span class="keywordflow">if</span> self._number_grad_accum != 0:</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;            <span class="comment"># if we&#39;re accumulating gradients, don&#39;t actually zero things out yet.</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        self.optimizer.zero_grad()</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a63011fa9bd927de8acc9ffa676caa73a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63011fa9bd927de8acc9ffa676caa73a">&#9670;&nbsp;</a></span>add_person_tokens</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.add_person_tokens</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00724">724</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a13d46ae8aed6052679b62c3961a4de62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13d46ae8aed6052679b62c3961a4de62">&#9670;&nbsp;</a></span>criterion</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.criterion</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00690">690</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="abebf29c0bb956bbc5ccc02777d2af3dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abebf29c0bb956bbc5ccc02777d2af3dd">&#9670;&nbsp;</a></span>dict</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.dict</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00667">667</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a3a80083f0e34d8abc15b50123efec884"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a80083f0e34d8abc15b50123efec884">&#9670;&nbsp;</a></span>EMPTY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.EMPTY</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00700">700</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a31bb7c8bf380660ee4e3822756563599"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31bb7c8bf380660ee4e3822756563599">&#9670;&nbsp;</a></span>END_IDX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.END_IDX</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00703">703</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="aa6f916e01d876679b529a893ad4f52f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6f916e01d876679b529a893ad4f52f6">&#9670;&nbsp;</a></span>fp16</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.fp16</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00663">663</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a0484b0246f0a930adc575899cdef033c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0484b0246f0a930adc575899cdef033c">&#9670;&nbsp;</a></span>history</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.history</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00720">720</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a15cbb1f743c1d341d914ade47e49071b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15cbb1f743c1d341d914ade47e49071b">&#9670;&nbsp;</a></span>histsz</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.histsz</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00712">712</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a4ac66a09c1c164ea08f4b257c61c38a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ac66a09c1c164ea08f4b257c61c38a0">&#9670;&nbsp;</a></span>id</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.id</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00697">697</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="ab0bd6456c94dfd9afae73b86f05016cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0bd6456c94dfd9afae73b86f05016cf">&#9670;&nbsp;</a></span>is_training</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.is_training</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00722">722</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="adbdd7cf2deb2c43d982c57852b83e685"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbdd7cf2deb2c43d982c57852b83e685">&#9670;&nbsp;</a></span>label_truncate</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.label_truncate</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00718">718</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a392ed66573001dfa2846d5042e8fc5a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a392ed66573001dfa2846d5042e8fc5a5">&#9670;&nbsp;</a></span>metrics</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.metrics</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00691">691</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="afe40410d2e3b2565ecd27441266011fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe40410d2e3b2565ecd27441266011fc">&#9670;&nbsp;</a></span>model</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.model</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00689">689</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a95cedd561757c9fc10dbf3a956e7f912"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95cedd561757c9fc10dbf3a956e7f912">&#9670;&nbsp;</a></span>NULL_IDX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.NULL_IDX</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00701">701</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a4bc525b20568822a042b3bbfa3da3a69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bc525b20568822a042b3bbfa3da3a69">&#9670;&nbsp;</a></span>observation</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.observation</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01579">1579</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a785bb920cf8c8afc3e9bf6a8b77e335a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a785bb920cf8c8afc3e9bf6a8b77e335a">&#9670;&nbsp;</a></span>opt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.opt</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00687">687</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a9533344de40049bf13209739bc92199d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9533344de40049bf13209739bc92199d">&#9670;&nbsp;</a></span>optimizer</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.optimizer</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00844">844</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a292c402279f706390ffed9a7af868abf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a292c402279f706390ffed9a7af868abf">&#9670;&nbsp;</a></span>P1_TOKEN</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.P1_TOKEN</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00330">330</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a81b5bf5acfa70764e3601c14a8afae85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81b5bf5acfa70764e3601c14a8afae85">&#9670;&nbsp;</a></span>P2_TOKEN</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.P2_TOKEN</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00331">331</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a805a9e47552d54d56f5b232ab4d5121f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a805a9e47552d54d56f5b232ab4d5121f">&#9670;&nbsp;</a></span>proj_rp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.proj_rp</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l01145">1145</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a1ca476189900643fab04d1ac0ebfc719"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ca476189900643fab04d1ac0ebfc719">&#9670;&nbsp;</a></span>random</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.random</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00710">710</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a6355b9b0c0ccb24ffe1b5e3d89903cc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6355b9b0c0ccb24ffe1b5e3d89903cc3">&#9670;&nbsp;</a></span>rank_candidates</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.rank_candidates</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00723">723</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a0affe6b199275c182a27c9aa07393347"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0affe6b199275c182a27c9aa07393347">&#9670;&nbsp;</a></span>scheduler</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.scheduler</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00924">924</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a2018afae9938937f80b61475314012cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2018afae9938937f80b61475314012cd">&#9670;&nbsp;</a></span>START_IDX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.START_IDX</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00702">702</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="ae3a69ecb5f20ce4f8a09c05c5f6f4376"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3a69ecb5f20ce4f8a09c05c5f6f4376">&#9670;&nbsp;</a></span>text_truncate</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.text_truncate</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00716">716</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a3ae27e9fe68d255a960bcb5180f48a65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ae27e9fe68d255a960bcb5180f48a65">&#9670;&nbsp;</a></span>truncate</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.truncate</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00714">714</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a10b8d2605e619d5d3dc9f67777cb190a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10b8d2605e619d5d3dc9f67777cb190a">&#9670;&nbsp;</a></span>use_cuda</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.use_cuda</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00656">656</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<a id="a54d8632c546ab621c93c34f13c964726"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54d8632c546ab621c93c34f13c964726">&#9670;&nbsp;</a></span>warmup_scheduler</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parlai.core.torch_agent.TorchAgent.warmup_scheduler</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d9b/torch__agent_8py_source.html#l00916">916</a> of file <a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>parlai/core/<a class="el" href="../../dd/d9b/torch__agent_8py_source.html">torch_agent.py</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
