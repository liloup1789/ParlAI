\hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker}{}\section{parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker Class Reference}
\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker}\index{parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker@{parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker}}


Inheritance diagram for parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=201pt]{d6/d4e/classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=201pt]{de/dca/classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a8bd42fd68fe2d18965bc4ad3b8940ba8}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, tfidf\+\_\+path=None, \hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a8c3f9e75f2a3b3ae127e87f25600c7fb}{strict}=True)
\item 
def \hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a4992c638010961247510dcb2ab96bd8e}{get\+\_\+doc\+\_\+index} (self, doc\+\_\+id)
\item 
def \hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a4ef2a607fd94e1ad9cf44239c8910378}{get\+\_\+doc\+\_\+id} (self, doc\+\_\+index)
\item 
def \hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a0573e296758121d2c40563e93acdf366}{closest\+\_\+docs} (self, query, k=1, matrix=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a3ed4fd5025cc8b1996efc9354ccc8e54}{batch\+\_\+closest\+\_\+docs} (self, queries, k=1, num\+\_\+workers=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a44274f0f828a51c50c641317663e56eb}{parse} (self, query)
\item 
def \hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ac6d8b86317616a64f5bc7f8f607dd997}{text2spvec} (self, query)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ad36148d59e1bce7e5904899316317c61}{doc\+\_\+mat}
\item 
\hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ab3d7c309a8de8cc664192169d95d9c87}{ngrams}
\item 
\hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_add0942063ebbb05487feadbe9b421d56}{hash\+\_\+size}
\item 
\hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ae125548ea43894545541ae71fdc35ff7}{tokenizer}
\item 
\hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a11677b2692fb3311eef1458762265ae9}{doc\+\_\+freqs}
\item 
\hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_af9cda5d944e01e08c45d0b3bbe6cb1ac}{doc\+\_\+dict}
\item 
\hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a5fe0df360e9868ba2ce073ffc49a7d1b}{num\+\_\+docs}
\item 
\hyperlink{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a8c3f9e75f2a3b3ae127e87f25600c7fb}{strict}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Loads a pre-weighted inverted index of token/document terms.

Scores new queries by taking sparse dot products.
\end{DoxyVerb}
 

Definition at line 23 of file tfidf\+\_\+doc\+\_\+ranker.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a8bd42fd68fe2d18965bc4ad3b8940ba8}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a8bd42fd68fe2d18965bc4ad3b8940ba8}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{tfidf\+\_\+path = {\ttfamily None},  }\item[{}]{strict = {\ttfamily True} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Args:
    tfidf_path: path to saved model file
    strict: fail on empty queries or continue (and return empty result)
\end{DoxyVerb}
 

Definition at line 30 of file tfidf\+\_\+doc\+\_\+ranker.\+py.


\begin{DoxyCode}
30     \textcolor{keyword}{def }\_\_init\_\_(self, tfidf\_path=None, strict=True):
31         \textcolor{stringliteral}{"""}
32 \textcolor{stringliteral}{        Args:}
33 \textcolor{stringliteral}{            tfidf\_path: path to saved model file}
34 \textcolor{stringliteral}{            strict: fail on empty queries or continue (and return empty result)}
35 \textcolor{stringliteral}{        """}
36         \textcolor{comment}{# Load from disk}
37         logger.info(\textcolor{stringliteral}{'Loading %s'} % tfidf\_path)
38         matrix, metadata = utils.load\_sparse\_csr(tfidf\_path)
39         self.doc\_mat = matrix
40         self.ngrams = metadata[\textcolor{stringliteral}{'ngram'}]
41         self.hash\_size = metadata[\textcolor{stringliteral}{'hash\_size'}]
42         self.tokenizer = tokenizers.get\_class(metadata[\textcolor{stringliteral}{'tokenizer'}])()
43         self.doc\_freqs = metadata[\textcolor{stringliteral}{'doc\_freqs'}].squeeze()
44         self.doc\_dict = metadata.get(\textcolor{stringliteral}{'doc\_dict'}, \textcolor{keywordtype}{None})
45         self.num\_docs = self.doc\_mat.shape[1] - 1
46         self.strict = strict
47 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a3ed4fd5025cc8b1996efc9354ccc8e54}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a3ed4fd5025cc8b1996efc9354ccc8e54}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!batch\+\_\+closest\+\_\+docs@{batch\+\_\+closest\+\_\+docs}}
\index{batch\+\_\+closest\+\_\+docs@{batch\+\_\+closest\+\_\+docs}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{batch\+\_\+closest\+\_\+docs()}{batch\_closest\_docs()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+batch\+\_\+closest\+\_\+docs (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{queries,  }\item[{}]{k = {\ttfamily 1},  }\item[{}]{num\+\_\+workers = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Process a batch of closest_docs requests multithreaded.

Note: we can use plain threads here as scipy is outside of the GIL.
\end{DoxyVerb}
 

Definition at line 80 of file tfidf\+\_\+doc\+\_\+ranker.\+py.


\begin{DoxyCode}
80     \textcolor{keyword}{def }batch\_closest\_docs(self, queries, k=1, num\_workers=None):
81         \textcolor{stringliteral}{"""}
82 \textcolor{stringliteral}{        Process a batch of closest\_docs requests multithreaded.}
83 \textcolor{stringliteral}{}
84 \textcolor{stringliteral}{        Note: we can use plain threads here as scipy is outside of the GIL.}
85 \textcolor{stringliteral}{        """}
86         with ThreadPool(num\_workers) \textcolor{keyword}{as} threads:
87             closest\_docs = partial(self.closest\_docs, k=k)
88             results = threads.map(closest\_docs, queries)
89         \textcolor{keywordflow}{return} results
90 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a0573e296758121d2c40563e93acdf366}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a0573e296758121d2c40563e93acdf366}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!closest\+\_\+docs@{closest\+\_\+docs}}
\index{closest\+\_\+docs@{closest\+\_\+docs}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{closest\+\_\+docs()}{closest\_docs()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+closest\+\_\+docs (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{query,  }\item[{}]{k = {\ttfamily 1},  }\item[{}]{matrix = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Closest docs by dot product between query and documents in tfidf weighted word
vector space.

matrix arg can be provided to be used instead of internal doc matrix.
\end{DoxyVerb}
 

Definition at line 60 of file tfidf\+\_\+doc\+\_\+ranker.\+py.


\begin{DoxyCode}
60     \textcolor{keyword}{def }closest\_docs(self, query, k=1, matrix=None):
61         \textcolor{stringliteral}{"""}
62 \textcolor{stringliteral}{        Closest docs by dot product between query and documents in tfidf weighted word}
63 \textcolor{stringliteral}{        vector space.}
64 \textcolor{stringliteral}{}
65 \textcolor{stringliteral}{        matrix arg can be provided to be used instead of internal doc matrix.}
66 \textcolor{stringliteral}{        """}
67         spvec = self.text2spvec(query)
68         res = spvec * matrix \textcolor{keywordflow}{if} matrix \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None} \textcolor{keywordflow}{else} spvec * self.doc\_mat
69 
70         \textcolor{keywordflow}{if} len(res.data) <= k:
71             o\_sort = np.argsort(-res.data)
72         \textcolor{keywordflow}{else}:
73             o = np.argpartition(-res.data, k)[0:k]
74             o\_sort = o[np.argsort(-res.data[o])]
75 
76         doc\_scores = res.data[o\_sort]
77         doc\_ids = res.indices[o\_sort]
78         \textcolor{keywordflow}{return} doc\_ids, doc\_scores
79 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a4ef2a607fd94e1ad9cf44239c8910378}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a4ef2a607fd94e1ad9cf44239c8910378}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!get\+\_\+doc\+\_\+id@{get\+\_\+doc\+\_\+id}}
\index{get\+\_\+doc\+\_\+id@{get\+\_\+doc\+\_\+id}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{get\+\_\+doc\+\_\+id()}{get\_doc\_id()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+get\+\_\+doc\+\_\+id (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{doc\+\_\+index }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert doc_index --> doc_id.
\end{DoxyVerb}
 

Definition at line 54 of file tfidf\+\_\+doc\+\_\+ranker.\+py.


\begin{DoxyCode}
54     \textcolor{keyword}{def }get\_doc\_id(self, doc\_index):
55         \textcolor{stringliteral}{"""}
56 \textcolor{stringliteral}{        Convert doc\_index --> doc\_id.}
57 \textcolor{stringliteral}{        """}
58         \textcolor{keywordflow}{return} self.doc\_dict[1][doc\_index] \textcolor{keywordflow}{if} self.doc\_dict \textcolor{keywordflow}{else} doc\_index
59 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a4992c638010961247510dcb2ab96bd8e}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a4992c638010961247510dcb2ab96bd8e}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!get\+\_\+doc\+\_\+index@{get\+\_\+doc\+\_\+index}}
\index{get\+\_\+doc\+\_\+index@{get\+\_\+doc\+\_\+index}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{get\+\_\+doc\+\_\+index()}{get\_doc\_index()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+get\+\_\+doc\+\_\+index (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{doc\+\_\+id }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert doc_id --> doc_index.
\end{DoxyVerb}
 

Definition at line 48 of file tfidf\+\_\+doc\+\_\+ranker.\+py.


\begin{DoxyCode}
48     \textcolor{keyword}{def }get\_doc\_index(self, doc\_id):
49         \textcolor{stringliteral}{"""}
50 \textcolor{stringliteral}{        Convert doc\_id --> doc\_index.}
51 \textcolor{stringliteral}{        """}
52         \textcolor{keywordflow}{return} self.doc\_dict[0][doc\_id] \textcolor{keywordflow}{if} self.doc\_dict \textcolor{keywordflow}{else} doc\_id
53 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a44274f0f828a51c50c641317663e56eb}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a44274f0f828a51c50c641317663e56eb}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!parse@{parse}}
\index{parse@{parse}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{parse()}{parse()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+parse (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{query }\end{DoxyParamCaption})}

\begin{DoxyVerb}Parse the query into tokens (either ngrams or tokens).
\end{DoxyVerb}
 

Definition at line 91 of file tfidf\+\_\+doc\+\_\+ranker.\+py.


\begin{DoxyCode}
91     \textcolor{keyword}{def }parse(self, query):
92         \textcolor{stringliteral}{"""}
93 \textcolor{stringliteral}{        Parse the query into tokens (either ngrams or tokens).}
94 \textcolor{stringliteral}{        """}
95         tokens = self.tokenizer.\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a1fdb457e98eb4e4c26047e229686a616}{tokenize}(query)
96         \textcolor{keywordflow}{return} tokens.ngrams(n=self.ngrams, uncased=\textcolor{keyword}{True}, filter\_fn=utils.filter\_ngram)
97 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ac6d8b86317616a64f5bc7f8f607dd997}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ac6d8b86317616a64f5bc7f8f607dd997}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!text2spvec@{text2spvec}}
\index{text2spvec@{text2spvec}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{text2spvec()}{text2spvec()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+text2spvec (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{query }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create a sparse tfidf-weighted word vector from query.

tfidf = log(tf + 1) * log((N - Nt + 0.5) / (Nt + 0.5))
\end{DoxyVerb}
 

Definition at line 98 of file tfidf\+\_\+doc\+\_\+ranker.\+py.


\begin{DoxyCode}
98     \textcolor{keyword}{def }text2spvec(self, query):
99         \textcolor{stringliteral}{"""}
100 \textcolor{stringliteral}{        Create a sparse tfidf-weighted word vector from query.}
101 \textcolor{stringliteral}{}
102 \textcolor{stringliteral}{        tfidf = log(tf + 1) * log((N - Nt + 0.5) / (Nt + 0.5))}
103 \textcolor{stringliteral}{        """}
104         \textcolor{comment}{# Get hashed ngrams}
105         words = self.parse(utils.normalize(query))
106         wids = [utils.hash(w, self.hash\_size) \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} words]
107 
108         \textcolor{keywordflow}{if} len(wids) == 0:
109             \textcolor{keywordflow}{if} self.strict:
110                 \textcolor{keywordflow}{raise} RuntimeError(\textcolor{stringliteral}{'No valid word in: %s'} % query)
111             \textcolor{keywordflow}{else}:
112                 logger.warning(\textcolor{stringliteral}{'No valid word in: %s'} % query)
113                 \textcolor{keywordflow}{return} sp.csr\_matrix((1, self.hash\_size))
114 
115         \textcolor{comment}{# Count TF}
116         wids\_unique, wids\_counts = np.unique(wids, return\_counts=\textcolor{keyword}{True})
117         tfs = np.log1p(wids\_counts)
118 
119         \textcolor{comment}{# Count IDF}
120         Ns = self.doc\_freqs[wids\_unique]
121         idfs = np.log((self.num\_docs - Ns + 0.5) / (Ns + 0.5))
122         idfs[idfs < 0] = 0
123 
124         \textcolor{comment}{# TF-IDF}
125         data = np.multiply(tfs, idfs)
126 
127         \textcolor{comment}{# One row, sparse csr matrix}
128         indptr = np.array([0, len(wids\_unique)])
129         spvec = sp.csr\_matrix((data, wids\_unique, indptr), shape=(1, self.hash\_size))
130 
131         \textcolor{keywordflow}{return} spvec
132 \end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_af9cda5d944e01e08c45d0b3bbe6cb1ac}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_af9cda5d944e01e08c45d0b3bbe6cb1ac}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!doc\+\_\+dict@{doc\+\_\+dict}}
\index{doc\+\_\+dict@{doc\+\_\+dict}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{doc\+\_\+dict}{doc\_dict}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+doc\+\_\+dict}



Definition at line 44 of file tfidf\+\_\+doc\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a11677b2692fb3311eef1458762265ae9}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a11677b2692fb3311eef1458762265ae9}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!doc\+\_\+freqs@{doc\+\_\+freqs}}
\index{doc\+\_\+freqs@{doc\+\_\+freqs}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{doc\+\_\+freqs}{doc\_freqs}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+doc\+\_\+freqs}



Definition at line 43 of file tfidf\+\_\+doc\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ad36148d59e1bce7e5904899316317c61}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ad36148d59e1bce7e5904899316317c61}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!doc\+\_\+mat@{doc\+\_\+mat}}
\index{doc\+\_\+mat@{doc\+\_\+mat}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{doc\+\_\+mat}{doc\_mat}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+doc\+\_\+mat}



Definition at line 39 of file tfidf\+\_\+doc\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_add0942063ebbb05487feadbe9b421d56}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_add0942063ebbb05487feadbe9b421d56}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!hash\+\_\+size@{hash\+\_\+size}}
\index{hash\+\_\+size@{hash\+\_\+size}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{hash\+\_\+size}{hash\_size}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+hash\+\_\+size}



Definition at line 41 of file tfidf\+\_\+doc\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ab3d7c309a8de8cc664192169d95d9c87}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ab3d7c309a8de8cc664192169d95d9c87}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!ngrams@{ngrams}}
\index{ngrams@{ngrams}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{ngrams}{ngrams}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+ngrams}



Definition at line 40 of file tfidf\+\_\+doc\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a5fe0df360e9868ba2ce073ffc49a7d1b}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a5fe0df360e9868ba2ce073ffc49a7d1b}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!num\+\_\+docs@{num\+\_\+docs}}
\index{num\+\_\+docs@{num\+\_\+docs}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{num\+\_\+docs}{num\_docs}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+num\+\_\+docs}



Definition at line 45 of file tfidf\+\_\+doc\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a8c3f9e75f2a3b3ae127e87f25600c7fb}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_a8c3f9e75f2a3b3ae127e87f25600c7fb}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!strict@{strict}}
\index{strict@{strict}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{strict}{strict}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+strict}



Definition at line 46 of file tfidf\+\_\+doc\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ae125548ea43894545541ae71fdc35ff7}\label{classparlai_1_1agents_1_1tfidf__retriever_1_1tfidf__doc__ranker_1_1TfidfDocRanker_ae125548ea43894545541ae71fdc35ff7}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}!tokenizer@{tokenizer}}
\index{tokenizer@{tokenizer}!parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker@{parlai\+::agents\+::tfidf\+\_\+retriever\+::tfidf\+\_\+doc\+\_\+ranker\+::\+Tfidf\+Doc\+Ranker}}
\subsubsection{\texorpdfstring{tokenizer}{tokenizer}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+tfidf\+\_\+doc\+\_\+ranker.\+Tfidf\+Doc\+Ranker.\+tokenizer}



Definition at line 42 of file tfidf\+\_\+doc\+\_\+ranker.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/tfidf\+\_\+retriever/\hyperlink{tfidf__doc__ranker_8py}{tfidf\+\_\+doc\+\_\+ranker.\+py}\end{DoxyCompactItemize}
