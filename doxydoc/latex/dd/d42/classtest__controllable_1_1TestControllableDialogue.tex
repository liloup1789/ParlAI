\hypertarget{classtest__controllable_1_1TestControllableDialogue}{}\section{test\+\_\+controllable.\+Test\+Controllable\+Dialogue Class Reference}
\label{classtest__controllable_1_1TestControllableDialogue}\index{test\+\_\+controllable.\+Test\+Controllable\+Dialogue@{test\+\_\+controllable.\+Test\+Controllable\+Dialogue}}


Inheritance diagram for test\+\_\+controllable.\+Test\+Controllable\+Dialogue\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=242pt]{dc/d7e/classtest__controllable_1_1TestControllableDialogue__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for test\+\_\+controllable.\+Test\+Controllable\+Dialogue\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=242pt]{d5/d03/classtest__controllable_1_1TestControllableDialogue__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classtest__controllable_1_1TestControllableDialogue_afb3df76378e7449db2a4122568d8a8b2}{test\+\_\+dataset\+\_\+integrity} (self)
\item 
def \hyperlink{classtest__controllable_1_1TestControllableDialogue_ad46fe0ecf2f0b42e60424d1c7b37a2f5}{test\+\_\+train\+\_\+model} (self)
\item 
def \hyperlink{classtest__controllable_1_1TestControllableDialogue_af293a117beb40fbfe28314beb4b88f35}{test\+\_\+convai2\+\_\+finetuned\+\_\+greedy} (self)
\item 
def \hyperlink{classtest__controllable_1_1TestControllableDialogue_a436d2be9796b5afb7a4656e614107d48}{test\+\_\+convai2\+\_\+finetuned\+\_\+beamsearch} (self)
\item 
def \hyperlink{classtest__controllable_1_1TestControllableDialogue_a12a49b51265fc21d9f1fe7a8dc45538a}{test\+\_\+convai2\+\_\+finetuned\+\_\+norepetition} (self)
\item 
def \hyperlink{classtest__controllable_1_1TestControllableDialogue_aad1b8cd43766d6bfe04339c5ed7f3830}{test\+\_\+ct\+\_\+question\+\_\+bucket7} (self)
\item 
def \hyperlink{classtest__controllable_1_1TestControllableDialogue_ab33835878eb846bcc457a90072bb06bd}{test\+\_\+ct\+\_\+question\+\_\+bucket10} (self)
\item 
def \hyperlink{classtest__controllable_1_1TestControllableDialogue_a1cf543f3400075fe15ae7eea6b51156c}{test\+\_\+ct\+\_\+specificity\+\_\+bucket7} (self)
\item 
def \hyperlink{classtest__controllable_1_1TestControllableDialogue_a357a886c76cc4d72cc2345eaee912f46}{test\+\_\+wd\+\_\+specificity} (self)
\item 
def \hyperlink{classtest__controllable_1_1TestControllableDialogue_acc29f953a7fb51ef9a0dedafa8129cc2}{test\+\_\+wd\+\_\+responsiveness} (self)
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 23 of file test\+\_\+controllable.\+py.



\subsection{Member Function Documentation}
\mbox{\Hypertarget{classtest__controllable_1_1TestControllableDialogue_a436d2be9796b5afb7a4656e614107d48}\label{classtest__controllable_1_1TestControllableDialogue_a436d2be9796b5afb7a4656e614107d48}} 
\index{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}!test\+\_\+convai2\+\_\+finetuned\+\_\+beamsearch@{test\+\_\+convai2\+\_\+finetuned\+\_\+beamsearch}}
\index{test\+\_\+convai2\+\_\+finetuned\+\_\+beamsearch@{test\+\_\+convai2\+\_\+finetuned\+\_\+beamsearch}!test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}}
\subsubsection{\texorpdfstring{test\+\_\+convai2\+\_\+finetuned\+\_\+beamsearch()}{test\_convai2\_finetuned\_beamsearch()}}
{\footnotesize\ttfamily def test\+\_\+controllable.\+Test\+Controllable\+Dialogue.\+test\+\_\+convai2\+\_\+finetuned\+\_\+beamsearch (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Check the beamsearch baseline produces correct results.
\end{DoxyVerb}
 

Definition at line 82 of file test\+\_\+controllable.\+py.


\begin{DoxyCode}
82     \textcolor{keyword}{def }test\_convai2\_finetuned\_beamsearch(self):
83         \textcolor{stringliteral}{"""}
84 \textcolor{stringliteral}{        Check the beamsearch baseline produces correct results.}
85 \textcolor{stringliteral}{        """}
86         \_, valid, \_ = testing\_utils.eval\_model(
87             \{
88                 \textcolor{stringliteral}{'model\_file'}: \textcolor{stringliteral}{'zoo:controllable\_dialogue/convai2\_finetuned\_baseline'},
89                 \textcolor{stringliteral}{'task'}: \textcolor{stringliteral}{'projects.controllable\_dialogue.tasks.agents'},
90                 \textcolor{stringliteral}{'beam\_size'}: 20,
91                 \textcolor{stringliteral}{'beam\_min\_n\_best'}: 10,
92                 \textcolor{stringliteral}{'batchsize'}: 64,
93                 \textcolor{stringliteral}{'num\_examples'}: NUM\_EXAMPLES,
94             \},
95             skip\_test=\textcolor{keyword}{True},
96         )
97 
98         \textcolor{keywordflow}{if} FAST\_MODE:
99             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 23.54, delta=0.1)
100             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1575, delta=0.0002)
101         \textcolor{keywordflow}{else}:
102             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 22.86, delta=0.1)
103             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1516, delta=0.0002)
104 
\end{DoxyCode}
\mbox{\Hypertarget{classtest__controllable_1_1TestControllableDialogue_af293a117beb40fbfe28314beb4b88f35}\label{classtest__controllable_1_1TestControllableDialogue_af293a117beb40fbfe28314beb4b88f35}} 
\index{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}!test\+\_\+convai2\+\_\+finetuned\+\_\+greedy@{test\+\_\+convai2\+\_\+finetuned\+\_\+greedy}}
\index{test\+\_\+convai2\+\_\+finetuned\+\_\+greedy@{test\+\_\+convai2\+\_\+finetuned\+\_\+greedy}!test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}}
\subsubsection{\texorpdfstring{test\+\_\+convai2\+\_\+finetuned\+\_\+greedy()}{test\_convai2\_finetuned\_greedy()}}
{\footnotesize\ttfamily def test\+\_\+controllable.\+Test\+Controllable\+Dialogue.\+test\+\_\+convai2\+\_\+finetuned\+\_\+greedy (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Check the greedy model produces correct results.
\end{DoxyVerb}
 

Definition at line 65 of file test\+\_\+controllable.\+py.


\begin{DoxyCode}
65     \textcolor{keyword}{def }test\_convai2\_finetuned\_greedy(self):
66         \textcolor{stringliteral}{"""}
67 \textcolor{stringliteral}{        Check the greedy model produces correct results.}
68 \textcolor{stringliteral}{        """}
69         \_, valid, \_ = testing\_utils.eval\_model(
70             \{
71                 \textcolor{stringliteral}{'model\_file'}: \textcolor{stringliteral}{'zoo:controllable\_dialogue/convai2\_finetuned\_baseline'},
72                 \textcolor{stringliteral}{'task'}: \textcolor{stringliteral}{'projects.controllable\_dialogue.tasks.agents'},
73                 \textcolor{stringliteral}{'beam\_size'}: 1,
74                 \textcolor{stringliteral}{'batchsize'}: 64,
75             \},
76             skip\_test=\textcolor{keyword}{True},
77         )
78 
79         self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 22.86, delta=0.1)
80         self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1702, delta=0.0002)
81 
\end{DoxyCode}
\mbox{\Hypertarget{classtest__controllable_1_1TestControllableDialogue_a12a49b51265fc21d9f1fe7a8dc45538a}\label{classtest__controllable_1_1TestControllableDialogue_a12a49b51265fc21d9f1fe7a8dc45538a}} 
\index{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}!test\+\_\+convai2\+\_\+finetuned\+\_\+norepetition@{test\+\_\+convai2\+\_\+finetuned\+\_\+norepetition}}
\index{test\+\_\+convai2\+\_\+finetuned\+\_\+norepetition@{test\+\_\+convai2\+\_\+finetuned\+\_\+norepetition}!test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}}
\subsubsection{\texorpdfstring{test\+\_\+convai2\+\_\+finetuned\+\_\+norepetition()}{test\_convai2\_finetuned\_norepetition()}}
{\footnotesize\ttfamily def test\+\_\+controllable.\+Test\+Controllable\+Dialogue.\+test\+\_\+convai2\+\_\+finetuned\+\_\+norepetition (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Checks the finetuned model with repetition blocking produces correct results.
\end{DoxyVerb}
 

Definition at line 105 of file test\+\_\+controllable.\+py.


\begin{DoxyCode}
105     \textcolor{keyword}{def }test\_convai2\_finetuned\_norepetition(self):
106         \textcolor{stringliteral}{"""}
107 \textcolor{stringliteral}{        Checks the finetuned model with repetition blocking produces correct results.}
108 \textcolor{stringliteral}{        """}
109         \_, valid, \_ = testing\_utils.eval\_model(
110             \{
111                 \textcolor{stringliteral}{'model\_file'}: \textcolor{stringliteral}{'zoo:controllable\_dialogue/convai2\_finetuned\_baseline'},
112                 \textcolor{stringliteral}{'task'}: \textcolor{stringliteral}{'projects.controllable\_dialogue.tasks.agents'},
113                 \textcolor{stringliteral}{'beam\_size'}: 20,
114                 \textcolor{stringliteral}{'beam\_min\_n\_best'}: 10,
115                 \textcolor{stringliteral}{'use\_reply'}: \textcolor{stringliteral}{'model'},
116                 \textcolor{stringliteral}{'batchsize'}: 64,
117                 \textcolor{stringliteral}{'num\_examples'}: NUM\_EXAMPLES,
118                 \textcolor{stringliteral}{'weighted\_decoding'}: NO\_REPETITION,
119             \},
120             skip\_test=\textcolor{keyword}{True},
121         )
122 
123         \textcolor{keywordflow}{if} FAST\_MODE:
124             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 26.66, delta=0.1)
125             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1389, delta=0.0002)
126         \textcolor{keywordflow}{else}:
127             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 25.83, delta=0.1)
128             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1375, delta=0.0002)
129 
\end{DoxyCode}
\mbox{\Hypertarget{classtest__controllable_1_1TestControllableDialogue_ab33835878eb846bcc457a90072bb06bd}\label{classtest__controllable_1_1TestControllableDialogue_ab33835878eb846bcc457a90072bb06bd}} 
\index{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}!test\+\_\+ct\+\_\+question\+\_\+bucket10@{test\+\_\+ct\+\_\+question\+\_\+bucket10}}
\index{test\+\_\+ct\+\_\+question\+\_\+bucket10@{test\+\_\+ct\+\_\+question\+\_\+bucket10}!test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}}
\subsubsection{\texorpdfstring{test\+\_\+ct\+\_\+question\+\_\+bucket10()}{test\_ct\_question\_bucket10()}}
{\footnotesize\ttfamily def test\+\_\+controllable.\+Test\+Controllable\+Dialogue.\+test\+\_\+ct\+\_\+question\+\_\+bucket10 (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Checks the question-controlled model (z=10 boost) produces correct results.
\end{DoxyVerb}
 

Definition at line 157 of file test\+\_\+controllable.\+py.


\begin{DoxyCode}
157     \textcolor{keyword}{def }test\_ct\_question\_bucket10(self):
158         \textcolor{stringliteral}{"""}
159 \textcolor{stringliteral}{        Checks the question-controlled model (z=10 boost) produces correct results.}
160 \textcolor{stringliteral}{        """}
161         \_, valid, \_ = testing\_utils.eval\_model(
162             \{
163                 \textcolor{stringliteral}{'model\_file'}: \textcolor{stringliteral}{'zoo:controllable\_dialogue/control\_questionb11e10'},
164                 \textcolor{stringliteral}{'task'}: \textcolor{stringliteral}{'projects.controllable\_dialogue.tasks.agents'},
165                 \textcolor{stringliteral}{'beam\_size'}: 20,
166                 \textcolor{stringliteral}{'beam\_min\_n\_best'}: 10,
167                 \textcolor{stringliteral}{'batchsize'}: 64,
168                 \textcolor{stringliteral}{'use\_reply'}: \textcolor{stringliteral}{'model'},
169                 \textcolor{stringliteral}{'num\_examples'}: NUM\_EXAMPLES,
170                 \textcolor{stringliteral}{'weighted\_decoding'}: \textcolor{stringliteral}{'extrep\_nonstopword:-1e20,intrep\_nonstopword:-1e20'},
171                 \textcolor{stringliteral}{'set\_controls'}: \textcolor{stringliteral}{'question:10'},
172                 \textcolor{stringliteral}{'beam\_reorder'}: \textcolor{stringliteral}{'best\_extrep2gram\_qn'},
173             \},
174             skip\_test=\textcolor{keyword}{True},
175         )
176 
177         \textcolor{keywordflow}{if} FAST\_MODE:
178             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 31.27, delta=0.1)
179             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1400, delta=0.0002)
180         \textcolor{keywordflow}{else}:
181             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 30.26, delta=0.1)
182             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1304, delta=0.0002)
183 
\end{DoxyCode}
\mbox{\Hypertarget{classtest__controllable_1_1TestControllableDialogue_aad1b8cd43766d6bfe04339c5ed7f3830}\label{classtest__controllable_1_1TestControllableDialogue_aad1b8cd43766d6bfe04339c5ed7f3830}} 
\index{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}!test\+\_\+ct\+\_\+question\+\_\+bucket7@{test\+\_\+ct\+\_\+question\+\_\+bucket7}}
\index{test\+\_\+ct\+\_\+question\+\_\+bucket7@{test\+\_\+ct\+\_\+question\+\_\+bucket7}!test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}}
\subsubsection{\texorpdfstring{test\+\_\+ct\+\_\+question\+\_\+bucket7()}{test\_ct\_question\_bucket7()}}
{\footnotesize\ttfamily def test\+\_\+controllable.\+Test\+Controllable\+Dialogue.\+test\+\_\+ct\+\_\+question\+\_\+bucket7 (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Checks the question-controlled model (z=7) produces correct results.
\end{DoxyVerb}
 

Definition at line 130 of file test\+\_\+controllable.\+py.


\begin{DoxyCode}
130     \textcolor{keyword}{def }test\_ct\_question\_bucket7(self):
131         \textcolor{stringliteral}{"""}
132 \textcolor{stringliteral}{        Checks the question-controlled model (z=7) produces correct results.}
133 \textcolor{stringliteral}{        """}
134         \_, valid, \_ = testing\_utils.eval\_model(
135             \{
136                 \textcolor{comment}{# b11e10 stands for 11 buckets, embedding size 10}
137                 \textcolor{stringliteral}{'model\_file'}: \textcolor{stringliteral}{'zoo:controllable\_dialogue/control\_questionb11e10'},
138                 \textcolor{stringliteral}{'task'}: \textcolor{stringliteral}{'projects.controllable\_dialogue.tasks.agents'},
139                 \textcolor{stringliteral}{'beam\_size'}: 20,
140                 \textcolor{stringliteral}{'beam\_min\_n\_best'}: 10,
141                 \textcolor{stringliteral}{'batchsize'}: 64,
142                 \textcolor{stringliteral}{'use\_reply'}: \textcolor{stringliteral}{'model'},
143                 \textcolor{stringliteral}{'num\_examples'}: NUM\_EXAMPLES,
144                 \textcolor{stringliteral}{'weighted\_decoding'}: NO\_REPETITION,
145                 \textcolor{stringliteral}{'set\_controls'}: \textcolor{stringliteral}{'question:7'},
146             \},
147             skip\_test=\textcolor{keyword}{True},
148         )
149 
150         \textcolor{keywordflow}{if} FAST\_MODE:
151             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 31.04, delta=0.1)
152             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1362, delta=0.0002)
153         \textcolor{keywordflow}{else}:
154             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 29.22, delta=0.1)
155             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1336, delta=0.0002)
156 
\end{DoxyCode}
\mbox{\Hypertarget{classtest__controllable_1_1TestControllableDialogue_a1cf543f3400075fe15ae7eea6b51156c}\label{classtest__controllable_1_1TestControllableDialogue_a1cf543f3400075fe15ae7eea6b51156c}} 
\index{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}!test\+\_\+ct\+\_\+specificity\+\_\+bucket7@{test\+\_\+ct\+\_\+specificity\+\_\+bucket7}}
\index{test\+\_\+ct\+\_\+specificity\+\_\+bucket7@{test\+\_\+ct\+\_\+specificity\+\_\+bucket7}!test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}}
\subsubsection{\texorpdfstring{test\+\_\+ct\+\_\+specificity\+\_\+bucket7()}{test\_ct\_specificity\_bucket7()}}
{\footnotesize\ttfamily def test\+\_\+controllable.\+Test\+Controllable\+Dialogue.\+test\+\_\+ct\+\_\+specificity\+\_\+bucket7 (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Checks the specificity-CT model (z=7) produces correct results.
\end{DoxyVerb}
 

Definition at line 184 of file test\+\_\+controllable.\+py.


\begin{DoxyCode}
184     \textcolor{keyword}{def }test\_ct\_specificity\_bucket7(self):
185         \textcolor{stringliteral}{"""}
186 \textcolor{stringliteral}{        Checks the specificity-CT model (z=7) produces correct results.}
187 \textcolor{stringliteral}{        """}
188         \_, valid, \_ = testing\_utils.eval\_model(
189             \{
190                 \textcolor{stringliteral}{'model\_file'}: \textcolor{stringliteral}{'zoo:controllable\_dialogue/control\_avgnidf10b10e'},
191                 \textcolor{stringliteral}{'task'}: \textcolor{stringliteral}{'projects.controllable\_dialogue.tasks.agents'},
192                 \textcolor{stringliteral}{'beam\_size'}: 20,
193                 \textcolor{stringliteral}{'beam\_min\_n\_best'}: 10,
194                 \textcolor{stringliteral}{'use\_reply'}: \textcolor{stringliteral}{'model'},
195                 \textcolor{stringliteral}{'batchsize'}: 64,
196                 \textcolor{stringliteral}{'num\_examples'}: NUM\_EXAMPLES,
197                 \textcolor{stringliteral}{'weighted\_decoding'}: NO\_REPETITION,
198                 \textcolor{stringliteral}{'set\_controls'}: \textcolor{stringliteral}{'avg\_nidf:7'},
199             \},
200             skip\_test=\textcolor{keyword}{True},
201         )
202 
203         \textcolor{keywordflow}{if} FAST\_MODE:
204             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 38.64, delta=0.1)
205             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1376, delta=0.0002)
206         \textcolor{keywordflow}{else}:
207             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 37.03, delta=0.1)
208             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1365, delta=0.0002)
209 
\end{DoxyCode}
\mbox{\Hypertarget{classtest__controllable_1_1TestControllableDialogue_afb3df76378e7449db2a4122568d8a8b2}\label{classtest__controllable_1_1TestControllableDialogue_afb3df76378e7449db2a4122568d8a8b2}} 
\index{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}!test\+\_\+dataset\+\_\+integrity@{test\+\_\+dataset\+\_\+integrity}}
\index{test\+\_\+dataset\+\_\+integrity@{test\+\_\+dataset\+\_\+integrity}!test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}}
\subsubsection{\texorpdfstring{test\+\_\+dataset\+\_\+integrity()}{test\_dataset\_integrity()}}
{\footnotesize\ttfamily def test\+\_\+controllable.\+Test\+Controllable\+Dialogue.\+test\+\_\+dataset\+\_\+integrity (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Check the controllble dialogue data loads.
\end{DoxyVerb}
 

Definition at line 24 of file test\+\_\+controllable.\+py.


\begin{DoxyCode}
24     \textcolor{keyword}{def }test\_dataset\_integrity(self):
25         \textcolor{stringliteral}{"""}
26 \textcolor{stringliteral}{        Check the controllble dialogue data loads.}
27 \textcolor{stringliteral}{        """}
28         train\_output, valid\_output, \_ = testing\_utils.display\_data(
29             \{\textcolor{stringliteral}{'task'}: \textcolor{stringliteral}{'projects.controllable\_dialogue.tasks.agents'}\}
30         )
31 
32         \textcolor{comment}{# check valid data}
33         self.assertIn(\textcolor{stringliteral}{'[lastuttsim]'}, train\_output)
34         self.assertIn(
35             \textcolor{stringliteral}{"hi , how are you doing ? i'm getting ready to do some cheetah "}
36             \textcolor{stringliteral}{"chasing to stay in shape ."},
37             train\_output,
38         )
39         self.assertIn(\textcolor{stringliteral}{'131438 examples'}, train\_output)
40 
41         \textcolor{comment}{# check valid data}
42         self.assertIn(\textcolor{stringliteral}{"hello what are doing today ?"}, valid\_output)
43         self.assertIn(\textcolor{stringliteral}{'[lastuttsim]'}, valid\_output)
44         self.assertIn(\textcolor{stringliteral}{'7801 examples'}, valid\_output)
45 
\end{DoxyCode}
\mbox{\Hypertarget{classtest__controllable_1_1TestControllableDialogue_ad46fe0ecf2f0b42e60424d1c7b37a2f5}\label{classtest__controllable_1_1TestControllableDialogue_ad46fe0ecf2f0b42e60424d1c7b37a2f5}} 
\index{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}!test\+\_\+train\+\_\+model@{test\+\_\+train\+\_\+model}}
\index{test\+\_\+train\+\_\+model@{test\+\_\+train\+\_\+model}!test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}}
\subsubsection{\texorpdfstring{test\+\_\+train\+\_\+model()}{test\_train\_model()}}
{\footnotesize\ttfamily def test\+\_\+controllable.\+Test\+Controllable\+Dialogue.\+test\+\_\+train\+\_\+model (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Check the training script doesn't crash.
\end{DoxyVerb}
 

Definition at line 46 of file test\+\_\+controllable.\+py.


\begin{DoxyCode}
46     \textcolor{keyword}{def }test\_train\_model(self):
47         \textcolor{stringliteral}{"""}
48 \textcolor{stringliteral}{        Check the training script doesn't crash.}
49 \textcolor{stringliteral}{        """}
50         \textcolor{keyword}{import} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1train__controllable__seq2seq}{projects.controllable\_dialogue.train\_controllable\_seq2seq}
       \textcolor{keyword}{as} tcs2s
51 
52         parser = tcs2s.setup\_args()
53         \textcolor{comment}{# make it much smaller just for testing}
54         parser.set\_params(
55             max\_train\_time=120,
56             validation\_max\_exs=128,
57             batchsize=16,
58             truncate=32,
59             short\_final\_eval=\textcolor{keyword}{True},
60         )
61         with testing\_utils.capture\_output():
62             opt = parser.parse\_args()
63             tcs2s.TrainLoop(opt).\hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a36a5f4f6f9df0611a6818610518d2cf0}{train}()
64 
\end{DoxyCode}
\mbox{\Hypertarget{classtest__controllable_1_1TestControllableDialogue_acc29f953a7fb51ef9a0dedafa8129cc2}\label{classtest__controllable_1_1TestControllableDialogue_acc29f953a7fb51ef9a0dedafa8129cc2}} 
\index{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}!test\+\_\+wd\+\_\+responsiveness@{test\+\_\+wd\+\_\+responsiveness}}
\index{test\+\_\+wd\+\_\+responsiveness@{test\+\_\+wd\+\_\+responsiveness}!test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}}
\subsubsection{\texorpdfstring{test\+\_\+wd\+\_\+responsiveness()}{test\_wd\_responsiveness()}}
{\footnotesize\ttfamily def test\+\_\+controllable.\+Test\+Controllable\+Dialogue.\+test\+\_\+wd\+\_\+responsiveness (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Checks the responsiveness-weighted decoding model produces correct results.
\end{DoxyVerb}
 

Definition at line 235 of file test\+\_\+controllable.\+py.


\begin{DoxyCode}
235     \textcolor{keyword}{def }test\_wd\_responsiveness(self):
236         \textcolor{stringliteral}{"""}
237 \textcolor{stringliteral}{        Checks the responsiveness-weighted decoding model produces correct results.}
238 \textcolor{stringliteral}{        """}
239         \_, valid, \_ = testing\_utils.eval\_model(
240             \{
241                 \textcolor{stringliteral}{'model\_file'}: \textcolor{stringliteral}{'zoo:controllable\_dialogue/convai2\_finetuned\_baseline'},
242                 \textcolor{stringliteral}{'task'}: \textcolor{stringliteral}{'projects.controllable\_dialogue.tasks.agents'},
243                 \textcolor{stringliteral}{'beam\_size'}: 20,
244                 \textcolor{stringliteral}{'beam\_min\_n\_best'}: 10,
245                 \textcolor{stringliteral}{'use\_reply'}: \textcolor{stringliteral}{'model'},
246                 \textcolor{stringliteral}{'batchsize'}: 64,
247                 \textcolor{stringliteral}{'num\_examples'}: NUM\_EXAMPLES,
248                 \textcolor{stringliteral}{'weighted\_decoding'}: NO\_REPETITION
249                 + \textcolor{stringliteral}{',intrep\_2gram:-1e20,partnerrep\_2gram:-1e20,lastuttsim:5'},  \textcolor{comment}{# noqa: E501}
250             \},
251             skip\_test=\textcolor{keyword}{True},
252         )
253 
254         \textcolor{keywordflow}{if} FAST\_MODE:
255             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 26.16, delta=0.1)
256             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1399, delta=0.0002)
257         \textcolor{keywordflow}{else}:
258             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 25.47, delta=0.1)
259             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1369, delta=0.0002)
260 
261 
\end{DoxyCode}
\mbox{\Hypertarget{classtest__controllable_1_1TestControllableDialogue_a357a886c76cc4d72cc2345eaee912f46}\label{classtest__controllable_1_1TestControllableDialogue_a357a886c76cc4d72cc2345eaee912f46}} 
\index{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}!test\+\_\+wd\+\_\+specificity@{test\+\_\+wd\+\_\+specificity}}
\index{test\+\_\+wd\+\_\+specificity@{test\+\_\+wd\+\_\+specificity}!test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue@{test\+\_\+controllable\+::\+Test\+Controllable\+Dialogue}}
\subsubsection{\texorpdfstring{test\+\_\+wd\+\_\+specificity()}{test\_wd\_specificity()}}
{\footnotesize\ttfamily def test\+\_\+controllable.\+Test\+Controllable\+Dialogue.\+test\+\_\+wd\+\_\+specificity (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Checks the specificity-weighted decoding model produces correct results.
\end{DoxyVerb}
 

Definition at line 210 of file test\+\_\+controllable.\+py.


\begin{DoxyCode}
210     \textcolor{keyword}{def }test\_wd\_specificity(self):
211         \textcolor{stringliteral}{"""}
212 \textcolor{stringliteral}{        Checks the specificity-weighted decoding model produces correct results.}
213 \textcolor{stringliteral}{        """}
214         \_, valid, \_ = testing\_utils.eval\_model(
215             \{
216                 \textcolor{stringliteral}{'model\_file'}: \textcolor{stringliteral}{'zoo:controllable\_dialogue/convai2\_finetuned\_baseline'},
217                 \textcolor{stringliteral}{'task'}: \textcolor{stringliteral}{'projects.controllable\_dialogue.tasks.agents'},
218                 \textcolor{stringliteral}{'beam\_size'}: 20,
219                 \textcolor{stringliteral}{'beam\_min\_n\_best'}: 10,
220                 \textcolor{stringliteral}{'use\_reply'}: \textcolor{stringliteral}{'model'},
221                 \textcolor{stringliteral}{'batchsize'}: 64,
222                 \textcolor{stringliteral}{'num\_examples'}: NUM\_EXAMPLES,
223                 \textcolor{stringliteral}{'weighted\_decoding'}: NO\_REPETITION + \textcolor{stringliteral}{',nidf:4'},
224             \},
225             skip\_test=\textcolor{keyword}{True},
226         )
227 
228         \textcolor{keywordflow}{if} FAST\_MODE:
229             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 25.74, delta=0.1)
230             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1366, delta=0.0002)
231         \textcolor{keywordflow}{else}:
232             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'ppl'}], 25.57, delta=0.1)
233             self.assertAlmostEqual(valid[\textcolor{stringliteral}{'f1'}], 0.1349, delta=0.0002)
234 
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
tests/nightly/gpu/\hyperlink{test__controllable_8py}{test\+\_\+controllable.\+py}\end{DoxyCompactItemize}
