\hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager}{}\section{parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager Class Reference}
\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager}\index{parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager@{parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager}}


Inheritance diagram for parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=320pt]{d3/dfb/classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=320pt]{d0/d0c/classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a7a9b4068fc428aebd90c38bbe745e45e}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1chat__service_1_1core_1_1chat__service__manager_1_1ChatServiceManager_a418cecffd5c3e0d6a00919eaa837d0e2}{opt})
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ab5419adfecea8ac7f1d5ceda1f15fad9}{parse\+\_\+additional\+\_\+args} (self, \hyperlink{classparlai_1_1chat__service_1_1core_1_1chat__service__manager_1_1ChatServiceManager_a418cecffd5c3e0d6a00919eaa837d0e2}{opt})
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_aef9d4ef50c80aa22176d992f14da9747}{restructure\+\_\+message} (self)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a305c58cba4b22f99274b81a9253a4ca9}{mark\+\_\+removed} (self, agent\+\_\+id, pageid)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ade5e639c76e2c48815c079d515ecaf9b}{after\+\_\+agent\+\_\+removed} (self, agent\+\_\+id)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_adb6559f9e8cca74e2ac94d443f36f9d2}{setup\+\_\+server} (self)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a0fa4fe590efa528624a0965dbb995683}{get\+\_\+app\+\_\+token} (self)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_aa3762b7362346cdaaf1d1ad0d6372166}{setup\+\_\+socket} (self)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ab951bfae1eeb05f42e9fa215b2d019a7}{observe\+\_\+message} (self, receiver\+\_\+id, text, quick\+\_\+replies=None, persona\+\_\+id=None)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ad969bb72a7095bde4f48be0a403e9471}{observe\+\_\+payload} (self, receiver\+\_\+id, data, quick\+\_\+replies=None, persona\+\_\+id=None)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a64b1a7241aecdca1d321efa92134ff96}{upload\+\_\+attachment} (self, payload)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a5e0b062728492fb6409eabe25895c5f8}{service\+\_\+reference\+\_\+id}
\item 
\hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a7cef66a59364fa94ea8ff77a311ecf63}{server\+\_\+task\+\_\+name}
\item 
\hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a70e95421663ad81807980f3461d4b380}{server\+\_\+url}
\item 
\hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_aa52ef2280a697896f4d3b5bdb322e553}{app\+\_\+token}
\item 
\hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a1e14e377b1e59ddba4a23ea45f793b01}{sender}
\item 
\hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a884b4e6cefa84652bbdb677f575ae6c4}{socket}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Manages interactions between agents on messenger as well as direct interactions
between agents and the messenger overworld.
\end{DoxyVerb}
 

Definition at line 27 of file messenger\+\_\+manager.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a7a9b4068fc428aebd90c38bbe745e45e}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a7a9b4068fc428aebd90c38bbe745e45e}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create an MessengerManager using the given setup options.
\end{DoxyVerb}
 

Definition at line 33 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
33     \textcolor{keyword}{def }\_\_init\_\_(self, opt):
34         \textcolor{stringliteral}{"""}
35 \textcolor{stringliteral}{        Create an MessengerManager using the given setup options.}
36 \textcolor{stringliteral}{        """}
37         \textcolor{comment}{# Manager attributes}
38         super().\_\_init\_\_(opt)
39 
40         self.\_init\_logs()
41         \textcolor{comment}{# Read in Config}
42         self.\_parse\_config(opt)
43         self.\_complete\_setup()
44 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ade5e639c76e2c48815c079d515ecaf9b}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ade5e639c76e2c48815c079d515ecaf9b}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!after\+\_\+agent\+\_\+removed@{after\+\_\+agent\+\_\+removed}}
\index{after\+\_\+agent\+\_\+removed@{after\+\_\+agent\+\_\+removed}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{after\+\_\+agent\+\_\+removed()}{after\_agent\_removed()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+after\+\_\+agent\+\_\+removed (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{agent\+\_\+id }\end{DoxyParamCaption})}

\begin{DoxyVerb}Perform any changes to metadata on agent removal.

override if extra bookkeeping must be done when removing agent
\end{DoxyVerb}
 

Definition at line 123 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
123     \textcolor{keyword}{def }after\_agent\_removed(self, agent\_id):
124         \textcolor{stringliteral}{"""}
125 \textcolor{stringliteral}{        Perform any changes to metadata on agent removal.}
126 \textcolor{stringliteral}{}
127 \textcolor{stringliteral}{        override if extra bookkeeping must be done when removing agent}
128 \textcolor{stringliteral}{        """}
129         \textcolor{keywordflow}{pass}
130 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a0fa4fe590efa528624a0965dbb995683}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a0fa4fe590efa528624a0965dbb995683}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!get\+\_\+app\+\_\+token@{get\+\_\+app\+\_\+token}}
\index{get\+\_\+app\+\_\+token@{get\+\_\+app\+\_\+token}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{get\+\_\+app\+\_\+token()}{get\_app\_token()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+get\+\_\+app\+\_\+token (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Find and return an app access token.
\end{DoxyVerb}
 

Definition at line 208 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
208     \textcolor{keyword}{def }get\_app\_token(self):
209         \textcolor{stringliteral}{"""}
210 \textcolor{stringliteral}{        Find and return an app access token.}
211 \textcolor{stringliteral}{        """}
212         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.opt.get(\textcolor{stringliteral}{'force\_page\_token'}):
213             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(os.path.expanduser(\textcolor{stringliteral}{'~/.parlai/'})):
214                 os.makedirs(os.path.expanduser(\textcolor{stringliteral}{'~/.parlai/'}))
215             access\_token\_file\_path = \textcolor{stringliteral}{'~/.parlai/messenger\_token'}
216             expanded\_file\_path = os.path.expanduser(access\_token\_file\_path)
217             \textcolor{keywordflow}{if} os.path.exists(expanded\_file\_path):
218                 with open(expanded\_file\_path, \textcolor{stringliteral}{'r') as access\_token\_file:}
219 \textcolor{stringliteral}{                    }\textcolor{keywordflow}{return} access\_token\_file.read()
220 
221         token = input(
222             \textcolor{stringliteral}{'Enter your page\(\backslash\)'s access token from the developer page at'}
223             \textcolor{stringliteral}{'https://developers.facebook.com/apps/<YOUR APP ID>'}
224             \textcolor{stringliteral}{'/messenger/settings/ to continue setup:'}
225         )
226         access\_token\_file\_path = \textcolor{stringliteral}{'~/.parlai/messenger\_token'}
227         expanded\_file\_path = os.path.expanduser(access\_token\_file\_path)
228         with open(expanded\_file\_path, \textcolor{stringliteral}{'w+'}) \textcolor{keyword}{as} access\_token\_file:
229             access\_token\_file.write(token)
230         \textcolor{keywordflow}{return} token
231 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a305c58cba4b22f99274b81a9253a4ca9}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a305c58cba4b22f99274b81a9253a4ca9}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!mark\+\_\+removed@{mark\+\_\+removed}}
\index{mark\+\_\+removed@{mark\+\_\+removed}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{mark\+\_\+removed()}{mark\_removed()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+mark\+\_\+removed (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{agent\+\_\+id,  }\item[{}]{pageid }\end{DoxyParamCaption})}

\begin{DoxyVerb}Mark the agent as removed from the pool.

Can be overriden to change other metadata linked to agent removal.

:param agent_id:
    int agent psid
:param pageid:
    int page id
\end{DoxyVerb}
 

Definition at line 81 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
81     \textcolor{keyword}{def }mark\_removed(self, agent\_id, pageid):
82         \textcolor{stringliteral}{"""}
83 \textcolor{stringliteral}{        Mark the agent as removed from the pool.}
84 \textcolor{stringliteral}{}
85 \textcolor{stringliteral}{        Can be overriden to change other metadata linked to agent removal.}
86 \textcolor{stringliteral}{}
87 \textcolor{stringliteral}{        :param agent\_id:}
88 \textcolor{stringliteral}{            int agent psid}
89 \textcolor{stringliteral}{        :param pageid:}
90 \textcolor{stringliteral}{            int page id}
91 \textcolor{stringliteral}{        """}
92         \textcolor{keywordflow}{pass}
93 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ab951bfae1eeb05f42e9fa215b2d019a7}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ab951bfae1eeb05f42e9fa215b2d019a7}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!observe\+\_\+message@{observe\+\_\+message}}
\index{observe\+\_\+message@{observe\+\_\+message}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{observe\+\_\+message()}{observe\_message()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+observe\+\_\+message (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{receiver\+\_\+id,  }\item[{}]{text,  }\item[{}]{quick\+\_\+replies = {\ttfamily None},  }\item[{}]{persona\+\_\+id = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Send a message through the message manager.

:param receiver_id:
    int identifier for agent to send message to
:param text:
    string text to send
:param quick_replies:
    list of quick replies
:param persona_id:
    identifier of persona
\end{DoxyVerb}
 

Definition at line 258 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
258     \textcolor{keyword}{def }observe\_message(self, receiver\_id, text, quick\_replies=None, persona\_id=None):
259         \textcolor{stringliteral}{"""}
260 \textcolor{stringliteral}{        Send a message through the message manager.}
261 \textcolor{stringliteral}{}
262 \textcolor{stringliteral}{        :param receiver\_id:}
263 \textcolor{stringliteral}{            int identifier for agent to send message to}
264 \textcolor{stringliteral}{        :param text:}
265 \textcolor{stringliteral}{            string text to send}
266 \textcolor{stringliteral}{        :param quick\_replies:}
267 \textcolor{stringliteral}{            list of quick replies}
268 \textcolor{stringliteral}{        :param persona\_id:}
269 \textcolor{stringliteral}{            identifier of persona}
270 \textcolor{stringliteral}{        """}
271         \textcolor{keywordflow}{return} self.sender.send\_fb\_message(
272             receiver\_id, text, \textcolor{keyword}{True}, quick\_replies=quick\_replies, persona\_id=persona\_id
273         )
274 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ad969bb72a7095bde4f48be0a403e9471}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ad969bb72a7095bde4f48be0a403e9471}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!observe\+\_\+payload@{observe\+\_\+payload}}
\index{observe\+\_\+payload@{observe\+\_\+payload}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{observe\+\_\+payload()}{observe\_payload()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+observe\+\_\+payload (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{receiver\+\_\+id,  }\item[{}]{data,  }\item[{}]{quick\+\_\+replies = {\ttfamily None},  }\item[{}]{persona\+\_\+id = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Send a payload through the message manager.

:param receiver_id:
    int identifier for agent to send message to
:param data:
    object data to send
:param quick_replies:
    list of quick replies
:param persona_id:
    identifier of persona
\end{DoxyVerb}
 

Definition at line 275 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
275     \textcolor{keyword}{def }observe\_payload(self, receiver\_id, data, quick\_replies=None, persona\_id=None):
276         \textcolor{stringliteral}{"""}
277 \textcolor{stringliteral}{        Send a payload through the message manager.}
278 \textcolor{stringliteral}{}
279 \textcolor{stringliteral}{        :param receiver\_id:}
280 \textcolor{stringliteral}{            int identifier for agent to send message to}
281 \textcolor{stringliteral}{        :param data:}
282 \textcolor{stringliteral}{            object data to send}
283 \textcolor{stringliteral}{        :param quick\_replies:}
284 \textcolor{stringliteral}{            list of quick replies}
285 \textcolor{stringliteral}{        :param persona\_id:}
286 \textcolor{stringliteral}{            identifier of persona}
287 \textcolor{stringliteral}{        """}
288         \textcolor{keywordflow}{return} self.sender.send\_fb\_payload(
289             receiver\_id, data, quick\_replies=quick\_replies, persona\_id=persona\_id
290         )
291 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ab5419adfecea8ac7f1d5ceda1f15fad9}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_ab5419adfecea8ac7f1d5ceda1f15fad9}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!parse\+\_\+additional\+\_\+args@{parse\+\_\+additional\+\_\+args}}
\index{parse\+\_\+additional\+\_\+args@{parse\+\_\+additional\+\_\+args}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{parse\+\_\+additional\+\_\+args()}{parse\_additional\_args()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+parse\+\_\+additional\+\_\+args (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 45 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
45     \textcolor{keyword}{def }parse\_additional\_args(self, opt):
46         self.service\_reference\_id = self.config[\textcolor{stringliteral}{'page\_id'}]
47         \textcolor{keywordflow}{if} self.service\_reference\_id == 1:
48             \textcolor{keywordflow}{raise} RuntimeError(
49                 \textcolor{stringliteral}{'Please configure your own page in order to run this task. '}
50                 \textcolor{stringliteral}{'See the docs (https://parl.ai/docs/tutorial\_messenger.html) '}
51                 \textcolor{stringliteral}{'for more information.'}
52             )
53 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_aef9d4ef50c80aa22176d992f14da9747}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_aef9d4ef50c80aa22176d992f14da9747}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!restructure\+\_\+message@{restructure\+\_\+message}}
\index{restructure\+\_\+message@{restructure\+\_\+message}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{restructure\+\_\+message()}{restructure\_message()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+restructure\+\_\+message (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 54 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
54     \textcolor{keyword}{def }restructure\_message(self):
55         \textcolor{keywordflow}{pass}
56 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_adb6559f9e8cca74e2ac94d443f36f9d2}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_adb6559f9e8cca74e2ac94d443f36f9d2}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!setup\+\_\+server@{setup\+\_\+server}}
\index{setup\+\_\+server@{setup\+\_\+server}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{setup\+\_\+server()}{setup\_server()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+setup\+\_\+server (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Prepare the Messenger server for handling messages.
\end{DoxyVerb}
 

Definition at line 158 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
158     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1server__utils_afb56b04206cd0f42384438f1ac6d9cda}{setup\_server}(self):
159         \textcolor{stringliteral}{"""}
160 \textcolor{stringliteral}{        Prepare the Messenger server for handling messages.}
161 \textcolor{stringliteral}{        """}
162         \textcolor{keywordflow}{if} self.bypass\_server\_setup:
163             \textcolor{keywordflow}{return}
164 
165         shared\_utils.print\_and\_log(
166             logging.INFO,
167             \textcolor{stringliteral}{'\(\backslash\)nYou are going to allow people on Facebook to be agents in '}
168             \textcolor{stringliteral}{'ParlAI.\(\backslash\)nDuring this process, Internet connection is required, '}
169             \textcolor{stringliteral}{'and you should turn off your computer\(\backslash\)'s auto-sleep '}
170             \textcolor{stringliteral}{'feature.\(\backslash\)n'},
171             should\_print=\textcolor{keyword}{True},
172         )
173         input(\textcolor{stringliteral}{'Please press Enter to continue... '})
174         shared\_utils.print\_and\_log(logging.NOTSET, \textcolor{stringliteral}{''}, \textcolor{keyword}{True})
175 
176         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'local'}] \textcolor{keywordflow}{is} \textcolor{keyword}{True}:
177             shared\_utils.print\_and\_log(
178                 logging.INFO,
179                 \textcolor{stringliteral}{'In order to run the server locally, you will need '}
180                 \textcolor{stringliteral}{'to have a public HTTPS endpoint (SSL signed) running on '}
181                 \textcolor{stringliteral}{'the server you are currently excecuting ParlAI on. Enter '}
182                 \textcolor{stringliteral}{'that public URL hostname when prompted and ensure that the '}
183                 \textcolor{stringliteral}{'port being used by ParlAI (usually 3000) has external '}
184                 \textcolor{stringliteral}{'traffic routed to it.'},
185                 should\_print=\textcolor{keyword}{True},
186             )
187             input(\textcolor{stringliteral}{'Please press Enter to continue... '})
188 
189         shared\_utils.print\_and\_log(
190             logging.INFO, \textcolor{stringliteral}{'Setting up Messenger webhook...'}, should\_print=\textcolor{keyword}{True}
191         )
192 
193         \textcolor{comment}{# Setup the server with a task name related to the current task}
194         task\_name = \textcolor{stringliteral}{'\{\}-\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(\textcolor{stringliteral}{'ParlAI-Messenger'}, self.opt[\textcolor{stringliteral}{'task'}])
195         self.server\_task\_name = \textcolor{stringliteral}{''}.join(
196             e \textcolor{keywordflow}{for} e \textcolor{keywordflow}{in} task\_name.lower() \textcolor{keywordflow}{if} e.isalnum() \textcolor{keywordflow}{or} e == \textcolor{stringliteral}{'-'}
197         )
198         self.server\_url = server\_utils.setup\_server(
199             self.server\_task\_name, local=self.opt[\textcolor{stringliteral}{'local'}]
200         )
201         shared\_utils.print\_and\_log(
202             logging.INFO,
203             \textcolor{stringliteral}{'Webhook address: \{\}/webhook'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(self.server\_url),
204             should\_print=\textcolor{keyword}{True},
205         )
206 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_aa3762b7362346cdaaf1d1ad0d6372166}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_aa3762b7362346cdaaf1d1ad0d6372166}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!setup\+\_\+socket@{setup\+\_\+socket}}
\index{setup\+\_\+socket@{setup\+\_\+socket}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{setup\+\_\+socket()}{setup\_socket()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+setup\+\_\+socket (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Set up socket to start communicating to workers.
\end{DoxyVerb}
 

Definition at line 232 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
232     \textcolor{keyword}{def }setup\_socket(self):
233         \textcolor{stringliteral}{"""}
234 \textcolor{stringliteral}{        Set up socket to start communicating to workers.}
235 \textcolor{stringliteral}{        """}
236         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.bypass\_server\_setup:
237             shared\_utils.print\_and\_log(
238                 logging.INFO, \textcolor{stringliteral}{'Local: Setting up WebSocket...'}, should\_print=\textcolor{keyword}{True}
239             )
240 
241         self.app\_token = self.get\_app\_token()
242         self.sender = MessageSender(self.app\_token)
243 
244         \textcolor{comment}{# Set up receive}
245         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.bypass\_server\_setup:
246             socket\_use\_url = self.server\_url
247             \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'local'}]:  \textcolor{comment}{# skip some hops for local stuff}
248                 socket\_use\_url = \textcolor{stringliteral}{'https://localhost'}
249             self.socket = ChatServiceMessageSocket(
250                 socket\_use\_url, self.port, self.\_handle\_webhook\_event
251             )
252         shared\_utils.print\_and\_log(
253             logging.INFO, \textcolor{stringliteral}{'done with websocket'}, should\_print=\textcolor{keyword}{True}
254         )
255 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a64b1a7241aecdca1d321efa92134ff96}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a64b1a7241aecdca1d321efa92134ff96}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!upload\+\_\+attachment@{upload\+\_\+attachment}}
\index{upload\+\_\+attachment@{upload\+\_\+attachment}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{upload\+\_\+attachment()}{upload\_attachment()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+upload\+\_\+attachment (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{payload }\end{DoxyParamCaption})}

\begin{DoxyVerb}Upload an attachment and return an attachment ID.

:param payload:
    dict with the following format:
{'type': <TYPE>, 'url': <URL>} or
{'type': <TYPE>, 'filename': <FILENAME>, 'format': <FILEFORMAT>}.
For example,
{'type': 'image', 'filename': 'test.png', 'format': 'png'}
\end{DoxyVerb}
 

Definition at line 292 of file messenger\+\_\+manager.\+py.


\begin{DoxyCode}
292     \textcolor{keyword}{def }upload\_attachment(self, payload):
293         \textcolor{stringliteral}{"""}
294 \textcolor{stringliteral}{        Upload an attachment and return an attachment ID.}
295 \textcolor{stringliteral}{}
296 \textcolor{stringliteral}{        :param payload:}
297 \textcolor{stringliteral}{            dict with the following format:}
298 \textcolor{stringliteral}{                \{'type': <TYPE>, 'url': <URL>\} or}
299 \textcolor{stringliteral}{                \{'type': <TYPE>, 'filename': <FILENAME>, 'format': <FILEFORMAT>\}.}
300 \textcolor{stringliteral}{                For example,}
301 \textcolor{stringliteral}{                \{'type': 'image', 'filename': 'test.png', 'format': 'png'\}}
302 \textcolor{stringliteral}{        """}
303         \textcolor{keywordflow}{return} self.sender.upload\_fb\_attachment(payload)
304 \end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_aa52ef2280a697896f4d3b5bdb322e553}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_aa52ef2280a697896f4d3b5bdb322e553}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!app\+\_\+token@{app\+\_\+token}}
\index{app\+\_\+token@{app\+\_\+token}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{app\+\_\+token}{app\_token}}
{\footnotesize\ttfamily parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+app\+\_\+token}



Definition at line 241 of file messenger\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a1e14e377b1e59ddba4a23ea45f793b01}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a1e14e377b1e59ddba4a23ea45f793b01}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!sender@{sender}}
\index{sender@{sender}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{sender}{sender}}
{\footnotesize\ttfamily parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+sender}



Definition at line 242 of file messenger\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a7cef66a59364fa94ea8ff77a311ecf63}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a7cef66a59364fa94ea8ff77a311ecf63}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!server\+\_\+task\+\_\+name@{server\+\_\+task\+\_\+name}}
\index{server\+\_\+task\+\_\+name@{server\+\_\+task\+\_\+name}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{server\+\_\+task\+\_\+name}{server\_task\_name}}
{\footnotesize\ttfamily parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+server\+\_\+task\+\_\+name}



Definition at line 195 of file messenger\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a70e95421663ad81807980f3461d4b380}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a70e95421663ad81807980f3461d4b380}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!server\+\_\+url@{server\+\_\+url}}
\index{server\+\_\+url@{server\+\_\+url}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{server\+\_\+url}{server\_url}}
{\footnotesize\ttfamily parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+server\+\_\+url}



Definition at line 198 of file messenger\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a5e0b062728492fb6409eabe25895c5f8}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a5e0b062728492fb6409eabe25895c5f8}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!service\+\_\+reference\+\_\+id@{service\+\_\+reference\+\_\+id}}
\index{service\+\_\+reference\+\_\+id@{service\+\_\+reference\+\_\+id}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{service\+\_\+reference\+\_\+id}{service\_reference\_id}}
{\footnotesize\ttfamily parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+service\+\_\+reference\+\_\+id}



Definition at line 46 of file messenger\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a884b4e6cefa84652bbdb677f575ae6c4}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1messenger__manager_1_1MessengerManager_a884b4e6cefa84652bbdb677f575ae6c4}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}!socket@{socket}}
\index{socket@{socket}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::messenger\+\_\+manager\+::\+Messenger\+Manager}}
\subsubsection{\texorpdfstring{socket}{socket}}
{\footnotesize\ttfamily parlai.\+chat\+\_\+service.\+services.\+messenger.\+messenger\+\_\+manager.\+Messenger\+Manager.\+socket}



Definition at line 249 of file messenger\+\_\+manager.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/chat\+\_\+service/services/messenger/\hyperlink{messenger__manager_8py}{messenger\+\_\+manager.\+py}\end{DoxyCompactItemize}
