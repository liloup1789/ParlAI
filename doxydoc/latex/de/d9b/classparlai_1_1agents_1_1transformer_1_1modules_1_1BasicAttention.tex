\hypertarget{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention}{}\section{parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention Class Reference}
\label{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention}\index{parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention@{parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention}}


Inheritance diagram for parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=263pt]{df/d42/classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=247pt]{d2/dd8/classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_afa25129ca6ce9851053205f44f090fd6}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_ad0beb8f8b3e4514139b08555cf739d55}{dim}=1, \hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a04d74d5efbfdf47d36aff30331775368}{attn}=\textquotesingle{}\hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_abed26e42fa2293f14cbbcf51c090794c}{cosine}\textquotesingle{}, \hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a98c0f263db25cf305c333e04f8a0843d}{residual}=False, \hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a98d54b38fac0a88d46eba7adf6ac542c}{get\+\_\+weights}=True)
\item 
def \hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_adb18b6c2564672c1820b3c72583dc0c0}{forward} (self, xs, ys, mask\+\_\+ys=None, values=None)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a669fa3f4cd988703371fc127a4943f07}{softmax}
\item 
\hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_abed26e42fa2293f14cbbcf51c090794c}{cosine}
\item 
\hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a04d74d5efbfdf47d36aff30331775368}{attn}
\item 
\hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_ad0beb8f8b3e4514139b08555cf739d55}{dim}
\item 
\hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a98d54b38fac0a88d46eba7adf6ac542c}{get\+\_\+weights}
\item 
\hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a98c0f263db25cf305c333e04f8a0843d}{residual}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Implements simple/classical attention.
\end{DoxyVerb}
 

Definition at line 946 of file modules.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_afa25129ca6ce9851053205f44f090fd6}\label{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_afa25129ca6ce9851053205f44f090fd6}} 
\index{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{dim = {\ttfamily 1},  }\item[{}]{attn = {\ttfamily \textquotesingle{}\hyperlink{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_abed26e42fa2293f14cbbcf51c090794c}{cosine}\textquotesingle{}},  }\item[{}]{residual = {\ttfamily False},  }\item[{}]{get\+\_\+weights = {\ttfamily True} }\end{DoxyParamCaption})}



Definition at line 951 of file modules.\+py.


\begin{DoxyCode}
951     \textcolor{keyword}{def }\_\_init\_\_(self, dim=1, attn='cosine', residual=False, get\_weights=True):
952         super().\_\_init\_\_()
953         self.softmax = nn.Softmax(dim=dim)
954         \textcolor{keywordflow}{if} attn == \textcolor{stringliteral}{'cosine'}:
955             self.cosine = nn.CosineSimilarity(dim=dim)
956         self.attn = attn
957         self.dim = dim
958         self.get\_weights = get\_weights
959         self.residual = residual
960 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_adb18b6c2564672c1820b3c72583dc0c0}\label{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_adb18b6c2564672c1820b3c72583dc0c0}} 
\index{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}!forward@{forward}}
\index{forward@{forward}!parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}}
\subsubsection{\texorpdfstring{forward()}{forward()}}
{\footnotesize\ttfamily def parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention.\+forward (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{xs,  }\item[{}]{ys,  }\item[{}]{mask\+\_\+ys = {\ttfamily None},  }\item[{}]{values = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Compute attention.

Attend over ys with query xs to obtain weights, then apply weights to
values (ys if yalues is None)

Args:
    xs: B x query_len x dim (queries)
    ys: B x key_len x dim (keys)
    mask_ys: B x key_len (mask)
    values: B x value_len x dim (values); if None, default to ys
\end{DoxyVerb}
 

Definition at line 961 of file modules.\+py.


\begin{DoxyCode}
961     \textcolor{keyword}{def }forward(self, xs, ys, mask\_ys=None, values=None):
962         \textcolor{stringliteral}{"""}
963 \textcolor{stringliteral}{        Compute attention.}
964 \textcolor{stringliteral}{}
965 \textcolor{stringliteral}{        Attend over ys with query xs to obtain weights, then apply weights to}
966 \textcolor{stringliteral}{        values (ys if yalues is None)}
967 \textcolor{stringliteral}{}
968 \textcolor{stringliteral}{        Args:}
969 \textcolor{stringliteral}{            xs: B x query\_len x dim (queries)}
970 \textcolor{stringliteral}{            ys: B x key\_len x dim (keys)}
971 \textcolor{stringliteral}{            mask\_ys: B x key\_len (mask)}
972 \textcolor{stringliteral}{            values: B x value\_len x dim (values); if None, default to ys}
973 \textcolor{stringliteral}{        """}
974         bsz = xs.size(0)
975         y\_len = ys.size(1)
976         x\_len = xs.size(1)
977         \textcolor{keywordflow}{if} self.attn == \textcolor{stringliteral}{'cosine'}:
978             l1 = self.cosine(xs, ys).unsqueeze(self.dim - 1)
979         \textcolor{keywordflow}{else}:
980             l1 = torch.bmm(xs, ys.transpose(1, 2))
981             \textcolor{keywordflow}{if} self.attn == \textcolor{stringliteral}{'sqrt'}:
982                 d\_k = ys.size(-1)
983                 l1 = l1 / math.sqrt(d\_k)
984         \textcolor{keywordflow}{if} mask\_ys \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
985             attn\_mask = (mask\_ys == 0).view(bsz, 1, y\_len)
986             attn\_mask = attn\_mask.repeat(1, x\_len, 1)
987             l1.masked\_fill\_(attn\_mask, -\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'inf'}))
988         l2 = self.softmax(l1)
989         \textcolor{keywordflow}{if} values \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
990             values = ys
991         lhs\_emb = torch.bmm(l2, values)
992 
993         \textcolor{comment}{# # add back the query}
994         \textcolor{keywordflow}{if} self.residual:
995             lhs\_emb = lhs\_emb.add(xs)
996 
997         \textcolor{keywordflow}{if} self.get\_weights:
998             \textcolor{keywordflow}{return} lhs\_emb.squeeze(self.dim - 1), l2
999         \textcolor{keywordflow}{else}:
1000             \textcolor{keywordflow}{return} lhs\_emb.squeeze(self.dim - 1)
1001 
1002 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a04d74d5efbfdf47d36aff30331775368}\label{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a04d74d5efbfdf47d36aff30331775368}} 
\index{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}!attn@{attn}}
\index{attn@{attn}!parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}}
\subsubsection{\texorpdfstring{attn}{attn}}
{\footnotesize\ttfamily parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention.\+attn}



Definition at line 956 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_abed26e42fa2293f14cbbcf51c090794c}\label{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_abed26e42fa2293f14cbbcf51c090794c}} 
\index{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}!cosine@{cosine}}
\index{cosine@{cosine}!parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}}
\subsubsection{\texorpdfstring{cosine}{cosine}}
{\footnotesize\ttfamily parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention.\+cosine}



Definition at line 955 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_ad0beb8f8b3e4514139b08555cf739d55}\label{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_ad0beb8f8b3e4514139b08555cf739d55}} 
\index{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}!dim@{dim}}
\index{dim@{dim}!parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}}
\subsubsection{\texorpdfstring{dim}{dim}}
{\footnotesize\ttfamily parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention.\+dim}



Definition at line 957 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a98d54b38fac0a88d46eba7adf6ac542c}\label{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a98d54b38fac0a88d46eba7adf6ac542c}} 
\index{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}!get\+\_\+weights@{get\+\_\+weights}}
\index{get\+\_\+weights@{get\+\_\+weights}!parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}}
\subsubsection{\texorpdfstring{get\+\_\+weights}{get\_weights}}
{\footnotesize\ttfamily parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention.\+get\+\_\+weights}



Definition at line 958 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a98c0f263db25cf305c333e04f8a0843d}\label{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a98c0f263db25cf305c333e04f8a0843d}} 
\index{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}!residual@{residual}}
\index{residual@{residual}!parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}}
\subsubsection{\texorpdfstring{residual}{residual}}
{\footnotesize\ttfamily parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention.\+residual}



Definition at line 959 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a669fa3f4cd988703371fc127a4943f07}\label{classparlai_1_1agents_1_1transformer_1_1modules_1_1BasicAttention_a669fa3f4cd988703371fc127a4943f07}} 
\index{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}!softmax@{softmax}}
\index{softmax@{softmax}!parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention@{parlai\+::agents\+::transformer\+::modules\+::\+Basic\+Attention}}
\subsubsection{\texorpdfstring{softmax}{softmax}}
{\footnotesize\ttfamily parlai.\+agents.\+transformer.\+modules.\+Basic\+Attention.\+softmax}



Definition at line 953 of file modules.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/transformer/\hyperlink{parlai_2agents_2transformer_2modules_8py}{modules.\+py}\end{DoxyCompactItemize}
