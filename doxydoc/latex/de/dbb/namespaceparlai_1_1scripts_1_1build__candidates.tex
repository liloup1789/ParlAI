\hypertarget{namespaceparlai_1_1scripts_1_1build__candidates}{}\section{parlai.\+scripts.\+build\+\_\+candidates Namespace Reference}
\label{namespaceparlai_1_1scripts_1_1build__candidates}\index{parlai.\+scripts.\+build\+\_\+candidates@{parlai.\+scripts.\+build\+\_\+candidates}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1scripts_1_1build__candidates_a7932b774b6e77c36347f89f3d79c676e}{build\+\_\+cands} (opt)
\item 
def \hyperlink{namespaceparlai_1_1scripts_1_1build__candidates_a99ffd6743adcd4a6f0f5a26418d21a3a}{main} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1scripts_1_1build__candidates_a7932b774b6e77c36347f89f3d79c676e}\label{namespaceparlai_1_1scripts_1_1build__candidates_a7932b774b6e77c36347f89f3d79c676e}} 
\index{parlai\+::scripts\+::build\+\_\+candidates@{parlai\+::scripts\+::build\+\_\+candidates}!build\+\_\+cands@{build\+\_\+cands}}
\index{build\+\_\+cands@{build\+\_\+cands}!parlai\+::scripts\+::build\+\_\+candidates@{parlai\+::scripts\+::build\+\_\+candidates}}
\subsubsection{\texorpdfstring{build\+\_\+cands()}{build\_cands()}}
{\footnotesize\ttfamily def parlai.\+scripts.\+build\+\_\+candidates.\+build\+\_\+cands (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 25 of file build\+\_\+candidates.\+py.


\begin{DoxyCode}
25 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1scripts_1_1build__candidates_a7932b774b6e77c36347f89f3d79c676e}{build\_cands}(opt):
26     \textcolor{comment}{# create repeat label agent and assign it to the specified task}
27     \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'numthreads'}] > 1:
28         \textcolor{comment}{# Broken in hogwild mode. Just fall back to single processing mode}
29         opt[\textcolor{stringliteral}{'numthreads'}] = 1
30     agent = RepeatLabelAgent(opt)
31     world = \hyperlink{namespaceparlai_1_1core_1_1worlds_a11923c10b545c7ecc1b08fe2242d9c2c}{create\_task}(opt, agent)
32     \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'outfile'}] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
33         outfile = tempfile.mkstemp(
34             prefix=\textcolor{stringliteral}{'\{\}\_\{\}\_'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(opt[\textcolor{stringliteral}{'task'}], opt[\textcolor{stringliteral}{'datatype'}]), suffix=\textcolor{stringliteral}{'.txt'}
35         )[1]
36     \textcolor{keywordflow}{else}:
37         outfile = opt[\textcolor{stringliteral}{'outfile'}]
38 
39     \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'num\_examples'}, -1) == -1:
40         num\_examples = world.num\_examples()
41     \textcolor{keywordflow}{else}:
42         num\_examples = opt[\textcolor{stringliteral}{'num\_examples'}]
43     log\_timer = TimeLogger()
44 
45     print(\textcolor{stringliteral}{'[ starting to build candidates from task.. (ex:'} + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(num\_examples) + \textcolor{stringliteral}{')]'})
46     print(\textcolor{stringliteral}{'[ saving output to \{\} ]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(outfile))
47     cands = set()
48     \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(num\_examples):
49         world.parley()
50         \textcolor{comment}{# We get the acts of the first agent, which is the teacher.}
51         acts = world.get\_acts()[0]
52         \textcolor{keywordflow}{if} isinstance(acts, dict):
53             \textcolor{comment}{# We turn into a batch of 1 example, in case batching is being used.}
54             acts = [acts]
55         \textcolor{keywordflow}{for} a \textcolor{keywordflow}{in} acts:
56             candidate = a.get(\textcolor{stringliteral}{'labels'}, a.get(\textcolor{stringliteral}{'eval\_labels'}, \textcolor{keywordtype}{None}))
57             \textcolor{keywordflow}{if} candidate \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
58                 candidate = candidate[0]
59                 cands.add(candidate)
60         \textcolor{keywordflow}{if} log\_timer.time() > opt[\textcolor{stringliteral}{'log\_every\_n\_secs'}]:
61             text, \_log = log\_timer.log(world.total\_parleys, world.num\_examples())
62             print(text)
63         \textcolor{keywordflow}{if} world.epoch\_done():
64             print(\textcolor{stringliteral}{'EPOCH DONE'})
65             \textcolor{keywordflow}{break}
66     fw = open(outfile, \textcolor{stringliteral}{'w'})
67     fw.write(\textcolor{stringliteral}{'\(\backslash\)n'}.join(cands))
68     fw.close()
69 
70 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1scripts_1_1build__candidates_a99ffd6743adcd4a6f0f5a26418d21a3a}\label{namespaceparlai_1_1scripts_1_1build__candidates_a99ffd6743adcd4a6f0f5a26418d21a3a}} 
\index{parlai\+::scripts\+::build\+\_\+candidates@{parlai\+::scripts\+::build\+\_\+candidates}!main@{main}}
\index{main@{main}!parlai\+::scripts\+::build\+\_\+candidates@{parlai\+::scripts\+::build\+\_\+candidates}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def parlai.\+scripts.\+build\+\_\+candidates.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 71 of file build\+\_\+candidates.\+py.


\begin{DoxyCode}
71 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1scripts_1_1build__candidates_a99ffd6743adcd4a6f0f5a26418d21a3a}{main}():
72     random.seed(42)
73     \textcolor{comment}{# Get command line arguments}
74     parser = ParlaiParser()
75     parser.add\_argument(
76         \textcolor{stringliteral}{'-n'},
77         \textcolor{stringliteral}{'--num-examples'},
78         default=-1,
79         type=int,
80         help=\textcolor{stringliteral}{'Total number of exs to convert, -1 to convert all examples'},
81     )
82     parser.add\_argument(
83         \textcolor{stringliteral}{'-of'},
84         \textcolor{stringliteral}{'--outfile'},
85         default=\textcolor{keywordtype}{None},
86         type=str,
87         help=\textcolor{stringliteral}{'Output file where to save, by default will be created in /tmp'},
88     )
89     parser.add\_argument(\textcolor{stringliteral}{'-ltim'}, \textcolor{stringliteral}{'--log-every-n-secs'}, type=float, default=2)
90     parser.set\_defaults(datatype=\textcolor{stringliteral}{'train:evalmode'})
91     opt = parser.parse\_args()
92     \hyperlink{namespaceparlai_1_1scripts_1_1build__candidates_a7932b774b6e77c36347f89f3d79c676e}{build\_cands}(opt)
93 
94 
\end{DoxyCode}
