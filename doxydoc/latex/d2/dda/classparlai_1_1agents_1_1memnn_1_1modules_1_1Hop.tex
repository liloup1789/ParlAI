\hypertarget{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop}{}\section{parlai.\+agents.\+memnn.\+modules.\+Hop Class Reference}
\label{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop}\index{parlai.\+agents.\+memnn.\+modules.\+Hop@{parlai.\+agents.\+memnn.\+modules.\+Hop}}


Inheritance diagram for parlai.\+agents.\+memnn.\+modules.\+Hop\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=248pt]{d2/da3/classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+memnn.\+modules.\+Hop\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=248pt]{da/d4a/classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_aa38fc63425e2968ae2530edd6b37ad1a}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, embedding\+\_\+size, \hyperlink{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_a88857c10815bc48ef24c78ecf367935d}{rotate}=True)
\item 
def \hyperlink{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_ad4e6c91364efc31ac3f0239d7a7c1376}{forward} (self, query\+\_\+embs, in\+\_\+mem\+\_\+embs, out\+\_\+mem\+\_\+embs, pad\+\_\+mask)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_a88857c10815bc48ef24c78ecf367935d}{rotate}
\item 
\hyperlink{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_a50d4a5a4bd188efc2944d68c0761cc0a}{softmax}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Memory Network hop outputs attention-weighted sum of memory embeddings.

0) rotate the query embeddings 1) compute the dot product between the input vector
and each memory vector 2) compute a softmax over the memory scores 3) compute the
weighted sum of the memory embeddings using the probabilities 4) add the query
embedding to the memory output and return the result
\end{DoxyVerb}
 

Definition at line 200 of file modules.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_aa38fc63425e2968ae2530edd6b37ad1a}\label{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_aa38fc63425e2968ae2530edd6b37ad1a}} 
\index{parlai\+::agents\+::memnn\+::modules\+::\+Hop@{parlai\+::agents\+::memnn\+::modules\+::\+Hop}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::memnn\+::modules\+::\+Hop@{parlai\+::agents\+::memnn\+::modules\+::\+Hop}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+memnn.\+modules.\+Hop.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{embedding\+\_\+size,  }\item[{}]{rotate = {\ttfamily True} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Initialize linear rotation.
\end{DoxyVerb}
 

Definition at line 210 of file modules.\+py.


\begin{DoxyCode}
210     \textcolor{keyword}{def }\_\_init\_\_(self, embedding\_size, rotate=True):
211         \textcolor{stringliteral}{"""}
212 \textcolor{stringliteral}{        Initialize linear rotation.}
213 \textcolor{stringliteral}{        """}
214         super().\_\_init\_\_()
215         \textcolor{keywordflow}{if} rotate:
216             self.rotate = nn.Linear(embedding\_size, embedding\_size, bias=\textcolor{keyword}{False})
217         \textcolor{keywordflow}{else}:
218             self.rotate = \textcolor{keyword}{lambda} x: x
219         self.softmax = nn.Softmax(dim=1)
220 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_ad4e6c91364efc31ac3f0239d7a7c1376}\label{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_ad4e6c91364efc31ac3f0239d7a7c1376}} 
\index{parlai\+::agents\+::memnn\+::modules\+::\+Hop@{parlai\+::agents\+::memnn\+::modules\+::\+Hop}!forward@{forward}}
\index{forward@{forward}!parlai\+::agents\+::memnn\+::modules\+::\+Hop@{parlai\+::agents\+::memnn\+::modules\+::\+Hop}}
\subsubsection{\texorpdfstring{forward()}{forward()}}
{\footnotesize\ttfamily def parlai.\+agents.\+memnn.\+modules.\+Hop.\+forward (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{query\+\_\+embs,  }\item[{}]{in\+\_\+mem\+\_\+embs,  }\item[{}]{out\+\_\+mem\+\_\+embs,  }\item[{}]{pad\+\_\+mask }\end{DoxyParamCaption})}

\begin{DoxyVerb}Compute MemNN Hop step.

:param query_embs:
    (bsz x esz) embedding of queries

:param in_mem_embs:
    bsz list of (num_mems x esz) embedding of memories for activation

:param out_mem_embs:
    bsz list of (num_mems x esz) embedding of memories for outputs

:param pad_mask
    (bsz x num_mems) optional mask indicating which tokens correspond to
    padding

:returns:
    (bsz x esz) output state
\end{DoxyVerb}
 

Definition at line 221 of file modules.\+py.


\begin{DoxyCode}
221     \textcolor{keyword}{def }forward(self, query\_embs, in\_mem\_embs, out\_mem\_embs, pad\_mask):
222         \textcolor{stringliteral}{"""}
223 \textcolor{stringliteral}{        Compute MemNN Hop step.}
224 \textcolor{stringliteral}{}
225 \textcolor{stringliteral}{        :param query\_embs:}
226 \textcolor{stringliteral}{            (bsz x esz) embedding of queries}
227 \textcolor{stringliteral}{}
228 \textcolor{stringliteral}{        :param in\_mem\_embs:}
229 \textcolor{stringliteral}{            bsz list of (num\_mems x esz) embedding of memories for activation}
230 \textcolor{stringliteral}{}
231 \textcolor{stringliteral}{        :param out\_mem\_embs:}
232 \textcolor{stringliteral}{            bsz list of (num\_mems x esz) embedding of memories for outputs}
233 \textcolor{stringliteral}{}
234 \textcolor{stringliteral}{        :param pad\_mask}
235 \textcolor{stringliteral}{            (bsz x num\_mems) optional mask indicating which tokens correspond to}
236 \textcolor{stringliteral}{            padding}
237 \textcolor{stringliteral}{}
238 \textcolor{stringliteral}{        :returns:}
239 \textcolor{stringliteral}{            (bsz x esz) output state}
240 \textcolor{stringliteral}{        """}
241         \textcolor{comment}{# rotate query embeddings}
242         attn = torch.bmm(query\_embs.unsqueeze(1), in\_mem\_embs).squeeze(1)
243         \textcolor{keywordflow}{if} pad\_mask \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
244             attn[pad\_mask] = \hyperlink{namespaceparlai_1_1utils_1_1torch_a6c6e25115353dba479cd72dc31dc76ae}{neginf}(attn.dtype)
245         probs = self.softmax(attn)
246         memory\_output = torch.bmm(probs.unsqueeze(1), out\_mem\_embs).squeeze(1)
247         output = memory\_output + self.rotate(query\_embs)
248         \textcolor{keywordflow}{return} output
249 \end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_a88857c10815bc48ef24c78ecf367935d}\label{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_a88857c10815bc48ef24c78ecf367935d}} 
\index{parlai\+::agents\+::memnn\+::modules\+::\+Hop@{parlai\+::agents\+::memnn\+::modules\+::\+Hop}!rotate@{rotate}}
\index{rotate@{rotate}!parlai\+::agents\+::memnn\+::modules\+::\+Hop@{parlai\+::agents\+::memnn\+::modules\+::\+Hop}}
\subsubsection{\texorpdfstring{rotate}{rotate}}
{\footnotesize\ttfamily parlai.\+agents.\+memnn.\+modules.\+Hop.\+rotate}



Definition at line 216 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_a50d4a5a4bd188efc2944d68c0761cc0a}\label{classparlai_1_1agents_1_1memnn_1_1modules_1_1Hop_a50d4a5a4bd188efc2944d68c0761cc0a}} 
\index{parlai\+::agents\+::memnn\+::modules\+::\+Hop@{parlai\+::agents\+::memnn\+::modules\+::\+Hop}!softmax@{softmax}}
\index{softmax@{softmax}!parlai\+::agents\+::memnn\+::modules\+::\+Hop@{parlai\+::agents\+::memnn\+::modules\+::\+Hop}}
\subsubsection{\texorpdfstring{softmax}{softmax}}
{\footnotesize\ttfamily parlai.\+agents.\+memnn.\+modules.\+Hop.\+softmax}



Definition at line 219 of file modules.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/memnn/\hyperlink{parlai_2agents_2memnn_2modules_8py}{modules.\+py}\end{DoxyCompactItemize}
