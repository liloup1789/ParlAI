\hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel}{}\section{projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model Class Reference}
\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel}\index{projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model@{projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model}}


Inheritance diagram for projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=317pt]{d8/d6c/classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=317pt]{d3/d29/classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_acce33a563010f01d7abf3b9def603119}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, opt, personalities\+\_\+list, dictionary)
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a9e5dd2a418ccbbe70d1b7f8ae3be78ed}{forward} (self, image\+\_\+features, personalities, dialogue\+\_\+histories, labels, batchsize=None, personalities\+\_\+tensor=None)
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_af645957261121c6c5a99ffc1f7e44f1e}{forward\+\_\+personality} (self, personalities, personalities\+\_\+tensor)
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a0dbaa08f20aed129c58237d8d7575197}{forward\+\_\+text\+\_\+encoder} (self, texts, dialogue\+\_\+history=False, batchsize=None)
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_ab6a9e6cfce463a5011e52f9740e70d4f}{forward\+\_\+image} (self, image\+\_\+features)
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a0dc7c4c9b5b395f3f5af7547d13d3425}{get\+\_\+rep} (self, encodings, batchsize=None)
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a528f9ad05ca6c0f0932b13b404ee054b}{choose\+\_\+best\+\_\+response} (self, image\+\_\+features, personalities, dialogue\+\_\+histories, candidates, candidates\+\_\+encoded=None, k=1, batchsize=None)
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a16771c029f996c0aa05a773000e40a11}{choose\+\_\+topk} (self, idx, encoded, candidates, candidates\+\_\+encoded, one\+\_\+cand\+\_\+set, k)
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a80dacb736b29beb2ed05e72f6ff6375e}{get\+\_\+loss} (self, total\+\_\+encoded, labels\+\_\+encoded)
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_aff6ec96c67c791d1adbc7ca4043805fc}{cat\+\_\+encodings} (self, tensors)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a562a24d9e23ea9fcd7e5975e1758e0a6}{add\+\_\+cmdline\+\_\+args} (argparser)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a20048d75d94df03026b967a544fe7042}{hidden\+\_\+dim}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a2c69c42e129241985a1b2c1c98c765ea}{share\+\_\+encoder}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a276a0538450df1870294a14da9f3bdfc}{blank\+\_\+encoding}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_ae74e64ff441aec913b199f53900ca260}{encode\+\_\+image}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a05a1c34914d4ea9bf0fa5167851ca79d}{encode\+\_\+personality}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_aee5d671af9c2b461faef374a0c5bcc72}{encode\+\_\+dialogue\+\_\+history}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a542374eb4038ae26a5c9b97fa7d58153}{label\+\_\+encoder}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_ab11778f11a2cb7d0470590369ce51286}{multimodal}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_afd940c08f70ec6a75ba173da9f99b700}{multimodal\+\_\+combo}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a0b3ef1c2e2ed2120344b8faba38a774c}{multimodal\+\_\+encoder}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a047e284ab770b37a1e76f45179c1d123}{context\+\_\+encoder}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Extension of Transresnet to incorporate dialogue history and multimodality.
\end{DoxyVerb}
 

Definition at line 23 of file modules.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_acce33a563010f01d7abf3b9def603119}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_acce33a563010f01d7abf3b9def603119}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{personalities\+\_\+list,  }\item[{}]{dictionary }\end{DoxyParamCaption})}



Definition at line 93 of file modules.\+py.


\begin{DoxyCode}
93     \textcolor{keyword}{def }\_\_init\_\_(self, opt, personalities\_list, dictionary):
94         super().\_\_init\_\_(opt, personalities\_list, dictionary)
95         self.hidden\_dim = self.opt[\textcolor{stringliteral}{"hidden\_dim"}]
96         self.share\_encoder = opt.get(\textcolor{stringliteral}{"share\_encoder"})
97         nlayers\_mm = (
98             opt[\textcolor{stringliteral}{"num\_layers\_all"}]
99             \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{"num\_layers\_all"}] != -1
100             \textcolor{keywordflow}{else} opt[\textcolor{stringliteral}{"num\_layers\_multimodal\_encoder"}]
101         )
102 
103         \textcolor{comment}{# blank encoding (for concat)}
104         self.blank\_encoding = torch.Tensor(opt[\textcolor{stringliteral}{"hidden\_dim"}]).fill\_(0).detach\_()
105         \textcolor{keywordflow}{if} self.use\_cuda:
106             self.blank\_encoding = self.blank\_encoding.cuda()
107 
108         \textcolor{comment}{# Encoders}
109         self.encode\_image = opt.get(\textcolor{stringliteral}{"encode\_image"}, \textcolor{keyword}{True})
110         self.encode\_personality = opt.get(\textcolor{stringliteral}{"encode\_personality"}, \textcolor{keyword}{True})
111         self.encode\_dialogue\_history = opt.get(\textcolor{stringliteral}{"encode\_dialogue\_history"}, \textcolor{keyword}{True})
112         \textcolor{keyword}{assert} any(
113             [self.encode\_dialogue\_history, self.encode\_image, self.encode\_personality]
114         )
115 
116         \textcolor{comment}{# Transformer 2}
117         self.\_build\_multimodal\_encoder(nlayers\_mm)
118 
119         \textcolor{comment}{# Label Encoder}
120         self.label\_encoder = self.text\_encoder
121 
122         \textcolor{comment}{# Context encoder}
123         self.\_build\_context\_encoder()
124 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a562a24d9e23ea9fcd7e5975e1758e0a6}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a562a24d9e23ea9fcd7e5975e1758e0a6}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}}
\index{add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{add\+\_\+cmdline\+\_\+args()}{add\_cmdline\_args()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+add\+\_\+cmdline\+\_\+args (\begin{DoxyParamCaption}\item[{}]{argparser }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\begin{DoxyVerb}Override to include model-specific args.
\end{DoxyVerb}
 

Definition at line 29 of file modules.\+py.


\begin{DoxyCode}
29     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(argparser):
30         \textcolor{stringliteral}{"""}
31 \textcolor{stringliteral}{        Override to include model-specific args.}
32 \textcolor{stringliteral}{        """}
33         TransresnetModel.add\_cmdline\_args(argparser)
34         agent = argparser.add\_argument\_group(\textcolor{stringliteral}{"TransresnetMultimodal task arguments"})
35         agent.add\_argument(
36             \textcolor{stringliteral}{"--context-encoder-embedding-type"},
37             type=str,
38             default=\textcolor{keywordtype}{None},
39             choices=[\textcolor{keywordtype}{None}, \textcolor{stringliteral}{"fasttext\_cc"}],
40             help=\textcolor{stringliteral}{"Specify if using pretrained embeddings"},
41         )
42         agent.add\_argument(
43             \textcolor{stringliteral}{"--load-context-encoder-from"},
44             type=str,
45             default=\textcolor{keywordtype}{None},
46             help=\textcolor{stringliteral}{"Specify if using a pretrained transformer encoder"},
47         )
48         agent.add\_argument(
49             \textcolor{stringliteral}{"--share-encoder"},
50             type=\textcolor{stringliteral}{"bool"},
51             default=\textcolor{keyword}{False},
52             help=\textcolor{stringliteral}{"Whether to share the text encoder for the "}
53             \textcolor{stringliteral}{"labels and the dialogue history"},
54         )
55         agent.add\_argument(\textcolor{stringliteral}{"--num-layers-multimodal-encoder"}, type=int, default=1)
56         agent.add\_argument(
57             \textcolor{stringliteral}{"--multimodal"},
58             type=\textcolor{stringliteral}{"bool"},
59             default=\textcolor{keyword}{False},
60             help=\textcolor{stringliteral}{"If true, feed a query term into a separate "}
61             \textcolor{stringliteral}{"transformer prior to computing final rank "}
62             \textcolor{stringliteral}{"scores"},
63         )
64         agent.add\_argument(
65             \textcolor{stringliteral}{"--multimodal-combo"},
66             type=str,
67             choices=[\textcolor{stringliteral}{"concat"}, \textcolor{stringliteral}{"sum"}],
68             default=\textcolor{stringliteral}{"sum"},
69             help=\textcolor{stringliteral}{"How to combine the encoding for the "} \textcolor{stringliteral}{"multi-modal transformer"},
70         )
71         agent.add\_argument(
72             \textcolor{stringliteral}{"--encode-image"},
73             type=\textcolor{stringliteral}{"bool"},
74             default=\textcolor{keyword}{True},
75             help=\textcolor{stringliteral}{"Whether to include the image encoding when "}
76             \textcolor{stringliteral}{"retrieving a candidate response"},
77         )
78         agent.add\_argument(
79             \textcolor{stringliteral}{"--encode-dialogue-history"},
80             type=\textcolor{stringliteral}{"bool"},
81             default=\textcolor{keyword}{True},
82             help=\textcolor{stringliteral}{"Whether to include the dialogue history "}
83             \textcolor{stringliteral}{"encoding when retrieving a candidate response"},
84         )
85         agent.add\_argument(
86             \textcolor{stringliteral}{"--encode-personality"},
87             type=\textcolor{stringliteral}{"bool"},
88             default=\textcolor{keyword}{True},
89             help=\textcolor{stringliteral}{"Whether to include the personality encoding "}
90             \textcolor{stringliteral}{"when retrieving a candidate response"},
91         )
92 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_aff6ec96c67c791d1adbc7ca4043805fc}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_aff6ec96c67c791d1adbc7ca4043805fc}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!cat\+\_\+encodings@{cat\+\_\+encodings}}
\index{cat\+\_\+encodings@{cat\+\_\+encodings}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{cat\+\_\+encodings()}{cat\_encodings()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+cat\+\_\+encodings (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{tensors }\end{DoxyParamCaption})}

\begin{DoxyVerb}Concatenate non-`None` encodings.

:param tensors:
    list tensors to concatenate

:return:
    concatenated tensors
\end{DoxyVerb}
 

Definition at line 457 of file modules.\+py.


\begin{DoxyCode}
457     \textcolor{keyword}{def }cat\_encodings(self, tensors):
458         \textcolor{stringliteral}{"""}
459 \textcolor{stringliteral}{        Concatenate non-`None` encodings.}
460 \textcolor{stringliteral}{}
461 \textcolor{stringliteral}{        :param tensors:}
462 \textcolor{stringliteral}{            list tensors to concatenate}
463 \textcolor{stringliteral}{}
464 \textcolor{stringliteral}{        :return:}
465 \textcolor{stringliteral}{            concatenated tensors}
466 \textcolor{stringliteral}{        """}
467         tensors = [t \textcolor{keywordflow}{for} t \textcolor{keywordflow}{in} tensors \textcolor{keywordflow}{if} t \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}]
468         \textcolor{keywordflow}{return} torch.cat([t.unsqueeze(1) \textcolor{keywordflow}{for} t \textcolor{keywordflow}{in} tensors], dim=1)
469 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a528f9ad05ca6c0f0932b13b404ee054b}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a528f9ad05ca6c0f0932b13b404ee054b}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!choose\+\_\+best\+\_\+response@{choose\+\_\+best\+\_\+response}}
\index{choose\+\_\+best\+\_\+response@{choose\+\_\+best\+\_\+response}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{choose\+\_\+best\+\_\+response()}{choose\_best\_response()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+choose\+\_\+best\+\_\+response (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{image\+\_\+features,  }\item[{}]{personalities,  }\item[{}]{dialogue\+\_\+histories,  }\item[{}]{candidates,  }\item[{}]{candidates\+\_\+encoded = {\ttfamily None},  }\item[{}]{k = {\ttfamily 1},  }\item[{}]{batchsize = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Choose the best response for each example.

:param image_features:
    list of tensors of image features
:param personalities:
    list of personalities
:param dialogue_histories:
    list of dialogue histories, one per example
:param candidates:
    list of candidates, one set per example
:param candidates_encoded:
    optional; if specified, a fixed set of encoded candidates that is
    used for each example
:param k:
    number of ranked candidates to return. if < 1, we return the ranks
    of all candidates in the set.

:return:
    a set of ranked candidates for each example
\end{DoxyVerb}
 

Definition at line 349 of file modules.\+py.


\begin{DoxyCode}
349     ):
350         \textcolor{stringliteral}{"""}
351 \textcolor{stringliteral}{        Choose the best response for each example.}
352 \textcolor{stringliteral}{}
353 \textcolor{stringliteral}{        :param image\_features:}
354 \textcolor{stringliteral}{            list of tensors of image features}
355 \textcolor{stringliteral}{        :param personalities:}
356 \textcolor{stringliteral}{            list of personalities}
357 \textcolor{stringliteral}{        :param dialogue\_histories:}
358 \textcolor{stringliteral}{            list of dialogue histories, one per example}
359 \textcolor{stringliteral}{        :param candidates:}
360 \textcolor{stringliteral}{            list of candidates, one set per example}
361 \textcolor{stringliteral}{        :param candidates\_encoded:}
362 \textcolor{stringliteral}{            optional; if specified, a fixed set of encoded candidates that is}
363 \textcolor{stringliteral}{            used for each example}
364 \textcolor{stringliteral}{        :param k:}
365 \textcolor{stringliteral}{            number of ranked candidates to return. if < 1, we return the ranks}
366 \textcolor{stringliteral}{            of all candidates in the set.}
367 \textcolor{stringliteral}{}
368 \textcolor{stringliteral}{        :return:}
369 \textcolor{stringliteral}{            a set of ranked candidates for each example}
370 \textcolor{stringliteral}{        """}
371         self.eval()
372         \_, \_, encoded = self.forward(
373             image\_features, personalities, dialogue\_histories, \textcolor{keywordtype}{None}, batchsize=batchsize
374         )
375         encoded = encoded.detach()
376         one\_cand\_set = \textcolor{keyword}{True}
377         \textcolor{keywordflow}{if} candidates\_encoded \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
378             one\_cand\_set = \textcolor{keyword}{False}
379             candidates\_encoded = [
380                 self.forward\_text\_encoder(c).detach() \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} candidates
381             ]
382         chosen = [
383             self.choose\_topk(
384                 idx \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} one\_cand\_set \textcolor{keywordflow}{else} 0,
385                 encoded,
386                 candidates,
387                 candidates\_encoded,
388                 one\_cand\_set,
389                 k,
390             )
391             \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range(len(encoded))
392         ]
393         \textcolor{keywordflow}{return} chosen
394 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a16771c029f996c0aa05a773000e40a11}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a16771c029f996c0aa05a773000e40a11}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!choose\+\_\+topk@{choose\+\_\+topk}}
\index{choose\+\_\+topk@{choose\+\_\+topk}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{choose\+\_\+topk()}{choose\_topk()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+choose\+\_\+topk (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{idx,  }\item[{}]{encoded,  }\item[{}]{candidates,  }\item[{}]{candidates\+\_\+encoded,  }\item[{}]{one\+\_\+cand\+\_\+set,  }\item[{}]{k }\end{DoxyParamCaption})}

\begin{DoxyVerb}Choose top k best responses for a single example.

:param idx:
    idx of example in encoded
:param encoded:
    full matrix of encoded representations (for the whole batch)
:param candidates:
    list of candidates
:param candidates_encoded:
    encoding of the candidates
:param one_cand_set:
    true if there is one set of candidates for each example
:param k:
    how many ranked responses to return

:return:
    ranked list of k responses
\end{DoxyVerb}
 

Definition at line 397 of file modules.\+py.


\begin{DoxyCode}
397     ):
398         \textcolor{stringliteral}{"""}
399 \textcolor{stringliteral}{        Choose top k best responses for a single example.}
400 \textcolor{stringliteral}{}
401 \textcolor{stringliteral}{        :param idx:}
402 \textcolor{stringliteral}{            idx of example in encoded}
403 \textcolor{stringliteral}{        :param encoded:}
404 \textcolor{stringliteral}{            full matrix of encoded representations (for the whole batch)}
405 \textcolor{stringliteral}{        :param candidates:}
406 \textcolor{stringliteral}{            list of candidates}
407 \textcolor{stringliteral}{        :param candidates\_encoded:}
408 \textcolor{stringliteral}{            encoding of the candidates}
409 \textcolor{stringliteral}{        :param one\_cand\_set:}
410 \textcolor{stringliteral}{            true if there is one set of candidates for each example}
411 \textcolor{stringliteral}{        :param k:}
412 \textcolor{stringliteral}{            how many ranked responses to return}
413 \textcolor{stringliteral}{}
414 \textcolor{stringliteral}{        :return:}
415 \textcolor{stringliteral}{            ranked list of k responses}
416 \textcolor{stringliteral}{        """}
417         encoding = encoded[idx : idx + 1, :]
418         scores = torch.mm(
419             candidates\_encoded[idx] \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} one\_cand\_set \textcolor{keywordflow}{else} candidates\_encoded,
420             encoding.transpose(0, 1),
421         )
422         \textcolor{keywordflow}{if} k >= 1:
423             \_, index\_top = torch.topk(scores, k, dim=0)
424         \textcolor{keywordflow}{else}:
425             \_, index\_top = torch.topk(scores, scores.size(0), dim=0)
426         \textcolor{keywordflow}{return} [
427             candidates[idx][idx2] \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} one\_cand\_set \textcolor{keywordflow}{else} candidates[idx2]
428             \textcolor{keywordflow}{for} idx2 \textcolor{keywordflow}{in} index\_top.unsqueeze(1)
429         ]
430 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a9e5dd2a418ccbbe70d1b7f8ae3be78ed}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a9e5dd2a418ccbbe70d1b7f8ae3be78ed}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!forward@{forward}}
\index{forward@{forward}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{forward()}{forward()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+forward (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{image\+\_\+features,  }\item[{}]{personalities,  }\item[{}]{dialogue\+\_\+histories,  }\item[{}]{labels,  }\item[{}]{batchsize = {\ttfamily None},  }\item[{}]{personalities\+\_\+tensor = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Model forward pass.

:param image_features:
    list of tensors of image features, one per example
:param personalities:
    list of personalities, one per example
:param dialogue_histories:
    list of dialogue histories, one per example
:param labels:
    list of response labels, one per example
:param personalities_tensor:
    (optional) list of personality representations, usually a one-hot
    vector if specified

:return:
    the encoded context and the encoded captions.
\end{DoxyVerb}
 

Definition at line 200 of file modules.\+py.


\begin{DoxyCode}
200     ):
201         \textcolor{stringliteral}{"""}
202 \textcolor{stringliteral}{        Model forward pass.}
203 \textcolor{stringliteral}{}
204 \textcolor{stringliteral}{        :param image\_features:}
205 \textcolor{stringliteral}{            list of tensors of image features, one per example}
206 \textcolor{stringliteral}{        :param personalities:}
207 \textcolor{stringliteral}{            list of personalities, one per example}
208 \textcolor{stringliteral}{        :param dialogue\_histories:}
209 \textcolor{stringliteral}{            list of dialogue histories, one per example}
210 \textcolor{stringliteral}{        :param labels:}
211 \textcolor{stringliteral}{            list of response labels, one per example}
212 \textcolor{stringliteral}{        :param personalities\_tensor:}
213 \textcolor{stringliteral}{            (optional) list of personality representations, usually a one-hot}
214 \textcolor{stringliteral}{            vector if specified}
215 \textcolor{stringliteral}{}
216 \textcolor{stringliteral}{        :return:}
217 \textcolor{stringliteral}{            the encoded context and the encoded captions.}
218 \textcolor{stringliteral}{        """}
219         \textcolor{comment}{# labels}
220         labels\_encoded = self.forward\_text\_encoder(labels)
221         \textcolor{comment}{# dialog history}
222         d\_hist\_encoded = self.forward\_text\_encoder(
223             dialogue\_histories, dialogue\_history=\textcolor{keyword}{True}, batchsize=batchsize
224         )
225         \textcolor{comment}{# images}
226         img\_encoded = self.forward\_image(image\_features)
227         \textcolor{comment}{# personalities}
228         pers\_encoded = self.forward\_personality(personalities, personalities\_tensor)
229         total\_encoded = self.get\_rep(
230             [img\_encoded, d\_hist\_encoded, pers\_encoded], batchsize=batchsize
231         )
232         loss, nb\_ok = self.get\_loss(total\_encoded, labels\_encoded)
233 
234         \textcolor{keywordflow}{return} loss, nb\_ok, total\_encoded
235 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_ab6a9e6cfce463a5011e52f9740e70d4f}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_ab6a9e6cfce463a5011e52f9740e70d4f}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!forward\+\_\+image@{forward\+\_\+image}}
\index{forward\+\_\+image@{forward\+\_\+image}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{forward\+\_\+image()}{forward\_image()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+forward\+\_\+image (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{image\+\_\+features }\end{DoxyParamCaption})}

\begin{DoxyVerb}Encode image features.

:param image_features:
    list of image features

:return:
    encoded representation of the image features
\end{DoxyVerb}
 

Definition at line 294 of file modules.\+py.


\begin{DoxyCode}
294     \textcolor{keyword}{def }forward\_image(self, image\_features):
295         \textcolor{stringliteral}{"""}
296 \textcolor{stringliteral}{        Encode image features.}
297 \textcolor{stringliteral}{}
298 \textcolor{stringliteral}{        :param image\_features:}
299 \textcolor{stringliteral}{            list of image features}
300 \textcolor{stringliteral}{}
301 \textcolor{stringliteral}{        :return:}
302 \textcolor{stringliteral}{            encoded representation of the image features}
303 \textcolor{stringliteral}{        """}
304         img\_encoded = \textcolor{keywordtype}{None}
305         \textcolor{keywordflow}{if} image\_features \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} \textcolor{keywordflow}{not} self.encode\_image:
306             \textcolor{keywordflow}{if} self.multimodal \textcolor{keywordflow}{and} self.multimodal\_combo == \textcolor{stringliteral}{"concat"}:
307                 img\_encoded = self.blank\_encoding
308         \textcolor{keywordflow}{else}:
309             img\_encoded = super().forward\_image(image\_features)
310 
311         \textcolor{keywordflow}{return} img\_encoded
312 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_af645957261121c6c5a99ffc1f7e44f1e}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_af645957261121c6c5a99ffc1f7e44f1e}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!forward\+\_\+personality@{forward\+\_\+personality}}
\index{forward\+\_\+personality@{forward\+\_\+personality}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{forward\+\_\+personality()}{forward\_personality()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+forward\+\_\+personality (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{personalities,  }\item[{}]{personalities\+\_\+tensor }\end{DoxyParamCaption})}

\begin{DoxyVerb}Encode personalities.

:param personalities:
    list of personalities, one per example
:param personalities_tensor:
    (optional) list of personality representations, usually a one-hot
    vector if specified

:return:
    encoded representation of the personalities
\end{DoxyVerb}
 

Definition at line 236 of file modules.\+py.


\begin{DoxyCode}
236     \textcolor{keyword}{def }forward\_personality(self, personalities, personalities\_tensor):
237         \textcolor{stringliteral}{"""}
238 \textcolor{stringliteral}{        Encode personalities.}
239 \textcolor{stringliteral}{}
240 \textcolor{stringliteral}{        :param personalities:}
241 \textcolor{stringliteral}{            list of personalities, one per example}
242 \textcolor{stringliteral}{        :param personalities\_tensor:}
243 \textcolor{stringliteral}{            (optional) list of personality representations, usually a one-hot}
244 \textcolor{stringliteral}{            vector if specified}
245 \textcolor{stringliteral}{}
246 \textcolor{stringliteral}{        :return:}
247 \textcolor{stringliteral}{            encoded representation of the personalities}
248 \textcolor{stringliteral}{        """}
249         pers\_encoded = \textcolor{keywordtype}{None}
250         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.encode\_personality:
251             \textcolor{keywordflow}{if} self.multimodal \textcolor{keywordflow}{and} self.multimodal\_combo == \textcolor{stringliteral}{"concat"}:
252                 pers\_encoded = self.blank\_encoding
253         \textcolor{keywordflow}{else}:
254             pers\_encoded = super().forward\_personality(
255                 personalities, personalities\_tensor
256             )
257         \textcolor{keywordflow}{return} pers\_encoded
258 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a0dbaa08f20aed129c58237d8d7575197}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a0dbaa08f20aed129c58237d8d7575197}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!forward\+\_\+text\+\_\+encoder@{forward\+\_\+text\+\_\+encoder}}
\index{forward\+\_\+text\+\_\+encoder@{forward\+\_\+text\+\_\+encoder}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{forward\+\_\+text\+\_\+encoder()}{forward\_text\_encoder()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+forward\+\_\+text\+\_\+encoder (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{texts,  }\item[{}]{dialogue\+\_\+history = {\ttfamily False},  }\item[{}]{batchsize = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Forward pass for a text encoder.

:param texts:
    text to encode
:param dialogue_history:
    flag that indicates whether the text is dialogue history; if False,
    text is a response candidate
:param batchsize:
    size of the batch

:return:
    encoded representation of the `texts`
\end{DoxyVerb}
 

Definition at line 259 of file modules.\+py.


\begin{DoxyCode}
259     \textcolor{keyword}{def }forward\_text\_encoder(self, texts, dialogue\_history=False, batchsize=None):
260         \textcolor{stringliteral}{"""}
261 \textcolor{stringliteral}{        Forward pass for a text encoder.}
262 \textcolor{stringliteral}{}
263 \textcolor{stringliteral}{        :param texts:}
264 \textcolor{stringliteral}{            text to encode}
265 \textcolor{stringliteral}{        :param dialogue\_history:}
266 \textcolor{stringliteral}{            flag that indicates whether the text is dialogue history; if False,}
267 \textcolor{stringliteral}{            text is a response candidate}
268 \textcolor{stringliteral}{        :param batchsize:}
269 \textcolor{stringliteral}{            size of the batch}
270 \textcolor{stringliteral}{}
271 \textcolor{stringliteral}{        :return:}
272 \textcolor{stringliteral}{            encoded representation of the `texts`}
273 \textcolor{stringliteral}{        """}
274         texts\_encoded = \textcolor{keywordtype}{None}
275         \textcolor{keywordflow}{if} texts \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} (dialogue\_history \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} self.encode\_dialogue\_history):
276             \textcolor{keywordflow}{if} (
277                 self.multimodal
278                 \textcolor{keywordflow}{and} self.multimodal\_combo == \textcolor{stringliteral}{"concat"}
279                 \textcolor{keywordflow}{and} dialogue\_history
280             ):
281                 texts\_encoded = torch.stack(
282                     [self.blank\_encoding \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(batchsize)]
283                 )
284         \textcolor{keywordflow}{else}:
285             encoder = self.context\_encoder \textcolor{keywordflow}{if} dialogue\_history \textcolor{keywordflow}{else} self.label\_encoder
286             indexes, mask = self.captions\_to\_tensor(texts)
287             texts\_encoded = encoder(indexes)
288             \textcolor{keywordflow}{if} self.text\_encoder\_frozen:
289                 texts\_encoded = texts\_encoded.detach()
290             texts\_encoded = self.additional\_layer(texts\_encoded)
291 
292         \textcolor{keywordflow}{return} texts\_encoded
293 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a80dacb736b29beb2ed05e72f6ff6375e}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a80dacb736b29beb2ed05e72f6ff6375e}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!get\+\_\+loss@{get\+\_\+loss}}
\index{get\+\_\+loss@{get\+\_\+loss}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{get\+\_\+loss()}{get\_loss()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+get\+\_\+loss (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{total\+\_\+encoded,  }\item[{}]{labels\+\_\+encoded }\end{DoxyParamCaption})}

\begin{DoxyVerb}Compute loss over batch.

:param total_encoded:
    encoding of the examples
:param labels_encoded:
    encoding of the labels

:return:
    total batch loss, and number of correct examples
\end{DoxyVerb}
 

Definition at line 431 of file modules.\+py.


\begin{DoxyCode}
431     \textcolor{keyword}{def }get\_loss(self, total\_encoded, labels\_encoded):
432         \textcolor{stringliteral}{"""}
433 \textcolor{stringliteral}{        Compute loss over batch.}
434 \textcolor{stringliteral}{}
435 \textcolor{stringliteral}{        :param total\_encoded:}
436 \textcolor{stringliteral}{            encoding of the examples}
437 \textcolor{stringliteral}{        :param labels\_encoded:}
438 \textcolor{stringliteral}{            encoding of the labels}
439 \textcolor{stringliteral}{}
440 \textcolor{stringliteral}{        :return:}
441 \textcolor{stringliteral}{            total batch loss, and number of correct examples}
442 \textcolor{stringliteral}{        """}
443         loss = \textcolor{keywordtype}{None}
444         num\_correct = \textcolor{keywordtype}{None}
445         \textcolor{keywordflow}{if} labels\_encoded \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
446             dot\_products = total\_encoded.mm(
447                 labels\_encoded.t()
448             )  \textcolor{comment}{# batch\_size * batch\_size}
449             log\_prob = torch.nn.functional.log\_softmax(dot\_products, dim=1)
450             targets = torch.arange(0, len(total\_encoded), dtype=torch.long)
451             \textcolor{keywordflow}{if} self.use\_cuda:
452                 targets = targets.cuda()
453             loss = torch.nn.functional.nll\_loss(log\_prob, targets)
454             num\_correct = (log\_prob.max(dim=1)[1] == targets).\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}().sum()
455         \textcolor{keywordflow}{return} loss, num\_correct
456 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a0dc7c4c9b5b395f3f5af7547d13d3425}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a0dc7c4c9b5b395f3f5af7547d13d3425}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!get\+\_\+rep@{get\+\_\+rep}}
\index{get\+\_\+rep@{get\+\_\+rep}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{get\+\_\+rep()}{get\_rep()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+get\+\_\+rep (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{encodings,  }\item[{}]{batchsize = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Get the multimodal representation of the encodings.

:param encodings:
    list of encodings
:param batchsize:
    size of batch

:return:
    final multimodal representations
\end{DoxyVerb}
 

Definition at line 313 of file modules.\+py.


\begin{DoxyCode}
313     \textcolor{keyword}{def }get\_rep(self, encodings, batchsize=None):
314         \textcolor{stringliteral}{"""}
315 \textcolor{stringliteral}{        Get the multimodal representation of the encodings.}
316 \textcolor{stringliteral}{}
317 \textcolor{stringliteral}{        :param encodings:}
318 \textcolor{stringliteral}{            list of encodings}
319 \textcolor{stringliteral}{        :param batchsize:}
320 \textcolor{stringliteral}{            size of batch}
321 \textcolor{stringliteral}{}
322 \textcolor{stringliteral}{        :return:}
323 \textcolor{stringliteral}{            final multimodal representations}
324 \textcolor{stringliteral}{        """}
325         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.multimodal:
326             rep = self.sum\_encodings(encodings)
327         \textcolor{keywordflow}{else}:
328             \textcolor{keywordflow}{if} self.multimodal\_combo == \textcolor{stringliteral}{"sum"}:
329                 encodings = self.sum\_encodings(encodings).unsqueeze(1)
330             \textcolor{keywordflow}{elif} self.multimodal\_combo == \textcolor{stringliteral}{"concat"}:
331                 encodings = self.cat\_encodings(encodings)
332             all\_one\_mask = torch.ones(encodings.size()[:2])
333             \textcolor{keywordflow}{if} self.use\_cuda:
334                 all\_one\_mask = all\_one\_mask.cuda()
335             rep = self.multimodal\_encoder(encodings, all\_one\_mask)
336         \textcolor{keywordflow}{if} rep \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
337             rep = torch.stack([self.blank\_encoding \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(batchsize)])
338         \textcolor{keywordflow}{return} rep
339 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a276a0538450df1870294a14da9f3bdfc}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a276a0538450df1870294a14da9f3bdfc}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!blank\+\_\+encoding@{blank\+\_\+encoding}}
\index{blank\+\_\+encoding@{blank\+\_\+encoding}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{blank\+\_\+encoding}{blank\_encoding}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+blank\+\_\+encoding}



Definition at line 104 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a047e284ab770b37a1e76f45179c1d123}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a047e284ab770b37a1e76f45179c1d123}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!context\+\_\+encoder@{context\+\_\+encoder}}
\index{context\+\_\+encoder@{context\+\_\+encoder}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{context\+\_\+encoder}{context\_encoder}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+context\+\_\+encoder}



Definition at line 158 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_aee5d671af9c2b461faef374a0c5bcc72}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_aee5d671af9c2b461faef374a0c5bcc72}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!encode\+\_\+dialogue\+\_\+history@{encode\+\_\+dialogue\+\_\+history}}
\index{encode\+\_\+dialogue\+\_\+history@{encode\+\_\+dialogue\+\_\+history}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{encode\+\_\+dialogue\+\_\+history}{encode\_dialogue\_history}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+encode\+\_\+dialogue\+\_\+history}



Definition at line 111 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_ae74e64ff441aec913b199f53900ca260}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_ae74e64ff441aec913b199f53900ca260}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!encode\+\_\+image@{encode\+\_\+image}}
\index{encode\+\_\+image@{encode\+\_\+image}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{encode\+\_\+image}{encode\_image}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+encode\+\_\+image}



Definition at line 109 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a05a1c34914d4ea9bf0fa5167851ca79d}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a05a1c34914d4ea9bf0fa5167851ca79d}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!encode\+\_\+personality@{encode\+\_\+personality}}
\index{encode\+\_\+personality@{encode\+\_\+personality}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{encode\+\_\+personality}{encode\_personality}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+encode\+\_\+personality}



Definition at line 110 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a20048d75d94df03026b967a544fe7042}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a20048d75d94df03026b967a544fe7042}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!hidden\+\_\+dim@{hidden\+\_\+dim}}
\index{hidden\+\_\+dim@{hidden\+\_\+dim}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{hidden\+\_\+dim}{hidden\_dim}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+hidden\+\_\+dim}



Definition at line 95 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a542374eb4038ae26a5c9b97fa7d58153}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a542374eb4038ae26a5c9b97fa7d58153}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!label\+\_\+encoder@{label\+\_\+encoder}}
\index{label\+\_\+encoder@{label\+\_\+encoder}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{label\+\_\+encoder}{label\_encoder}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+label\+\_\+encoder}



Definition at line 120 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_ab11778f11a2cb7d0470590369ce51286}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_ab11778f11a2cb7d0470590369ce51286}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!multimodal@{multimodal}}
\index{multimodal@{multimodal}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{multimodal}{multimodal}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+multimodal}



Definition at line 132 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_afd940c08f70ec6a75ba173da9f99b700}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_afd940c08f70ec6a75ba173da9f99b700}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!multimodal\+\_\+combo@{multimodal\+\_\+combo}}
\index{multimodal\+\_\+combo@{multimodal\+\_\+combo}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{multimodal\+\_\+combo}{multimodal\_combo}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+multimodal\+\_\+combo}



Definition at line 134 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a0b3ef1c2e2ed2120344b8faba38a774c}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a0b3ef1c2e2ed2120344b8faba38a774c}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!multimodal\+\_\+encoder@{multimodal\+\_\+encoder}}
\index{multimodal\+\_\+encoder@{multimodal\+\_\+encoder}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{multimodal\+\_\+encoder}{multimodal\_encoder}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+multimodal\+\_\+encoder}



Definition at line 140 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a2c69c42e129241985a1b2c1c98c765ea}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1TransresnetMultimodalModel_a2c69c42e129241985a1b2c1c98c765ea}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}!share\+\_\+encoder@{share\+\_\+encoder}}
\index{share\+\_\+encoder@{share\+\_\+encoder}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Transresnet\+Multimodal\+Model}}
\subsubsection{\texorpdfstring{share\+\_\+encoder}{share\_encoder}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Transresnet\+Multimodal\+Model.\+share\+\_\+encoder}



Definition at line 96 of file modules.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
projects/image\+\_\+chat/transresnet\+\_\+multimodal/\hyperlink{projects_2image__chat_2transresnet__multimodal_2modules_8py}{modules.\+py}\end{DoxyCompactItemize}
