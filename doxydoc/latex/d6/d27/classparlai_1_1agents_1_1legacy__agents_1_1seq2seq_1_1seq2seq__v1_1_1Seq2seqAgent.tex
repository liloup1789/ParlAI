\hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent}{}\section{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent Class Reference}
\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent}\index{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent@{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent}}


Inheritance diagram for parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=226pt]{d8/d72/classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=211pt]{dc/d76/classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a2f5c66732d78976428b26b96f14b311b}{add\+\_\+cmdline\+\_\+args} (cls, argparser)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aea5753e8b1090fc88e657ada44492556}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a4e938a91873bd6edde0ac7ed5299bc6a}{opt}, shared=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_af2e9c4d06f55802308dbfedfea69d0cd}{zero\+\_\+grad} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a3fabaacec11534b452a1786d3dd5a6c8}{update\+\_\+params} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a521db011d2188e8e513976af5737c322}{reset\+\_\+metrics} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae588ce85bae56791bac9dd744e5414ce}{report} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_afb99f50cbac1707480d1953163d91018}{share} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae0e5663a7879b2704378dfe99ef6d0f4}{vectorize} (self, args, kwargs)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_abb81dee41215c5d402fef970b0bf1931}{batchify} (self, args, kwargs)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a59a524e15577396e60a1e5f8b6bfe9a7}{train\+\_\+step} (self, batch)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a6afc143cc0ec59803be416416ce1ec97}{greedy\+\_\+search} (self, batch)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aa1e972eb8a41c98486a50baa14700345}{extend\+\_\+input} (self, batch)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae4496420685c3cd273920f89b4e82625}{truncate\+\_\+input} (self, batch)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a4567d7a200e20bd09235d4833424bdad}{truncate\+\_\+output} (self, out)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ad06de7c94ee40c403f792e7b48e0b137}{eval\+\_\+step} (self, batch)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a8aa6a1efae9091dc0b38af3ce4b49706}{save} (self, path=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a3ee5ae38c0e37bcc1e4eb44bae8a3cce}{load} (self, path)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a3838eb2d88b4e9f80c9c234e6742fa30}{model\+\_\+version} ()
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a58227903fd44e3d436710c06457c8f84}{beam\+\_\+search} (\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aeea96acec40c7a63d019ca56feca3c73}{model}, batch, \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ab4afd6e6f79d32bd21e60ac11c0d414b}{beam\+\_\+size}, start=1, end=2, pad=0, min\+\_\+length=3, min\+\_\+n\+\_\+best=5, max\+\_\+ts=40, block\+\_\+ngram=0)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a8636132dae633a66cc34da3a20d9894a}{id}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a82ff9540ce457658a7a7035055b36f77}{multigpu}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_af0b1011238f6a71eed46f10ea0300705}{beam\+\_\+dot\+\_\+log}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ab4afd6e6f79d32bd21e60ac11c0d414b}{beam\+\_\+size}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a0416c2a28c0efae160d31f755f3b5db9}{beam\+\_\+min\+\_\+n\+\_\+best}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aeebfbcecc59779e751869f7df3fcda19}{beam\+\_\+min\+\_\+length}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a070849409fda0767b993e13b9096fc29}{beam\+\_\+block\+\_\+ngram}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aeea96acec40c7a63d019ca56feca3c73}{model}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a640b76ddf76c70e73c4012f37d4c72b7}{metrics}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aa60eebf5d848b1e8b8c15a856456918a}{beam\+\_\+dot\+\_\+dir}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a821dfcf56b6872f4377b0fc8c5ed94de}{criterion}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae4bcab12b2cf1070cc8f712956f886ca}{buffer\+\_\+initialized}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
\begin{DoxyVerb}Agent which takes an input sequence and produces an output sequence.

This model supports encoding the input and decoding the output via one of
several flavors of RNN. It then uses a linear layer (whose weights can
be shared with the embedding layer) to convert RNN output states into
output tokens. This model supports greedy decoding, selecting the
highest probability token at each time step, as well as beam
search.

For more information, see the following papers:
- Neural Machine Translation by Jointly Learning to Align and Translate
  `(Bahdanau et al. 2014) <arxiv.org/abs/1409.0473>`_
- Sequence to Sequence Learning with Neural Networks
  `(Sutskever et al. 2014) <arxiv.org/abs/1409.3215>`_
- Effective Approaches to Attention-based Neural Machine Translation
  `(Luong et al. 2015) <arxiv.org/abs/1508.04025>`_
\end{DoxyVerb}
 

Definition at line 24 of file seq2seq\+\_\+v1.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aea5753e8b1090fc88e657ada44492556}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aea5753e8b1090fc88e657ada44492556}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Set up model.
\end{DoxyVerb}
 

Definition at line 199 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
199     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
200         \textcolor{stringliteral}{"""}
201 \textcolor{stringliteral}{        Set up model.}
202 \textcolor{stringliteral}{        """}
203         init\_model = \textcolor{keywordtype}{None}
204         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} shared:  \textcolor{comment}{# only do this on first setup}
205             \textcolor{comment}{# first check load path in case we need to override paths}
206             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'init\_model'}) \textcolor{keywordflow}{and} os.path.isfile(opt[\textcolor{stringliteral}{'init\_model'}]):
207                 \textcolor{comment}{# check first for 'init\_model' for loading model from file}
208                 init\_model = opt[\textcolor{stringliteral}{'init\_model'}]
209             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'model\_file'}) \textcolor{keywordflow}{and} os.path.isfile(opt[\textcolor{stringliteral}{'model\_file'}]):
210                 \textcolor{comment}{# next check for 'model\_file', this would override init\_model}
211                 init\_model = opt[\textcolor{stringliteral}{'model\_file'}]
212 
213             \textcolor{keywordflow}{if} init\_model \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
214                 \textcolor{comment}{# if we are loading a model, should load its dict too}
215                 \textcolor{keywordflow}{if} os.path.isfile(init\_model + \textcolor{stringliteral}{'.dict'}) \textcolor{keywordflow}{or} opt[\textcolor{stringliteral}{'dict\_file'}] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
216                     opt[\textcolor{stringliteral}{'dict\_file'}] = init\_model + \textcolor{stringliteral}{'.dict'}
217         super().\_\_init\_\_(opt, shared)
218         opt = self.opt
219 
220         \textcolor{comment}{# all instances may need some params}
221         self.id = \textcolor{stringliteral}{'Seq2Seq'}
222         self.multigpu = (
223             opt.get(\textcolor{stringliteral}{'multigpu'}) \textcolor{keywordflow}{and} self.use\_cuda \textcolor{keywordflow}{and} (opt.get(\textcolor{stringliteral}{'batchsize'}) > 1)
224         )
225         states = \{\}
226 
227         self.beam\_dot\_log = opt.get(\textcolor{stringliteral}{'beam\_dot\_log'}, \textcolor{keyword}{False})
228         self.beam\_size = opt.get(\textcolor{stringliteral}{'beam\_size'}, 1)
229         self.beam\_min\_n\_best = opt.get(\textcolor{stringliteral}{'beam\_min\_n\_best'}, 3)
230         self.beam\_min\_length = opt.get(\textcolor{stringliteral}{'beam\_min\_length'}, 3)
231         self.beam\_block\_ngram = opt.get(\textcolor{stringliteral}{'beam\_block\_ngram'}, 0)
232 
233         \textcolor{keywordflow}{if} shared:
234             \textcolor{comment}{# set up shared properties}
235             self.model = shared[\textcolor{stringliteral}{'model'}]
236             self.metrics = shared[\textcolor{stringliteral}{'metrics'}]
237             states = shared.get(\textcolor{stringliteral}{'states'}, \{\})
238         \textcolor{keywordflow}{else}:
239             self.metrics = \{
240                 \textcolor{stringliteral}{'loss'}: 0.0,
241                 \textcolor{stringliteral}{'num\_tokens'}: 0,
242                 \textcolor{stringliteral}{'correct\_tokens'}: 0,
243                 \textcolor{stringliteral}{'total\_skipped\_batches'}: 0,
244             \}
245             \textcolor{comment}{# this is not a shared instance of this class, so do full init}
246             \textcolor{keywordflow}{if} self.beam\_dot\_log:
247                 self.beam\_dot\_dir = tempfile.mkdtemp(
248                     prefix=\textcolor{stringliteral}{'\{\}-beamdot-beamsize-\{\}-'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
249                         os.path.basename(opt.get(\textcolor{stringliteral}{'model\_file'})), self.beam\_size
250                     )
251                 )
252                 print(\textcolor{stringliteral}{'[ Saving dot beam logs in \{\} ]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(self.beam\_dot\_dir))
253             \textcolor{keywordflow}{if} init\_model \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
254                 \textcolor{comment}{# load model parameters if available}
255                 print(\textcolor{stringliteral}{'[ Loading existing model params from \{\} ]'} \textcolor{stringliteral}{''}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(init\_model))
256                 states = self.load(init\_model)
257 
258             self.\_init\_model(states=states)
259 
260         \textcolor{comment}{# set up criteria}
261         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'numsoftmax'}, 1) > 1:
262             self.criterion = nn.NLLLoss(ignore\_index=self.NULL\_IDX, size\_average=\textcolor{keyword}{False})
263         \textcolor{keywordflow}{else}:
264             self.criterion = nn.CrossEntropyLoss(
265                 ignore\_index=self.NULL\_IDX, size\_average=\textcolor{keyword}{False}
266             )
267 
268         \textcolor{keywordflow}{if} self.use\_cuda:
269             self.criterion.cuda()
270 
271         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'train'} \textcolor{keywordflow}{in} opt.get(\textcolor{stringliteral}{'datatype'}, \textcolor{stringliteral}{''}):
272             self.init\_optim(
273                 [p \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} self.model.parameters() \textcolor{keywordflow}{if} p.requires\_grad],
274                 optim\_states=states.get(\textcolor{stringliteral}{'optimizer'}),
275                 saved\_optim\_type=states.get(\textcolor{stringliteral}{'optimizer\_type'}),
276             )
277 
278         self.reset()
279 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a2f5c66732d78976428b26b96f14b311b}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a2f5c66732d78976428b26b96f14b311b}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}}
\index{add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+cmdline\+\_\+args()}{add\_cmdline\_args()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+add\+\_\+cmdline\+\_\+args (\begin{DoxyParamCaption}\item[{}]{cls,  }\item[{}]{argparser }\end{DoxyParamCaption})}

\begin{DoxyVerb}Add command-line arguments specifically for this agent.
\end{DoxyVerb}
 

Definition at line 45 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
45     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(cls, argparser):
46         \textcolor{stringliteral}{"""}
47 \textcolor{stringliteral}{        Add command-line arguments specifically for this agent.}
48 \textcolor{stringliteral}{        """}
49         agent = argparser.add\_argument\_group(\textcolor{stringliteral}{'Seq2Seq Arguments'})
50         agent.add\_argument(
51             \textcolor{stringliteral}{'--init-model'},
52             type=str,
53             default=\textcolor{keywordtype}{None},
54             help=\textcolor{stringliteral}{'load dict/model/opts from this path'},
55         )
56         agent.add\_argument(
57             \textcolor{stringliteral}{'-hs'},
58             \textcolor{stringliteral}{'--hiddensize'},
59             type=int,
60             default=128,
61             help=\textcolor{stringliteral}{'size of the hidden layers'},
62         )
63         agent.add\_argument(
64             \textcolor{stringliteral}{'-esz'},
65             \textcolor{stringliteral}{'--embeddingsize'},
66             type=int,
67             default=128,
68             help=\textcolor{stringliteral}{'size of the token embeddings'},
69         )
70         agent.add\_argument(
71             \textcolor{stringliteral}{'-nl'}, \textcolor{stringliteral}{'--numlayers'}, type=int, default=2, help=\textcolor{stringliteral}{'number of hidden layers'}
72         )
73         agent.add\_argument(
74             \textcolor{stringliteral}{'-dr'}, \textcolor{stringliteral}{'--dropout'}, type=float, default=0.1, help=\textcolor{stringliteral}{'dropout rate'}
75         )
76         agent.add\_argument(
77             \textcolor{stringliteral}{'-bi'},
78             \textcolor{stringliteral}{'--bidirectional'},
79             type=\textcolor{stringliteral}{'bool'},
80             default=\textcolor{keyword}{False},
81             help=\textcolor{stringliteral}{'whether to encode the context with a '} \textcolor{stringliteral}{'bidirectional rnn'},
82         )
83         agent.add\_argument(
84             \textcolor{stringliteral}{'-att'},
85             \textcolor{stringliteral}{'--attention'},
86             default=\textcolor{stringliteral}{'none'},
87             choices=[\textcolor{stringliteral}{'none'}, \textcolor{stringliteral}{'concat'}, \textcolor{stringliteral}{'general'}, \textcolor{stringliteral}{'dot'}, \textcolor{stringliteral}{'local'}],
88             help=\textcolor{stringliteral}{'Choices: none, concat, general, local. '}
89             \textcolor{stringliteral}{'If set local, also set attention-length. '}
90             \textcolor{stringliteral}{'(see arxiv.org/abs/1508.04025)'},
91         )
92         agent.add\_argument(
93             \textcolor{stringliteral}{'-attl'},
94             \textcolor{stringliteral}{'--attention-length'},
95             default=48,
96             type=int,
97             help=\textcolor{stringliteral}{'Length of local attention.'},
98         )
99         agent.add\_argument(
100             \textcolor{stringliteral}{'--attention-time'},
101             default=\textcolor{stringliteral}{'post'},
102             choices=[\textcolor{stringliteral}{'pre'}, \textcolor{stringliteral}{'post'}],
103             help=\textcolor{stringliteral}{'Whether to apply attention before or after '} \textcolor{stringliteral}{'decoding.'},
104         )
105         agent.add\_argument(
106             \textcolor{stringliteral}{'-rnn'},
107             \textcolor{stringliteral}{'--rnn-class'},
108             default=\textcolor{stringliteral}{'lstm'},
109             choices=Seq2seq.RNN\_OPTS.keys(),
110             help=\textcolor{stringliteral}{'Choose between different types of RNNs.'},
111         )
112         agent.add\_argument(
113             \textcolor{stringliteral}{'-dec'},
114             \textcolor{stringliteral}{'--decoder'},
115             default=\textcolor{stringliteral}{'same'},
116             choices=[\textcolor{stringliteral}{'same'}, \textcolor{stringliteral}{'shared'}],
117             help=\textcolor{stringliteral}{'Choose between different decoder modules. '}
118             \textcolor{stringliteral}{'Default "same" uses same class as encoder, '}
119             \textcolor{stringliteral}{'while "shared" also uses the same weights. '}
120             \textcolor{stringliteral}{'Note that shared disabled some encoder '}
121             \textcolor{stringliteral}{'options--in particular, bidirectionality.'},
122         )
123         agent.add\_argument(
124             \textcolor{stringliteral}{'-lt'},
125             \textcolor{stringliteral}{'--lookuptable'},
126             default=\textcolor{stringliteral}{'unique'},
127             choices=[\textcolor{stringliteral}{'unique'}, \textcolor{stringliteral}{'enc\_dec'}, \textcolor{stringliteral}{'dec\_out'}, \textcolor{stringliteral}{'all'}],
128             help=\textcolor{stringliteral}{'The encoder, decoder, and output modules can '}
129             \textcolor{stringliteral}{'share weights, or not. '}
130             \textcolor{stringliteral}{'Unique has independent embeddings for each. '}
131             \textcolor{stringliteral}{'Enc\_dec shares the embedding for the encoder '}
132             \textcolor{stringliteral}{'and decoder. '}
133             \textcolor{stringliteral}{'Dec\_out shares decoder embedding and output '}
134             \textcolor{stringliteral}{'weights. '}
135             \textcolor{stringliteral}{'All shares all three weights.'},
136         )
137         agent.add\_argument(
138             \textcolor{stringliteral}{'-soft'},
139             \textcolor{stringliteral}{'--numsoftmax'},
140             default=1,
141             type=int,
142             help=\textcolor{stringliteral}{'default 1, if greater then uses mixture of '}
143             \textcolor{stringliteral}{'softmax (see arxiv.org/abs/1711.03953).'},
144         )
145         agent.add\_argument(
146             \textcolor{stringliteral}{'--beam-size'},
147             type=int,
148             default=1,
149             help=\textcolor{stringliteral}{'Beam size, if 1 then greedy search'},
150         )
151         agent.add\_argument(
152             \textcolor{stringliteral}{'--beam-dot-log'},
153             type=\textcolor{stringliteral}{'bool'},
154             default=\textcolor{keyword}{False},
155             help=\textcolor{stringliteral}{'Dump beam trees as png dot images into /tmp folder'},
156         )
157         agent.add\_argument(
158             \textcolor{stringliteral}{'--beam-min-n-best'},
159             type=int,
160             default=3,
161             help=\textcolor{stringliteral}{'Minimum number of nbest candidates to achieve '}
162             \textcolor{stringliteral}{'during the beam search'},
163         )
164         agent.add\_argument(
165             \textcolor{stringliteral}{'--beam-min-length'},
166             type=int,
167             default=3,
168             help=\textcolor{stringliteral}{'Minimum length of prediction to be generated by '} \textcolor{stringliteral}{'the beam search'},
169         )
170         agent.add\_argument(
171             \textcolor{stringliteral}{'-idr'},
172             \textcolor{stringliteral}{'--input-dropout'},
173             type=float,
174             default=0.0,
175             help=\textcolor{stringliteral}{'Each token from the input will be masked with'}
176             \textcolor{stringliteral}{' \_\_unk\_\_ token with this probability.'},
177         )
178         agent.add\_argument(
179             \textcolor{stringliteral}{'--beam-block-ngram'},
180             type=int,
181             default=0,
182             help=\textcolor{stringliteral}{'Block all repeating ngrams up to history length n-1'},
183         )
184         TorchAgent.add\_cmdline\_args(argparser)
185         Seq2seqAgent.dictionary\_class().\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(argparser)
186         \textcolor{keywordflow}{return} agent
187 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_abb81dee41215c5d402fef970b0bf1931}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_abb81dee41215c5d402fef970b0bf1931}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!batchify@{batchify}}
\index{batchify@{batchify}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{batchify()}{batchify()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+batchify (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{args,  }\item[{}]{kwargs }\end{DoxyParamCaption})}

\begin{DoxyVerb}Override batchify options for seq2seq.
\end{DoxyVerb}
 

Definition at line 420 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
420     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1utils_aca22dd97c5b6dcda2a7479c1cb22ef1e}{batchify}(self, *args, **kwargs):
421         \textcolor{stringliteral}{"""}
422 \textcolor{stringliteral}{        Override batchify options for seq2seq.}
423 \textcolor{stringliteral}{        """}
424         kwargs[\textcolor{stringliteral}{'sort'}] = \textcolor{keyword}{True}  \textcolor{comment}{# need sorted for pack\_padded}
425         \textcolor{keywordflow}{return} super().\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1utils_aca22dd97c5b6dcda2a7479c1cb22ef1e}{batchify}(*args, **kwargs)
426 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a58227903fd44e3d436710c06457c8f84}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a58227903fd44e3d436710c06457c8f84}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!beam\+\_\+search@{beam\+\_\+search}}
\index{beam\+\_\+search@{beam\+\_\+search}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{beam\+\_\+search()}{beam\_search()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+beam\+\_\+search (\begin{DoxyParamCaption}\item[{}]{model,  }\item[{}]{batch,  }\item[{}]{beam\+\_\+size,  }\item[{}]{start = {\ttfamily 1},  }\item[{}]{end = {\ttfamily 2},  }\item[{}]{pad = {\ttfamily 0},  }\item[{}]{min\+\_\+length = {\ttfamily 3},  }\item[{}]{min\+\_\+n\+\_\+best = {\ttfamily 5},  }\item[{}]{max\+\_\+ts = {\ttfamily 40},  }\item[{}]{block\+\_\+ngram = {\ttfamily 0} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\begin{DoxyVerb}Beam search given the model and Batch This function uses model with the
following reqs:

- model.encoder takes input returns tuple (enc_out, enc_hidden, attn_mask)
- model.decoder takes decoder params and returns decoder outputs after attn
- model.output takes decoder outputs and returns distr over dictionary

Function arguments:
model : nn.Module, here defined in modules.py
batch : Batch structure with input and labels
beam_size : Size of each beam during the search
start : start of sequence token
end : end of sequence token
pad : padding token
min_length : minimum length of the decoded sequence
min_n_best : minimum number of completed hypothesis generated from each beam
max_ts: the maximum length of the decoded sequence

Return:
beam_preds_scores : list of tuples (prediction, score) for each sample in Batch
n_best_preds_scores : list of n_best list of tuples (prediction, score) for
              each sample from Batch
beams : list of Beam instances defined in Beam class, can be used for any
following postprocessing, e.g. dot logging.
\end{DoxyVerb}
 

Definition at line 538 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
538     ):
539         \textcolor{stringliteral}{"""}
540 \textcolor{stringliteral}{        Beam search given the model and Batch This function uses model with the}
541 \textcolor{stringliteral}{        following reqs:}
542 \textcolor{stringliteral}{}
543 \textcolor{stringliteral}{        - model.encoder takes input returns tuple (enc\_out, enc\_hidden, attn\_mask)}
544 \textcolor{stringliteral}{        - model.decoder takes decoder params and returns decoder outputs after attn}
545 \textcolor{stringliteral}{        - model.output takes decoder outputs and returns distr over dictionary}
546 \textcolor{stringliteral}{}
547 \textcolor{stringliteral}{        Function arguments:}
548 \textcolor{stringliteral}{        model : nn.Module, here defined in modules.py}
549 \textcolor{stringliteral}{        batch : Batch structure with input and labels}
550 \textcolor{stringliteral}{        beam\_size : Size of each beam during the search}
551 \textcolor{stringliteral}{        start : start of sequence token}
552 \textcolor{stringliteral}{        end : end of sequence token}
553 \textcolor{stringliteral}{        pad : padding token}
554 \textcolor{stringliteral}{        min\_length : minimum length of the decoded sequence}
555 \textcolor{stringliteral}{        min\_n\_best : minimum number of completed hypothesis generated from each beam}
556 \textcolor{stringliteral}{        max\_ts: the maximum length of the decoded sequence}
557 \textcolor{stringliteral}{}
558 \textcolor{stringliteral}{        Return:}
559 \textcolor{stringliteral}{        beam\_preds\_scores : list of tuples (prediction, score) for each sample in Batch}
560 \textcolor{stringliteral}{        n\_best\_preds\_scores : list of n\_best list of tuples (prediction, score) for}
561 \textcolor{stringliteral}{                              each sample from Batch}
562 \textcolor{stringliteral}{        beams : list of Beam instances defined in Beam class, can be used for any}
563 \textcolor{stringliteral}{                following postprocessing, e.g. dot logging.}
564 \textcolor{stringliteral}{        """}
565         encoder\_states = model.encoder(batch.text\_vec)
566         enc\_out = encoder\_states[0]
567         enc\_hidden = encoder\_states[1]
568         attn\_mask = encoder\_states[2]
569         current\_device = encoder\_states[0][0].device
570 
571         batch\_size = len(batch.text\_lengths)
572         beams = [
573             Beam(
574                 beam\_size,
575                 min\_length=min\_length,
576                 padding\_token=pad,
577                 bos\_token=start,
578                 eos\_token=end,
579                 min\_n\_best=min\_n\_best,
580                 cuda=current\_device,
581                 block\_ngram=block\_ngram,
582             )
583             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(batch\_size)
584         ]
585         decoder\_input = (
586             torch.Tensor([start])
587             .detach()
588             .expand(batch\_size, 1)
589             .long()
590             .to(current\_device)
591         )
592         \textcolor{comment}{# repeat encoder\_outputs, hiddens, attn\_mask}
593         decoder\_input = decoder\_input.repeat(1, beam\_size).view(
594             beam\_size * batch\_size, -1
595         )
596         enc\_out = (
597             enc\_out.unsqueeze(1)
598             .\hyperlink{namespacerepeat}{repeat}(1, beam\_size, 1, 1)
599             .view(batch\_size * beam\_size, -1, enc\_out.size(-1))
600         )
601         attn\_mask = (
602             encoder\_states[2]
603             .\hyperlink{namespacerepeat}{repeat}(1, beam\_size)
604             .view(attn\_mask.size(0) * beam\_size, -1)
605         )
606         repeated\_hiddens = []
607         \textcolor{keywordflow}{if} isinstance(enc\_hidden, tuple):  \textcolor{comment}{# LSTM}
608             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(enc\_hidden)):
609                 repeated\_hiddens.append(
610                     enc\_hidden[i].unsqueeze(2).\hyperlink{namespacerepeat}{repeat}(1, 1, beam\_size, 1)
611                 )
612             num\_layers = enc\_hidden[0].size(0)
613             hidden\_size = enc\_hidden[0].size(-1)
614             enc\_hidden = tuple(
615                 [
616                     repeated\_hiddens[i].view(
617                         num\_layers, batch\_size * beam\_size, hidden\_size
618                     )
619                     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(repeated\_hiddens))
620                 ]
621             )
622         \textcolor{keywordflow}{else}:  \textcolor{comment}{# GRU}
623             num\_layers = enc\_hidden.size(0)
624             hidden\_size = enc\_hidden.size(-1)
625             enc\_hidden = (
626                 enc\_hidden.unsqueeze(2)
627                 .\hyperlink{namespacerepeat}{repeat}(1, 1, beam\_size, 1)
628                 .view(num\_layers, batch\_size * beam\_size, hidden\_size)
629             )
630 
631         hidden = enc\_hidden
632         \textcolor{keywordflow}{for} ts \textcolor{keywordflow}{in} range(max\_ts):
633             \textcolor{keywordflow}{if} all((b.done() \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} beams)):
634                 \textcolor{keywordflow}{break}
635             output, hidden = model.decoder(decoder\_input, hidden, (enc\_out, attn\_mask))
636             score = model.output(output)
637             \textcolor{comment}{# score contains softmax scores for batch\_size * beam\_size samples}
638             score = score.view(batch\_size, beam\_size, -1)
639             score = F.log\_softmax(score, dim=-1)
640             \textcolor{keywordflow}{for} i, b \textcolor{keywordflow}{in} enumerate(beams):
641                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} b.done():
642                     b.advance(score[i])
643             decoder\_input = torch.cat(
644                 [b.get\_output\_from\_current\_step() \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} beams]
645             ).unsqueeze(-1)
646             permute\_hidden\_idx = torch.cat(
647                 [
648                     beam\_size * i + b.get\_backtrack\_from\_current\_step()
649                     \textcolor{keywordflow}{for} i, b \textcolor{keywordflow}{in} enumerate(beams)
650                 ]
651             )
652             \textcolor{comment}{# permute decoder hiddens with respect to chosen hypothesis now}
653             \textcolor{keywordflow}{if} isinstance(hidden, tuple):  \textcolor{comment}{# LSTM}
654                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(hidden)):
655                     hidden[i].data.copy\_(
656                         hidden[i].data.index\_select(dim=1, index=permute\_hidden\_idx)
657                     )
658             \textcolor{keywordflow}{else}:  \textcolor{comment}{# GRU}
659                 hidden.data.copy\_(
660                     hidden.data.index\_select(dim=1, index=permute\_hidden\_idx)
661                 )
662         \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} beams:
663             b.check\_finished()
664 
665         beam\_preds\_scores = [list(b.get\_top\_hyp()) \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} beams]
666         \textcolor{keywordflow}{for} pair \textcolor{keywordflow}{in} beam\_preds\_scores:
667             pair[0] = Beam.get\_pretty\_hypothesis(pair[0])
668 
669         n\_best\_beams = [b.get\_rescored\_finished(n\_best=min\_n\_best) \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} beams]
670         n\_best\_beam\_preds\_scores = []
671         \textcolor{keywordflow}{for} i, beamhyp \textcolor{keywordflow}{in} enumerate(n\_best\_beams):
672             this\_beam = []
673             \textcolor{keywordflow}{for} hyp \textcolor{keywordflow}{in} beamhyp:
674                 pred = beams[i].get\_pretty\_hypothesis(
675                     beams[i].get\_hyp\_from\_finished(hyp)
676                 )
677                 score = hyp.score
678                 this\_beam.append((pred, score))
679             n\_best\_beam\_preds\_scores.append(this\_beam)
680 
681         \textcolor{keywordflow}{return} beam\_preds\_scores, n\_best\_beam\_preds\_scores, beams
682 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ad06de7c94ee40c403f792e7b48e0b137}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ad06de7c94ee40c403f792e7b48e0b137}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!eval\+\_\+step@{eval\+\_\+step}}
\index{eval\+\_\+step@{eval\+\_\+step}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{eval\+\_\+step()}{eval\_step()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+eval\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}Evaluate a single batch of examples.
\end{DoxyVerb}
 

Definition at line 719 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
719     \textcolor{keyword}{def }eval\_step(self, batch):
720         \textcolor{stringliteral}{"""}
721 \textcolor{stringliteral}{        Evaluate a single batch of examples.}
722 \textcolor{stringliteral}{        """}
723         \textcolor{keywordflow}{if} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
724             \textcolor{keywordflow}{return}
725         orig\_batch = batch  \textcolor{comment}{# save for evaluation}
726         needs\_truncation = self.multigpu \textcolor{keywordflow}{and} batch.text\_vec.size(0) % 2 != 0
727         \textcolor{keywordflow}{if} needs\_truncation:
728             \textcolor{comment}{# for multigpu, we need to split evenly across gpus}
729             batch = self.extend\_input(batch)
730         self.model.eval()
731         cand\_scores = \textcolor{keywordtype}{None}
732         \textcolor{keywordflow}{if} self.beam\_size == 1:
733             out, cand\_params = self.greedy\_search(batch)
734             \textcolor{keywordflow}{if} needs\_truncation:
735                 out = self.truncate\_output(out)
736                 \textcolor{keywordflow}{if} cand\_params[0] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
737                     cand\_params = (cand\_params[0][:-1], cand\_params[1][:-1])
738             scores, cand\_scores = out[0], out[1]
739             \_, preds = scores.max(2)
740         \textcolor{keywordflow}{elif} self.beam\_size > 1:
741             out = Seq2seqAgent.beam\_search(
742                 self.model,
743                 batch,
744                 self.beam\_size,
745                 start=self.START\_IDX,
746                 end=self.END\_IDX,
747                 pad=self.NULL\_IDX,
748                 min\_length=self.beam\_min\_length,
749                 min\_n\_best=self.beam\_min\_n\_best,
750                 block\_ngram=self.beam\_block\_ngram,
751             )
752             \textcolor{keywordflow}{if} needs\_truncation:
753                 out = self.truncate\_output(out)
754             beam\_preds\_scores, \_, beams = out
755             preds, scores = (
756                 [p[0] \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} beam\_preds\_scores],
757                 [p[1] \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} beam\_preds\_scores],
758             )
759             \textcolor{keywordflow}{if} self.beam\_dot\_log \textcolor{keywordflow}{is} \textcolor{keyword}{True}:
760                 \textcolor{keywordflow}{for} i, b \textcolor{keywordflow}{in} enumerate(beams):
761                     dot\_graph = b.get\_beam\_dot(dictionary=self.dict, n\_best=3)
762                     image\_name = (
763                         self.\_v2t(batch.text\_vec[i, -20:])
764                         .replace(\textcolor{stringliteral}{' '}, \textcolor{stringliteral}{'-'})
765                         .replace(\textcolor{stringliteral}{'\_\_null\_\_'}, \textcolor{stringliteral}{''})
766                     )
767                     dot\_graph.write\_png(
768                         os.path.join(self.beam\_dot\_dir, \textcolor{stringliteral}{"\{\}.png"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(image\_name))
769                     )
770 
771         \textcolor{keywordflow}{if} batch.label\_vec \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
772             \textcolor{comment}{# calculate loss on targets with teacher forcing}
773             seq\_len = \textcolor{keywordtype}{None} \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.multigpu \textcolor{keywordflow}{else} batch.text\_vec.size(1)
774             out = self.model(batch.text\_vec, batch.label\_vec, seq\_len=seq\_len)
775             \textcolor{keywordflow}{if} needs\_truncation:
776                 out = self.truncate\_output(out)
777             f\_scores = out[0]  \textcolor{comment}{# forced scores}
778             \_, f\_preds = f\_scores.max(2)  \textcolor{comment}{# forced preds}
779             score\_view = f\_scores.view(-1, f\_scores.size(-1))
780             loss = self.criterion(score\_view, orig\_batch.label\_vec.view(-1))
781             \textcolor{comment}{# save loss to metrics}
782             notnull = orig\_batch.label\_vec.ne(self.NULL\_IDX)
783             target\_tokens = notnull.long().sum().item()
784             correct = ((orig\_batch.label\_vec == f\_preds) * notnull).sum().item()
785             self.metrics[\textcolor{stringliteral}{'correct\_tokens'}] += correct
786             self.metrics[\textcolor{stringliteral}{'loss'}] += loss.item()
787             self.metrics[\textcolor{stringliteral}{'num\_tokens'}] += target\_tokens
788 
789         cand\_choices = \textcolor{keywordtype}{None}
790         \textcolor{keywordflow}{if} cand\_scores \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
791             cand\_preds = cand\_scores.sort(1, descending=\textcolor{keyword}{True})[1]
792             \textcolor{comment}{# now select the text of the cands based on their scores}
793             cand\_choices = self.\_pick\_cands(
794                 cand\_preds, cand\_params[1], orig\_batch.candidates
795             )
796 
797         text = [self.\_v2t(p) \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} preds]
798         \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(text, cand\_choices)
799 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aa1e972eb8a41c98486a50baa14700345}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aa1e972eb8a41c98486a50baa14700345}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!extend\+\_\+input@{extend\+\_\+input}}
\index{extend\+\_\+input@{extend\+\_\+input}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{extend\+\_\+input()}{extend\_input()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+extend\+\_\+input (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 683 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
683     \textcolor{keyword}{def }extend\_input(self, batch):
684         \textcolor{comment}{# add pad tensor to text vec}
685         pad\_tensor = torch.zeros(1, batch.text\_vec.size(1)).long().cuda()
686         text\_vec = torch.cat([batch.text\_vec, pad\_tensor], 0)
687         batch = batch.\_replace(text\_vec=text\_vec)
688         \textcolor{keywordflow}{if} batch.label\_vec \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
689             \textcolor{comment}{# add pad tensor to label vec}
690             pad\_tensor = torch.zeros(1, batch.label\_vec.size(1)).long().cuda()
691             label\_vec = torch.cat([batch.label\_vec, pad\_tensor], 0)
692             batch = batch.\_replace(label\_vec=label\_vec)
693         \textcolor{keywordflow}{if} batch.candidates \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
694             \textcolor{comment}{# add dummy candidates list}
695             dummy\_list = [[\textcolor{stringliteral}{'None'}] \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(len(batch.candidates[0]))]
696             batch = batch.\_replace(candidates=batch.candidates + [dummy\_list])
697             \textcolor{comment}{# add pad tensor to candidate\_vecs}
698             new\_vecs = batch.candidate\_vecs + [
699                 [torch.zeros(1).long() \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(len(batch.candidate\_vecs[0]))]
700             ]
701             batch = batch.\_replace(candidate\_vecs=new\_vecs)
702         \textcolor{keywordflow}{return} batch
703 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a6afc143cc0ec59803be416416ce1ec97}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a6afc143cc0ec59803be416416ce1ec97}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!greedy\+\_\+search@{greedy\+\_\+search}}
\index{greedy\+\_\+search@{greedy\+\_\+search}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{greedy\+\_\+search()}{greedy\_search()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+greedy\+\_\+search (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 520 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
520     \textcolor{keyword}{def }greedy\_search(self, batch):
521         cand\_params = self.\_build\_cands(batch)
522         seq\_len = \textcolor{keywordtype}{None} \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.multigpu \textcolor{keywordflow}{else} batch.text\_vec.size(1)
523         out = self.model(batch.text\_vec, ys=\textcolor{keywordtype}{None}, cands=cand\_params[0], seq\_len=seq\_len)
524         \textcolor{keywordflow}{return} out, cand\_params
525 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a3ee5ae38c0e37bcc1e4eb44bae8a3cce}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a3ee5ae38c0e37bcc1e4eb44bae8a3cce}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!load@{load}}
\index{load@{load}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{load()}{load()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+load (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return opt and model states.
\end{DoxyVerb}
 

Definition at line 822 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
822     \textcolor{keyword}{def }load(self, path):
823         \textcolor{stringliteral}{"""}
824 \textcolor{stringliteral}{        Return opt and model states.}
825 \textcolor{stringliteral}{        """}
826         states = torch.load(path, map\_location=\textcolor{keyword}{lambda} cpu, \_: cpu)
827 
828         \textcolor{comment}{# check opt file for multigpu}
829         with open(path + \textcolor{stringliteral}{".opt"}, \textcolor{stringliteral}{'r') as handle:}
830 \textcolor{stringliteral}{            saved\_opt = json.load(handle)}
831 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} saved\_opt.get(\textcolor{stringliteral}{'multigpu'}):
832             \textcolor{comment}{# create new OrderedDict that does not contain `module.`}
833             \textcolor{keyword}{from} collections \textcolor{keyword}{import} OrderedDict
834 
835             new\_state\_dict = OrderedDict()
836             \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} states[\textcolor{stringliteral}{'model'}].items():
837                 \textcolor{keywordflow}{if} k.startswith(\textcolor{stringliteral}{'module'}):
838                     name = k[7:]  \textcolor{comment}{# remove `module.`}
839                     new\_state\_dict[name] = v
840             states[\textcolor{stringliteral}{'model'}] = new\_state\_dict
841 
842         \textcolor{keywordflow}{return} states
843 
844 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a3838eb2d88b4e9f80c9c234e6742fa30}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a3838eb2d88b4e9f80c9c234e6742fa30}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!model\+\_\+version@{model\+\_\+version}}
\index{model\+\_\+version@{model\+\_\+version}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{model\+\_\+version()}{model\_version()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+model\+\_\+version (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\begin{DoxyVerb}Return current version of this model, counting up from 0.

Models may not be backwards-compatible with older versions. Version 1 split from
version 0 on Aug 29, 2018. To use version 0, use --model legacy:seq2seq:0
(legacy agent code is located in parlai/agents/legacy_agents).
\end{DoxyVerb}
 

Definition at line 189 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
189     \textcolor{keyword}{def }model\_version():
190         \textcolor{stringliteral}{"""}
191 \textcolor{stringliteral}{        Return current version of this model, counting up from 0.}
192 \textcolor{stringliteral}{}
193 \textcolor{stringliteral}{        Models may not be backwards-compatible with older versions. Version 1 split from}
194 \textcolor{stringliteral}{        version 0 on Aug 29, 2018. To use version 0, use --model legacy:seq2seq:0}
195 \textcolor{stringliteral}{        (legacy agent code is located in parlai/agents/legacy\_agents).}
196 \textcolor{stringliteral}{        """}
197         \textcolor{keywordflow}{return} 1
198 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae588ce85bae56791bac9dd744e5414ce}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae588ce85bae56791bac9dd744e5414ce}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!report@{report}}
\index{report@{report}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{report()}{report()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+report (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Report loss and perplexity from model's perspective.

Note that this includes predicting __END__ and __UNK__ tokens and may differ
from a truly independent measurement.
\end{DoxyVerb}
 

Definition at line 368 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
368     \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1convai2_1_1eval__f1_a01a47b9c08dad189837a51f085defc45}{report}(self):
369         \textcolor{stringliteral}{"""}
370 \textcolor{stringliteral}{        Report loss and perplexity from model's perspective.}
371 \textcolor{stringliteral}{}
372 \textcolor{stringliteral}{        Note that this includes predicting \_\_END\_\_ and \_\_UNK\_\_ tokens and may differ}
373 \textcolor{stringliteral}{        from a truly independent measurement.}
374 \textcolor{stringliteral}{        """}
375         m = \{\}
376         num\_tok = self.metrics[\textcolor{stringliteral}{'num\_tokens'}]
377         \textcolor{keywordflow}{if} num\_tok > 0:
378             \textcolor{keywordflow}{if} self.metrics[\textcolor{stringliteral}{'correct\_tokens'}] > 0:
379                 m[\textcolor{stringliteral}{'token\_acc'}] = self.metrics[\textcolor{stringliteral}{'correct\_tokens'}] / num\_tok
380             m[\textcolor{stringliteral}{'loss'}] = self.metrics[\textcolor{stringliteral}{'loss'}] / num\_tok
381             \textcolor{keywordflow}{try}:
382                 m[\textcolor{stringliteral}{'ppl'}] = math.exp(m[\textcolor{stringliteral}{'loss'}])
383             \textcolor{keywordflow}{except} OverflowError:
384                 m[\textcolor{stringliteral}{'ppl'}] = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'inf'})
385         \textcolor{keywordflow}{if} self.metrics[\textcolor{stringliteral}{'total\_skipped\_batches'}] > 0:
386             m[\textcolor{stringliteral}{'total\_skipped\_batches'}] = self.metrics[\textcolor{stringliteral}{'total\_skipped\_batches'}]
387         \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} m.items():
388             \textcolor{comment}{# clean up: rounds to sigfigs and converts tensors to floats}
389             m[k] = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}{round\_sigfigs}(v, 4)
390         \textcolor{keywordflow}{return} m
391 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a521db011d2188e8e513976af5737c322}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a521db011d2188e8e513976af5737c322}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!reset\+\_\+metrics@{reset\+\_\+metrics}}
\index{reset\+\_\+metrics@{reset\+\_\+metrics}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{reset\+\_\+metrics()}{reset\_metrics()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+reset\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Reset metrics for reporting loss and perplexity.
\end{DoxyVerb}
 

Definition at line 359 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
359     \textcolor{keyword}{def }reset\_metrics(self):
360         \textcolor{stringliteral}{"""}
361 \textcolor{stringliteral}{        Reset metrics for reporting loss and perplexity.}
362 \textcolor{stringliteral}{        """}
363         super().reset\_metrics()
364         self.metrics[\textcolor{stringliteral}{'loss'}] = 0.0
365         self.metrics[\textcolor{stringliteral}{'num\_tokens'}] = 0
366         self.metrics[\textcolor{stringliteral}{'correct\_tokens'}] = 0
367 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a8aa6a1efae9091dc0b38af3ce4b49706}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a8aa6a1efae9091dc0b38af3ce4b49706}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!save@{save}}
\index{save@{save}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+save (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Save model parameters if model_file is set.
\end{DoxyVerb}
 

Definition at line 800 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
800     \textcolor{keyword}{def }save(self, path=None):
801         \textcolor{stringliteral}{"""}
802 \textcolor{stringliteral}{        Save model parameters if model\_file is set.}
803 \textcolor{stringliteral}{        """}
804         path = self.opt.get(\textcolor{stringliteral}{'model\_file'}, \textcolor{keywordtype}{None}) \textcolor{keywordflow}{if} path \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{else} path
805 
806         \textcolor{keywordflow}{if} path \textcolor{keywordflow}{and} hasattr(self, \textcolor{stringliteral}{'model'}):
807             model = \{\}
808             model[\textcolor{stringliteral}{'model'}] = self.model.state\_dict()
809             model[\textcolor{stringliteral}{'longest\_label'}] = self.model.longest\_label
810             model[\textcolor{stringliteral}{'optimizer'}] = self.optimizer.state\_dict()
811             model[\textcolor{stringliteral}{'optimizer\_type'}] = self.opt[\textcolor{stringliteral}{'optimizer'}]
812 
813             with open(path, \textcolor{stringliteral}{'wb'}) \textcolor{keyword}{as} write:
814                 torch.save(model, write)
815 
816             \textcolor{comment}{# save opt file}
817             with open(path + \textcolor{stringliteral}{'.opt'}, \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} handle:
818                 \textcolor{comment}{# save version string}
819                 self.opt[\textcolor{stringliteral}{'model\_version'}] = self.model\_version()
820                 json.dump(self.opt, handle)
821 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_afb99f50cbac1707480d1953163d91018}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_afb99f50cbac1707480d1953163d91018}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!share@{share}}
\index{share@{share}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{share()}{share()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+share (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Share internal states between parent and child instances.
\end{DoxyVerb}
 

Definition at line 392 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
392     \textcolor{keyword}{def }share(self):
393         \textcolor{stringliteral}{"""}
394 \textcolor{stringliteral}{        Share internal states between parent and child instances.}
395 \textcolor{stringliteral}{        """}
396         shared = super().share()
397         shared[\textcolor{stringliteral}{'model'}] = self.model
398         \textcolor{keywordflow}{if} self.opt.get(\textcolor{stringliteral}{'numthreads'}, 1) > 1:
399             \textcolor{comment}{# we're doing hogwild so share the model too}
400             \textcolor{keywordflow}{if} isinstance(self.metrics, dict):
401                 \textcolor{comment}{# move metrics and model to shared memory}
402                 self.metrics = SharedTable(self.metrics)
403                 self.model.share\_memory()
404             shared[\textcolor{stringliteral}{'states'}] = \{  \textcolor{comment}{# don't share optimizer states}
405                 \textcolor{stringliteral}{'optimizer\_type'}: self.opt[\textcolor{stringliteral}{'optimizer'}]
406             \}
407         shared[\textcolor{stringliteral}{'metrics'}] = self.metrics  \textcolor{comment}{# do after numthreads check}
408         \textcolor{keywordflow}{if} self.beam\_dot\_log \textcolor{keywordflow}{is} \textcolor{keyword}{True}:
409             shared[\textcolor{stringliteral}{'beam\_dot\_dir'}] = self.beam\_dot\_dir
410         \textcolor{keywordflow}{return} shared
411 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a59a524e15577396e60a1e5f8b6bfe9a7}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a59a524e15577396e60a1e5f8b6bfe9a7}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!train\+\_\+step@{train\+\_\+step}}
\index{train\+\_\+step@{train\+\_\+step}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{train\+\_\+step()}{train\_step()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+train\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}Train on a single batch of examples.
\end{DoxyVerb}
 

Definition at line 451 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
451     \textcolor{keyword}{def }train\_step(self, batch):
452         \textcolor{stringliteral}{"""}
453 \textcolor{stringliteral}{        Train on a single batch of examples.}
454 \textcolor{stringliteral}{        """}
455         batchsize = batch.text\_vec.size(0)
456         \textcolor{keywordflow}{if} self.multigpu \textcolor{keywordflow}{and} batchsize % 2 != 0:
457             \textcolor{comment}{# throw out one training example}
458             batch = self.truncate\_input(batch)
459         \textcolor{comment}{# helps with memory usage}
460         self.\_init\_cuda\_buffer(
461             self.model, self.criterion, batchsize, self.truncate \textcolor{keywordflow}{or} 180
462         )
463         self.model.\hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a36a5f4f6f9df0611a6818610518d2cf0}{train}()
464         self.zero\_grad()
465 
466         \textcolor{keywordflow}{try}:
467             seq\_len = \textcolor{keywordtype}{None} \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.multigpu \textcolor{keywordflow}{else} batch.text\_vec.size(1)
468             out = self.model(batch.text\_vec, batch.label\_vec, seq\_len=seq\_len)
469 
470             \textcolor{comment}{# generated response}
471             scores = out[0]
472             \_, preds = scores.max(2)
473 
474             score\_view = scores.view(-1, scores.size(-1))
475             loss = self.criterion(score\_view, batch.label\_vec.view(-1))
476             \textcolor{comment}{# save loss to metrics}
477             notnull = batch.label\_vec.ne(self.NULL\_IDX)
478             target\_tokens = notnull.long().sum().item()
479             correct = ((batch.label\_vec == preds) * notnull).sum().item()
480             self.metrics[\textcolor{stringliteral}{'correct\_tokens'}] += correct
481             self.metrics[\textcolor{stringliteral}{'loss'}] += loss.item()
482             self.metrics[\textcolor{stringliteral}{'num\_tokens'}] += target\_tokens
483             loss /= target\_tokens  \textcolor{comment}{# average loss per token}
484             loss.backward()
485             self.update\_params()
486         \textcolor{keywordflow}{except} RuntimeError \textcolor{keyword}{as} e:
487             \textcolor{comment}{# catch out of memory exceptions during fwd/bck (skip batch)}
488             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'out of memory'} \textcolor{keywordflow}{in} \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(e):
489                 print(
490                     \textcolor{stringliteral}{'| WARNING: ran out of memory, skipping batch. '}
491                     \textcolor{stringliteral}{'if this happens frequently, decrease batchsize or '}
492                     \textcolor{stringliteral}{'truncate the inputs to the model.'}
493                 )
494                 self.metrics[\textcolor{stringliteral}{'total\_skipped\_batches'}] += 1
495             \textcolor{keywordflow}{else}:
496                 \textcolor{keywordflow}{raise} e
497 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae4496420685c3cd273920f89b4e82625}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae4496420685c3cd273920f89b4e82625}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!truncate\+\_\+input@{truncate\+\_\+input}}
\index{truncate\+\_\+input@{truncate\+\_\+input}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{truncate\+\_\+input()}{truncate\_input()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+truncate\+\_\+input (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 704 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
704     \textcolor{keyword}{def }truncate\_input(self, batch):
705         \textcolor{comment}{# truncate batch for multigpu}
706         text\_vec = batch.text\_vec[:-1]
707         batch = batch.\_replace(text\_vec=text\_vec)
708         \textcolor{keywordflow}{if} batch.label\_vec \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
709             label\_vec = batch.label\_vec[:-1]
710             batch = batch.\_replace(label\_vec=label\_vec)
711         \textcolor{keywordflow}{return} batch
712 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a4567d7a200e20bd09235d4833424bdad}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a4567d7a200e20bd09235d4833424bdad}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!truncate\+\_\+output@{truncate\+\_\+output}}
\index{truncate\+\_\+output@{truncate\+\_\+output}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{truncate\+\_\+output()}{truncate\_output()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+truncate\+\_\+output (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{out }\end{DoxyParamCaption})}



Definition at line 713 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
713     \textcolor{keyword}{def }truncate\_output(self, out):
714         new\_out\_0 = out[0][:-1]
715         new\_out\_1 = \textcolor{keywordtype}{None} \textcolor{keywordflow}{if} out[1] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{else} out[1][:-1]
716         new\_out\_2 = [vec[:-1] \textcolor{keywordflow}{for} vec \textcolor{keywordflow}{in} out[2]]
717         \textcolor{keywordflow}{return} tuple([new\_out\_0, new\_out\_1, new\_out\_2])
718 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a3fabaacec11534b452a1786d3dd5a6c8}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a3fabaacec11534b452a1786d3dd5a6c8}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!update\+\_\+params@{update\+\_\+params}}
\index{update\+\_\+params@{update\+\_\+params}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{update\+\_\+params()}{update\_params()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+update\+\_\+params (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Do one optimization step.
\end{DoxyVerb}
 

Definition at line 351 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
351     \textcolor{keyword}{def }update\_params(self):
352         \textcolor{stringliteral}{"""}
353 \textcolor{stringliteral}{        Do one optimization step.}
354 \textcolor{stringliteral}{        """}
355         \textcolor{keywordflow}{if} self.clip > 0:
356             torch.nn.utils.clip\_grad\_norm\_(self.model.parameters(), self.clip)
357         self.optimizer.step()
358 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae0e5663a7879b2704378dfe99ef6d0f4}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae0e5663a7879b2704378dfe99ef6d0f4}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!vectorize@{vectorize}}
\index{vectorize@{vectorize}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{vectorize()}{vectorize()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+vectorize (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{args,  }\item[{}]{kwargs }\end{DoxyParamCaption})}

\begin{DoxyVerb}Override vectorize for seq2seq.
\end{DoxyVerb}
 

Definition at line 412 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
412     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1utils_a5c76cc39e3014c7bcf9199d566dbdc0f}{vectorize}(self, *args, **kwargs):
413         \textcolor{stringliteral}{"""}
414 \textcolor{stringliteral}{        Override vectorize for seq2seq.}
415 \textcolor{stringliteral}{        """}
416         kwargs[\textcolor{stringliteral}{'add\_start'}] = \textcolor{keyword}{False}  \textcolor{comment}{# model does this in module code}
417         kwargs[\textcolor{stringliteral}{'add\_end'}] = \textcolor{keyword}{True}  \textcolor{comment}{# we do want this}
418         \textcolor{keywordflow}{return} super().\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1utils_a5c76cc39e3014c7bcf9199d566dbdc0f}{vectorize}(*args, **kwargs)
419 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_af2e9c4d06f55802308dbfedfea69d0cd}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_af2e9c4d06f55802308dbfedfea69d0cd}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!zero\+\_\+grad@{zero\+\_\+grad}}
\index{zero\+\_\+grad@{zero\+\_\+grad}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{zero\+\_\+grad()}{zero\_grad()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+zero\+\_\+grad (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Zero out optimizer.
\end{DoxyVerb}
 

Definition at line 345 of file seq2seq\+\_\+v1.\+py.


\begin{DoxyCode}
345     \textcolor{keyword}{def }zero\_grad(self):
346         \textcolor{stringliteral}{"""}
347 \textcolor{stringliteral}{        Zero out optimizer.}
348 \textcolor{stringliteral}{        """}
349         self.optimizer.zero\_grad()
350 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a070849409fda0767b993e13b9096fc29}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a070849409fda0767b993e13b9096fc29}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!beam\+\_\+block\+\_\+ngram@{beam\+\_\+block\+\_\+ngram}}
\index{beam\+\_\+block\+\_\+ngram@{beam\+\_\+block\+\_\+ngram}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{beam\+\_\+block\+\_\+ngram}{beam\_block\_ngram}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+beam\+\_\+block\+\_\+ngram}



Definition at line 231 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aa60eebf5d848b1e8b8c15a856456918a}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aa60eebf5d848b1e8b8c15a856456918a}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!beam\+\_\+dot\+\_\+dir@{beam\+\_\+dot\+\_\+dir}}
\index{beam\+\_\+dot\+\_\+dir@{beam\+\_\+dot\+\_\+dir}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{beam\+\_\+dot\+\_\+dir}{beam\_dot\_dir}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+beam\+\_\+dot\+\_\+dir}



Definition at line 247 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_af0b1011238f6a71eed46f10ea0300705}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_af0b1011238f6a71eed46f10ea0300705}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!beam\+\_\+dot\+\_\+log@{beam\+\_\+dot\+\_\+log}}
\index{beam\+\_\+dot\+\_\+log@{beam\+\_\+dot\+\_\+log}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{beam\+\_\+dot\+\_\+log}{beam\_dot\_log}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+beam\+\_\+dot\+\_\+log}



Definition at line 227 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aeebfbcecc59779e751869f7df3fcda19}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aeebfbcecc59779e751869f7df3fcda19}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!beam\+\_\+min\+\_\+length@{beam\+\_\+min\+\_\+length}}
\index{beam\+\_\+min\+\_\+length@{beam\+\_\+min\+\_\+length}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{beam\+\_\+min\+\_\+length}{beam\_min\_length}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+beam\+\_\+min\+\_\+length}



Definition at line 230 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a0416c2a28c0efae160d31f755f3b5db9}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a0416c2a28c0efae160d31f755f3b5db9}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!beam\+\_\+min\+\_\+n\+\_\+best@{beam\+\_\+min\+\_\+n\+\_\+best}}
\index{beam\+\_\+min\+\_\+n\+\_\+best@{beam\+\_\+min\+\_\+n\+\_\+best}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{beam\+\_\+min\+\_\+n\+\_\+best}{beam\_min\_n\_best}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+beam\+\_\+min\+\_\+n\+\_\+best}



Definition at line 229 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ab4afd6e6f79d32bd21e60ac11c0d414b}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ab4afd6e6f79d32bd21e60ac11c0d414b}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!beam\+\_\+size@{beam\+\_\+size}}
\index{beam\+\_\+size@{beam\+\_\+size}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{beam\+\_\+size}{beam\_size}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+beam\+\_\+size}



Definition at line 228 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae4bcab12b2cf1070cc8f712956f886ca}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_ae4bcab12b2cf1070cc8f712956f886ca}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!buffer\+\_\+initialized@{buffer\+\_\+initialized}}
\index{buffer\+\_\+initialized@{buffer\+\_\+initialized}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{buffer\+\_\+initialized}{buffer\_initialized}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+buffer\+\_\+initialized}



Definition at line 439 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a821dfcf56b6872f4377b0fc8c5ed94de}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a821dfcf56b6872f4377b0fc8c5ed94de}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!criterion@{criterion}}
\index{criterion@{criterion}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{criterion}{criterion}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+criterion}



Definition at line 262 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a8636132dae633a66cc34da3a20d9894a}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a8636132dae633a66cc34da3a20d9894a}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!id@{id}}
\index{id@{id}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{id}{id}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+id}



Definition at line 221 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a640b76ddf76c70e73c4012f37d4c72b7}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a640b76ddf76c70e73c4012f37d4c72b7}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!metrics@{metrics}}
\index{metrics@{metrics}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{metrics}{metrics}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+metrics}



Definition at line 236 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aeea96acec40c7a63d019ca56feca3c73}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_aeea96acec40c7a63d019ca56feca3c73}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!model@{model}}
\index{model@{model}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{model}{model}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+model}



Definition at line 235 of file seq2seq\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a82ff9540ce457658a7a7035055b36f77}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1seq2seq__v1_1_1Seq2seqAgent_a82ff9540ce457658a7a7035055b36f77}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}!multigpu@{multigpu}}
\index{multigpu@{multigpu}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::seq2seq\+\_\+v1\+::\+Seq2seq\+Agent}}
\subsubsection{\texorpdfstring{multigpu}{multigpu}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+seq2seq\+\_\+v1.\+Seq2seq\+Agent.\+multigpu}



Definition at line 222 of file seq2seq\+\_\+v1.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/legacy\+\_\+agents/seq2seq/\hyperlink{seq2seq__v1_8py}{seq2seq\+\_\+v1.\+py}\end{DoxyCompactItemize}
