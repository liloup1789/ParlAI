\hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp}{}\section{projects.\+self\+\_\+feeding.\+scripts.\+create\+\_\+synth\+\_\+supp Namespace Reference}
\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp}\index{projects.\+self\+\_\+feeding.\+scripts.\+create\+\_\+synth\+\_\+supp@{projects.\+self\+\_\+feeding.\+scripts.\+create\+\_\+synth\+\_\+supp}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_ac102836989a094f474dc72bb0aea814e}{setup\+\_\+args} (\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a8da22689879eac4440c61a84a853116f}{parser}=None)
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a81cbb13896d9614507b68362e90d8f6c}{create\+\_\+supp} (\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_afdf666a946d736b36f7ea30bc79b68a5}{opt})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a908a2aa407818b82de25657d8134fad0}{P\+A\+R\+L\+A\+I\+H\+O\+ME}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a5b495f99032281c13a567348fb396e0b}{N\+U\+M\+\_\+\+I\+N\+L\+I\+N\+E\+\_\+\+C\+A\+N\+DS}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a8da22689879eac4440c61a84a853116f}{parser}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_afdf666a946d736b36f7ea30bc79b68a5}{opt}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a81cbb13896d9614507b68362e90d8f6c}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a81cbb13896d9614507b68362e90d8f6c}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}!create\+\_\+supp@{create\+\_\+supp}}
\index{create\+\_\+supp@{create\+\_\+supp}!projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}}
\subsubsection{\texorpdfstring{create\+\_\+supp()}{create\_supp()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+scripts.\+create\+\_\+synth\+\_\+supp.\+create\+\_\+supp (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Evaluates a model.

:param opt: tells the evaluation function how to run
:param bool print_parser: if provided, prints the options that are set within the
    model after loading the model
:return: the final result of calling report()
\end{DoxyVerb}
 

Definition at line 76 of file create\+\_\+synth\+\_\+supp.\+py.


\begin{DoxyCode}
76 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a81cbb13896d9614507b68362e90d8f6c}{create\_supp}(opt):
77     \textcolor{stringliteral}{"""}
78 \textcolor{stringliteral}{    Evaluates a model.}
79 \textcolor{stringliteral}{}
80 \textcolor{stringliteral}{    :param opt: tells the evaluation function how to run}
81 \textcolor{stringliteral}{    :param bool print\_parser: if provided, prints the options that are set within the}
82 \textcolor{stringliteral}{        model after loading the model}
83 \textcolor{stringliteral}{    :return: the final result of calling report()}
84 \textcolor{stringliteral}{    """}
85     \textcolor{comment}{# Create model and assign it to the specified task}
86     agent = \hyperlink{namespaceparlai_1_1core_1_1agents_ad0d54074d4bcc148bb415ab5515a53b5}{create\_agent}(opt, requireModelExists=\textcolor{keyword}{True})
87     world = \hyperlink{namespaceparlai_1_1core_1_1worlds_a11923c10b545c7ecc1b08fe2242d9c2c}{create\_task}(opt, agent)
88 
89     \textcolor{comment}{# Extract supp examples from misses on deploy set}
90     num\_seen = 0
91     num\_misses = 0
92     num\_supp = 0
93     num\_supp\_correct = 0
94     examples = []
95     \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world.epoch\_done():
96         world.parley()
97         \textcolor{comment}{# Examples are considered one at a time}
98         num\_seen += 1
99         \textcolor{keywordflow}{if} num\_seen % 1000 == 0:
100             print(f\textcolor{stringliteral}{"\{num\_seen\}/\{world.num\_examples()\}"})
101         report = world.report()
102         \textcolor{keywordflow}{if} report[\textcolor{stringliteral}{'accuracy'}] < 1.0:
103             \textcolor{comment}{# Example is a miss (i.e., model got it wrong)}
104             num\_misses += 1
105             \textcolor{keywordflow}{if} random.random() < opt[\textcolor{stringliteral}{'conversion\_rate'}]:
106                 \textcolor{comment}{# Example will be converted (e.g., bot recognized mistake and asked)}
107                 num\_supp += 1
108                 texts = world.acts[0][\textcolor{stringliteral}{'text'}].split(\textcolor{stringliteral}{'\(\backslash\)n'})
109                 context = texts[-1]
110                 memories = texts[:-1]
111                 candidates = world.acts[0][\textcolor{stringliteral}{'label\_candidates'}]
112                 \textcolor{comment}{# Reward of 1 indicates positive, -1 indicates negative (for training)}
113                 \textcolor{comment}{# For now, we only train with positives, and the reward field is unused}
114                 reward = 1
115 
116                 \textcolor{keywordflow}{if} random.random() < opt[\textcolor{stringliteral}{'conversion\_acc'}]:
117                     \textcolor{comment}{# Example will be converted correctly (e.g., good user response)}
118                     num\_supp\_correct += 1
119                     response = world.acts[0][\textcolor{stringliteral}{'eval\_labels'}][0]
120                 \textcolor{keywordflow}{else}:
121                     \textcolor{comment}{# Example will be converted incorrectly (e.g., bad user response)}
122                     response = random.choice(
123                         world.acts[0][\textcolor{stringliteral}{'label\_candidates'}][: NUM\_INLINE\_CANDS - 1]
124                     )
125 
126                 example = Parley(context, response, reward, candidates, memories)
127                 examples.append(example)
128         world.reset\_metrics()
129 
130     print(\textcolor{stringliteral}{"EPOCH DONE"})
131     print(f\textcolor{stringliteral}{"Model file: \{opt['model\_file']\}"})
132     print(f\textcolor{stringliteral}{"Deploy file: \{opt['task']\}"})
133     print(f\textcolor{stringliteral}{"Supp file: \{opt['outfile']\}"})
134     print(f\textcolor{stringliteral}{"Deploy size (# examples seen): \{num\_seen\}"})
135     print(f\textcolor{stringliteral}{"Supp size (# examples converted): \{num\_supp\}"})
136 
137     acc = 1 - (num\_misses / num\_seen)
138     print(f\textcolor{stringliteral}{"Accuracy (% of deploy): \{acc * 100:.1f\}% (\{num\_misses\} misses)"})
139     print(
140         f\textcolor{stringliteral}{"Conversion rate (% of misses): \{num\_supp/num\_misses * 100:.2f\}% "}
141         f\textcolor{stringliteral}{"(\{num\_supp\}/\{num\_misses\})"}
142     )
143     print(
144         f\textcolor{stringliteral}{"Conversion acc (% of converted): \{num\_supp\_correct/num\_supp * 100:.2f\}% "}
145         f\textcolor{stringliteral}{"(\{num\_supp\_correct\}/\{num\_supp\})"}
146     )
147 
148     with open(opt[\textcolor{stringliteral}{'outfile'}], \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} outfile:
149         \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} examples:
150             outfile.write(json.dumps(ex.to\_dict()) + \textcolor{stringliteral}{'\(\backslash\)n'})
151 
152 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_ac102836989a094f474dc72bb0aea814e}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_ac102836989a094f474dc72bb0aea814e}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}!setup\+\_\+args@{setup\+\_\+args}}
\index{setup\+\_\+args@{setup\+\_\+args}!projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}}
\subsubsection{\texorpdfstring{setup\+\_\+args()}{setup\_args()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+scripts.\+create\+\_\+synth\+\_\+supp.\+setup\+\_\+args (\begin{DoxyParamCaption}\item[{}]{parser = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 44 of file create\+\_\+synth\+\_\+supp.\+py.


\begin{DoxyCode}
44 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_ac102836989a094f474dc72bb0aea814e}{setup\_args}(parser=None):
45     \textcolor{comment}{# Get command line arguments}
46     \textcolor{keywordflow}{if} parser \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
47         parser = ParlaiParser(\textcolor{keyword}{True}, \textcolor{keyword}{True}, \textcolor{stringliteral}{'Display data from a task'})
48     parser.add\_argument(
49         \textcolor{stringliteral}{'-mf'},
50         \textcolor{stringliteral}{'--model-file'},
51         type=str,
52         default=\textcolor{stringliteral}{'/private/home/bhancock/metadialog/models/unknown.mdl'},
53     )
54     parser.add\_argument(\textcolor{stringliteral}{'-dfile'}, \textcolor{stringliteral}{'--deploy-file'}, type=str, default=\textcolor{stringliteral}{'train\_c'})
55     parser.add\_argument(\textcolor{stringliteral}{'-sfile'}, \textcolor{stringliteral}{'--supp-file'}, type=str, default=\textcolor{stringliteral}{'supp\_c'})
56     parser.add\_argument(
57         \textcolor{stringliteral}{'-cr'},
58         \textcolor{stringliteral}{'--conversion-rate'},
59         type=float,
60         default=1.0,
61         help=\textcolor{stringliteral}{"The fraction of misses converted into new training data"},
62     )
63     parser.add\_argument(
64         \textcolor{stringliteral}{'-ca'},
65         \textcolor{stringliteral}{'--conversion-acc'},
66         type=float,
67         default=1.0,
68         help=\textcolor{stringliteral}{"The fraction of converted data that have a correct label"},
69     )
70     parser.set\_defaults(bs=1)
71     parser.set\_defaults(ecands=\textcolor{stringliteral}{'inline'})
72     parser.set\_defaults(datatype=\textcolor{stringliteral}{'valid'})
73     \textcolor{keywordflow}{return} parser
74 
75 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a5b495f99032281c13a567348fb396e0b}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a5b495f99032281c13a567348fb396e0b}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}!N\+U\+M\+\_\+\+I\+N\+L\+I\+N\+E\+\_\+\+C\+A\+N\+DS@{N\+U\+M\+\_\+\+I\+N\+L\+I\+N\+E\+\_\+\+C\+A\+N\+DS}}
\index{N\+U\+M\+\_\+\+I\+N\+L\+I\+N\+E\+\_\+\+C\+A\+N\+DS@{N\+U\+M\+\_\+\+I\+N\+L\+I\+N\+E\+\_\+\+C\+A\+N\+DS}!projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}}
\subsubsection{\texorpdfstring{N\+U\+M\+\_\+\+I\+N\+L\+I\+N\+E\+\_\+\+C\+A\+N\+DS}{NUM\_INLINE\_CANDS}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+create\+\_\+synth\+\_\+supp.\+N\+U\+M\+\_\+\+I\+N\+L\+I\+N\+E\+\_\+\+C\+A\+N\+DS}



Definition at line 41 of file create\+\_\+synth\+\_\+supp.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_afdf666a946d736b36f7ea30bc79b68a5}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_afdf666a946d736b36f7ea30bc79b68a5}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}!opt@{opt}}
\index{opt@{opt}!projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+create\+\_\+synth\+\_\+supp.\+opt}



Definition at line 156 of file create\+\_\+synth\+\_\+supp.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a908a2aa407818b82de25657d8134fad0}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a908a2aa407818b82de25657d8134fad0}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}!P\+A\+R\+L\+A\+I\+H\+O\+ME@{P\+A\+R\+L\+A\+I\+H\+O\+ME}}
\index{P\+A\+R\+L\+A\+I\+H\+O\+ME@{P\+A\+R\+L\+A\+I\+H\+O\+ME}!projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}}
\subsubsection{\texorpdfstring{P\+A\+R\+L\+A\+I\+H\+O\+ME}{PARLAIHOME}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+create\+\_\+synth\+\_\+supp.\+P\+A\+R\+L\+A\+I\+H\+O\+ME}



Definition at line 40 of file create\+\_\+synth\+\_\+supp.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a8da22689879eac4440c61a84a853116f}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1create__synth__supp_a8da22689879eac4440c61a84a853116f}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}!parser@{parser}}
\index{parser@{parser}!projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp@{projects\+::self\+\_\+feeding\+::scripts\+::create\+\_\+synth\+\_\+supp}}
\subsubsection{\texorpdfstring{parser}{parser}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+create\+\_\+synth\+\_\+supp.\+parser}



Definition at line 155 of file create\+\_\+synth\+\_\+supp.\+py.

