\hypertarget{namespaceprojects_1_1self__feeding_1_1utils}{}\section{projects.\+self\+\_\+feeding.\+utils Namespace Reference}
\label{namespaceprojects_1_1self__feeding_1_1utils}\index{projects.\+self\+\_\+feeding.\+utils@{projects.\+self\+\_\+feeding.\+utils}}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classprojects_1_1self__feeding_1_1utils_1_1Parley}{Parley}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a82b7afe0cb01d90b1de3724f3a6b23fb}{sanitize\+\_\+parley} (parley)
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a3f3d055dc6c4058057baae7b240de5ec}{add\+\_\+person\+\_\+tokens} (responses, first\+\_\+speaker=None, last\+\_\+speaker=1)
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a813014fa481008e57bf444f8a3f88d3e}{extract\+\_\+fb\+\_\+episodes} (datafile)
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a7bfa2fe610a2d0da7968b1a2662e0c23}{extract\+\_\+parlai\+\_\+episodes} (datafile)
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a4523d4a7c4da698dda134e32acebe320}{episode\+\_\+to\+\_\+examples} (episode, histsz)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1utils_a3f3d055dc6c4058057baae7b240de5ec}\label{namespaceprojects_1_1self__feeding_1_1utils_a3f3d055dc6c4058057baae7b240de5ec}} 
\index{projects\+::self\+\_\+feeding\+::utils@{projects\+::self\+\_\+feeding\+::utils}!add\+\_\+person\+\_\+tokens@{add\+\_\+person\+\_\+tokens}}
\index{add\+\_\+person\+\_\+tokens@{add\+\_\+person\+\_\+tokens}!projects\+::self\+\_\+feeding\+::utils@{projects\+::self\+\_\+feeding\+::utils}}
\subsubsection{\texorpdfstring{add\+\_\+person\+\_\+tokens()}{add\_person\_tokens()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+utils.\+add\+\_\+person\+\_\+tokens (\begin{DoxyParamCaption}\item[{}]{responses,  }\item[{}]{first\+\_\+speaker = {\ttfamily None},  }\item[{}]{last\+\_\+speaker = {\ttfamily 1} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Converts a list of responses into a single tag-separated string
Args:
    responses: list of responses (strings)
    first_speaker: either 1 or 2; the owner of the first response
    last_speaker: either 1 or 2; the owner of the last response
        NOTE: if first_speaker is provided, it overrides last_speaker
Output:
    text: the concatenated text

e.g.,
responses = ["How are you?", "I'm doing fine!", "I'm glad to hear it!"]
result = add_person_tokens(responses)
result: "__p1__ How are you? __p2__ I'm doing fine! __p1__ I'm glad to
    hear it!"
\end{DoxyVerb}
 

Definition at line 107 of file utils.\+py.


\begin{DoxyCode}
107 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a3f3d055dc6c4058057baae7b240de5ec}{add\_person\_tokens}(responses, first\_speaker=None, last\_speaker=1):
108     \textcolor{stringliteral}{"""Converts a list of responses into a single tag-separated string}
109 \textcolor{stringliteral}{    Args:}
110 \textcolor{stringliteral}{        responses: list of responses (strings)}
111 \textcolor{stringliteral}{        first\_speaker: either 1 or 2; the owner of the first response}
112 \textcolor{stringliteral}{        last\_speaker: either 1 or 2; the owner of the last response}
113 \textcolor{stringliteral}{            NOTE: if first\_speaker is provided, it overrides last\_speaker}
114 \textcolor{stringliteral}{    Output:}
115 \textcolor{stringliteral}{        text: the concatenated text}
116 \textcolor{stringliteral}{}
117 \textcolor{stringliteral}{    e.g.,}
118 \textcolor{stringliteral}{    responses = ["How are you?", "I'm doing fine!", "I'm glad to hear it!"]}
119 \textcolor{stringliteral}{    result = add\_person\_tokens(responses)}
120 \textcolor{stringliteral}{    result: "\_\_p1\_\_ How are you? \_\_p2\_\_ I'm doing fine! \_\_p1\_\_ I'm glad to}
121 \textcolor{stringliteral}{        hear it!"}
122 \textcolor{stringliteral}{    """}
123     \textcolor{keywordflow}{if} first\_speaker \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
124         first\_speaker = (last\_speaker + len(responses)) % 2 + 1
125     speaker = first\_speaker
126     text = \textcolor{stringliteral}{''}
127     \textcolor{keywordflow}{for} response \textcolor{keywordflow}{in} responses:
128         tag = f\textcolor{stringliteral}{"\_\_p\{speaker\}\_\_"}
129         text += \textcolor{stringliteral}{' '} + tag + \textcolor{stringliteral}{' '} + response
130         speaker = 1 \textcolor{keywordflow}{if} speaker == 2 \textcolor{keywordflow}{else} 2
131     \textcolor{keywordflow}{return} text.strip()
132 
133 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1utils_a4523d4a7c4da698dda134e32acebe320}\label{namespaceprojects_1_1self__feeding_1_1utils_a4523d4a7c4da698dda134e32acebe320}} 
\index{projects\+::self\+\_\+feeding\+::utils@{projects\+::self\+\_\+feeding\+::utils}!episode\+\_\+to\+\_\+examples@{episode\+\_\+to\+\_\+examples}}
\index{episode\+\_\+to\+\_\+examples@{episode\+\_\+to\+\_\+examples}!projects\+::self\+\_\+feeding\+::utils@{projects\+::self\+\_\+feeding\+::utils}}
\subsubsection{\texorpdfstring{episode\+\_\+to\+\_\+examples()}{episode\_to\_examples()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+utils.\+episode\+\_\+to\+\_\+examples (\begin{DoxyParamCaption}\item[{}]{episode,  }\item[{}]{histsz }\end{DoxyParamCaption})}

\begin{DoxyVerb}Converts an episode (list of Parleys) into self-feeding compatible examples.

WARNING: we no longer require a histz when making a self-feeding file. Shortening of
the history is typically done in the teacher file or in interactive mode.
\end{DoxyVerb}
 

Definition at line 161 of file utils.\+py.


\begin{DoxyCode}
161 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a4523d4a7c4da698dda134e32acebe320}{episode\_to\_examples}(episode, histsz):
162     \textcolor{stringliteral}{"""}
163 \textcolor{stringliteral}{    Converts an episode (list of Parleys) into self-feeding compatible examples.}
164 \textcolor{stringliteral}{}
165 \textcolor{stringliteral}{    WARNING: we no longer require a histz when making a self-feeding file. Shortening of}
166 \textcolor{stringliteral}{    the history is typically done in the teacher file or in interactive mode.}
167 \textcolor{stringliteral}{    """}
168     examples = []
169     history = []
170     \textcolor{keywordflow}{for} parley \textcolor{keywordflow}{in} episode:
171         \textcolor{comment}{# Update memories and history}
172         \textcolor{comment}{# memories.extend(parley.memories)}
173         history.append(parley.context)
174 
175         \textcolor{comment}{# Concatenate history and add speaker tokens as necessary}
176         \textcolor{comment}{# if history\_size == 1, the bot (p2) only sees the immediately}
177         \textcolor{comment}{# preceding utterance (the prompt from the human, p1).}
178         \textcolor{keywordflow}{if} histsz < 0:
179             utterances = history
180             context = \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a3f3d055dc6c4058057baae7b240de5ec}{add\_person\_tokens}(utterances, last\_speaker=1)
181         \textcolor{keywordflow}{elif} histsz == 0:
182             context = \textcolor{stringliteral}{'\_\_null\_\_'}
183         \textcolor{keywordflow}{else}:
184             utterances = history[-histsz:]
185             context = \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a3f3d055dc6c4058057baae7b240de5ec}{add\_person\_tokens}(utterances, last\_speaker=1)
186 
187         example = Parley(
188             context,
189             parley.response,
190             parley.reward,
191             copy.deepcopy(parley.candidates),
192             \textcolor{comment}{# copy.deepcopy(memories),}
193         )
194         examples.append(example)
195 
196         \textcolor{comment}{# Add current turn's response to the history}
197         history.append(parley.response)
198     \textcolor{keywordflow}{return} examples
199 \end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1utils_a813014fa481008e57bf444f8a3f88d3e}\label{namespaceprojects_1_1self__feeding_1_1utils_a813014fa481008e57bf444f8a3f88d3e}} 
\index{projects\+::self\+\_\+feeding\+::utils@{projects\+::self\+\_\+feeding\+::utils}!extract\+\_\+fb\+\_\+episodes@{extract\+\_\+fb\+\_\+episodes}}
\index{extract\+\_\+fb\+\_\+episodes@{extract\+\_\+fb\+\_\+episodes}!projects\+::self\+\_\+feeding\+::utils@{projects\+::self\+\_\+feeding\+::utils}}
\subsubsection{\texorpdfstring{extract\+\_\+fb\+\_\+episodes()}{extract\_fb\_episodes()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+utils.\+extract\+\_\+fb\+\_\+episodes (\begin{DoxyParamCaption}\item[{}]{datafile }\end{DoxyParamCaption})}



Definition at line 134 of file utils.\+py.


\begin{DoxyCode}
134 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a813014fa481008e57bf444f8a3f88d3e}{extract\_fb\_episodes}(datafile):
135     opt = \{\textcolor{stringliteral}{'datatype'}: \textcolor{stringliteral}{'train'}, \textcolor{stringliteral}{'datafile'}: datafile\}
136     episode = \textcolor{keywordtype}{None}
137     \textcolor{keywordflow}{for} parley \textcolor{keywordflow}{in} FbDialogTeacher(opt).\hyperlink{namespaceparlai_1_1tasks_1_1aqua_1_1agents_a2d4e9f4e80d4edc0646c7e3d52be9f25}{setup\_data}(datafile):
138         fields, is\_new\_episode = parley
139         \textcolor{keywordflow}{if} is\_new\_episode:
140             \textcolor{keywordflow}{if} episode \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
141                 \textcolor{keywordflow}{yield} episode
142             episode = []
143         raw\_parley = Parley(*fields)
144         parley = \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a82b7afe0cb01d90b1de3724f3a6b23fb}{sanitize\_parley}(raw\_parley)
145         episode.append(parley)
146     \textcolor{keywordflow}{yield} episode
147 
148 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1utils_a7bfa2fe610a2d0da7968b1a2662e0c23}\label{namespaceprojects_1_1self__feeding_1_1utils_a7bfa2fe610a2d0da7968b1a2662e0c23}} 
\index{projects\+::self\+\_\+feeding\+::utils@{projects\+::self\+\_\+feeding\+::utils}!extract\+\_\+parlai\+\_\+episodes@{extract\+\_\+parlai\+\_\+episodes}}
\index{extract\+\_\+parlai\+\_\+episodes@{extract\+\_\+parlai\+\_\+episodes}!projects\+::self\+\_\+feeding\+::utils@{projects\+::self\+\_\+feeding\+::utils}}
\subsubsection{\texorpdfstring{extract\+\_\+parlai\+\_\+episodes()}{extract\_parlai\_episodes()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+utils.\+extract\+\_\+parlai\+\_\+episodes (\begin{DoxyParamCaption}\item[{}]{datafile }\end{DoxyParamCaption})}



Definition at line 149 of file utils.\+py.


\begin{DoxyCode}
149 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a7bfa2fe610a2d0da7968b1a2662e0c23}{extract\_parlai\_episodes}(datafile):
150     opt = \{
151         \textcolor{stringliteral}{'datatype'}: \textcolor{stringliteral}{'train'},
152         \textcolor{stringliteral}{'datafile'}: datafile,  \textcolor{comment}{# is this necessary?}
153         \textcolor{stringliteral}{'parlaidialogteacher\_datafile'}: datafile,
154     \}
155     episode = \textcolor{keywordtype}{None}
156     \textcolor{keywordflow}{for} episode \textcolor{keywordflow}{in} ParlAIDialogTeacher(opt).episodes:
157         episode = [Parley(**parley\_dict) \textcolor{keywordflow}{for} parley\_dict \textcolor{keywordflow}{in} episode]
158         \textcolor{keywordflow}{yield} episode
159 
160 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1utils_a82b7afe0cb01d90b1de3724f3a6b23fb}\label{namespaceprojects_1_1self__feeding_1_1utils_a82b7afe0cb01d90b1de3724f3a6b23fb}} 
\index{projects\+::self\+\_\+feeding\+::utils@{projects\+::self\+\_\+feeding\+::utils}!sanitize\+\_\+parley@{sanitize\+\_\+parley}}
\index{sanitize\+\_\+parley@{sanitize\+\_\+parley}!projects\+::self\+\_\+feeding\+::utils@{projects\+::self\+\_\+feeding\+::utils}}
\subsubsection{\texorpdfstring{sanitize\+\_\+parley()}{sanitize\_parley()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+utils.\+sanitize\+\_\+parley (\begin{DoxyParamCaption}\item[{}]{parley }\end{DoxyParamCaption})}

\begin{DoxyVerb}Separate memories from context, pull out response, split context/memories lists.
\end{DoxyVerb}
 

Definition at line 91 of file utils.\+py.


\begin{DoxyCode}
91 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a82b7afe0cb01d90b1de3724f3a6b23fb}{sanitize\_parley}(parley):
92     \textcolor{stringliteral}{"""}
93 \textcolor{stringliteral}{    Separate memories from context, pull out response, split context/memories lists.}
94 \textcolor{stringliteral}{    """}
95     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'\(\backslash\)n'} \textcolor{keywordflow}{in} parley.context:
96         snippets = parley.context.split(\textcolor{stringliteral}{'\(\backslash\)n'})
97         text = snippets[-1]
98         mems = snippets[:-1]
99         parley.context = text
100         parley.memories = mems
101     parley.response = parley.response[0]
102     \textcolor{keyword}{assert} isinstance(parley.candidates, list)
103     \textcolor{keyword}{assert} isinstance(parley.memories, list)
104     \textcolor{keywordflow}{return} parley
105 
106 
\end{DoxyCode}
