\hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions}{}\section{parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions Class Reference}
\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions}\index{parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions}}


Inheritance diagram for parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=304pt]{d4/d2d/classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=304pt]{d3/d55/classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a7fc003fa5fd1a550c5beb62e312a3493}{set\+Up} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a7528a419b3b3d3b18a4c1c498f46129f}{tear\+Down} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ad5d172db7820f6b3b976a292df305a20}{test\+\_\+socket\+\_\+dead} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_af52a75550f8ece0ef60c6efefef85846}{test\+\_\+send\+\_\+message\+\_\+command} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_abe4ad6d598ea29fcecf8b75d0c5213e9}{test\+\_\+free\+\_\+workers} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a3e39e30f2cfbc368090fb01c3eba9797}{test\+\_\+force\+\_\+expire\+\_\+hit} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_afe09472ef978a90bd79e8cd36f96c713}{test\+\_\+get\+\_\+qualifications} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_aa7ba1eaf133653de11a01797a710a73a}{test\+\_\+create\+\_\+additional\+\_\+hits} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a3fab685b210500647083aac1cc85d55e}{test\+\_\+expire\+\_\+all\+\_\+hits} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ad71616be59c93693599aa84f3f2d9393}{test\+\_\+qualification\+\_\+management} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a780c4799ea08d54aa3505d2a6ca391a4}{test\+\_\+partner\+\_\+disconnect} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ab4d94c614264f70168dc18a97b9d2e19}{test\+\_\+expire\+\_\+onboarding} (self)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_aa488a2c74a44efa954d7f00d7d6f7364}{fake\+\_\+socket}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ae031b00d0578e66e16776d21f3b17cbb}{opt}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a9a1019796c71636d8fb2260ed140e53d}{mturk\+\_\+agent\+\_\+ids}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_aebae0d07a4711e62c3d8453b36f04a93}{mturk\+\_\+manager}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a82517cee6c47de3f79d4dfdddbae1a5b}{agent\+\_\+1}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_afcd9b1d86894071982c38aeddc2b69c2}{agent\+\_\+2}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Semi-unit semi-integration tests on the more state-dependent MTurkManager
functionality.
\end{DoxyVerb}
 

Definition at line 1036 of file test\+\_\+mturk\+\_\+manager.\+py.



\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a7fc003fa5fd1a550c5beb62e312a3493}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a7fc003fa5fd1a550c5beb62e312a3493}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!set\+Up@{set\+Up}}
\index{set\+Up@{set\+Up}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{set\+Up()}{setUp()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+set\+Up (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1042 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1042     \textcolor{keyword}{def }setUp(self):
1043         self.fake\_socket = MockSocket()
1044         time.sleep(0.1)
1045         argparser = ParlaiParser(\textcolor{keyword}{False}, \textcolor{keyword}{False})
1046         argparser.add\_parlai\_data\_path()
1047         argparser.add\_mturk\_args()
1048         self.opt = argparser.parse\_args(print\_args=\textcolor{keyword}{False})
1049         self.opt[\textcolor{stringliteral}{'task'}] = \textcolor{stringliteral}{'unittest'}
1050         self.opt[\textcolor{stringliteral}{'assignment\_duration\_in\_seconds'}] = 6
1051         self.mturk\_agent\_ids = [\textcolor{stringliteral}{'mturk\_agent\_1'}, \textcolor{stringliteral}{'mturk\_agent\_2'}]
1052         self.mturk\_manager = MTurkManager(
1053             opt=self.opt, mturk\_agent\_ids=self.mturk\_agent\_ids, is\_test=\textcolor{keyword}{True}
1054         )
1055         self.mturk\_manager.\_init\_state()
1056         self.mturk\_manager.port = self.fake\_socket.port
1057         self.mturk\_manager.\_onboard\_new\_agent = mock.MagicMock()
1058         self.mturk\_manager.\_wait\_for\_task\_expirations = mock.MagicMock()
1059         self.mturk\_manager.task\_group\_id = \textcolor{stringliteral}{'TEST\_GROUP\_ID'}
1060         self.mturk\_manager.server\_url = \textcolor{stringliteral}{'https://127.0.0.1'}
1061         self.mturk\_manager.task\_state = self.mturk\_manager.STATE\_ACCEPTING\_WORKERS
1062         self.mturk\_manager.\_setup\_socket()
1063         alive\_packet = Packet(
1064             \textcolor{stringliteral}{''},
1065             \textcolor{stringliteral}{''},
1066             \textcolor{stringliteral}{''},
1067             \textcolor{stringliteral}{''},
1068             \textcolor{stringliteral}{''},
1069             \{
1070                 \textcolor{stringliteral}{'worker\_id'}: TEST\_WORKER\_ID\_1,
1071                 \textcolor{stringliteral}{'hit\_id'}: TEST\_HIT\_ID\_1,
1072                 \textcolor{stringliteral}{'assignment\_id'}: TEST\_ASSIGNMENT\_ID\_1,
1073                 \textcolor{stringliteral}{'conversation\_id'}: \textcolor{keywordtype}{None},
1074             \},
1075             \textcolor{stringliteral}{''},
1076         )
1077         self.mturk\_manager.\_on\_alive(alive\_packet)
1078         alive\_packet = Packet(
1079             \textcolor{stringliteral}{''},
1080             \textcolor{stringliteral}{''},
1081             \textcolor{stringliteral}{''},
1082             \textcolor{stringliteral}{''},
1083             \textcolor{stringliteral}{''},
1084             \{
1085                 \textcolor{stringliteral}{'worker\_id'}: TEST\_WORKER\_ID\_2,
1086                 \textcolor{stringliteral}{'hit\_id'}: TEST\_HIT\_ID\_2,
1087                 \textcolor{stringliteral}{'assignment\_id'}: TEST\_ASSIGNMENT\_ID\_2,
1088                 \textcolor{stringliteral}{'conversation\_id'}: \textcolor{keywordtype}{None},
1089             \},
1090             \textcolor{stringliteral}{''},
1091         )
1092         self.mturk\_manager.\_on\_alive(alive\_packet)
1093         self.agent\_1 = self.mturk\_manager.worker\_manager.get\_agent\_for\_assignment(
1094             TEST\_ASSIGNMENT\_ID\_1
1095         )
1096         self.agent\_2 = self.mturk\_manager.worker\_manager.get\_agent\_for\_assignment(
1097             TEST\_ASSIGNMENT\_ID\_2
1098         )
1099 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a7528a419b3b3d3b18a4c1c498f46129f}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a7528a419b3b3d3b18a4c1c498f46129f}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!tear\+Down@{tear\+Down}}
\index{tear\+Down@{tear\+Down}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{tear\+Down()}{tearDown()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+tear\+Down (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1100 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1100     \textcolor{keyword}{def }tearDown(self):
1101         self.mturk\_manager.shutdown()
1102         self.fake\_socket.close()
1103 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_aa7ba1eaf133653de11a01797a710a73a}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_aa7ba1eaf133653de11a01797a710a73a}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!test\+\_\+create\+\_\+additional\+\_\+hits@{test\+\_\+create\+\_\+additional\+\_\+hits}}
\index{test\+\_\+create\+\_\+additional\+\_\+hits@{test\+\_\+create\+\_\+additional\+\_\+hits}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{test\+\_\+create\+\_\+additional\+\_\+hits()}{test\_create\_additional\_hits()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+test\+\_\+create\+\_\+additional\+\_\+hits (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1363 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1363     \textcolor{keyword}{def }test\_create\_additional\_hits(self):
1364         manager = self.mturk\_manager
1365         manager.opt[\textcolor{stringliteral}{'hit\_title'}] = \textcolor{stringliteral}{'test\_hit\_title'}
1366         manager.opt[\textcolor{stringliteral}{'hit\_description'}] = \textcolor{stringliteral}{'test\_hit\_description'}
1367         manager.opt[\textcolor{stringliteral}{'hit\_keywords'}] = \textcolor{stringliteral}{'test\_hit\_keywords'}
1368         manager.opt[\textcolor{stringliteral}{'reward'}] = 0.1
1369         mturk\_utils = MTurkManagerFile.mturk\_utils
1370         fake\_hit = \textcolor{stringliteral}{'fake\_hit\_type'}
1371         mturk\_utils.create\_hit\_type = mock.MagicMock(return\_value=fake\_hit)
1372         mturk\_utils.subscribe\_to\_hits = mock.MagicMock()
1373         mturk\_utils.create\_hit\_with\_hit\_type = mock.MagicMock(
1374             return\_value=(\textcolor{stringliteral}{'page\_url'}, \textcolor{stringliteral}{'hit\_id'}, \textcolor{stringliteral}{'test\_hit\_response'})
1375         )
1376         manager.server\_url = \textcolor{stringliteral}{'test\_url'}
1377         manager.task\_group\_id = \textcolor{stringliteral}{'task\_group\_id'}
1378         manager.topic\_arn = \textcolor{stringliteral}{'topic\_arn'}
1379         mturk\_chat\_url = \textcolor{stringliteral}{'\{\}/chat\_index?task\_group\_id=\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
1380             manager.server\_url, manager.task\_group\_id
1381         )
1382         hit\_url = manager.create\_additional\_hits(5)
1383         mturk\_utils.create\_hit\_type.assert\_called\_once()
1384         mturk\_utils.subscribe\_to\_hits.assert\_called\_with(
1385             fake\_hit, manager.is\_sandbox, manager.topic\_arn
1386         )
1387         self.assertEqual(len(mturk\_utils.create\_hit\_with\_hit\_type.call\_args\_list), 5)
1388         mturk\_utils.create\_hit\_with\_hit\_type.assert\_called\_with(
1389             opt=manager.opt,
1390             page\_url=mturk\_chat\_url,
1391             hit\_type\_id=fake\_hit,
1392             num\_assignments=1,
1393             is\_sandbox=manager.is\_sandbox,
1394         )
1395         self.assertEqual(len(manager.hit\_id\_list), 5)
1396         self.assertEqual(hit\_url, \textcolor{stringliteral}{'page\_url'})
1397 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a3fab685b210500647083aac1cc85d55e}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a3fab685b210500647083aac1cc85d55e}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!test\+\_\+expire\+\_\+all\+\_\+hits@{test\+\_\+expire\+\_\+all\+\_\+hits}}
\index{test\+\_\+expire\+\_\+all\+\_\+hits@{test\+\_\+expire\+\_\+all\+\_\+hits}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{test\+\_\+expire\+\_\+all\+\_\+hits()}{test\_expire\_all\_hits()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+test\+\_\+expire\+\_\+all\+\_\+hits (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1398 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1398     \textcolor{keyword}{def }test\_expire\_all\_hits(self):
1399         manager = self.mturk\_manager
1400         incomplete\_1 = \textcolor{stringliteral}{'incomplete\_1'}
1401         incomplete\_2 = \textcolor{stringliteral}{'incomplete\_2'}
1402         MTurkManagerFile.mturk\_utils.expire\_hit = mock.MagicMock()
1403         manager.hit\_id\_list = [incomplete\_1, incomplete\_2]
1404 
1405         manager.expire\_all\_unassigned\_hits()
1406         expire\_calls = MTurkManagerFile.mturk\_utils.expire\_hit.call\_args\_list
1407         self.assertEqual(len(expire\_calls), 2)
1408         \textcolor{keywordflow}{for} hit \textcolor{keywordflow}{in} [incomplete\_1, incomplete\_2]:
1409             found = \textcolor{keyword}{False}
1410             \textcolor{keywordflow}{for} expire\_call \textcolor{keywordflow}{in} expire\_calls:
1411                 \textcolor{keywordflow}{if} expire\_call[0][1] == hit:
1412                     found = \textcolor{keyword}{True}
1413                     \textcolor{keywordflow}{break}
1414             self.assertTrue(found)
1415 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ab4d94c614264f70168dc18a97b9d2e19}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ab4d94c614264f70168dc18a97b9d2e19}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!test\+\_\+expire\+\_\+onboarding@{test\+\_\+expire\+\_\+onboarding}}
\index{test\+\_\+expire\+\_\+onboarding@{test\+\_\+expire\+\_\+onboarding}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{test\+\_\+expire\+\_\+onboarding()}{test\_expire\_onboarding()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+test\+\_\+expire\+\_\+onboarding (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1474 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1474     \textcolor{keyword}{def }test\_expire\_onboarding(self):
1475         manager = self.mturk\_manager
1476         manager.force\_expire\_hit = mock.MagicMock()
1477         self.agent\_2.set\_status(AssignState.STATUS\_ONBOARDING)
1478         manager.\_expire\_onboarding\_pool()
1479 
1480         manager.force\_expire\_hit.assert\_called\_once\_with(
1481             self.agent\_2.worker\_id, self.agent\_2.assignment\_id
1482         )
1483 
1484 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a3e39e30f2cfbc368090fb01c3eba9797}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a3e39e30f2cfbc368090fb01c3eba9797}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!test\+\_\+force\+\_\+expire\+\_\+hit@{test\+\_\+force\+\_\+expire\+\_\+hit}}
\index{test\+\_\+force\+\_\+expire\+\_\+hit@{test\+\_\+force\+\_\+expire\+\_\+hit}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{test\+\_\+force\+\_\+expire\+\_\+hit()}{test\_force\_expire\_hit()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+test\+\_\+force\+\_\+expire\+\_\+hit (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1239 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1239     \textcolor{keyword}{def }test\_force\_expire\_hit(self):
1240         manager = self.mturk\_manager
1241         agent = self.agent\_1
1242         worker\_id = agent.worker\_id
1243         assignment\_id = agent.assignment\_id
1244         socket\_manager = manager.socket\_manager
1245         manager.send\_command = mock.MagicMock()
1246         manager.send\_state\_change = mock.MagicMock()
1247         socket\_manager.close\_channel = mock.MagicMock()
1248 
1249         \textcolor{comment}{# Test expiring finished worker}
1250         agent.set\_status(AssignState.STATUS\_DONE)
1251         manager.force\_expire\_hit(worker\_id, assignment\_id)
1252         manager.send\_command.assert\_not\_called()
1253         socket\_manager.close\_channel.assert\_not\_called()
1254         self.assertEqual(agent.get\_status(), AssignState.STATUS\_DONE)
1255 
1256         \textcolor{comment}{# Test expiring not finished worker with default args}
1257         agent.set\_status(AssignState.STATUS\_ONBOARDING)
1258         manager.send\_state\_change.reset\_mock()
1259         manager.force\_expire\_hit(worker\_id, assignment\_id)
1260         manager.send\_state\_change.assert\_called\_once()
1261         args = manager.send\_state\_change.call\_args[0]
1262         used\_worker\_id, used\_assignment\_id, data = args[0], args[1], args[2]
1263         ack\_func = manager.send\_state\_change.call\_args[1][\textcolor{stringliteral}{'ack\_func'}]
1264         ack\_func()
1265         self.assertEqual(worker\_id, used\_worker\_id)
1266         self.assertEqual(assignment\_id, used\_assignment\_id)
1267         self.assertEqual(agent.get\_status(), AssignState.STATUS\_EXPIRED)
1268         self.assertTrue(agent.hit\_is\_expired)
1269         self.assertIsNotNone(data[\textcolor{stringliteral}{'done\_text'}])
1270         socket\_manager.close\_channel.assert\_called\_once\_with(agent.get\_connection\_id())
1271 
1272         \textcolor{comment}{# Test expiring not finished worker with custom arguments}
1273         agent.set\_status(AssignState.STATUS\_ONBOARDING)
1274         agent.hit\_is\_expired = \textcolor{keyword}{False}
1275         manager.send\_state\_change.reset\_mock()
1276         socket\_manager.close\_channel = mock.MagicMock()
1277         special\_disconnect\_text = \textcolor{stringliteral}{'You were disconnected as part of a test'}
1278         test\_ack\_function = mock.MagicMock()
1279         manager.force\_expire\_hit(
1280             worker\_id,
1281             assignment\_id,
1282             text=special\_disconnect\_text,
1283             ack\_func=test\_ack\_function,
1284         )
1285         manager.send\_state\_change.assert\_called\_once()
1286         args = manager.send\_state\_change.call\_args[0]
1287         used\_worker\_id, used\_assignment\_id, data = args[0], args[1], args[2]
1288         ack\_func = manager.send\_state\_change.call\_args[1][\textcolor{stringliteral}{'ack\_func'}]
1289         ack\_func()
1290         self.assertEqual(worker\_id, used\_worker\_id)
1291         self.assertEqual(assignment\_id, used\_assignment\_id)
1292         self.assertEqual(agent.get\_status(), AssignState.STATUS\_EXPIRED)
1293         self.assertTrue(agent.hit\_is\_expired)
1294         self.assertEqual(data[\textcolor{stringliteral}{'done\_text'}], special\_disconnect\_text)
1295         socket\_manager.close\_channel.assert\_called\_once\_with(agent.get\_connection\_id())
1296         test\_ack\_function.assert\_called()
1297 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_abe4ad6d598ea29fcecf8b75d0c5213e9}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_abe4ad6d598ea29fcecf8b75d0c5213e9}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!test\+\_\+free\+\_\+workers@{test\+\_\+free\+\_\+workers}}
\index{test\+\_\+free\+\_\+workers@{test\+\_\+free\+\_\+workers}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{test\+\_\+free\+\_\+workers()}{test\_free\_workers()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+test\+\_\+free\+\_\+workers (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1231 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1231     \textcolor{keyword}{def }test\_free\_workers(self):
1232         manager = self.mturk\_manager
1233         manager.socket\_manager.close\_channel = mock.MagicMock()
1234         manager.free\_workers([self.agent\_1])
1235         manager.socket\_manager.close\_channel.assert\_called\_once\_with(
1236             self.agent\_1.get\_connection\_id()
1237         )
1238 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_afe09472ef978a90bd79e8cd36f96c713}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_afe09472ef978a90bd79e8cd36f96c713}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!test\+\_\+get\+\_\+qualifications@{test\+\_\+get\+\_\+qualifications}}
\index{test\+\_\+get\+\_\+qualifications@{test\+\_\+get\+\_\+qualifications}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{test\+\_\+get\+\_\+qualifications()}{test\_get\_qualifications()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+test\+\_\+get\+\_\+qualifications (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1298 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1298     \textcolor{keyword}{def }test\_get\_qualifications(self):
1299         manager = self.mturk\_manager
1300         mturk\_utils = MTurkManagerFile.mturk\_utils
1301         mturk\_utils.find\_or\_create\_qualification = mock.MagicMock()
1302 
1303         \textcolor{comment}{# create a qualification list with nothing but a provided junk qual}
1304         fake\_qual = \{
1305             \textcolor{stringliteral}{'QualificationTypeId'}: \textcolor{stringliteral}{'fake\_qual\_id'},
1306             \textcolor{stringliteral}{'Comparator'}: \textcolor{stringliteral}{'DoesNotExist'},
1307             \textcolor{stringliteral}{'ActionsGuarded'}: \textcolor{stringliteral}{'DiscoverPreviewAndAccept'},
1308         \}
1309         qualifications = manager.get\_qualification\_list([fake\_qual])
1310         self.assertListEqual(qualifications, [fake\_qual])
1311         self.assertListEqual(manager.qualifications, [fake\_qual])
1312         mturk\_utils.find\_or\_create\_qualification.assert\_not\_called()
1313 
1314         \textcolor{comment}{# Create a qualificaiton list using all the default types}
1315         disconnect\_qual\_name = \textcolor{stringliteral}{'disconnect\_qual\_name'}
1316         disconnect\_qual\_id = \textcolor{stringliteral}{'disconnect\_qual\_id'}
1317         block\_qual\_name = \textcolor{stringliteral}{'block\_qual\_name'}
1318         block\_qual\_id = \textcolor{stringliteral}{'block\_qual\_id'}
1319         max\_time\_qual\_name = \textcolor{stringliteral}{'max\_time\_qual\_name'}
1320         max\_time\_qual\_id = \textcolor{stringliteral}{'max\_time\_qual\_id'}
1321         unique\_qual\_name = \textcolor{stringliteral}{'unique\_qual\_name'}
1322         unique\_qual\_id = \textcolor{stringliteral}{'unique\_qual\_id'}
1323 
1324         \textcolor{keyword}{def }return\_qualifications(qual\_name, \_text, \_sb):
1325             \textcolor{keywordflow}{if} qual\_name == disconnect\_qual\_name:
1326                 \textcolor{keywordflow}{return} disconnect\_qual\_id
1327             \textcolor{keywordflow}{if} qual\_name == block\_qual\_name:
1328                 \textcolor{keywordflow}{return} block\_qual\_id
1329             \textcolor{keywordflow}{if} qual\_name == max\_time\_qual\_name:
1330                 \textcolor{keywordflow}{return} max\_time\_qual\_id
1331             \textcolor{keywordflow}{if} qual\_name == unique\_qual\_name:
1332                 \textcolor{keywordflow}{return} unique\_qual\_id
1333 
1334         mturk\_utils.find\_or\_create\_qualification = return\_qualifications
1335         manager.opt[\textcolor{stringliteral}{'disconnect\_qualification'}] = disconnect\_qual\_name
1336         manager.opt[\textcolor{stringliteral}{'block\_qualification'}] = block\_qual\_name
1337         manager.opt[\textcolor{stringliteral}{'max\_time\_qual'}] = max\_time\_qual\_name
1338         manager.opt[\textcolor{stringliteral}{'unique\_qual\_name'}] = unique\_qual\_name
1339         manager.is\_unique = \textcolor{keyword}{True}
1340         manager.has\_time\_limit = \textcolor{keyword}{True}
1341         manager.qualifications = \textcolor{keywordtype}{None}
1342         qualifications = manager.get\_qualification\_list()
1343 
1344         \textcolor{keywordflow}{for} qual \textcolor{keywordflow}{in} qualifications:
1345             self.assertEqual(qual[\textcolor{stringliteral}{'ActionsGuarded'}], \textcolor{stringliteral}{'DiscoverPreviewAndAccept'})
1346             self.assertEqual(qual[\textcolor{stringliteral}{'Comparator'}], \textcolor{stringliteral}{'DoesNotExist'})
1347 
1348         \textcolor{keywordflow}{for} qual\_id \textcolor{keywordflow}{in} [
1349             disconnect\_qual\_id,
1350             block\_qual\_id,
1351             max\_time\_qual\_id,
1352             unique\_qual\_id,
1353         ]:
1354             has\_qual = \textcolor{keyword}{False}
1355             \textcolor{keywordflow}{for} qual \textcolor{keywordflow}{in} qualifications:
1356                 \textcolor{keywordflow}{if} qual[\textcolor{stringliteral}{'QualificationTypeId'}] == qual\_id:
1357                     has\_qual = \textcolor{keyword}{True}
1358                     \textcolor{keywordflow}{break}
1359             self.assertTrue(has\_qual)
1360 
1361         self.assertListEqual(qualifications, manager.qualifications)
1362 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a780c4799ea08d54aa3505d2a6ca391a4}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a780c4799ea08d54aa3505d2a6ca391a4}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!test\+\_\+partner\+\_\+disconnect@{test\+\_\+partner\+\_\+disconnect}}
\index{test\+\_\+partner\+\_\+disconnect@{test\+\_\+partner\+\_\+disconnect}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{test\+\_\+partner\+\_\+disconnect()}{test\_partner\_disconnect()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+test\+\_\+partner\+\_\+disconnect (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1461 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1461     \textcolor{keyword}{def }test\_partner\_disconnect(self):
1462         manager = self.mturk\_manager
1463         manager.send\_state\_change = mock.MagicMock()
1464         self.agent\_1.set\_status(AssignState.STATUS\_IN\_TASK)
1465         manager.\_handle\_partner\_disconnect(self.agent\_1)
1466         self.assertEqual(
1467             self.agent\_1.get\_status(), AssignState.STATUS\_PARTNER\_DISCONNECT
1468         )
1469         args = manager.send\_state\_change.call\_args[0]
1470         worker\_id, assignment\_id = args[0], args[1]
1471         self.assertEqual(worker\_id, self.agent\_1.worker\_id)
1472         self.assertEqual(assignment\_id, self.agent\_1.assignment\_id)
1473 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ad71616be59c93693599aa84f3f2d9393}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ad71616be59c93693599aa84f3f2d9393}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!test\+\_\+qualification\+\_\+management@{test\+\_\+qualification\+\_\+management}}
\index{test\+\_\+qualification\+\_\+management@{test\+\_\+qualification\+\_\+management}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{test\+\_\+qualification\+\_\+management()}{test\_qualification\_management()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+test\+\_\+qualification\+\_\+management (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1416 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1416     \textcolor{keyword}{def }test\_qualification\_management(self):
1417         manager = self.mturk\_manager
1418         test\_qual\_name = \textcolor{stringliteral}{'test\_qual'}
1419         other\_qual\_name = \textcolor{stringliteral}{'other\_qual'}
1420         test\_qual\_id = \textcolor{stringliteral}{'test\_qual\_id'}
1421         worker\_id = self.agent\_1.worker\_id
1422         mturk\_utils = MTurkManagerFile.mturk\_utils
1423         success\_id = \textcolor{stringliteral}{'Success'}
1424 
1425         \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_acd636315cbbf11cc5d9d641173e51586}{find\_qualification}(qual\_name, \_sandbox):
1426             \textcolor{keywordflow}{if} qual\_name == test\_qual\_name:
1427                 \textcolor{keywordflow}{return} test\_qual\_id
1428             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
1429 
1430         mturk\_utils.find\_qualification = find\_qualification
1431         mturk\_utils.give\_worker\_qualification = mock.MagicMock()
1432         mturk\_utils.remove\_worker\_qualification = mock.MagicMock()
1433         mturk\_utils.find\_or\_create\_qualification = mock.MagicMock(
1434             return\_value=success\_id
1435         )
1436 
1437         \textcolor{comment}{# Test give qualification}
1438         manager.give\_worker\_qualification(worker\_id, test\_qual\_name)
1439         mturk\_utils.give\_worker\_qualification.assert\_called\_once\_with(
1440             worker\_id, test\_qual\_id, \textcolor{keywordtype}{None}, manager.is\_sandbox
1441         )
1442 
1443         \textcolor{comment}{# Test revoke qualification}
1444         manager.remove\_worker\_qualification(worker\_id, test\_qual\_name)
1445         mturk\_utils.remove\_worker\_qualification.assert\_called\_once\_with(
1446             worker\_id, test\_qual\_id, manager.is\_sandbox, \textcolor{stringliteral}{''}
1447         )
1448 
1449         \textcolor{comment}{# Test create qualification can exist}
1450         result = manager.create\_qualification(test\_qual\_name, \textcolor{stringliteral}{''})
1451         self.assertEqual(result, success\_id)
1452 
1453         \textcolor{comment}{# Test create qualification can't exist failure}
1454         result = manager.create\_qualification(test\_qual\_name, \textcolor{stringliteral}{''}, \textcolor{keyword}{False})
1455         self.assertIsNone(result)
1456 
1457         \textcolor{comment}{# Test create qualification can't exist success}
1458         result = manager.create\_qualification(other\_qual\_name, \textcolor{stringliteral}{''})
1459         self.assertEqual(result, success\_id)
1460 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_af52a75550f8ece0ef60c6efefef85846}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_af52a75550f8ece0ef60c6efefef85846}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!test\+\_\+send\+\_\+message\+\_\+command@{test\+\_\+send\+\_\+message\+\_\+command}}
\index{test\+\_\+send\+\_\+message\+\_\+command@{test\+\_\+send\+\_\+message\+\_\+command}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{test\+\_\+send\+\_\+message\+\_\+command()}{test\_send\_message\_command()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+test\+\_\+send\+\_\+message\+\_\+command (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1197 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1197     \textcolor{keyword}{def }test\_send\_message\_command(self):
1198         manager = self.mturk\_manager
1199         worker\_id = self.agent\_1.worker\_id
1200         assignment\_id = self.agent\_1.assignment\_id
1201         manager.socket\_manager.queue\_packet = mock.MagicMock()
1202 
1203         \textcolor{comment}{# Send a command}
1204         data = \{\textcolor{stringliteral}{'text'}: data\_model.COMMAND\_SEND\_MESSAGE\}
1205         manager.send\_command(worker\_id, assignment\_id, data)
1206 
1207         manager.socket\_manager.queue\_packet.assert\_called\_once()
1208         packet = manager.socket\_manager.queue\_packet.call\_args[0][0]
1209         self.assertIsNotNone(packet.id)
1210         self.assertEqual(packet.type, data\_model.WORLD\_MESSAGE)
1211         self.assertEqual(packet.receiver\_id, worker\_id)
1212         self.assertEqual(packet.assignment\_id, assignment\_id)
1213         self.assertEqual(packet.data, data)
1214         self.assertEqual(packet.data[\textcolor{stringliteral}{'type'}], data\_model.MESSAGE\_TYPE\_COMMAND)
1215 
1216         \textcolor{comment}{# Send a message}
1217         data = \{\textcolor{stringliteral}{'text'}: \textcolor{stringliteral}{'This is a test message'}\}
1218         manager.socket\_manager.queue\_packet.reset\_mock()
1219         message\_id = manager.send\_message(worker\_id, assignment\_id, data)
1220         manager.socket\_manager.queue\_packet.assert\_called\_once()
1221         packet = manager.socket\_manager.queue\_packet.call\_args[0][0]
1222         self.assertIsNotNone(packet.id)
1223         self.assertEqual(packet.type, data\_model.WORLD\_MESSAGE)
1224         self.assertEqual(packet.receiver\_id, worker\_id)
1225         self.assertEqual(packet.assignment\_id, assignment\_id)
1226         self.assertNotEqual(packet.data, data)
1227         self.assertEqual(data[\textcolor{stringliteral}{'text'}], packet.data[\textcolor{stringliteral}{'text'}])
1228         self.assertEqual(packet.data[\textcolor{stringliteral}{'message\_id'}], message\_id)
1229         self.assertEqual(packet.data[\textcolor{stringliteral}{'type'}], data\_model.MESSAGE\_TYPE\_ACT)
1230 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ad5d172db7820f6b3b976a292df305a20}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ad5d172db7820f6b3b976a292df305a20}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!test\+\_\+socket\+\_\+dead@{test\+\_\+socket\+\_\+dead}}
\index{test\+\_\+socket\+\_\+dead@{test\+\_\+socket\+\_\+dead}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{test\+\_\+socket\+\_\+dead()}{test\_socket\_dead()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+test\+\_\+socket\+\_\+dead (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Test all states of socket dead calls.
\end{DoxyVerb}
 

Definition at line 1104 of file test\+\_\+mturk\+\_\+manager.\+py.


\begin{DoxyCode}
1104     \textcolor{keyword}{def }test\_socket\_dead(self):
1105         \textcolor{stringliteral}{"""}
1106 \textcolor{stringliteral}{        Test all states of socket dead calls.}
1107 \textcolor{stringliteral}{        """}
1108         manager = self.mturk\_manager
1109         agent = self.agent\_1
1110         worker\_id = agent.worker\_id
1111         assignment\_id = agent.assignment\_id
1112         manager.socket\_manager.close\_channel = mock.MagicMock()
1113         agent.reduce\_state = mock.MagicMock()
1114         agent.set\_status = mock.MagicMock(wraps=agent.set\_status)
1115         manager.\_handle\_agent\_disconnect = mock.MagicMock(
1116             wraps=manager.\_handle\_agent\_disconnect
1117         )
1118 
1119         \textcolor{comment}{# Test status none}
1120         agent.set\_status(AssignState.STATUS\_NONE)
1121         agent.set\_status.reset\_mock()
1122         manager.\_on\_socket\_dead(worker\_id, assignment\_id)
1123         self.assertEqual(agent.get\_status(), AssignState.STATUS\_DISCONNECT)
1124         agent.reduce\_state.assert\_called\_once()
1125         manager.socket\_manager.close\_channel.assert\_called\_once\_with(
1126             agent.get\_connection\_id()
1127         )
1128         manager.\_handle\_agent\_disconnect.assert\_not\_called()
1129 
1130         \textcolor{comment}{# Test status onboarding}
1131         agent.set\_status(AssignState.STATUS\_ONBOARDING)
1132         agent.set\_status.reset\_mock()
1133         agent.reduce\_state.reset\_mock()
1134         manager.socket\_manager.close\_channel.reset\_mock()
1135         self.assertFalse(agent.disconnected)
1136         manager.\_on\_socket\_dead(worker\_id, assignment\_id)
1137         self.assertEqual(agent.get\_status(), AssignState.STATUS\_DISCONNECT)
1138         agent.reduce\_state.assert\_called\_once()
1139         manager.socket\_manager.close\_channel.assert\_called\_once\_with(
1140             agent.get\_connection\_id()
1141         )
1142         self.assertTrue(agent.disconnected)
1143         manager.\_handle\_agent\_disconnect.assert\_not\_called()
1144 
1145         \textcolor{comment}{# test status waiting}
1146         agent.disconnected = \textcolor{keyword}{False}
1147         agent.set\_status(AssignState.STATUS\_WAITING)
1148         agent.set\_status.reset\_mock()
1149         agent.reduce\_state.reset\_mock()
1150         manager.socket\_manager.close\_channel.reset\_mock()
1151         manager.\_add\_agent\_to\_pool(agent)
1152         manager.\_remove\_from\_agent\_pool = mock.MagicMock()
1153         manager.\_on\_socket\_dead(worker\_id, assignment\_id)
1154         self.assertEqual(agent.get\_status(), AssignState.STATUS\_DISCONNECT)
1155         agent.reduce\_state.assert\_called\_once()
1156         manager.socket\_manager.close\_channel.assert\_called\_once\_with(
1157             agent.get\_connection\_id()
1158         )
1159         self.assertTrue(agent.disconnected)
1160         manager.\_handle\_agent\_disconnect.assert\_not\_called()
1161         manager.\_remove\_from\_agent\_pool.assert\_called\_once\_with(agent)
1162 
1163         \textcolor{comment}{# test status in task}
1164         agent.disconnected = \textcolor{keyword}{False}
1165         agent.set\_status(AssignState.STATUS\_IN\_TASK)
1166         agent.set\_status.reset\_mock()
1167         agent.reduce\_state.reset\_mock()
1168         manager.socket\_manager.close\_channel.reset\_mock()
1169         manager.\_add\_agent\_to\_pool(agent)
1170         manager.\_remove\_from\_agent\_pool = mock.MagicMock()
1171         manager.\_on\_socket\_dead(worker\_id, assignment\_id)
1172         self.assertEqual(agent.get\_status(), AssignState.STATUS\_DISCONNECT)
1173         manager.socket\_manager.close\_channel.assert\_called\_once\_with(
1174             agent.get\_connection\_id()
1175         )
1176         self.assertTrue(agent.disconnected)
1177         manager.\_handle\_agent\_disconnect.assert\_called\_once\_with(
1178             worker\_id, assignment\_id
1179         )
1180 
1181         \textcolor{comment}{# test status done}
1182         agent.disconnected = \textcolor{keyword}{False}
1183         agent.set\_status(AssignState.STATUS\_DONE)
1184         agent.set\_status.reset\_mock()
1185         agent.reduce\_state.reset\_mock()
1186         manager.\_handle\_agent\_disconnect.reset\_mock()
1187         manager.socket\_manager.close\_channel.reset\_mock()
1188         manager.\_add\_agent\_to\_pool(agent)
1189         manager.\_remove\_from\_agent\_pool = mock.MagicMock()
1190         manager.\_on\_socket\_dead(worker\_id, assignment\_id)
1191         self.assertNotEqual(agent.get\_status(), AssignState.STATUS\_DISCONNECT)
1192         agent.reduce\_state.assert\_not\_called()
1193         manager.socket\_manager.close\_channel.assert\_not\_called()
1194         self.assertFalse(agent.disconnected)
1195         manager.\_handle\_agent\_disconnect.assert\_not\_called()
1196 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a82517cee6c47de3f79d4dfdddbae1a5b}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a82517cee6c47de3f79d4dfdddbae1a5b}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!agent\+\_\+1@{agent\+\_\+1}}
\index{agent\+\_\+1@{agent\+\_\+1}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{agent\+\_\+1}{agent\_1}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+agent\+\_\+1}



Definition at line 1093 of file test\+\_\+mturk\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_afcd9b1d86894071982c38aeddc2b69c2}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_afcd9b1d86894071982c38aeddc2b69c2}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!agent\+\_\+2@{agent\+\_\+2}}
\index{agent\+\_\+2@{agent\+\_\+2}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{agent\+\_\+2}{agent\_2}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+agent\+\_\+2}



Definition at line 1096 of file test\+\_\+mturk\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_aa488a2c74a44efa954d7f00d7d6f7364}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_aa488a2c74a44efa954d7f00d7d6f7364}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!fake\+\_\+socket@{fake\+\_\+socket}}
\index{fake\+\_\+socket@{fake\+\_\+socket}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{fake\+\_\+socket}{fake\_socket}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+fake\+\_\+socket}



Definition at line 1043 of file test\+\_\+mturk\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a9a1019796c71636d8fb2260ed140e53d}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_a9a1019796c71636d8fb2260ed140e53d}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!mturk\+\_\+agent\+\_\+ids@{mturk\+\_\+agent\+\_\+ids}}
\index{mturk\+\_\+agent\+\_\+ids@{mturk\+\_\+agent\+\_\+ids}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{mturk\+\_\+agent\+\_\+ids}{mturk\_agent\_ids}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+mturk\+\_\+agent\+\_\+ids}



Definition at line 1051 of file test\+\_\+mturk\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_aebae0d07a4711e62c3d8453b36f04a93}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_aebae0d07a4711e62c3d8453b36f04a93}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!mturk\+\_\+manager@{mturk\+\_\+manager}}
\index{mturk\+\_\+manager@{mturk\+\_\+manager}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{mturk\+\_\+manager}{mturk\_manager}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+mturk\+\_\+manager}



Definition at line 1052 of file test\+\_\+mturk\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ae031b00d0578e66e16776d21f3b17cbb}\label{classparlai_1_1mturk_1_1core_1_1dev_1_1test_1_1test__mturk__manager_1_1TestMTurkManagerConnectedFunctions_ae031b00d0578e66e16776d21f3b17cbb}} 
\index{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}!opt@{opt}}
\index{opt@{opt}!parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions@{parlai\+::mturk\+::core\+::dev\+::test\+::test\+\_\+mturk\+\_\+manager\+::\+Test\+M\+Turk\+Manager\+Connected\+Functions}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+dev.\+test.\+test\+\_\+mturk\+\_\+manager.\+Test\+M\+Turk\+Manager\+Connected\+Functions.\+opt}



Definition at line 1048 of file test\+\_\+mturk\+\_\+manager.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/mturk/core/dev/test/\hyperlink{dev_2test_2test__mturk__manager_8py}{test\+\_\+mturk\+\_\+manager.\+py}\end{DoxyCompactItemize}
