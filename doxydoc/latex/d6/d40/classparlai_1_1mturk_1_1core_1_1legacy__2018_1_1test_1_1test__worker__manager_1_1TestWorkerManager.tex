\hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager}{}\section{parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager Class Reference}
\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager}\index{parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager@{parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager}}


Inheritance diagram for parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=231pt]{d6/d91/classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=231pt]{d4/da4/classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_adc02b37bdfeeb628452ff51330eaaafe}{set\+Up} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_ab336c773a303cf0b208ad6df95f8a061}{tear\+Down} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_aa19b4459deb2011957558f125460c307}{test\+\_\+private\+\_\+create\+\_\+agent} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a678dccd5eac5bd04901b5dfe6edf4b1f}{test\+\_\+agent\+\_\+task\+\_\+management} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a71aaa44341e8b99f4593484de1bd2459}{test\+\_\+shutdown} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a815c23442cf90f83d18391139a774e10}{test\+\_\+time\+\_\+blocks} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a64ed45c4f124cf9a6dba3716b65e858f}{test\+\_\+disconnect\+\_\+management} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a9182a7034c635a303990a6c90635ef26}{test\+\_\+conversation\+\_\+management} (self)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a8345c8a144607e001d530dd0c3082334}{opt}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a053eca3bf966f63d8740b0049102cd2d}{mturk\+\_\+manager}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_ae9e288c3b82a1451cb88a800c6d6c7bb}{worker\+\_\+manager}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a3cd35f72a2eafb6bf46de95ab9c2a74c}{worker\+\_\+state\+\_\+1}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a3aa5f117a73e8a4a0947aa675f1fb0e8}{worker\+\_\+state\+\_\+2}
\item 
\hyperlink{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a4b78cfccbd467410a7b86bf3387c92b9}{worker\+\_\+state\+\_\+3}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Various unit tests for the WorkerManager class.
\end{DoxyVerb}
 

Definition at line 130 of file test\+\_\+worker\+\_\+manager.\+py.



\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_adc02b37bdfeeb628452ff51330eaaafe}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_adc02b37bdfeeb628452ff51330eaaafe}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!set\+Up@{set\+Up}}
\index{set\+Up@{set\+Up}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{set\+Up()}{setUp()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+set\+Up (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 135 of file test\+\_\+worker\+\_\+manager.\+py.


\begin{DoxyCode}
135     \textcolor{keyword}{def }setUp(self):
136         disconnect\_path = os.path.join(parent\_dir, \textcolor{stringliteral}{'disconnect-test.pickle'})
137         \textcolor{keywordflow}{if} os.path.exists(disconnect\_path):
138             os.remove(disconnect\_path)
139 
140         argparser = ParlaiParser(\textcolor{keyword}{False}, \textcolor{keyword}{False})
141         argparser.add\_parlai\_data\_path()
142         argparser.add\_mturk\_args()
143         self.opt = argparser.parse\_args(print\_args=\textcolor{keyword}{False})
144         self.opt[\textcolor{stringliteral}{'task'}] = \textcolor{stringliteral}{'unittest'}
145         self.opt[\textcolor{stringliteral}{'assignment\_duration\_in\_seconds'}] = 6
146         mturk\_agent\_ids = [\textcolor{stringliteral}{'mturk\_agent\_1'}]
147         self.mturk\_manager = MTurkManager(
148             opt=self.opt.copy(), mturk\_agent\_ids=mturk\_agent\_ids
149         )
150         self.worker\_manager = self.mturk\_manager.worker\_manager
151 
152         self.worker\_state\_1 = self.worker\_manager.worker\_alive(TEST\_WORKER\_ID\_1)
153         self.worker\_state\_2 = self.worker\_manager.worker\_alive(TEST\_WORKER\_ID\_2)
154         self.worker\_state\_3 = self.worker\_manager.worker\_alive(TEST\_WORKER\_ID\_3)
155 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_ab336c773a303cf0b208ad6df95f8a061}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_ab336c773a303cf0b208ad6df95f8a061}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!tear\+Down@{tear\+Down}}
\index{tear\+Down@{tear\+Down}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{tear\+Down()}{tearDown()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+tear\+Down (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 156 of file test\+\_\+worker\+\_\+manager.\+py.


\begin{DoxyCode}
156     \textcolor{keyword}{def }tearDown(self):
157         self.mturk\_manager.shutdown()
158 
159         disconnect\_path = os.path.join(parent\_dir, \textcolor{stringliteral}{'disconnect-test.pickle'})
160         \textcolor{keywordflow}{if} os.path.exists(disconnect\_path):
161             os.remove(disconnect\_path)
162 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a678dccd5eac5bd04901b5dfe6edf4b1f}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a678dccd5eac5bd04901b5dfe6edf4b1f}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!test\+\_\+agent\+\_\+task\+\_\+management@{test\+\_\+agent\+\_\+task\+\_\+management}}
\index{test\+\_\+agent\+\_\+task\+\_\+management@{test\+\_\+agent\+\_\+task\+\_\+management}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{test\+\_\+agent\+\_\+task\+\_\+management()}{test\_agent\_task\_management()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+test\+\_\+agent\+\_\+task\+\_\+management (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Ensure agents and tasks have proper bookkeeping.
\end{DoxyVerb}
 

Definition at line 175 of file test\+\_\+worker\+\_\+manager.\+py.


\begin{DoxyCode}
175     \textcolor{keyword}{def }test\_agent\_task\_management(self):
176         \textcolor{stringliteral}{"""}
177 \textcolor{stringliteral}{        Ensure agents and tasks have proper bookkeeping.}
178 \textcolor{stringliteral}{        """}
179         self.worker\_manager.assign\_task\_to\_worker(
180             TEST\_HIT\_ID\_1, TEST\_ASSIGNMENT\_ID\_1, TEST\_WORKER\_ID\_1
181         )
182         self.worker\_manager.assign\_task\_to\_worker(
183             TEST\_HIT\_ID\_2, TEST\_ASSIGNMENT\_ID\_2, TEST\_WORKER\_ID\_2
184         )
185         self.worker\_manager.assign\_task\_to\_worker(
186             TEST\_HIT\_ID\_3, TEST\_ASSIGNMENT\_ID\_3, TEST\_WORKER\_ID\_1
187         )
188         self.assertTrue(self.worker\_state\_1.has\_assignment(TEST\_ASSIGNMENT\_ID\_1))
189         self.assertTrue(self.worker\_state\_1.has\_assignment(TEST\_ASSIGNMENT\_ID\_3))
190         self.assertTrue(self.worker\_state\_2.has\_assignment(TEST\_ASSIGNMENT\_ID\_2))
191 
192         assign\_agent = self.worker\_manager.get\_agent\_for\_assignment(
193             TEST\_ASSIGNMENT\_ID\_1
194         )
195         self.assertEqual(assign\_agent.worker\_id, TEST\_WORKER\_ID\_1)
196         self.assertEqual(assign\_agent.hit\_id, TEST\_HIT\_ID\_1)
197         self.assertEqual(assign\_agent.assignment\_id, TEST\_ASSIGNMENT\_ID\_1)
198 
199         no\_such\_agent = self.worker\_manager.get\_agent\_for\_assignment(FAKE\_ID)
200         self.assertIsNone(no\_such\_agent)
201 
202         \textcolor{comment}{# Ensure all agents are being maintained}
203         checked\_count = 0
204         filtered\_count = 0
205 
206         \textcolor{keyword}{def }check\_is\_worker\_1(agent):
207             nonlocal checked\_count  \textcolor{comment}{# noqa E999 python 3 only}
208             checked\_count += 1
209             self.assertEqual(agent.worker\_id, TEST\_WORKER\_ID\_1)
210 
211         \textcolor{keyword}{def }is\_worker\_1(agent):
212             nonlocal filtered\_count
213             filtered\_count += 1
214             \textcolor{keywordflow}{return} agent.worker\_id == TEST\_WORKER\_ID\_1
215 
216         self.worker\_manager.map\_over\_agents(check\_is\_worker\_1, is\_worker\_1)
217         self.assertEqual(checked\_count, 2)
218         self.assertEqual(filtered\_count, 3)
219 
220         \textcolor{comment}{# Ensuring \_get\_worker is accurate}
221         self.assertEqual(
222             self.worker\_manager.\_get\_worker(TEST\_WORKER\_ID\_1), self.worker\_state\_1
223         )
224         self.assertEqual(
225             self.worker\_manager.\_get\_worker(TEST\_WORKER\_ID\_2), self.worker\_state\_2
226         )
227         self.assertEqual(
228             self.worker\_manager.\_get\_worker(TEST\_WORKER\_ID\_3), self.worker\_state\_3
229         )
230         self.assertIsNone(self.worker\_manager.\_get\_worker(FAKE\_ID))
231 
232         \textcolor{comment}{# Ensuring \_get\_agent is accurate}
233         self.assertEqual(
234             self.worker\_manager.\_get\_agent(TEST\_WORKER\_ID\_1, TEST\_ASSIGNMENT\_ID\_1),
235             self.worker\_manager.get\_agent\_for\_assignment(TEST\_ASSIGNMENT\_ID\_1),
236         )
237         self.assertNotEqual(
238             self.worker\_manager.\_get\_agent(TEST\_WORKER\_ID\_1, TEST\_ASSIGNMENT\_ID\_2),
239             self.worker\_manager.get\_agent\_for\_assignment(TEST\_ASSIGNMENT\_ID\_2),
240         )
241 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a9182a7034c635a303990a6c90635ef26}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a9182a7034c635a303990a6c90635ef26}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!test\+\_\+conversation\+\_\+management@{test\+\_\+conversation\+\_\+management}}
\index{test\+\_\+conversation\+\_\+management@{test\+\_\+conversation\+\_\+management}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{test\+\_\+conversation\+\_\+management()}{test\_conversation\_management()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+test\+\_\+conversation\+\_\+management (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Tests handling conversation state, moving agents to the correct conversations,
and disconnecting one worker in an active convo.
\end{DoxyVerb}
 

Definition at line 355 of file test\+\_\+worker\+\_\+manager.\+py.


\begin{DoxyCode}
355     \textcolor{keyword}{def }test\_conversation\_management(self):
356         \textcolor{stringliteral}{"""}
357 \textcolor{stringliteral}{        Tests handling conversation state, moving agents to the correct conversations,}
358 \textcolor{stringliteral}{        and disconnecting one worker in an active convo.}
359 \textcolor{stringliteral}{        """}
360         self.worker\_manager.assign\_task\_to\_worker(
361             TEST\_HIT\_ID\_1, TEST\_ASSIGNMENT\_ID\_1, TEST\_WORKER\_ID\_1
362         )
363         self.worker\_manager.assign\_task\_to\_worker(
364             TEST\_HIT\_ID\_2, TEST\_ASSIGNMENT\_ID\_2, TEST\_WORKER\_ID\_2
365         )
366 
367         good\_agent = self.worker\_manager.get\_agent\_for\_assignment(TEST\_ASSIGNMENT\_ID\_1)
368         bad\_agent = self.worker\_manager.get\_agent\_for\_assignment(TEST\_ASSIGNMENT\_ID\_2)
369 
370         \textcolor{keyword}{def }fake\_command\_send(worker\_id, assignment\_id, data, ack\_func):
371             pkt = mock.MagicMock()
372             pkt.sender\_id = worker\_id
373             pkt.assignment\_id = assignment\_id
374             self.assertEqual(data[\textcolor{stringliteral}{'text'}], data\_model.COMMAND\_CHANGE\_CONVERSATION)
375             ack\_func(pkt)
376 
377         self.mturk\_manager.send\_command = fake\_command\_send
378         self.worker\_manager.change\_agent\_conversation(good\_agent, \textcolor{stringliteral}{'t1'}, \textcolor{stringliteral}{'good'})
379         self.worker\_manager.change\_agent\_conversation(bad\_agent, \textcolor{stringliteral}{'t1'}, \textcolor{stringliteral}{'bad'})
380         self.assertEqual(good\_agent.id, \textcolor{stringliteral}{'good'})
381         self.assertEqual(bad\_agent.id, \textcolor{stringliteral}{'bad'})
382         self.assertEqual(good\_agent.conversation\_id, \textcolor{stringliteral}{'t1'})
383         self.assertEqual(bad\_agent.conversation\_id, \textcolor{stringliteral}{'t1'})
384         self.assertIn(\textcolor{stringliteral}{'t1'}, self.worker\_manager.conv\_to\_agent)
385         self.assertEqual(len(self.worker\_manager.conv\_to\_agent[\textcolor{stringliteral}{'t1'}]), 2)
386         self.worker\_manager.handle\_bad\_disconnect = mock.MagicMock()
387 
388         checked\_worker = \textcolor{keyword}{False}
389 
390         \textcolor{keyword}{def }partner\_callback(agent):
391             nonlocal checked\_worker
392             checked\_worker = \textcolor{keyword}{True}
393             self.assertEqual(agent.worker\_id, good\_agent.worker\_id)
394 
395         self.worker\_manager.handle\_agent\_disconnect(
396             bad\_agent.worker\_id, bad\_agent.assignment\_id, partner\_callback
397         )
398         self.assertTrue(checked\_worker)
399         self.worker\_manager.handle\_bad\_disconnect.assert\_called\_once\_with(
400             bad\_agent.worker\_id
401         )
402         self.assertEqual(bad\_agent.get\_status(), AssignState.STATUS\_DISCONNECT)
403 
404 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a64ed45c4f124cf9a6dba3716b65e858f}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a64ed45c4f124cf9a6dba3716b65e858f}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!test\+\_\+disconnect\+\_\+management@{test\+\_\+disconnect\+\_\+management}}
\index{test\+\_\+disconnect\+\_\+management@{test\+\_\+disconnect\+\_\+management}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{test\+\_\+disconnect\+\_\+management()}{test\_disconnect\_management()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+test\+\_\+disconnect\+\_\+management (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 302 of file test\+\_\+worker\+\_\+manager.\+py.


\begin{DoxyCode}
302     \textcolor{keyword}{def }test\_disconnect\_management(self):
303         self.worker\_manager.load\_disconnects()
304         self.worker\_manager.is\_sandbox = \textcolor{keyword}{False}
305         self.mturk\_manager.block\_worker = mock.MagicMock()
306         self.mturk\_manager.soft\_block\_worker = mock.MagicMock()
307 
308         self.assertEqual(len(self.worker\_manager.disconnects), 0)
309         \textcolor{comment}{# Make one worker disconnect twice}
310         self.worker\_manager.handle\_bad\_disconnect(TEST\_WORKER\_ID\_1)
311         self.assertEqual(len(self.worker\_manager.disconnects), 1)
312         self.mturk\_manager.block\_worker.assert\_not\_called()
313         self.mturk\_manager.soft\_block\_worker.assert\_not\_called()
314         self.worker\_manager.handle\_bad\_disconnect(TEST\_WORKER\_ID\_1)
315         self.assertEqual(len(self.worker\_manager.disconnects), 2)
316         self.mturk\_manager.block\_worker.assert\_not\_called()
317         self.mturk\_manager.soft\_block\_worker.assert\_not\_called()
318 
319         \textcolor{comment}{# Ensure both disconnects recorded}
320         self.assertEqual(
321             self.worker\_manager.mturk\_workers[TEST\_WORKER\_ID\_1].disconnects, 2
322         )
323 
324         \textcolor{comment}{# Make second worker disconnect}
325         self.worker\_manager.handle\_bad\_disconnect(TEST\_WORKER\_ID\_2)
326         self.assertEqual(len(self.worker\_manager.disconnects), 3)
327         self.mturk\_manager.block\_worker.assert\_not\_called()
328         self.mturk\_manager.soft\_block\_worker.assert\_not\_called()
329 
330         \textcolor{comment}{# Make us soft block workers on disconnect}
331         self.worker\_manager.opt[\textcolor{stringliteral}{'disconnect\_qualification'}] = \textcolor{stringliteral}{'test'}
332         self.worker\_manager.handle\_bad\_disconnect(TEST\_WORKER\_ID\_1)
333         self.mturk\_manager.block\_worker.assert\_not\_called()
334         self.mturk\_manager.soft\_block\_worker.assert\_called\_with(
335             TEST\_WORKER\_ID\_1, \textcolor{stringliteral}{'disconnect\_qualification'}
336         )
337         self.mturk\_manager.soft\_block\_worker.reset\_mock()
338 
339         \textcolor{comment}{# Make us now block workers on disconnect}
340         self.worker\_manager.opt[\textcolor{stringliteral}{'hard\_block'}] = \textcolor{keyword}{True}
341         self.worker\_manager.handle\_bad\_disconnect(TEST\_WORKER\_ID\_2)
342         self.mturk\_manager.block\_worker.assert\_called\_once()
343         self.mturk\_manager.soft\_block\_worker.assert\_not\_called()
344 
345         \textcolor{comment}{# Ensure we can save and reload disconnects}
346         self.worker\_manager.save\_disconnects()
347 
348         \textcolor{comment}{# Make a new worker manager}
349         worker\_manager2 = WorkerManager(self.mturk\_manager, self.opt)
350         self.assertEqual(len(worker\_manager2.disconnects), 5)
351         self.assertEqual(worker\_manager2.mturk\_workers[TEST\_WORKER\_ID\_1].disconnects, 3)
352         self.assertEqual(worker\_manager2.mturk\_workers[TEST\_WORKER\_ID\_2].disconnects, 2)
353         worker\_manager2.shutdown()
354 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_aa19b4459deb2011957558f125460c307}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_aa19b4459deb2011957558f125460c307}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!test\+\_\+private\+\_\+create\+\_\+agent@{test\+\_\+private\+\_\+create\+\_\+agent}}
\index{test\+\_\+private\+\_\+create\+\_\+agent@{test\+\_\+private\+\_\+create\+\_\+agent}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{test\+\_\+private\+\_\+create\+\_\+agent()}{test\_private\_create\_agent()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+test\+\_\+private\+\_\+create\+\_\+agent (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Check create agent method used internally in worker_manager.
\end{DoxyVerb}
 

Definition at line 163 of file test\+\_\+worker\+\_\+manager.\+py.


\begin{DoxyCode}
163     \textcolor{keyword}{def }test\_private\_create\_agent(self):
164         \textcolor{stringliteral}{"""}
165 \textcolor{stringliteral}{        Check create agent method used internally in worker\_manager.}
166 \textcolor{stringliteral}{        """}
167         test\_agent = self.worker\_manager.\_create\_agent(
168             TEST\_HIT\_ID\_1, TEST\_ASSIGNMENT\_ID\_1, TEST\_WORKER\_ID\_1
169         )
170         self.assertIsInstance(test\_agent, MTurkAgent)
171         self.assertEqual(test\_agent.worker\_id, TEST\_WORKER\_ID\_1)
172         self.assertEqual(test\_agent.hit\_id, TEST\_HIT\_ID\_1)
173         self.assertEqual(test\_agent.assignment\_id, TEST\_ASSIGNMENT\_ID\_1)
174 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a71aaa44341e8b99f4593484de1bd2459}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a71aaa44341e8b99f4593484de1bd2459}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!test\+\_\+shutdown@{test\+\_\+shutdown}}
\index{test\+\_\+shutdown@{test\+\_\+shutdown}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{test\+\_\+shutdown()}{test\_shutdown()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+test\+\_\+shutdown (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Ensure shutdown clears required resources.
\end{DoxyVerb}
 

Definition at line 242 of file test\+\_\+worker\+\_\+manager.\+py.


\begin{DoxyCode}
242     \textcolor{keyword}{def }test\_shutdown(self):
243         \textcolor{stringliteral}{"""}
244 \textcolor{stringliteral}{        Ensure shutdown clears required resources.}
245 \textcolor{stringliteral}{        """}
246         self.worker\_manager.save\_disconnects = mock.MagicMock()
247         self.worker\_manager.un\_time\_block\_workers = mock.MagicMock()
248         self.worker\_manager.shutdown()
249         self.assertEqual(
250             len(self.worker\_manager.save\_disconnects.mock\_calls),
251             1,
252             \textcolor{stringliteral}{'save\_disconnects must be called in worker manager shutdown'},
253         )
254         self.assertEqual(
255             len(self.worker\_manager.un\_time\_block\_workers.mock\_calls),
256             1,
257             \textcolor{stringliteral}{'un\_time\_block\_workers must be called in worker manager shutdown'},
258         )
259 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a815c23442cf90f83d18391139a774e10}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a815c23442cf90f83d18391139a774e10}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!test\+\_\+time\+\_\+blocks@{test\+\_\+time\+\_\+blocks}}
\index{test\+\_\+time\+\_\+blocks@{test\+\_\+time\+\_\+blocks}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{test\+\_\+time\+\_\+blocks()}{test\_time\_blocks()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+test\+\_\+time\+\_\+blocks (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Check to see if time blocking and clearing works.
\end{DoxyVerb}
 

Definition at line 260 of file test\+\_\+worker\+\_\+manager.\+py.


\begin{DoxyCode}
260     \textcolor{keyword}{def }test\_time\_blocks(self):
261         \textcolor{stringliteral}{"""}
262 \textcolor{stringliteral}{        Check to see if time blocking and clearing works.}
263 \textcolor{stringliteral}{        """}
264         self.mturk\_manager.soft\_block\_worker = mock.MagicMock()
265         self.mturk\_manager.un\_soft\_block\_worker = mock.MagicMock()
266 
267         \textcolor{comment}{# No workers blocked, none should be unblocked}
268         self.worker\_manager.un\_time\_block\_workers()
269         self.assertEqual(len(self.mturk\_manager.un\_soft\_block\_worker.mock\_calls), 0)
270 
271         \textcolor{comment}{# Block some workers, ensure state change and correct calls}
272         self.assertEqual(len(self.worker\_manager.time\_blocked\_workers), 0)
273         self.worker\_manager.time\_block\_worker(TEST\_WORKER\_ID\_1)
274         self.mturk\_manager.soft\_block\_worker.assert\_called\_with(
275             TEST\_WORKER\_ID\_1, \textcolor{stringliteral}{'max\_time\_qual'}
276         )
277         self.assertEqual(len(self.worker\_manager.time\_blocked\_workers), 1)
278         self.worker\_manager.time\_block\_worker(TEST\_WORKER\_ID\_2)
279         self.mturk\_manager.soft\_block\_worker.assert\_called\_with(
280             TEST\_WORKER\_ID\_2, \textcolor{stringliteral}{'max\_time\_qual'}
281         )
282         self.assertEqual(len(self.worker\_manager.time\_blocked\_workers), 2)
283         self.assertEqual(len(self.mturk\_manager.soft\_block\_worker.mock\_calls), 2)
284 
285         \textcolor{comment}{# Unblock a worker passed in as a keyword arg, ensure state remains}
286         self.worker\_manager.un\_time\_block\_workers([TEST\_WORKER\_ID\_3])
287         self.mturk\_manager.un\_soft\_block\_worker.assert\_called\_with(
288             TEST\_WORKER\_ID\_3, \textcolor{stringliteral}{'max\_time\_qual'}
289         )
290         self.assertEqual(len(self.worker\_manager.time\_blocked\_workers), 2)
291 
292         \textcolor{comment}{# Unblock blocked workers, ensure proper calls and state change}
293         self.worker\_manager.un\_time\_block\_workers()
294         self.assertEqual(len(self.worker\_manager.time\_blocked\_workers), 0)
295         self.mturk\_manager.un\_soft\_block\_worker.assert\_any\_call(
296             TEST\_WORKER\_ID\_1, \textcolor{stringliteral}{'max\_time\_qual'}
297         )
298         self.mturk\_manager.un\_soft\_block\_worker.assert\_any\_call(
299             TEST\_WORKER\_ID\_2, \textcolor{stringliteral}{'max\_time\_qual'}
300         )
301 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a053eca3bf966f63d8740b0049102cd2d}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a053eca3bf966f63d8740b0049102cd2d}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!mturk\+\_\+manager@{mturk\+\_\+manager}}
\index{mturk\+\_\+manager@{mturk\+\_\+manager}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{mturk\+\_\+manager}{mturk\_manager}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+mturk\+\_\+manager}



Definition at line 147 of file test\+\_\+worker\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a8345c8a144607e001d530dd0c3082334}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a8345c8a144607e001d530dd0c3082334}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!opt@{opt}}
\index{opt@{opt}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+opt}



Definition at line 143 of file test\+\_\+worker\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_ae9e288c3b82a1451cb88a800c6d6c7bb}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_ae9e288c3b82a1451cb88a800c6d6c7bb}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!worker\+\_\+manager@{worker\+\_\+manager}}
\index{worker\+\_\+manager@{worker\+\_\+manager}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{worker\+\_\+manager}{worker\_manager}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+worker\+\_\+manager}



Definition at line 150 of file test\+\_\+worker\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a3cd35f72a2eafb6bf46de95ab9c2a74c}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a3cd35f72a2eafb6bf46de95ab9c2a74c}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!worker\+\_\+state\+\_\+1@{worker\+\_\+state\+\_\+1}}
\index{worker\+\_\+state\+\_\+1@{worker\+\_\+state\+\_\+1}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{worker\+\_\+state\+\_\+1}{worker\_state\_1}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+worker\+\_\+state\+\_\+1}



Definition at line 152 of file test\+\_\+worker\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a3aa5f117a73e8a4a0947aa675f1fb0e8}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a3aa5f117a73e8a4a0947aa675f1fb0e8}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!worker\+\_\+state\+\_\+2@{worker\+\_\+state\+\_\+2}}
\index{worker\+\_\+state\+\_\+2@{worker\+\_\+state\+\_\+2}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{worker\+\_\+state\+\_\+2}{worker\_state\_2}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+worker\+\_\+state\+\_\+2}



Definition at line 153 of file test\+\_\+worker\+\_\+manager.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a4b78cfccbd467410a7b86bf3387c92b9}\label{classparlai_1_1mturk_1_1core_1_1legacy__2018_1_1test_1_1test__worker__manager_1_1TestWorkerManager_a4b78cfccbd467410a7b86bf3387c92b9}} 
\index{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}!worker\+\_\+state\+\_\+3@{worker\+\_\+state\+\_\+3}}
\index{worker\+\_\+state\+\_\+3@{worker\+\_\+state\+\_\+3}!parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager@{parlai\+::mturk\+::core\+::legacy\+\_\+2018\+::test\+::test\+\_\+worker\+\_\+manager\+::\+Test\+Worker\+Manager}}
\subsubsection{\texorpdfstring{worker\+\_\+state\+\_\+3}{worker\_state\_3}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+legacy\+\_\+2018.\+test.\+test\+\_\+worker\+\_\+manager.\+Test\+Worker\+Manager.\+worker\+\_\+state\+\_\+3}



Definition at line 154 of file test\+\_\+worker\+\_\+manager.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/mturk/core/legacy\+\_\+2018/test/\hyperlink{legacy__2018_2test_2test__worker__manager_8py}{test\+\_\+worker\+\_\+manager.\+py}\end{DoxyCompactItemize}
