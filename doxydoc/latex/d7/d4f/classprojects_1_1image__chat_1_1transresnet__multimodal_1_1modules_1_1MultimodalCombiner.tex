\hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner}{}\section{projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner Class Reference}
\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner}\index{projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner@{projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner}}


Inheritance diagram for projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=281pt]{d2/dd7/classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=281pt]{d2/d48/classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a5587602df98b09e9f8871eab1d0d0fa4}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a352d2c87e1084b8d3dfe15346d038184}{n\+\_\+heads}, \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_af1150161d16875a23fe10f61e7aa1cf8}{n\+\_\+layers}, hidden\+\_\+dim, \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a0af7352a16cba4f0c183a50193b33f78}{ffn\+\_\+size}, \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a51a70794d4a9d5b8d6b12515833bcad4}{reduction}=True, attention\+\_\+dropout=0.\+0, relu\+\_\+dropout=0.\+0, learn\+\_\+positional\+\_\+embeddings=False)
\item 
def \hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a9cbcfc6a2c97c9636ec1f77ce898c6f0}{forward} (self, tensor, mask)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a0af7352a16cba4f0c183a50193b33f78}{ffn\+\_\+size}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_af1150161d16875a23fe10f61e7aa1cf8}{n\+\_\+layers}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a352d2c87e1084b8d3dfe15346d038184}{n\+\_\+heads}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_ae9db59ed18feccfecfb4c96701c21839}{out\+\_\+dim}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_aca0caa4e6262ec061a318348d99e517b}{dim}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a51a70794d4a9d5b8d6b12515833bcad4}{reduction}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a522ea58558cd910ec642c618503b1ccc}{position\+\_\+embeddings}
\item 
\hyperlink{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_aeb5eb46560988ba57f2577c52058b07c}{layers}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Multimodal Combination module.
\end{DoxyVerb}
 

Definition at line 499 of file modules.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a5587602df98b09e9f8871eab1d0d0fa4}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a5587602df98b09e9f8871eab1d0d0fa4}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{n\+\_\+heads,  }\item[{}]{n\+\_\+layers,  }\item[{}]{hidden\+\_\+dim,  }\item[{}]{ffn\+\_\+size,  }\item[{}]{reduction = {\ttfamily True},  }\item[{}]{attention\+\_\+dropout = {\ttfamily 0.0},  }\item[{}]{relu\+\_\+dropout = {\ttfamily 0.0},  }\item[{}]{learn\+\_\+positional\+\_\+embeddings = {\ttfamily False} }\end{DoxyParamCaption})}



Definition at line 514 of file modules.\+py.


\begin{DoxyCode}
514     ):
515         super().\_\_init\_\_()
516         self.ffn\_size = ffn\_size
517         self.n\_layers = n\_layers
518         self.n\_heads = n\_heads
519         self.out\_dim = hidden\_dim
520         self.dim = hidden\_dim
521         self.reduction = reduction
522         \textcolor{keyword}{assert} hidden\_dim % n\_heads == 0, \textcolor{stringliteral}{"MM-Combiner dim must be multiple of n\_heads"}
523         n\_positions = 1024
524         self.position\_embeddings = nn.Embedding(n\_positions, hidden\_dim)
525         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} learn\_positional\_embeddings:
526             \hyperlink{namespaceparlai_1_1agents_1_1transformer_1_1modules_a0b86437e6e9682fa3100e9cadcaae259}{create\_position\_codes}(
527                 n\_positions, hidden\_dim, out=self.position\_embeddings.weight
528             )
529         \textcolor{keywordflow}{else}:
530             nn.init.normal\_(self.position\_embeddings.weight, 0, hidden\_dim ** -0.5)
531 
532         self.layers = nn.ModuleList()
533         \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(self.n\_layers):
534             self.layers.append(
535                 TransformerEncoderLayer(
536                     n\_heads, hidden\_dim, ffn\_size, attention\_dropout, relu\_dropout
537                 )
538             )
539 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a9cbcfc6a2c97c9636ec1f77ce898c6f0}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a9cbcfc6a2c97c9636ec1f77ce898c6f0}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}!forward@{forward}}
\index{forward@{forward}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}}
\subsubsection{\texorpdfstring{forward()}{forward()}}
{\footnotesize\ttfamily def projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner.\+forward (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{tensor,  }\item[{}]{mask }\end{DoxyParamCaption})}

\begin{DoxyVerb}Forward pass.

:param tensor:
    a [bsz, seq_len, hidden_dim] FloatTensor
:param mask:
    a [bsz, seq_len] ByteTensor filled with 1 when inside the sequence and 0 outside.

:return:
    output: a [bsz, hidden_dim] FloatTensor of encodings
    mask: the same as before
\end{DoxyVerb}
 

Definition at line 540 of file modules.\+py.


\begin{DoxyCode}
540     \textcolor{keyword}{def }forward(self, tensor, mask):
541         \textcolor{stringliteral}{"""}
542 \textcolor{stringliteral}{        Forward pass.}
543 \textcolor{stringliteral}{}
544 \textcolor{stringliteral}{        :param tensor:}
545 \textcolor{stringliteral}{            a [bsz, seq\_len, hidden\_dim] FloatTensor}
546 \textcolor{stringliteral}{        :param mask:}
547 \textcolor{stringliteral}{            a [bsz, seq\_len] ByteTensor filled with 1 when inside the sequence and 0 outside.}
548 \textcolor{stringliteral}{}
549 \textcolor{stringliteral}{        :return:}
550 \textcolor{stringliteral}{            output: a [bsz, hidden\_dim] FloatTensor of encodings}
551 \textcolor{stringliteral}{            mask: the same as before}
552 \textcolor{stringliteral}{        """}
553         seq\_len = tensor.size(1)
554         positions = tensor.new(seq\_len).long()
555         positions = torch.arange(seq\_len, out=positions).unsqueeze(0)
556         tensor = tensor + self.position\_embeddings(positions).expand\_as(tensor)
557 
558         tensor *= mask.unsqueeze(-1).\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}()
559         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.n\_layers):
560             tensor = self.layers[i](tensor, mask)
561 
562         \textcolor{keywordflow}{if} self.reduction:
563             divisor = mask.float().sum(dim=1).unsqueeze(-1).clamp(min=1e-20)
564             output = tensor.sum(dim=1) / divisor
565             \textcolor{keywordflow}{return} output
566         \textcolor{keywordflow}{else}:
567             output = tensor
568             \textcolor{keywordflow}{return} output, mask
569 \end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_aca0caa4e6262ec061a318348d99e517b}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_aca0caa4e6262ec061a318348d99e517b}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}!dim@{dim}}
\index{dim@{dim}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}}
\subsubsection{\texorpdfstring{dim}{dim}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner.\+dim}



Definition at line 520 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a0af7352a16cba4f0c183a50193b33f78}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a0af7352a16cba4f0c183a50193b33f78}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}!ffn\+\_\+size@{ffn\+\_\+size}}
\index{ffn\+\_\+size@{ffn\+\_\+size}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}}
\subsubsection{\texorpdfstring{ffn\+\_\+size}{ffn\_size}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner.\+ffn\+\_\+size}



Definition at line 516 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_aeb5eb46560988ba57f2577c52058b07c}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_aeb5eb46560988ba57f2577c52058b07c}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}!layers@{layers}}
\index{layers@{layers}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}}
\subsubsection{\texorpdfstring{layers}{layers}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner.\+layers}



Definition at line 532 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a352d2c87e1084b8d3dfe15346d038184}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a352d2c87e1084b8d3dfe15346d038184}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}!n\+\_\+heads@{n\+\_\+heads}}
\index{n\+\_\+heads@{n\+\_\+heads}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}}
\subsubsection{\texorpdfstring{n\+\_\+heads}{n\_heads}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner.\+n\+\_\+heads}



Definition at line 518 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_af1150161d16875a23fe10f61e7aa1cf8}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_af1150161d16875a23fe10f61e7aa1cf8}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}!n\+\_\+layers@{n\+\_\+layers}}
\index{n\+\_\+layers@{n\+\_\+layers}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}}
\subsubsection{\texorpdfstring{n\+\_\+layers}{n\_layers}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner.\+n\+\_\+layers}



Definition at line 517 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_ae9db59ed18feccfecfb4c96701c21839}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_ae9db59ed18feccfecfb4c96701c21839}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}!out\+\_\+dim@{out\+\_\+dim}}
\index{out\+\_\+dim@{out\+\_\+dim}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}}
\subsubsection{\texorpdfstring{out\+\_\+dim}{out\_dim}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner.\+out\+\_\+dim}



Definition at line 519 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a522ea58558cd910ec642c618503b1ccc}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a522ea58558cd910ec642c618503b1ccc}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}!position\+\_\+embeddings@{position\+\_\+embeddings}}
\index{position\+\_\+embeddings@{position\+\_\+embeddings}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}}
\subsubsection{\texorpdfstring{position\+\_\+embeddings}{position\_embeddings}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner.\+position\+\_\+embeddings}



Definition at line 524 of file modules.\+py.

\mbox{\Hypertarget{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a51a70794d4a9d5b8d6b12515833bcad4}\label{classprojects_1_1image__chat_1_1transresnet__multimodal_1_1modules_1_1MultimodalCombiner_a51a70794d4a9d5b8d6b12515833bcad4}} 
\index{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}!reduction@{reduction}}
\index{reduction@{reduction}!projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner@{projects\+::image\+\_\+chat\+::transresnet\+\_\+multimodal\+::modules\+::\+Multimodal\+Combiner}}
\subsubsection{\texorpdfstring{reduction}{reduction}}
{\footnotesize\ttfamily projects.\+image\+\_\+chat.\+transresnet\+\_\+multimodal.\+modules.\+Multimodal\+Combiner.\+reduction}



Definition at line 521 of file modules.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
projects/image\+\_\+chat/transresnet\+\_\+multimodal/\hyperlink{projects_2image__chat_2transresnet__multimodal_2modules_8py}{modules.\+py}\end{DoxyCompactItemize}
