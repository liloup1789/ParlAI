\hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop}{}\section{parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop Class Reference}
\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop}\index{parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop@{parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop}}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a87a9194a461efe30e8b4de6cd4036699}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a3f9cd4c0c08f457b3ecfd1e494ccf58c}{opt})
\item 
def \hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a352f759a644e87251c37931bf276309a}{save\+\_\+model} (self, suffix=None)
\item 
def \hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a707bb03792ef7427f5ddbb66184a9756}{validate} (self)
\item 
def \hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a8ef64c11f101d087ceb83d21621b9665}{log} (self)
\item 
def \hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a8c15c0d4490891fd3e61e57501474e40}{train} (self)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a04b7275f3ab548989a48161a7f1b8f3c}{agent}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_aa22c430edd5956591bd0d266f0984ebb}{world}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a47cce17f07df89709cb9c6579b653920}{train\+\_\+time}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_ac7752245b67836fbcf9469a6247a14a2}{validate\+\_\+time}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a171257163a989d07a30e0a7077b85f13}{log\+\_\+time}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abed9a13e3ff9dcdf4b4c1711c0554531}{save\+\_\+time}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abd0cf79ef34f6ef8f028f7fa44eae971}{parleys}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a48187974c2f14dcb5c7416709cf750b3}{max\+\_\+num\+\_\+epochs}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_af83e63de91a310e6be11b7570442b191}{max\+\_\+train\+\_\+time}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a21dfaed0d552564c081077d9f2476a7a}{log\+\_\+every\+\_\+n\+\_\+secs}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_af1b6a637b6bfbc2f47f688b739a9b38d}{val\+\_\+every\+\_\+n\+\_\+secs}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a1b0c1444a2a2d2550e4f6eea53a435d2}{save\+\_\+every\+\_\+n\+\_\+secs}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a4600c4ed3161598de0be5de12e220625}{val\+\_\+every\+\_\+n\+\_\+epochs}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a46ffd685b324d61beb0428afba352664}{last\+\_\+valid\+\_\+epoch}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abe8e421aafd3a42103c794f3e3a1bcc6}{valid\+\_\+optim}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abceaa403716b5def408e2fedca6c651d}{valid\+\_\+reports}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a48a44b00d7b814ff20d0599803e92411}{best\+\_\+valid}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_aeb16930507dc585a10096e2b235e2745}{impatience}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a22cd642f6665fabdc49cdd294e257643}{saved}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a45643d393057a2a47e8a6e74acdc7515}{valid\+\_\+worlds}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a3f9cd4c0c08f457b3ecfd1e494ccf58c}{opt}
\item 
\hyperlink{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_af6636a1279a3fb33f57ba1af500d049b}{tb\+\_\+logger}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}TrainLoop contains the core training loop logic.
\end{DoxyVerb}
 

Definition at line 329 of file train\+\_\+model.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a87a9194a461efe30e8b4de6cd4036699}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a87a9194a461efe30e8b4de6cd4036699}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 334 of file train\+\_\+model.\+py.


\begin{DoxyCode}
334     \textcolor{keyword}{def }\_\_init\_\_(self, opt):
335         \textcolor{comment}{# if python is called from a non-interactive shell, like a bash script,}
336         \textcolor{comment}{# it will by-default ignore SIGINTs, and KeyboardInterrupt exceptions are}
337         \textcolor{comment}{# not produced. This line brings them back}
338         signal.signal(signal.SIGINT, signal.default\_int\_handler)
339 
340         \textcolor{keywordflow}{if} isinstance(opt, ParlaiParser):
341             print(\textcolor{stringliteral}{'[ Deprecated Warning: TrainLoop should be passed opt not Parser ]'})
342             opt = opt.parse\_args()
343         \textcolor{comment}{# Possibly load from checkpoint}
344         trainstats\_suffix = \textcolor{stringliteral}{'.trainstats'}  \textcolor{comment}{# we might load training statistics from here}
345         \textcolor{keywordflow}{if} (
346             opt[\textcolor{stringliteral}{'load\_from\_checkpoint'}]
347             \textcolor{keywordflow}{and} opt.get(\textcolor{stringliteral}{'model\_file'})
348             \textcolor{keywordflow}{and} os.path.isfile(opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'.checkpoint'})
349         ):
350             opt[\textcolor{stringliteral}{'init\_model'}] = opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'.checkpoint'}
351             trainstats\_suffix = \textcolor{stringliteral}{'.checkpoint.trainstats'}
352         \textcolor{comment}{# Possibly build a dictionary (not all models do this).}
353         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} (opt.get(\textcolor{stringliteral}{'dict\_file'}) \textcolor{keywordflow}{or} opt.get(\textcolor{stringliteral}{'model\_file'})):
354             \textcolor{keywordflow}{raise} RuntimeError(
355                 \textcolor{stringliteral}{'WARNING: For train\_model, please specify either a '}
356                 \textcolor{stringliteral}{'model\_file or dict\_file.'}
357             )
358         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'dict\_file'} \textcolor{keywordflow}{in} opt:
359             \textcolor{comment}{# If data built via pytorch data teacher, we need to load prebuilt dict}
360             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'pytorch\_teacher\_task'}):
361                 opt[\textcolor{stringliteral}{'dict\_file'}] = \hyperlink{namespaceparlai_1_1scripts_1_1build__pytorch__data_a6ec85a5842150af78f5178d75075b0cc}{get\_pyt\_dict\_file}(opt)
362             \textcolor{keywordflow}{elif} opt[\textcolor{stringliteral}{'dict\_file'}] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{and} opt.get(\textcolor{stringliteral}{'model\_file'}):
363                 opt[\textcolor{stringliteral}{'dict\_file'}] = opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'.dict'}
364             print(\textcolor{stringliteral}{"[ building dictionary first... ]"})
365             \hyperlink{namespacebuild__dict}{build\_dict}(opt, skip\_if\_built=\textcolor{keyword}{True})
366         \textcolor{comment}{# Create model and assign it to the specified task}
367         self.agent = \hyperlink{namespaceparlai_1_1core_1_1agents_a00d77a7e26fb89e8bd900f7b2a02982a}{create\_agent}(opt)
368         print(self.agent)
369         self.world = \hyperlink{namespaceparlai_1_1core_1_1worlds_a79969c7ba76d4b3c500f5bb776444dc6}{create\_task}(opt, self.agent)
370         \textcolor{comment}{# print(self.world)}
371         print(self.world.get\_agents())
372         \textcolor{comment}{# sys.exit()}
373         \textcolor{comment}{# set up timers}
374         self.train\_time = Timer()
375         self.validate\_time = Timer()
376         self.log\_time = Timer()
377         self.save\_time = Timer()
378         print(\textcolor{stringliteral}{'[ training... ]'})
379         self.parleys = 0
380         self.max\_num\_epochs = (
381             opt[\textcolor{stringliteral}{'num\_epochs'}] \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'num\_epochs'}] > 0 \textcolor{keywordflow}{else} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'inf'})
382         )
383         self.max\_train\_time = (
384             opt[\textcolor{stringliteral}{'max\_train\_time'}] \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'max\_train\_time'}] > 0 \textcolor{keywordflow}{else} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'inf'})
385         )
386         self.log\_every\_n\_secs = (
387             opt[\textcolor{stringliteral}{'log\_every\_n\_secs'}] \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'log\_every\_n\_secs'}] > 0 \textcolor{keywordflow}{else} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'inf'})
388         )
389         self.val\_every\_n\_secs = (
390             opt[\textcolor{stringliteral}{'validation\_every\_n\_secs'}]
391             \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'validation\_every\_n\_secs'}] > 0
392             \textcolor{keywordflow}{else} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'inf'})
393         )
394         self.save\_every\_n\_secs = (
395             opt[\textcolor{stringliteral}{'save\_every\_n\_secs'}] \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'save\_every\_n\_secs'}] > 0 \textcolor{keywordflow}{else} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'inf'})
396         )
397         self.val\_every\_n\_epochs = (
398             opt[\textcolor{stringliteral}{'validation\_every\_n\_epochs'}]
399             \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'validation\_every\_n\_epochs'}] > 0
400             \textcolor{keywordflow}{else} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'inf'})
401         )
402 
403         \textcolor{comment}{# smart defaults for --validation-metric-mode}
404         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'validation\_metric'}] \textcolor{keywordflow}{in} \{\textcolor{stringliteral}{'loss'}, \textcolor{stringliteral}{'ppl'}, \textcolor{stringliteral}{'mean\_rank'}\}:
405             opt[\textcolor{stringliteral}{'validation\_metric\_mode'}] = \textcolor{stringliteral}{'min'}
406         \textcolor{keywordflow}{elif} opt[\textcolor{stringliteral}{'validation\_metric'}] \textcolor{keywordflow}{in} \{\textcolor{stringliteral}{'accuracy'}, \textcolor{stringliteral}{'hits@1'}, \textcolor{stringliteral}{'hits@5'}, \textcolor{stringliteral}{'f1'}, \textcolor{stringliteral}{'bleu'}\}:
407             opt[\textcolor{stringliteral}{'validation\_metric\_mode'}] = \textcolor{stringliteral}{'max'}
408         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'validation\_metric\_mode'}) \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
409             opt[\textcolor{stringliteral}{'validation\_metric\_mode'}] = \textcolor{stringliteral}{'max'}
410 
411         self.last\_valid\_epoch = 0
412         self.valid\_optim = 1 \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'validation\_metric\_mode'}] == \textcolor{stringliteral}{'max'} \textcolor{keywordflow}{else} -1
413         self.valid\_reports = []
414         self.best\_valid = \textcolor{keywordtype}{None}
415         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'model\_file'}) \textcolor{keywordflow}{and} os.path.isfile(opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'.best\_valid'}):
416             with open(opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{".best\_valid"}, \textcolor{stringliteral}{'r') as f:}
417 \textcolor{stringliteral}{                x = f.readline()}
418 \textcolor{stringliteral}{                self.best\_valid = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(x)}
419 \textcolor{stringliteral}{                f.close()}
420 \textcolor{stringliteral}{        self.impatience = 0}
421 \textcolor{stringliteral}{        self.saved = }\textcolor{keyword}{False}
422         self.valid\_worlds = \textcolor{keywordtype}{None}
423         self.opt = opt
424 
425         \textcolor{comment}{# we may have been preempted, make sure we note that amount}
426         self.\_preempted\_epochs = 0.0
427         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'model\_file'}) \textcolor{keywordflow}{and} os.path.isfile(
428             opt[\textcolor{stringliteral}{'model\_file'}] + trainstats\_suffix
429         ):
430             \textcolor{comment}{# looks like we were preempted. make sure we load up our total}
431             \textcolor{comment}{# training stats, etc}
432             with open(opt[\textcolor{stringliteral}{'model\_file'}] + trainstats\_suffix) \textcolor{keyword}{as} ts:
433                 obj = json.load(ts)
434                 self.\_preempted\_epochs = obj.get(\textcolor{stringliteral}{'total\_epochs'}, 0)
435                 self.train\_time.total = obj.get(\textcolor{stringliteral}{'train\_time'}, 0)
436                 self.impatience = obj.get(\textcolor{stringliteral}{'impatience'}, 0)
437                 self.valid\_reports = obj.get(\textcolor{stringliteral}{'valid\_reports'}, [])
438 
439         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'tensorboard\_log'}] \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a9bb1dac198180590ef8c6b6c6f9fc2c4}{is\_primary\_worker}():
440             self.tb\_logger = TensorboardLogger(opt)
441 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a8ef64c11f101d087ceb83d21621b9665}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a8ef64c11f101d087ceb83d21621b9665}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!log@{log}}
\index{log@{log}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{log()}{log()}}
{\footnotesize\ttfamily def parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+log (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Output a training log entry.
\end{DoxyVerb}
 

Definition at line 669 of file train\+\_\+model.\+py.


\begin{DoxyCode}
669     \textcolor{keyword}{def }log(self):
670         \textcolor{stringliteral}{"""}
671 \textcolor{stringliteral}{        Output a training log entry.}
672 \textcolor{stringliteral}{        """}
673         opt = self.opt
674         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'display\_examples'}]:
675             print(self.world.display() + \textcolor{stringliteral}{'\(\backslash\)n~~'})
676         logs = []
677         \textcolor{comment}{# get report}
678         train\_report = self.world.\hyperlink{namespaceprojects_1_1convai2_1_1eval__f1_a01a47b9c08dad189837a51f085defc45}{report}()
679         self.\_cleanup\_inaccurate\_metrics(train\_report)
680         train\_report = self.\_sync\_training\_metrics(train\_report)
681         self.world.reset\_metrics()
682 
683         \textcolor{comment}{# time elapsed}
684         logs.append(\textcolor{stringliteral}{'time:\{\}s'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(np.floor(self.train\_time.time())))
685         logs.append(\textcolor{stringliteral}{'total\_exs:\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(self.\_total\_exs))
686 
687         \textcolor{keywordflow}{if} self.\_total\_epochs >= 0:
688             \textcolor{comment}{# only if it's unbounded}
689             logs.append(\textcolor{stringliteral}{'epochs:\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(round(self.\_total\_epochs, 2)))
690 
691         time\_left = self.\_compute\_eta(self.\_total\_epochs, self.train\_time.time())
692         \textcolor{keywordflow}{if} time\_left \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
693             logs.append(\textcolor{stringliteral}{'time\_left:\{\}s'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(max(0, np.ceil(time\_left))))
694 
695         log = \textcolor{stringliteral}{'[ \{\} ] \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(\textcolor{stringliteral}{' '}.join(logs), self.\_nice\_format(train\_report))
696         print(log)
697         self.log\_time.reset()
698 
699         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'tensorboard\_log'}] \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a9bb1dac198180590ef8c6b6c6f9fc2c4}{is\_primary\_worker}():
700             self.tb\_logger.log\_metrics(\textcolor{stringliteral}{'train'}, self.parleys, train\_report)
701 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a352f759a644e87251c37931bf276309a}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a352f759a644e87251c37931bf276309a}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!save\+\_\+model@{save\+\_\+model}}
\index{save\+\_\+model@{save\+\_\+model}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{save\+\_\+model()}{save\_model()}}
{\footnotesize\ttfamily def parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+save\+\_\+model (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{suffix = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Save the model to disk, possibly with a suffix.
\end{DoxyVerb}
 

Definition at line 442 of file train\+\_\+model.\+py.


\begin{DoxyCode}
442     \textcolor{keyword}{def }save\_model(self, suffix=None):
443         \textcolor{stringliteral}{"""}
444 \textcolor{stringliteral}{        Save the model to disk, possibly with a suffix.}
445 \textcolor{stringliteral}{        """}
446         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a9bb1dac198180590ef8c6b6c6f9fc2c4}{is\_primary\_worker}():
447             \textcolor{comment}{# never do IO as a non-primary worker}
448             \textcolor{keywordflow}{return}
449         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.opt.get(\textcolor{stringliteral}{'model\_file'}):
450             \textcolor{comment}{# nothing to save to, just exit}
451             \textcolor{keywordflow}{return}
452 
453         fn = self.opt[\textcolor{stringliteral}{'model\_file'}]
454         \textcolor{keywordflow}{if} suffix:
455             fn += suffix
456         \textcolor{keywordflow}{while} \textcolor{keyword}{True}:
457             \textcolor{comment}{# don't ever let a ctrl-c interrupt saving}
458             \textcolor{keywordflow}{try}:
459                 self.agent.save(fn)
460                 self.\_save\_train\_stats(suffix)
461                 \textcolor{keywordflow}{break}
462             \textcolor{keywordflow}{except} KeyboardInterrupt:
463                 \textcolor{keywordflow}{pass}
464 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a8c15c0d4490891fd3e61e57501474e40}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a8c15c0d4490891fd3e61e57501474e40}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!train@{train}}
\index{train@{train}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{train()}{train()}}
{\footnotesize\ttfamily def parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+train (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Perform a training run.

:return: tuple of reports (validation_report, test_report)
\end{DoxyVerb}
 

Definition at line 702 of file train\+\_\+model.\+py.


\begin{DoxyCode}
702     \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a36a5f4f6f9df0611a6818610518d2cf0}{train}(self):
703         \textcolor{stringliteral}{"""}
704 \textcolor{stringliteral}{        Perform a training run.}
705 \textcolor{stringliteral}{}
706 \textcolor{stringliteral}{        :return: tuple of reports (validation\_report, test\_report)}
707 \textcolor{stringliteral}{        """}
708         \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a023acb5e3b66e1f27e21247c35661279}{is\_distributed}():
709             \hyperlink{namespaceparlai_1_1utils_1_1misc_a884a3aefa90581f53bc592fa6a78dc43}{warn\_once}(
710                 \textcolor{stringliteral}{"Distributed training outputs average-per-worker metrics during "}
711                 \textcolor{stringliteral}{"training, and may be slightly distorted. Validation/test are "}
712                 \textcolor{stringliteral}{"unadulterated."}
713             )
714         opt = self.opt
715         world = self.world
716         print(world)
717         print(self.max\_num\_epochs)
718         \textcolor{comment}{# sys.exit()}
719         with world:
720             \textcolor{keywordflow}{while} \textcolor{keyword}{True}:
721                 \textcolor{comment}{# do one example / batch of examples}
722 
723                 world.parley()
724                 print(world.get\_agents()[0].\hyperlink{namespaceprojects_1_1convai2_1_1eval__f1_a01a47b9c08dad189837a51f085defc45}{report}())
725 
726                 \textcolor{keywordflow}{try}:
727                     world.parley()
728                 \textcolor{keywordflow}{except} StopTrainException:
729                     \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a023acb5e3b66e1f27e21247c35661279}{is\_distributed}():
730                         \textcolor{keywordflow}{raise} RuntimeError(
731                             \textcolor{stringliteral}{"StopTrainException not supported for "} \textcolor{stringliteral}{"distributed mode"}
732                         )
733                     \textcolor{keywordflow}{break}
734 
735 
736                 world.parley()
737                 print(world.get\_agents()[0].\hyperlink{namespaceprojects_1_1convai2_1_1eval__f1_a01a47b9c08dad189837a51f085defc45}{report}())
738                 self.parleys += 1
739                 \textcolor{keywordflow}{break}
740 
741                 \textcolor{comment}{# get the total training examples done, compute epochs}
742                 self.\_total\_epochs = (
743                     self.\_preempted\_epochs
744                     + \hyperlink{namespaceparlai_1_1utils_1_1distributed_a99b61b4756577c6542039c238d670dba}{num\_workers}() * self.world.get\_total\_epochs()
745                 )
746                 exs\_per\_epoch = self.world.num\_examples()
747                 self.\_total\_exs = \hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(np.round(self.\_total\_epochs * exs\_per\_epoch))
748 
749                 \textcolor{comment}{# and use the primary worker's timings for everything}
750                 train\_time, log\_time, validate\_time = \hyperlink{namespaceparlai_1_1utils_1_1distributed_a269d3c7284127d9b287b9b61e9161de6}{sync\_object}(
751                     (
752                         self.train\_time.time(),
753                         self.log\_time.time(),
754                         self.validate\_time.time(),
755                     )
756                 )
757 
758                 \textcolor{comment}{# check counters and timers}
759                 \textcolor{keywordflow}{if} self.\_total\_epochs >= self.max\_num\_epochs:
760                     self.log()
761                     print(
762                         \textcolor{stringliteral}{'[ num\_epochs completed:\{\} time elapsed:\{\}s ]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
763                             self.max\_num\_epochs, train\_time
764                         )
765                     )
766                     \textcolor{keywordflow}{break}
767                 \textcolor{keywordflow}{if} train\_time > self.max\_train\_time:
768                     print(\textcolor{stringliteral}{'[ max\_train\_time elapsed:\{\}s ]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(train\_time))
769                     \textcolor{keywordflow}{break}
770                 \textcolor{keywordflow}{if} log\_time > self.log\_every\_n\_secs:
771                     self.log()
772                 \textcolor{keywordflow}{if} (
773                     validate\_time > self.val\_every\_n\_secs
774                     \textcolor{keywordflow}{or} self.\_total\_epochs - self.last\_valid\_epoch
775                     >= self.val\_every\_n\_epochs
776                 ):
777                     \textcolor{keywordflow}{try}:
778                         stop\_training = self.validate()
779                     \textcolor{keywordflow}{except} StopTrainException:
780                         \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a023acb5e3b66e1f27e21247c35661279}{is\_distributed}():
781                             \textcolor{keywordflow}{raise} RuntimeError(
782                                 \textcolor{stringliteral}{"StopTrainException not "}
783                                 \textcolor{stringliteral}{"supported for distributed mode"}
784                             )
785                         \textcolor{keywordflow}{break}
786                     self.last\_valid\_epoch = self.\_total\_epochs
787                     \textcolor{keywordflow}{if} stop\_training:
788                         \textcolor{keywordflow}{break}
789                 \textcolor{keywordflow}{if} (
790                     self.save\_time.time() > self.save\_every\_n\_secs
791                     \textcolor{keywordflow}{and} opt.get(\textcolor{stringliteral}{'model\_file'})
792                     \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a9bb1dac198180590ef8c6b6c6f9fc2c4}{is\_primary\_worker}()
793                 ):
794                     print(
795                         \textcolor{stringliteral}{"[ saving model checkpoint: \{\}.checkpoint"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
796                             opt[\textcolor{stringliteral}{'model\_file'}]
797                         )
798                     )
799                     self.save\_model(\textcolor{stringliteral}{'.checkpoint'})
800                     self.save\_time.reset()
801 
802         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.saved \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a9bb1dac198180590ef8c6b6c6f9fc2c4}{is\_primary\_worker}():
803             \textcolor{comment}{# save agent}
804             self.save\_model()
805         \textcolor{keywordflow}{elif} opt.get(\textcolor{stringliteral}{'model\_file'}):
806             \textcolor{comment}{# reload best validation model}
807             self.agent = \hyperlink{namespaceparlai_1_1core_1_1agents_a00d77a7e26fb89e8bd900f7b2a02982a}{create\_agent}(opt)
808 
809         valid\_worlds = \_maybe\_load\_eval\_worlds(self.agent, opt, \textcolor{stringliteral}{'valid'})
810         max\_exs = opt[\textcolor{stringliteral}{'validation\_max\_exs'}] \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'short\_final\_eval'}) \textcolor{keywordflow}{else} -1
811         v\_report = \hyperlink{namespaceparlai_1_1scripts_1_1train__model_a496dfe3bf04da9b55d261b4c8d6229a7}{run\_eval}(valid\_worlds, opt, \textcolor{stringliteral}{'valid'}, max\_exs, write\_log=\textcolor{keyword}{True})
812         test\_worlds = \_maybe\_load\_eval\_worlds(self.agent, opt, \textcolor{stringliteral}{'test'})
813         t\_report = \hyperlink{namespaceparlai_1_1scripts_1_1train__model_a496dfe3bf04da9b55d261b4c8d6229a7}{run\_eval}(test\_worlds, opt, \textcolor{stringliteral}{'test'}, max\_exs, write\_log=\textcolor{keyword}{True})
814         \textcolor{keywordflow}{if} valid\_worlds:
815             \textcolor{keywordflow}{for} valid\_world \textcolor{keywordflow}{in} valid\_worlds:
816                 valid\_world.shutdown()
817         \textcolor{keywordflow}{if} test\_worlds:
818             \textcolor{keywordflow}{for} test\_world \textcolor{keywordflow}{in} test\_worlds:
819                 test\_world.shutdown()
820 
821         \hyperlink{namespaceparlai_1_1core_1_1params_afd1a47c94990168ea9e70d894a79bd2c}{print\_announcements}(opt)
822 
823         \textcolor{keywordflow}{return} v\_report, t\_report
824 
825 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a707bb03792ef7427f5ddbb66184a9756}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a707bb03792ef7427f5ddbb66184a9756}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!validate@{validate}}
\index{validate@{validate}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{validate()}{validate()}}
{\footnotesize\ttfamily def parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+validate (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Perform a validation run, checking whether we should stop training.

:return: boolean indicating whether training should stop
:rtype: bool
\end{DoxyVerb}
 

Definition at line 484 of file train\+\_\+model.\+py.


\begin{DoxyCode}
484     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(self):
485         \textcolor{stringliteral}{"""}
486 \textcolor{stringliteral}{        Perform a validation run, checking whether we should stop training.}
487 \textcolor{stringliteral}{}
488 \textcolor{stringliteral}{        :return: boolean indicating whether training should stop}
489 \textcolor{stringliteral}{        :rtype: bool}
490 \textcolor{stringliteral}{        """}
491         opt = self.opt
492 
493         \textcolor{keywordflow}{if} self.valid\_worlds \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
494             \textcolor{comment}{# we need to load the world now}
495             self.valid\_worlds = \_maybe\_load\_eval\_worlds(self.agent, opt, \textcolor{stringliteral}{'valid'})
496 
497         \textcolor{comment}{# run evaluation on valid set}
498         valid\_report = \hyperlink{namespaceparlai_1_1utils_1_1distributed_a269d3c7284127d9b287b9b61e9161de6}{sync\_object}(
499             \hyperlink{namespaceparlai_1_1scripts_1_1train__model_a496dfe3bf04da9b55d261b4c8d6229a7}{run\_eval}(self.valid\_worlds, opt, \textcolor{stringliteral}{'valid'}, opt[\textcolor{stringliteral}{'validation\_max\_exs'}])
500         )
501         v = valid\_report.copy()
502         v[\textcolor{stringliteral}{'train\_time'}] = self.train\_time.time()
503         self.valid\_reports.append(v)
504         \textcolor{comment}{# logging}
505         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'tensorboard\_log'}] \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a9bb1dac198180590ef8c6b6c6f9fc2c4}{is\_primary\_worker}():
506             self.tb\_logger.log\_metrics(\textcolor{stringliteral}{'valid'}, self.parleys, valid\_report)
507         \textcolor{comment}{# saving}
508         \textcolor{keywordflow}{if} (
509             opt.get(\textcolor{stringliteral}{'model\_file'})
510             \textcolor{keywordflow}{and} opt.get(\textcolor{stringliteral}{'save\_after\_valid'})
511             \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a9bb1dac198180590ef8c6b6c6f9fc2c4}{is\_primary\_worker}()
512         ):
513             print(\textcolor{stringliteral}{"[ saving model checkpoint: "} + opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{".checkpoint ]"})
514             self.save\_model(\textcolor{stringliteral}{'.checkpoint'})
515 
516         \textcolor{comment}{# send valid metrics to agent if the agent wants them}
517         \textcolor{keywordflow}{if} hasattr(self.agent, \textcolor{stringliteral}{'receive\_metrics'}):
518             self.agent.receive\_metrics(valid\_report)
519 
520         \textcolor{comment}{# check which metric to look at}
521         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'tasks'} \textcolor{keywordflow}{in} valid\_report \textcolor{keywordflow}{and} \textcolor{stringliteral}{'/'} \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'validation\_metric'}]:
522             \textcolor{comment}{# if you are multitasking and want your validation metric to be}
523             \textcolor{comment}{# a metric specific to a subtask, specify your validation metric}
524             \textcolor{comment}{# as -vmt subtask/metric}
525             subtask = opt[\textcolor{stringliteral}{'validation\_metric'}].split(\textcolor{stringliteral}{'/'})[0]
526             validation\_metric = opt[\textcolor{stringliteral}{'validation\_metric'}].split(\textcolor{stringliteral}{'/'})[1]
527             new\_valid = valid\_report[\textcolor{stringliteral}{'tasks'}][subtask][validation\_metric]
528         \textcolor{keywordflow}{else}:
529             new\_valid = valid\_report[opt[\textcolor{stringliteral}{'validation\_metric'}]]
530 
531         \textcolor{comment}{# check if this is the best validation so far}
532         \textcolor{keywordflow}{if} (
533             self.best\_valid \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}
534             \textcolor{keywordflow}{or} self.valid\_optim * new\_valid > self.valid\_optim * self.best\_valid
535         ):
536             print(
537                 \textcolor{stringliteral}{'[ new best \{\}: \{\}\{\} ]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
538                     opt[\textcolor{stringliteral}{'validation\_metric'}],
539                     new\_valid,
540                     \textcolor{stringliteral}{' (previous best was \{\})'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(self.best\_valid)
541                     \textcolor{keywordflow}{if} self.best\_valid \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
542                     \textcolor{keywordflow}{else} \textcolor{stringliteral}{''},
543                 )
544             )
545             self.best\_valid = new\_valid
546             self.impatience = 0
547             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'model\_file'}) \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a9bb1dac198180590ef8c6b6c6f9fc2c4}{is\_primary\_worker}():
548                 print(\textcolor{stringliteral}{"[ saving best valid model: "} + opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{" ]"})
549                 self.save\_model()
550                 print(
551                     \textcolor{stringliteral}{"[ saving best valid metric: "} + opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{".best\_valid ]"}
552                 )
553                 \_save\_best\_valid(opt[\textcolor{stringliteral}{'model\_file'}], self.best\_valid)
554                 self.saved = \textcolor{keyword}{True}
555             \textcolor{keywordflow}{if} (
556                 opt[\textcolor{stringliteral}{'validation\_metric'}] == \textcolor{stringliteral}{'accuracy'}
557                 \textcolor{keywordflow}{and} self.best\_valid >= opt[\textcolor{stringliteral}{'validation\_cutoff'}]
558             ):
559                 print(\textcolor{stringliteral}{'[ task solved! stopping. ]'})
560                 \textcolor{keywordflow}{return} \textcolor{keyword}{True}
561         \textcolor{keywordflow}{else}:
562             self.impatience += 1
563             print(
564                 \textcolor{stringliteral}{'[ did not beat best \{\}: \{\} impatience: \{\} ]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
565                     opt[\textcolor{stringliteral}{'validation\_metric'}], round(self.best\_valid, 4), self.impatience
566                 )
567             )
568         self.validate\_time.reset()
569 
570         \textcolor{comment}{# check if we are out of patience}
571         \textcolor{keywordflow}{if} (
572             opt[\textcolor{stringliteral}{'validation\_patience'}] > 0
573             \textcolor{keywordflow}{and} self.impatience >= opt[\textcolor{stringliteral}{'validation\_patience'}]
574         ):
575             print(\textcolor{stringliteral}{'[ ran out of patience! stopping training. ]'})
576             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
577         \textcolor{keywordflow}{return} \textcolor{keyword}{False}
578 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a04b7275f3ab548989a48161a7f1b8f3c}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a04b7275f3ab548989a48161a7f1b8f3c}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!agent@{agent}}
\index{agent@{agent}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{agent}{agent}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+agent}



Definition at line 367 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a48a44b00d7b814ff20d0599803e92411}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a48a44b00d7b814ff20d0599803e92411}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!best\+\_\+valid@{best\+\_\+valid}}
\index{best\+\_\+valid@{best\+\_\+valid}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{best\+\_\+valid}{best\_valid}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+best\+\_\+valid}



Definition at line 414 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_aeb16930507dc585a10096e2b235e2745}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_aeb16930507dc585a10096e2b235e2745}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!impatience@{impatience}}
\index{impatience@{impatience}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{impatience}{impatience}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+impatience}



Definition at line 420 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a46ffd685b324d61beb0428afba352664}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a46ffd685b324d61beb0428afba352664}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!last\+\_\+valid\+\_\+epoch@{last\+\_\+valid\+\_\+epoch}}
\index{last\+\_\+valid\+\_\+epoch@{last\+\_\+valid\+\_\+epoch}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{last\+\_\+valid\+\_\+epoch}{last\_valid\_epoch}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+last\+\_\+valid\+\_\+epoch}



Definition at line 411 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a21dfaed0d552564c081077d9f2476a7a}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a21dfaed0d552564c081077d9f2476a7a}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!log\+\_\+every\+\_\+n\+\_\+secs@{log\+\_\+every\+\_\+n\+\_\+secs}}
\index{log\+\_\+every\+\_\+n\+\_\+secs@{log\+\_\+every\+\_\+n\+\_\+secs}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{log\+\_\+every\+\_\+n\+\_\+secs}{log\_every\_n\_secs}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+log\+\_\+every\+\_\+n\+\_\+secs}



Definition at line 386 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a171257163a989d07a30e0a7077b85f13}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a171257163a989d07a30e0a7077b85f13}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!log\+\_\+time@{log\+\_\+time}}
\index{log\+\_\+time@{log\+\_\+time}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{log\+\_\+time}{log\_time}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+log\+\_\+time}



Definition at line 376 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a48187974c2f14dcb5c7416709cf750b3}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a48187974c2f14dcb5c7416709cf750b3}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!max\+\_\+num\+\_\+epochs@{max\+\_\+num\+\_\+epochs}}
\index{max\+\_\+num\+\_\+epochs@{max\+\_\+num\+\_\+epochs}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{max\+\_\+num\+\_\+epochs}{max\_num\_epochs}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+max\+\_\+num\+\_\+epochs}



Definition at line 380 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_af83e63de91a310e6be11b7570442b191}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_af83e63de91a310e6be11b7570442b191}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!max\+\_\+train\+\_\+time@{max\+\_\+train\+\_\+time}}
\index{max\+\_\+train\+\_\+time@{max\+\_\+train\+\_\+time}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{max\+\_\+train\+\_\+time}{max\_train\_time}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+max\+\_\+train\+\_\+time}



Definition at line 383 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a3f9cd4c0c08f457b3ecfd1e494ccf58c}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a3f9cd4c0c08f457b3ecfd1e494ccf58c}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!opt@{opt}}
\index{opt@{opt}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+opt}



Definition at line 423 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abd0cf79ef34f6ef8f028f7fa44eae971}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abd0cf79ef34f6ef8f028f7fa44eae971}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!parleys@{parleys}}
\index{parleys@{parleys}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{parleys}{parleys}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+parleys}



Definition at line 379 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a1b0c1444a2a2d2550e4f6eea53a435d2}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a1b0c1444a2a2d2550e4f6eea53a435d2}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!save\+\_\+every\+\_\+n\+\_\+secs@{save\+\_\+every\+\_\+n\+\_\+secs}}
\index{save\+\_\+every\+\_\+n\+\_\+secs@{save\+\_\+every\+\_\+n\+\_\+secs}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{save\+\_\+every\+\_\+n\+\_\+secs}{save\_every\_n\_secs}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+save\+\_\+every\+\_\+n\+\_\+secs}



Definition at line 394 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abed9a13e3ff9dcdf4b4c1711c0554531}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abed9a13e3ff9dcdf4b4c1711c0554531}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!save\+\_\+time@{save\+\_\+time}}
\index{save\+\_\+time@{save\+\_\+time}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{save\+\_\+time}{save\_time}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+save\+\_\+time}



Definition at line 377 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a22cd642f6665fabdc49cdd294e257643}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a22cd642f6665fabdc49cdd294e257643}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!saved@{saved}}
\index{saved@{saved}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{saved}{saved}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+saved}



Definition at line 421 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_af6636a1279a3fb33f57ba1af500d049b}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_af6636a1279a3fb33f57ba1af500d049b}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!tb\+\_\+logger@{tb\+\_\+logger}}
\index{tb\+\_\+logger@{tb\+\_\+logger}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{tb\+\_\+logger}{tb\_logger}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+tb\+\_\+logger}



Definition at line 440 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a47cce17f07df89709cb9c6579b653920}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a47cce17f07df89709cb9c6579b653920}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!train\+\_\+time@{train\+\_\+time}}
\index{train\+\_\+time@{train\+\_\+time}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{train\+\_\+time}{train\_time}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+train\+\_\+time}



Definition at line 374 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a4600c4ed3161598de0be5de12e220625}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a4600c4ed3161598de0be5de12e220625}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!val\+\_\+every\+\_\+n\+\_\+epochs@{val\+\_\+every\+\_\+n\+\_\+epochs}}
\index{val\+\_\+every\+\_\+n\+\_\+epochs@{val\+\_\+every\+\_\+n\+\_\+epochs}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{val\+\_\+every\+\_\+n\+\_\+epochs}{val\_every\_n\_epochs}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+val\+\_\+every\+\_\+n\+\_\+epochs}



Definition at line 397 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_af1b6a637b6bfbc2f47f688b739a9b38d}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_af1b6a637b6bfbc2f47f688b739a9b38d}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!val\+\_\+every\+\_\+n\+\_\+secs@{val\+\_\+every\+\_\+n\+\_\+secs}}
\index{val\+\_\+every\+\_\+n\+\_\+secs@{val\+\_\+every\+\_\+n\+\_\+secs}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{val\+\_\+every\+\_\+n\+\_\+secs}{val\_every\_n\_secs}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+val\+\_\+every\+\_\+n\+\_\+secs}



Definition at line 389 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abe8e421aafd3a42103c794f3e3a1bcc6}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abe8e421aafd3a42103c794f3e3a1bcc6}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!valid\+\_\+optim@{valid\+\_\+optim}}
\index{valid\+\_\+optim@{valid\+\_\+optim}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{valid\+\_\+optim}{valid\_optim}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+valid\+\_\+optim}



Definition at line 412 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abceaa403716b5def408e2fedca6c651d}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_abceaa403716b5def408e2fedca6c651d}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!valid\+\_\+reports@{valid\+\_\+reports}}
\index{valid\+\_\+reports@{valid\+\_\+reports}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{valid\+\_\+reports}{valid\_reports}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+valid\+\_\+reports}



Definition at line 413 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a45643d393057a2a47e8a6e74acdc7515}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_a45643d393057a2a47e8a6e74acdc7515}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!valid\+\_\+worlds@{valid\+\_\+worlds}}
\index{valid\+\_\+worlds@{valid\+\_\+worlds}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{valid\+\_\+worlds}{valid\_worlds}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+valid\+\_\+worlds}



Definition at line 422 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_ac7752245b67836fbcf9469a6247a14a2}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_ac7752245b67836fbcf9469a6247a14a2}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!validate\+\_\+time@{validate\+\_\+time}}
\index{validate\+\_\+time@{validate\+\_\+time}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{validate\+\_\+time}{validate\_time}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+validate\+\_\+time}



Definition at line 375 of file train\+\_\+model.\+py.

\mbox{\Hypertarget{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_aa22c430edd5956591bd0d266f0984ebb}\label{classparlai_1_1scripts_1_1train__model_1_1TrainLoop_aa22c430edd5956591bd0d266f0984ebb}} 
\index{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}!world@{world}}
\index{world@{world}!parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop@{parlai\+::scripts\+::train\+\_\+model\+::\+Train\+Loop}}
\subsubsection{\texorpdfstring{world}{world}}
{\footnotesize\ttfamily parlai.\+scripts.\+train\+\_\+model.\+Train\+Loop.\+world}



Definition at line 369 of file train\+\_\+model.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/scripts/\hyperlink{parlai_2scripts_2train__model_8py}{train\+\_\+model.\+py}\end{DoxyCompactItemize}
