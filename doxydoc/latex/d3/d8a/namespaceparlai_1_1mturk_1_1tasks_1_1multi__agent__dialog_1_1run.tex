\hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1multi__agent__dialog_1_1run}{}\section{parlai.\+mturk.\+tasks.\+multi\+\_\+agent\+\_\+dialog.\+run Namespace Reference}
\label{namespaceparlai_1_1mturk_1_1tasks_1_1multi__agent__dialog_1_1run}\index{parlai.\+mturk.\+tasks.\+multi\+\_\+agent\+\_\+dialog.\+run@{parlai.\+mturk.\+tasks.\+multi\+\_\+agent\+\_\+dialog.\+run}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1multi__agent__dialog_1_1run_ab60f6ad04de7f9c7192cdaec99b441d9}{main} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1multi__agent__dialog_1_1run_ab60f6ad04de7f9c7192cdaec99b441d9}\label{namespaceparlai_1_1mturk_1_1tasks_1_1multi__agent__dialog_1_1run_ab60f6ad04de7f9c7192cdaec99b441d9}} 
\index{parlai\+::mturk\+::tasks\+::multi\+\_\+agent\+\_\+dialog\+::run@{parlai\+::mturk\+::tasks\+::multi\+\_\+agent\+\_\+dialog\+::run}!main@{main}}
\index{main@{main}!parlai\+::mturk\+::tasks\+::multi\+\_\+agent\+\_\+dialog\+::run@{parlai\+::mturk\+::tasks\+::multi\+\_\+agent\+\_\+dialog\+::run}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+multi\+\_\+agent\+\_\+dialog.\+run.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}This task consists of one local human agent and two MTurk agents, each MTurk agent
will go through the onboarding step to provide information about themselves, before
being put into a conversation.

You can end the conversation by sending a message ending with `[DONE]` from human_1.
\end{DoxyVerb}
 

Definition at line 17 of file run.\+py.


\begin{DoxyCode}
17 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run_ad3ab2c71f8083c3112815c0b363d316b}{main}():
18     \textcolor{stringliteral}{"""}
19 \textcolor{stringliteral}{    This task consists of one local human agent and two MTurk agents, each MTurk agent}
20 \textcolor{stringliteral}{    will go through the onboarding step to provide information about themselves, before}
21 \textcolor{stringliteral}{    being put into a conversation.}
22 \textcolor{stringliteral}{}
23 \textcolor{stringliteral}{    You can end the conversation by sending a message ending with `[DONE]` from human\_1.}
24 \textcolor{stringliteral}{    """}
25     argparser = ParlaiParser(\textcolor{keyword}{False}, \textcolor{keyword}{False})
26     argparser.add\_parlai\_data\_path()
27     argparser.add\_mturk\_args()
28     opt = argparser.parse\_args()
29     opt[\textcolor{stringliteral}{'task'}] = os.path.basename(os.path.dirname(os.path.abspath(\_\_file\_\_)))
30     opt.update(task\_config)
31 
32     mturk\_agent\_1\_id = \textcolor{stringliteral}{'mturk\_agent\_1'}
33     mturk\_agent\_2\_id = \textcolor{stringliteral}{'mturk\_agent\_2'}
34     human\_agent\_1\_id = \textcolor{stringliteral}{'human\_1'}
35     mturk\_agent\_ids = [mturk\_agent\_1\_id, mturk\_agent\_2\_id]
36     mturk\_manager = MTurkManager(opt=opt, mturk\_agent\_ids=mturk\_agent\_ids)
37     mturk\_manager.setup\_server()
38 
39     \textcolor{keywordflow}{try}:
40         mturk\_manager.start\_new\_run()
41         mturk\_manager.create\_hits()
42 
43         \textcolor{keyword}{def }run\_onboard(worker):
44             world = MTurkMultiAgentDialogOnboardWorld(opt=opt, mturk\_agent=worker)
45             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world.episode\_done():
46                 world.parley()
47             world.shutdown()
48 
49         \textcolor{comment}{# You can set onboard\_function to None to skip onboarding}
50         mturk\_manager.set\_onboard\_function(onboard\_function=run\_onboard)
51         mturk\_manager.ready\_to\_accept\_workers()
52 
53         \textcolor{keyword}{def }check\_worker\_eligibility(worker):
54             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
55 
56         eligibility\_function = \{\textcolor{stringliteral}{'func'}: check\_worker\_eligibility, \textcolor{stringliteral}{'multiple'}: \textcolor{keyword}{False}\}
57 
58         \textcolor{keyword}{def }assign\_worker\_roles(workers):
59             \textcolor{keywordflow}{for} index, worker \textcolor{keywordflow}{in} enumerate(workers):
60                 worker.id = mturk\_agent\_ids[index % len(mturk\_agent\_ids)]
61 
62         \textcolor{keyword}{def }run\_conversation(mturk\_manager, opt, workers):
63             \textcolor{comment}{# Create mturk agents}
64             mturk\_agent\_1 = workers[0]
65             mturk\_agent\_2 = workers[1]
66 
67             \textcolor{comment}{# Create the local human agents}
68             human\_agent\_1 = LocalHumanAgent(opt=\{\})
69             human\_agent\_1.id = human\_agent\_1\_id
70 
71             world = MTurkMultiAgentDialogWorld(
72                 opt=opt, agents=[human\_agent\_1, mturk\_agent\_1, mturk\_agent\_2]
73             )
74 
75             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world.episode\_done():
76                 world.parley()
77 
78             world.shutdown()
79 
80         mturk\_manager.start\_task(
81             eligibility\_function=eligibility\_function,
82             assign\_role\_function=assign\_worker\_roles,
83             task\_function=run\_conversation,
84         )
85 
86     \textcolor{keywordflow}{except} BaseException:
87         \textcolor{keywordflow}{raise}
88     \textcolor{keywordflow}{finally}:
89         mturk\_manager.expire\_all\_unassigned\_hits()
90         mturk\_manager.shutdown()
91 
92 
\end{DoxyCode}
