\hypertarget{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling}{}\section{parlai.\+core.\+torch\+\_\+generator\+\_\+agent.\+Nucleus\+Sampling Class Reference}
\label{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling}\index{parlai.\+core.\+torch\+\_\+generator\+\_\+agent.\+Nucleus\+Sampling@{parlai.\+core.\+torch\+\_\+generator\+\_\+agent.\+Nucleus\+Sampling}}


Inheritance diagram for parlai.\+core.\+torch\+\_\+generator\+\_\+agent.\+Nucleus\+Sampling\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=212pt]{d7/de2/classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+core.\+torch\+\_\+generator\+\_\+agent.\+Nucleus\+Sampling\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=212pt]{da/dd2/classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling_a90c444c7fa1f76baac3a54fc7c980e15}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling_a54a43b58e2e2cf7da776c40311e0a3c1}{p}, args, kwargs)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling_a91abde2fb2dccf5cd0564825ddc5ea4d}{select\+\_\+paths} (self, logprobs, prior\+\_\+scores)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling_a54a43b58e2e2cf7da776c40311e0a3c1}{p}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
\begin{DoxyVerb}Nucelus, aka top-p sampling (Holtzman et al., 2019).

Samples from a truncated distribution which covers a fixed CDF proportion
of the original distribution.

Typical values of p are 0.3 and 0.9.

See https://arxiv.org/abs/1904.09751 for details.
\end{DoxyVerb}
 

Definition at line 1398 of file torch\+\_\+generator\+\_\+agent.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling_a90c444c7fa1f76baac3a54fc7c980e15}\label{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling_a90c444c7fa1f76baac3a54fc7c980e15}} 
\index{parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling@{parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling@{parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+generator\+\_\+agent.\+Nucleus\+Sampling.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{p,  }\item[{}]{args,  }\item[{}]{kwargs }\end{DoxyParamCaption})}



Definition at line 1410 of file torch\+\_\+generator\+\_\+agent.\+py.


\begin{DoxyCode}
1410     \textcolor{keyword}{def }\_\_init\_\_(self, p, *args, **kwargs):
1411         super().\_\_init\_\_(*args, **kwargs)
1412         self.p = p
1413 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling_a91abde2fb2dccf5cd0564825ddc5ea4d}\label{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling_a91abde2fb2dccf5cd0564825ddc5ea4d}} 
\index{parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling@{parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling}!select\+\_\+paths@{select\+\_\+paths}}
\index{select\+\_\+paths@{select\+\_\+paths}!parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling@{parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling}}
\subsubsection{\texorpdfstring{select\+\_\+paths()}{select\_paths()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+generator\+\_\+agent.\+Nucleus\+Sampling.\+select\+\_\+paths (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{logprobs,  }\item[{}]{prior\+\_\+scores }\end{DoxyParamCaption})}



Definition at line 1414 of file torch\+\_\+generator\+\_\+agent.\+py.


\begin{DoxyCode}
1414     \textcolor{keyword}{def }select\_paths(self, logprobs, prior\_scores):
1415         \textcolor{comment}{# Unlike the other treesearch methods, we have to switch to linspace}
1416         \textcolor{comment}{# for the probabilities in order to compute the CDF.}
1417         probs = torch.softmax(logprobs, dim=-1)
1418         sprobs, sinds = probs.sort(dim=-1, descending=\textcolor{keyword}{True})
1419         \textcolor{comment}{# The subtraction here is so that we always include the first word to}
1420         \textcolor{comment}{# go over p. For example, if the most probable token has a prob of 0.5, and}
1421         \textcolor{comment}{# p = 0.3, then we need still need to include that first token.}
1422         mask = (sprobs.cumsum(dim=-1) - sprobs[:, :1]) >= self.p
1423         sprobs[mask] = 0
1424         sprobs.div\_(sprobs.sum(dim=-1).unsqueeze(1))
1425         choices = torch.multinomial(sprobs, 1)[:, 0]
1426         hyp\_ids = torch.arange(logprobs.size(0)).to(logprobs.device)
1427         tok\_ids = sinds[hyp\_ids, choices]
1428         \textcolor{comment}{# Convert back to logspace.}
1429         scores = sprobs[hyp\_ids, choices].log()
1430         best\_scores = prior\_scores.expand\_as(scores) + scores
1431         \textcolor{keywordflow}{return} (hyp\_ids, tok\_ids, best\_scores)
1432 \end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling_a54a43b58e2e2cf7da776c40311e0a3c1}\label{classparlai_1_1core_1_1torch__generator__agent_1_1NucleusSampling_a54a43b58e2e2cf7da776c40311e0a3c1}} 
\index{parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling@{parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling}!p@{p}}
\index{p@{p}!parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling@{parlai\+::core\+::torch\+\_\+generator\+\_\+agent\+::\+Nucleus\+Sampling}}
\subsubsection{\texorpdfstring{p}{p}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+generator\+\_\+agent.\+Nucleus\+Sampling.\+p}



Definition at line 1412 of file torch\+\_\+generator\+\_\+agent.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/core/\hyperlink{torch__generator__agent_8py}{torch\+\_\+generator\+\_\+agent.\+py}\end{DoxyCompactItemize}
