\hypertarget{namespaceparlai_1_1tasks_1_1ms__marco_1_1build}{}\section{parlai.\+tasks.\+ms\+\_\+marco.\+build Namespace Reference}
\label{namespaceparlai_1_1tasks_1_1ms__marco_1_1build}\index{parlai.\+tasks.\+ms\+\_\+marco.\+build@{parlai.\+tasks.\+ms\+\_\+marco.\+build}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a8e7fee7824a3a7aa1facadf9979f3f4a}{read\+\_\+file} (filename)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_ac19db5d0ad4ba8559f6aca64f2fe192b}{convert\+\_\+file} (input\+\_\+file\+\_\+path)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a6c94ade2f99fa70bf4103a22a1fbdc42}{cleanup} (txt)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_ac3cdd4cc2ccd3e9551ddd0349b94d537}{create\+\_\+fb\+\_\+format} (outpath, dtype, inpath)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a3516057a3812247cdb1b1c9e8f6cb84d}{build} (opt)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_af344d1660233d915e9e6efa8ceccb22b}{R\+E\+S\+O\+U\+R\+C\+ES}
\item 
\hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_aa59139a792f73cbb243b98278c6b753e}{zipped}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a3516057a3812247cdb1b1c9e8f6cb84d}\label{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a3516057a3812247cdb1b1c9e8f6cb84d}} 
\index{parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}!build@{build}}
\index{build@{build}!parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}}
\subsubsection{\texorpdfstring{build()}{build()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+ms\+\_\+marco.\+build.\+build (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 98 of file build.\+py.


\begin{DoxyCode}
98 \textcolor{keyword}{def }\hyperlink{namespacedialog__babi__feedback_1_1build_a7a9d289f7493a5ded13c4b7f071b6184}{build}(opt):
99     dpath = os.path.join(opt[\textcolor{stringliteral}{'datapath'}], \textcolor{stringliteral}{'MS\_MARCO'})
100     version = \textcolor{stringliteral}{"2.1"}
101 
102     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} build\_data.built(dpath, version\_string=version):
103         print(\textcolor{stringliteral}{'[building data: '} + dpath + \textcolor{stringliteral}{']'})
104         \textcolor{keywordflow}{if} build\_data.built(dpath):
105             \textcolor{comment}{# An older version exists, so remove these outdated files.}
106             build\_data.remove\_dir(dpath)
107         build\_data.make\_dir(dpath)
108 
109         \textcolor{comment}{# Download the data.}
110         \textcolor{keywordflow}{for} downloadable\_file \textcolor{keywordflow}{in} RESOURCES:
111             downloadable\_file.download\_file(dpath)
112 
113         \hyperlink{namespaceparlai_1_1tasks_1_1wikiqa_1_1build_a554828702769592403db58c955d1dfe3}{create\_fb\_format}(dpath, \textcolor{stringliteral}{"train"}, os.path.join(dpath, \textcolor{stringliteral}{'train.gz'}))
114         \textcolor{comment}{# os.remove(os.path.join(dpath, 'train.gz'))}
115         \hyperlink{namespaceparlai_1_1tasks_1_1wikiqa_1_1build_a554828702769592403db58c955d1dfe3}{create\_fb\_format}(dpath, \textcolor{stringliteral}{"valid"}, os.path.join(dpath, \textcolor{stringliteral}{'valid.gz'}))
116         \textcolor{comment}{# os.remove(os.path.join(dpath, 'valid.gz'))}
117         \hyperlink{namespaceparlai_1_1tasks_1_1wikiqa_1_1build_a554828702769592403db58c955d1dfe3}{create\_fb\_format}(dpath, \textcolor{stringliteral}{"test"}, os.path.join(dpath, \textcolor{stringliteral}{'test.gz'}))
118         \textcolor{comment}{# os.remove(os.path.join(dpath, 'test.gz'))}
119 
120         \textcolor{comment}{# Mark the data as built.}
121         build\_data.mark\_done(dpath, version\_string=version)
122 \end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a6c94ade2f99fa70bf4103a22a1fbdc42}\label{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a6c94ade2f99fa70bf4103a22a1fbdc42}} 
\index{parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}!cleanup@{cleanup}}
\index{cleanup@{cleanup}!parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}}
\subsubsection{\texorpdfstring{cleanup()}{cleanup()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+ms\+\_\+marco.\+build.\+cleanup (\begin{DoxyParamCaption}\item[{}]{txt }\end{DoxyParamCaption})}



Definition at line 60 of file build.\+py.


\begin{DoxyCode}
60 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a6c94ade2f99fa70bf4103a22a1fbdc42}{cleanup}(txt):
61     \textcolor{keywordflow}{return} txt.strip().replace(\textcolor{stringliteral}{"|"}, \textcolor{stringliteral}{"\_\_PIPE\_\_"}).replace(\textcolor{stringliteral}{"\(\backslash\)\(\backslash\)n"}, \textcolor{stringliteral}{"\_\_NEWLINE\_\_"})
62 
63 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_ac19db5d0ad4ba8559f6aca64f2fe192b}\label{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_ac19db5d0ad4ba8559f6aca64f2fe192b}} 
\index{parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}!convert\+\_\+file@{convert\+\_\+file}}
\index{convert\+\_\+file@{convert\+\_\+file}!parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}}
\subsubsection{\texorpdfstring{convert\+\_\+file()}{convert\_file()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+ms\+\_\+marco.\+build.\+convert\+\_\+file (\begin{DoxyParamCaption}\item[{}]{input\+\_\+file\+\_\+path }\end{DoxyParamCaption})}



Definition at line 42 of file build.\+py.


\begin{DoxyCode}
42 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_ac19db5d0ad4ba8559f6aca64f2fe192b}{convert\_file}(input\_file\_path):
43     print(\textcolor{stringliteral}{"Reading gzip file \{\}."}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(input\_file\_path))
44     with gzip.open(input\_file\_path) \textcolor{keyword}{as} f:
45         records = json.load(f)
46     n = len(records[\textcolor{stringliteral}{"passages"}].keys())
47     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} tqdm.tqdm(range(n), \textcolor{stringliteral}{"Converting"}):
48         newline\_dict = \{\}
49         index = \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(i)
50         \textcolor{keywordflow}{if} \textcolor{stringliteral}{"test"} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} input\_file\_path:
51             newline\_dict[\textcolor{stringliteral}{"answers"}] = records[\textcolor{stringliteral}{"answers"}][index]
52             newline\_dict[\textcolor{stringliteral}{"wellFormedAnswers"}] = records[\textcolor{stringliteral}{"wellFormedAnswers"}][index]
53         newline\_dict[\textcolor{stringliteral}{"passages"}] = records[\textcolor{stringliteral}{"passages"}][index]
54         newline\_dict[\textcolor{stringliteral}{"query"}] = records[\textcolor{stringliteral}{"query"}][index]
55         newline\_dict[\textcolor{stringliteral}{"query\_id"}] = records[\textcolor{stringliteral}{"query\_id"}][index]
56         newline\_dict[\textcolor{stringliteral}{"query\_type"}] = records[\textcolor{stringliteral}{"query\_type"}][index]
57         \textcolor{keywordflow}{yield} newline\_dict
58 
59 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_ac3cdd4cc2ccd3e9551ddd0349b94d537}\label{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_ac3cdd4cc2ccd3e9551ddd0349b94d537}} 
\index{parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}!create\+\_\+fb\+\_\+format@{create\+\_\+fb\+\_\+format}}
\index{create\+\_\+fb\+\_\+format@{create\+\_\+fb\+\_\+format}!parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}}
\subsubsection{\texorpdfstring{create\+\_\+fb\+\_\+format()}{create\_fb\_format()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+ms\+\_\+marco.\+build.\+create\+\_\+fb\+\_\+format (\begin{DoxyParamCaption}\item[{}]{outpath,  }\item[{}]{dtype,  }\item[{}]{inpath }\end{DoxyParamCaption})}



Definition at line 64 of file build.\+py.


\begin{DoxyCode}
64 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1wikiqa_1_1build_a554828702769592403db58c955d1dfe3}{create\_fb\_format}(outpath, dtype, inpath):
65     print(\textcolor{stringliteral}{'building fbformat:'} + dtype)
66     episodes = list(\hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_ac19db5d0ad4ba8559f6aca64f2fe192b}{convert\_file}(inpath))
67 
68     \textcolor{comment}{# save the raw json version for span selection task (default)}
69     with open(os.path.join(outpath, dtype + \textcolor{stringliteral}{'.txt'}), \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} fout1:
70         \textcolor{keywordflow}{for} ep \textcolor{keywordflow}{in} episodes:
71             fout1.write(json.dumps(ep) + \textcolor{stringliteral}{"\(\backslash\)n"})
72 
73     \textcolor{comment}{# save the file for passage selection task}
74     with open(os.path.join(outpath, dtype + \textcolor{stringliteral}{'.passage.txt'}), \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} fout2:
75         \textcolor{keywordflow}{for} dic \textcolor{keywordflow}{in} episodes:
76             lq = dic[\textcolor{stringliteral}{"query"}]
77             \textcolor{keywordflow}{if} dtype != \textcolor{stringliteral}{"test"}:
78                 ans = [
79                     \hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a6c94ade2f99fa70bf4103a22a1fbdc42}{cleanup}(d[\textcolor{stringliteral}{"passage\_text"}])
80                     \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} dic[\textcolor{stringliteral}{"passages"}]
81                     \textcolor{keywordflow}{if} d[\textcolor{stringliteral}{"is\_selected"}] == 1
82                 ]
83                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} ans:
84                     \textcolor{keywordflow}{continue}
85             \textcolor{keywordflow}{else}:
86                 \textcolor{comment}{# ground truth for test data is not available yet}
87                 ans = []
88 
89             cands = [\hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a6c94ade2f99fa70bf4103a22a1fbdc42}{cleanup}(d[\textcolor{stringliteral}{"passage\_text"}]) \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} dic[\textcolor{stringliteral}{"passages"}]]
90             \textcolor{keywordflow}{if} cands \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} ans:
91                 cands.append(\textcolor{stringliteral}{""})
92             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} cands:
93                 \textcolor{keywordflow}{continue}
94             fout2.write(\textcolor{stringliteral}{'1 \{\}\(\backslash\)t\{\}\(\backslash\)t\(\backslash\)t\{\}\(\backslash\)n'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(lq, \textcolor{stringliteral}{'|'}.join(ans), \textcolor{stringliteral}{'|'}.join(cands)))
95 
96 
97 \textcolor{comment}{# Download and build the data if it does not exist.}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a8e7fee7824a3a7aa1facadf9979f3f4a}\label{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a8e7fee7824a3a7aa1facadf9979f3f4a}} 
\index{parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}!read\+\_\+file@{read\+\_\+file}}
\index{read\+\_\+file@{read\+\_\+file}!parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}}
\subsubsection{\texorpdfstring{read\+\_\+file()}{read\_file()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+ms\+\_\+marco.\+build.\+read\+\_\+file (\begin{DoxyParamCaption}\item[{}]{filename }\end{DoxyParamCaption})}



Definition at line 36 of file build.\+py.


\begin{DoxyCode}
36 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_a8e7fee7824a3a7aa1facadf9979f3f4a}{read\_file}(filename):
37     with open(filename) \textcolor{keyword}{as} f:
38         lines = [x \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} f.readlines()]
39     \textcolor{keywordflow}{return} lines
40 
41 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_af344d1660233d915e9e6efa8ceccb22b}\label{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_af344d1660233d915e9e6efa8ceccb22b}} 
\index{parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}!R\+E\+S\+O\+U\+R\+C\+ES@{R\+E\+S\+O\+U\+R\+C\+ES}}
\index{R\+E\+S\+O\+U\+R\+C\+ES@{R\+E\+S\+O\+U\+R\+C\+ES}!parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}}
\subsubsection{\texorpdfstring{R\+E\+S\+O\+U\+R\+C\+ES}{RESOURCES}}
{\footnotesize\ttfamily parlai.\+tasks.\+ms\+\_\+marco.\+build.\+R\+E\+S\+O\+U\+R\+C\+ES}



Definition at line 14 of file build.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_aa59139a792f73cbb243b98278c6b753e}\label{namespaceparlai_1_1tasks_1_1ms__marco_1_1build_aa59139a792f73cbb243b98278c6b753e}} 
\index{parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}!zipped@{zipped}}
\index{zipped@{zipped}!parlai\+::tasks\+::ms\+\_\+marco\+::build@{parlai\+::tasks\+::ms\+\_\+marco\+::build}}
\subsubsection{\texorpdfstring{zipped}{zipped}}
{\footnotesize\ttfamily parlai.\+tasks.\+ms\+\_\+marco.\+build.\+zipped}



Definition at line 19 of file build.\+py.

