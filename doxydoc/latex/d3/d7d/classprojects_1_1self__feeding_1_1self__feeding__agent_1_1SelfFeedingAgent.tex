\hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent}{}\section{projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent Class Reference}
\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent}\index{projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent@{projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent}}


Inheritance diagram for projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=280pt]{d6/d74/classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=280pt]{de/d2d/classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a22f9ef0ce5fb83da14d404296476ad0f}{add\+\_\+cmdline\+\_\+args} (cls, argparser)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abfcd542bf7b9c1fa8922d31459b12e2e}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1core_1_1torch__agent_1_1TorchAgent_a785bb920cf8c8afc3e9bf6a8b77e335a}{opt}, shared=None)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a89a2bb3f299fe29c018ea39af72446c6}{upgrade\+\_\+opt} (cls, opt\+\_\+on\+\_\+disk)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af80537d5c439bd9c475e252e533e24cc}{build\+\_\+model} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aeb85e03ea2d8dfebd9cb29d717bea763}{act} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a083d8cde4e9351b2f41c52a6205fe92b}{observe} (self, \hyperlink{classparlai_1_1core_1_1torch__agent_1_1TorchAgent_a4bc525b20568822a042b3bbfa3da3a69}{observation})
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a72c574a9342e5cf9e268ad0cb7a1e721}{batchify} (self, observations)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa650efc924cd97c7ac6303fad46aeee6}{train\+\_\+step} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af50200b087a797a01b5e5ccdd1be63ba}{eval\+\_\+step} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a29d503e95d996bbe351fe860631c3162}{dialog\+\_\+step} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ae98cf6c1345c3cff3278339ef1c855a4}{feedback\+\_\+step} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4e504bd6e7179930122bcec4a658e30f}{satisfaction\+\_\+step} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a6891c2c3b9782cc190dad6f3f89c8390}{update\+\_\+dia\+\_\+metrics} (self, loss, ranks, label\+\_\+inds, batchsize)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a39ce3bfde7b4bcf692133012a7a3bcbc}{update\+\_\+fee\+\_\+metrics} (self, loss, ranks, label\+\_\+inds, batchsize)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab41a6e0b9f7ba0163ebb1152eadfdeb1}{update\+\_\+sat\+\_\+metrics} (self, loss, preds, labels, batchsize)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa94174029fa282fd301ae01ea2ac90de}{reset} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ada3fee611be323fc660f634f7e33d83e}{reset\+\_\+metrics} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a456725f7e04d7452bd14f733fb3cea35}{report} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a3208c69de4a2452cafa3d7feeec85218}{encode\+\_\+candidates} (self, cands)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a8d1ee3e56b88c0efaed910cc867970d3}{do\+\_\+request\+\_\+feedback} (self, positivity)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af0cd2239c4610157ac513163eb9437a3}{do\+\_\+request\+\_\+rating} (self, positivity)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a9c1c1e9435e1b56420fee71a31c5d57e}{extract\+\_\+rating} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abf84c3ae5ee4a7f80dfe3e441ad170b2}{predict\+\_\+satisfaction} (self, \hyperlink{classparlai_1_1core_1_1torch__agent_1_1TorchAgent_a4bc525b20568822a042b3bbfa3da3a69}{observation})
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a2788bb764560c9d021ac0b8a5596e1e0}{predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af23daff9436acdeadd63b74396870255}{check\+\_\+prev\+\_\+response} (self, preds, cand\+\_\+ranked)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a57bd8a3eaeecc56d5df86c8bedc6d2d2}{make\+\_\+action} (self, text, reward=0)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a65e172c7c2dff330e0a92ce361acdc45}{make\+\_\+feedback\+\_\+request} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa97b64df930c600bd7be1b69779849e7}{make\+\_\+rating\+\_\+request} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a0c79b5c366eded0b21f90674837d6d93}{make\+\_\+rating\+\_\+response} (self, rating)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad0e1cbdcc32b0c50e15de866efd963f3}{set\+\_\+subtasks} (self, \hyperlink{classparlai_1_1core_1_1torch__agent_1_1TorchAgent_a785bb920cf8c8afc3e9bf6a8b77e335a}{opt})
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa6011af735a855f23a7630f464abbd9a}{load} (self, path)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59261a9ada05e97b6b9e9f10c193e9b7}{multitask}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a25ee430dd49391cc8265f2a3e789bbf0}{subtask}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a27184d7df8f89fd0643b4973674826d7}{prev\+\_\+responses}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a30211c1fec9722594aca49c18670c711}{prev\+\_\+response}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59ba1da30dacc1c8c7a7a321d94c25d6}{status}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab2d87eedf68d027424673ada89954fc1}{task\+\_\+weight}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad8190f0d70c2f3415e48d23252be3834}{satisfaction\+\_\+criterion}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ace46abbade806237aef24a58a76d554f}{rating\+\_\+classifier}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a810afc1857cbf598661e845ee00c0483}{model}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a91168bac37bb10ada694c29d47039c35}{requested\+\_\+rating}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4f3aa2b94dedfa052d15e80e046070d4}{last\+\_\+rating}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a02d034bc0c9208fb3d6561b90f176ddf}{eval\+\_\+candidates}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a47fd708e2c3e2c5a5e48e32126543c8c}{subtasks}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 55 of file self\+\_\+feeding\+\_\+agent.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abfcd542bf7b9c1fa8922d31459b12e2e}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abfcd542bf7b9c1fa8922d31459b12e2e}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 226 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
226     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
227         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'interactive'}]:
228             print(\textcolor{stringliteral}{"[ Setting interactive mode defaults... ]"})
229             opt[\textcolor{stringliteral}{'prev\_response\_filter'}] = \textcolor{keyword}{True}
230 
231         \textcolor{comment}{# Set subtasks first so that opt['subtasks'] is set before build\_model()}
232         self.set\_subtasks(opt)
233         self.multitask = len(self.subtasks) > 1
234         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.multitask:
235             self.subtask = self.subtasks[0]
236 
237         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'prev\_response\_negatives'}]:
238             \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'candidates'}] \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'fixed'}, \textcolor{stringliteral}{'vocab'}]:
239                 msg = (
240                     \textcolor{stringliteral}{"[ Option --prev-response-negatives=True is incompatible with "}
241                     \textcolor{stringliteral}{"--candidates=['fixed','vocab']. Overriding it to False. ]"}
242                 )
243                 \hyperlink{namespaceparlai_1_1utils_1_1misc_a884a3aefa90581f53bc592fa6a78dc43}{warn\_once}(msg)
244                 self.opt[\textcolor{stringliteral}{'prev\_response\_negatives'}] = \textcolor{keyword}{False}
245             self.prev\_responses = \textcolor{keywordtype}{None}
246         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'prev\_response\_filter'}]:
247             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} opt[\textcolor{stringliteral}{'interactive'}]:
248                 msg = (
249                     \textcolor{stringliteral}{"[ Option --prev-response-filter=True can only be used when "}
250                     \textcolor{stringliteral}{"--interactive=True. Overriding it to False. ]"}
251                 )
252                 \hyperlink{namespaceparlai_1_1utils_1_1misc_a884a3aefa90581f53bc592fa6a78dc43}{warn\_once}(msg)
253                 self.opt[\textcolor{stringliteral}{'prev\_response\_filter'}] = \textcolor{keyword}{False}
254             self.prev\_response = \textcolor{keywordtype}{None}
255 
256         super().\_\_init\_\_(opt, shared)
257 
258         self.status = NORMAL
259         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'interactive'}]:
260             \textcolor{keyword}{assert} \textcolor{stringliteral}{'dialog'} \textcolor{keywordflow}{in} self.subtasks
261             \textcolor{keyword}{assert} \textcolor{stringliteral}{'satisfaction'} \textcolor{keywordflow}{in} self.subtasks
262         \textcolor{keywordflow}{else}:
263             \textcolor{keyword}{assert} \textcolor{keywordflow}{not} self.opt[\textcolor{stringliteral}{'request\_feedback'}]
264             \textcolor{keyword}{assert} \textcolor{keywordflow}{not} self.opt[\textcolor{stringliteral}{'request\_rating'}]
265 
266         self.task\_weight = \{
267             \textcolor{stringliteral}{'dialog'}: opt[\textcolor{stringliteral}{'dia\_weight'}],
268             \textcolor{stringliteral}{'feedback'}: opt[\textcolor{stringliteral}{'fee\_weight'}],
269             \textcolor{stringliteral}{'satisfaction'}: opt[\textcolor{stringliteral}{'sat\_weight'}],
270         \}
271 
272         \textcolor{comment}{# dialog/feedback tasks use self.rank\_loss from TorchRankerAgent}
273         \textcolor{comment}{# Don't do BCEWithLogitsLoss since we need the probs from the sigmoid anyway}
274         self.satisfaction\_criterion = nn.BCELoss(reduce=\textcolor{keyword}{True}, size\_average=\textcolor{keyword}{False})
275 
276         \textcolor{comment}{# Set rating classifier}
277         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'regex'}]:
278             self.rating\_classifier = FeedbackClassifierRegex()
279 
280         random.seed()
281         self.reset()
282 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aeb85e03ea2d8dfebd9cb29d717bea763}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aeb85e03ea2d8dfebd9cb29d717bea763}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!act@{act}}
\index{act@{act}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{act()}{act()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+act (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 311 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
311     \textcolor{keyword}{def }act(self):
312         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'request\_feedback'}] \textcolor{keywordflow}{or} self.opt[\textcolor{stringliteral}{'request\_rating'}]:
313             \textcolor{comment}{# rating request ->}
314             \textcolor{comment}{#   0/+1 -> normal}
315             \textcolor{comment}{#   -1 -> feedback request}
316             \textcolor{comment}{# feedback request -> topic request -> normal}
317             positivity = -1  \textcolor{comment}{# actual positivity values are in [0, 1]}
318 
319             \textcolor{comment}{# Preprocessing (for special states that transition to NORMAL)}
320             \textcolor{keywordflow}{if} self.status \textcolor{keywordflow}{in} [NEWTOPIC\_REQUESTED, RATING\_ACCEPTED]:
321                 self.status = NORMAL
322 
323             \textcolor{keywordflow}{if} self.status == NORMAL:
324                 positivity = self.predict\_satisfaction(self.observation)
325                 \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{"display\_sat\_estimate"}]:
326                     print(f\textcolor{stringliteral}{"[ satisfaction estimate ]: \{positivity\}"})
327                 \textcolor{keywordflow}{if} self.do\_request\_feedback(positivity):
328                     action = self.make\_action(self.make\_feedback\_request())
329                     self.status = FEEDBACK\_REQUESTED
330                 \textcolor{keywordflow}{elif} self.do\_request\_rating(positivity):
331                     action = self.make\_action(self.make\_rating\_request())
332                     self.requested\_rating = \textcolor{keyword}{True}
333                     self.status = RATING\_REQUESTED
334 
335             \textcolor{keywordflow}{elif} self.status == RATING\_REQUESTED:
336                 rating = self.extract\_rating()
337                 \textcolor{keywordflow}{if} rating == -1:
338                     action = self.make\_action(
339                         self.make\_feedback\_request(), reward=rating
340                     )
341                     self.status = FEEDBACK\_REQUESTED
342 
343                 \textcolor{keywordflow}{else}:
344                     action, reply = self.make\_rating\_response(rating)
345                     self.status = RATING\_ACCEPTED
346                     \textcolor{comment}{# Store just the non-template part of the response in the history}
347                     self.history.update\_history(\{\textcolor{stringliteral}{"text"}: reply\})
348 
349             \textcolor{keywordflow}{elif} self.status == FEEDBACK\_REQUESTED:
350                 action = self.make\_action(THANKS + \textcolor{stringliteral}{' '} + NEWTOPIC)
351                 self.status = NEWTOPIC\_REQUESTED
352                 self.history.reset()
353 
354             \textcolor{keywordflow}{else}:
355                 \textcolor{keywordflow}{raise} Exception(f\textcolor{stringliteral}{"Unrecognized status: \{self.status\}"})
356 
357         \textcolor{keywordflow}{if} self.status == NORMAL:
358             action = super().act()
359             self.history.update\_history(action)
360 
361         \textcolor{keywordflow}{return} action
362 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a22f9ef0ce5fb83da14d404296476ad0f}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a22f9ef0ce5fb83da14d404296476ad0f}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}}
\index{add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+cmdline\+\_\+args()}{add\_cmdline\_args()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+add\+\_\+cmdline\+\_\+args (\begin{DoxyParamCaption}\item[{}]{cls,  }\item[{}]{argparser }\end{DoxyParamCaption})}

\begin{DoxyVerb}Add command-line arguments specifically for this agent.
\end{DoxyVerb}
 

Definition at line 57 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
57     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(cls, argparser):
58         \textcolor{stringliteral}{"""}
59 \textcolor{stringliteral}{        Add command-line arguments specifically for this agent.}
60 \textcolor{stringliteral}{        """}
61         super().\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(argparser)
62         SelfFeedingModel.add\_cmdline\_args(argparser)
63 
64         agent = argparser.add\_argument\_group(\textcolor{stringliteral}{'Self-feeding Agent'})
65         agent.add\_argument(
66             \textcolor{stringliteral}{'--request-rating'},
67             type=\textcolor{stringliteral}{'bool'},
68             default=\textcolor{keyword}{False},
69             help=\textcolor{stringliteral}{"If True, ocassionally request ratings"},
70         )
71         agent.add\_argument(
72             \textcolor{stringliteral}{'--rating-frequency'},
73             type=float,
74             default=0.01,
75             help=\textcolor{stringliteral}{"The fraction of the time that a rating will be "}
76             \textcolor{stringliteral}{"randomly requested, regardless of classifier confidence"},
77         )
78         agent.add\_argument(
79             \textcolor{stringliteral}{'--rating-gap'},
80             type=float,
81             default=0.05,
82             help=\textcolor{stringliteral}{"A positivity rating must be within this amount of "}
83             \textcolor{stringliteral}{"the rating-threshold to trigger the confidence-based "}
84             \textcolor{stringliteral}{"rating request"},
85         )
86 
87         agent.add\_argument(
88             \textcolor{stringliteral}{'--request-feedback'},
89             type=\textcolor{stringliteral}{'bool'},
90             default=\textcolor{keyword}{False},
91             help=\textcolor{stringliteral}{"If True, recognize mistakes and request feedback"},
92         )
93         agent.add\_argument(
94             \textcolor{stringliteral}{'--rating-threshold'},
95             type=float,
96             default=0.5,
97             help=\textcolor{stringliteral}{"Treat feedback below this threshold as negative"},
98         )
99         agent.add\_argument(
100             \textcolor{stringliteral}{'--display-sat-estimate'},
101             type=\textcolor{stringliteral}{'bool'},
102             default=\textcolor{keyword}{False},
103             help=\textcolor{stringliteral}{"If True, print estimated satisfaction after each response"},
104         )
105         agent.add\_argument(
106             \textcolor{stringliteral}{'--target-class'},
107             type=int,
108             default=0,
109             help=\textcolor{stringliteral}{"The label (in [0,1]) to treat as the target rarer "}
110             \textcolor{stringliteral}{"class when calculating tp/fp/tn/fn"},
111         )
112 
113         agent.add\_argument(
114             \textcolor{stringliteral}{'--freeze-base'},
115             type=\textcolor{stringliteral}{'bool'},
116             default=\textcolor{keyword}{False},
117             help=\textcolor{stringliteral}{"If True, freeze all but the satisfaction linear layer"},
118         )
119         agent.add\_argument(
120             \textcolor{stringliteral}{'--partial-load'},
121             type=\textcolor{stringliteral}{'bool'},
122             default=\textcolor{keyword}{False},
123             help=\textcolor{stringliteral}{"If True, allow a model to be partially loaded (i.e., "}
124             \textcolor{stringliteral}{"a model need not be a perfect match to be loaded"},
125         )
126 
127         agent.add\_argument(
128             \textcolor{stringliteral}{'-subtasks'},
129             \textcolor{stringliteral}{'--subtasks'},
130             type=str,
131             help=\textcolor{stringliteral}{"A comma-separated list of active subtasks"},
132         )
133 
134         agent.add\_argument(
135             \textcolor{stringliteral}{'--dia-weight'},
136             type=float,
137             default=1.0,
138             help=\textcolor{stringliteral}{"The dialog task loss is multiplied by this"},
139         )
140         agent.add\_argument(
141             \textcolor{stringliteral}{'--fee-weight'},
142             type=float,
143             default=1.0,
144             help=\textcolor{stringliteral}{"The feedback task loss is multiplied by this"},
145         )
146         agent.add\_argument(
147             \textcolor{stringliteral}{'--sat-weight'},
148             type=float,
149             default=1.0,
150             help=\textcolor{stringliteral}{"The satisfaction task loss is multiplied by this"},
151         )
152 
153         agent.add\_argument(
154             \textcolor{stringliteral}{'--prev-response-negatives'},
155             type=\textcolor{stringliteral}{'bool'},
156             default=\textcolor{keyword}{False},
157             help=\textcolor{stringliteral}{"If True, during training add the previous agent response as a "}
158             \textcolor{stringliteral}{"negative candidate for the current response (as a way to "}
159             \textcolor{stringliteral}{"organically teach the model to not repeat itself). This option is "}
160             \textcolor{stringliteral}{"ignored when candidate set is 'fixed' or 'vocab', as these already "}
161             \textcolor{stringliteral}{"include all candidates"},
162         )
163         agent.add\_argument(
164             \textcolor{stringliteral}{'--prev-response-filter'},
165             type=\textcolor{stringliteral}{'bool'},
166             default=\textcolor{keyword}{False},
167             help=\textcolor{stringliteral}{"If True and --interactive=True, do not allow the model to output its "}
168             \textcolor{stringliteral}{"previous response. This is a hackier solution than using "}
169             \textcolor{stringliteral}{"--prev-response-negatives, but MUCH faster/simpler"},
170         )
171         agent.add\_argument(
172             \textcolor{stringliteral}{'--interactive'},
173             type=\textcolor{stringliteral}{'bool'},
174             default=\textcolor{keyword}{False},
175             help=\textcolor{stringliteral}{"Mark as true if you are in a setting where you are only doing "}
176             \textcolor{stringliteral}{"evaluation, and always with the same fixed candidate set."},
177         )
178 
179         agent.add\_argument(
180             \textcolor{stringliteral}{'--add-double-person-tokens'},
181             type=\textcolor{stringliteral}{'bool'},
182             default=\textcolor{keyword}{False},
183             help=\textcolor{stringliteral}{"For backwards compatibility with old models only. For new "}
184             \textcolor{stringliteral}{"models, this should always be False."},
185         )
186 
187         agent.set\_defaults(person\_tokens=\textcolor{keyword}{False})  \textcolor{comment}{# add these in a special way}
188 
189         variants = argparser.add\_argument\_group(\textcolor{stringliteral}{'Self-feeding Variants'})
190         variants.add\_argument(
191             \textcolor{stringliteral}{'-rgx'},
192             \textcolor{stringliteral}{'--regex'},
193             type=\textcolor{stringliteral}{'bool'},
194             default=\textcolor{keyword}{False},
195             help=\textcolor{stringliteral}{"If True, classify satisfaction using regexes instead "} \textcolor{stringliteral}{"of model"},
196         )
197         variants.add\_argument(
198             \textcolor{stringliteral}{'-up'},
199             \textcolor{stringliteral}{'--uncertainty-predictor'},
200             type=\textcolor{stringliteral}{'bool'},
201             default=\textcolor{keyword}{False},
202             help=\textcolor{stringliteral}{"If True, classify satisfaction using uncertainty of "}
203             \textcolor{stringliteral}{"dialog models predictions instead of classifer"}
204             \textcolor{stringliteral}{"model"},
205         )
206         variants.add\_argument(
207             \textcolor{stringliteral}{'-ut'},
208             \textcolor{stringliteral}{'--uncertainty-threshold'},
209             type=float,
210             default=0.5,
211             help=\textcolor{stringliteral}{"If model confidence is smaller than this number and"}
212             \textcolor{stringliteral}{" --uncertainty-predictor=True, classify as bot mistake"},
213         )
214         variants.add\_argument(
215             \textcolor{stringliteral}{'-us'},
216             \textcolor{stringliteral}{'--uncertainty-style'},
217             type=str,
218             default=\textcolor{stringliteral}{'gap'},
219             choices=[\textcolor{stringliteral}{'gap'}, \textcolor{stringliteral}{'mag'}],
220             help=\textcolor{stringliteral}{"Whether the uncertainty threshold measures the "}
221             \textcolor{stringliteral}{"magnitude of the top confidence, or the gap between the "}
222             \textcolor{stringliteral}{"two most confident answers"},
223         )
224         \textcolor{keywordflow}{return} agent
225 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a72c574a9342e5cf9e268ad0cb7a1e721}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a72c574a9342e5cf9e268ad0cb7a1e721}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!batchify@{batchify}}
\index{batchify@{batchify}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{batchify()}{batchify()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+batchify (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observations }\end{DoxyParamCaption})}



Definition at line 374 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
374     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1utils_aca22dd97c5b6dcda2a7479c1cb22ef1e}{batchify}(self, observations):
375         batch = super().\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1utils_aca22dd97c5b6dcda2a7479c1cb22ef1e}{batchify}(observations)
376         \textcolor{keywordflow}{if} self.multitask \textcolor{keywordflow}{and} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
377             \textcolor{comment}{# Dialog is the default task; e.g., in interactive mode}
378             subtasks = [o.get(\textcolor{stringliteral}{'subtask'}, \textcolor{stringliteral}{'dialog'}) \textcolor{keywordflow}{for} o \textcolor{keywordflow}{in} observations]
379             \textcolor{comment}{# Catch error here for debugging}
380             \textcolor{keyword}{assert} len(set(subtasks)) == 1
381             self.subtask = subtasks[0]
382         \textcolor{comment}{# print(f"[ context ]: \{observations[0]['text']\}")}
383         \textcolor{keywordflow}{return} batch
384 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af80537d5c439bd9c475e252e533e24cc}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af80537d5c439bd9c475e252e533e24cc}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!build\+\_\+model@{build\+\_\+model}}
\index{build\+\_\+model@{build\+\_\+model}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{build\+\_\+model()}{build\_model()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+build\+\_\+model (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 299 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
299     \textcolor{keyword}{def }build\_model(self):
300         self.model = SelfFeedingModel(self.opt, self.dict)
301         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'embedding\_type'}] != \textcolor{stringliteral}{'random'}:
302             \textcolor{keywordflow}{for} embeddings \textcolor{keywordflow}{in} [
303                 getattr(self.model, \textcolor{stringliteral}{'dia\_embeddings'}, \textcolor{keywordtype}{None}),
304                 getattr(self.model, \textcolor{stringliteral}{'fee\_embeddings'}, \textcolor{keywordtype}{None}),
305                 getattr(self.model, \textcolor{stringliteral}{'sat\_embeddings'}, \textcolor{keywordtype}{None}),
306             ]:
307                 \textcolor{keywordflow}{if} embeddings \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
308                     self.\_copy\_embeddings(embeddings.weight, self.opt[\textcolor{stringliteral}{'embedding\_type'}])
309         \textcolor{keywordflow}{return} self.model
310 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af23daff9436acdeadd63b74396870255}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af23daff9436acdeadd63b74396870255}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!check\+\_\+prev\+\_\+response@{check\+\_\+prev\+\_\+response}}
\index{check\+\_\+prev\+\_\+response@{check\+\_\+prev\+\_\+response}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{check\+\_\+prev\+\_\+response()}{check\_prev\_response()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+check\+\_\+prev\+\_\+response (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{preds,  }\item[{}]{cand\+\_\+ranked }\end{DoxyParamCaption})}



Definition at line 781 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
781     \textcolor{keyword}{def }check\_prev\_response(self, preds, cand\_ranked):
782         \textcolor{comment}{# Compare current prediction to previous (replacing if necessary)}
783         \textcolor{keywordflow}{if} self.prev\_response \textcolor{keywordflow}{and} (preds[0] == self.prev\_response):
784             preds[0] = cand\_ranked[0][1]
785         \textcolor{comment}{# Save current prediction for next turn}
786         self.prev\_response = preds[0]
787         \textcolor{keywordflow}{return} preds
788 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a29d503e95d996bbe351fe860631c3162}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a29d503e95d996bbe351fe860631c3162}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!dialog\+\_\+step@{dialog\+\_\+step}}
\index{dialog\+\_\+step@{dialog\+\_\+step}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{dialog\+\_\+step()}{dialog\_step()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+dialog\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 470 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
470     \textcolor{keyword}{def }dialog\_step(self, batch):
471         batchsize = batch.text\_vec.size(0)
472         \textcolor{keywordflow}{if} self.model.training:
473             cands, cand\_vecs, label\_inds = self.\_build\_candidates(
474                 batch, source=self.opt[\textcolor{stringliteral}{'candidates'}], mode=\textcolor{stringliteral}{'train'}
475             )
476         \textcolor{keywordflow}{else}:
477             cands, cand\_vecs, label\_inds = self.\_build\_candidates(
478                 batch, source=self.opt[\textcolor{stringliteral}{'eval\_candidates'}], mode=\textcolor{stringliteral}{'eval'}
479             )
480             \textcolor{keywordflow}{if} self.encode\_candidate\_vecs \textcolor{keywordflow}{and} self.eval\_candidates \textcolor{keywordflow}{in} [
481                 \textcolor{stringliteral}{'fixed'},
482                 \textcolor{stringliteral}{'vocab'},
483             ]:
484                 \textcolor{comment}{# if we cached candidate encodings for a fixed list of candidates,}
485                 \textcolor{comment}{# pass those into the score\_candidates function}
486                 \textcolor{keywordflow}{if} self.eval\_candidates == \textcolor{stringliteral}{'fixed'}:
487                     cand\_vecs = self.fixed\_candidate\_encs
488                 \textcolor{keywordflow}{elif} self.eval\_candidates == \textcolor{stringliteral}{'vocab'}:
489                     cand\_vecs = self.vocab\_candidate\_encs
490 
491         scores = self.model.score\_dialog(batch.text\_vec, cand\_vecs)
492         \_, ranks = scores.sort(1, descending=\textcolor{keyword}{True})
493 
494         \textcolor{keywordflow}{if} self.model.training:
495             \textcolor{comment}{# Get predictions but not full rankings for the sake of speed}
496             cand\_ranked = \textcolor{keywordtype}{None}
497             \textcolor{keywordflow}{if} cand\_vecs.dim() == 2:
498                 preds = [cands[ordering[0]] \textcolor{keywordflow}{for} ordering \textcolor{keywordflow}{in} ranks]
499             \textcolor{keywordflow}{elif} cand\_vecs.dim() == 3:
500                 preds = [cands[i][ordering[0]] \textcolor{keywordflow}{for} i, ordering \textcolor{keywordflow}{in} enumerate(ranks)]
501         \textcolor{keywordflow}{else}:
502             \textcolor{comment}{# Return full rankings to calculate hits@ metrics}
503             cand\_ranked = []
504             \textcolor{keywordflow}{for} i, ordering \textcolor{keywordflow}{in} enumerate(ranks):
505                 \textcolor{keywordflow}{if} cand\_vecs.dim() == 2:
506                     cand\_list = cands
507                 \textcolor{keywordflow}{elif} cand\_vecs.dim() == 3:
508                     cand\_list = cands[i]
509                 cand\_ranked.append([cand\_list[rank] \textcolor{keywordflow}{for} rank \textcolor{keywordflow}{in} ordering])
510             preds = [cand\_ranked[i][0] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(batchsize)]
511 
512         \textcolor{keywordflow}{if} label\_inds \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
513             loss = \textcolor{keywordtype}{None}
514         \textcolor{keywordflow}{else}:
515             loss = self.criterion(scores, label\_inds)
516             self.update\_dia\_metrics(loss, ranks, label\_inds, batchsize)
517         \textcolor{keywordflow}{return} loss, preds, cand\_ranked
518 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a8d1ee3e56b88c0efaed910cc867970d3}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a8d1ee3e56b88c0efaed910cc867970d3}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!do\+\_\+request\+\_\+feedback@{do\+\_\+request\+\_\+feedback}}
\index{do\+\_\+request\+\_\+feedback@{do\+\_\+request\+\_\+feedback}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{do\+\_\+request\+\_\+feedback()}{do\_request\_feedback()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+do\+\_\+request\+\_\+feedback (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{positivity }\end{DoxyParamCaption})}

\begin{DoxyVerb}Decide whether to request an feedback this turn.
\end{DoxyVerb}
 

Definition at line 685 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
685     \textcolor{keyword}{def }do\_request\_feedback(self, positivity):
686         \textcolor{stringliteral}{"""}
687 \textcolor{stringliteral}{        Decide whether to request an feedback this turn.}
688 \textcolor{stringliteral}{        """}
689         \textcolor{comment}{# If --request-feedback=False, then don't request an feedback}
690         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.opt[\textcolor{stringliteral}{'request\_feedback'}] \textcolor{keywordflow}{or} len(self.history.history\_strings) == 1:
691             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
692         \textcolor{keywordflow}{else}:
693             \textcolor{keywordflow}{return} positivity < self.opt[\textcolor{stringliteral}{'rating\_threshold'}]
694 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af0cd2239c4610157ac513163eb9437a3}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af0cd2239c4610157ac513163eb9437a3}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!do\+\_\+request\+\_\+rating@{do\+\_\+request\+\_\+rating}}
\index{do\+\_\+request\+\_\+rating@{do\+\_\+request\+\_\+rating}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{do\+\_\+request\+\_\+rating()}{do\_request\_rating()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+do\+\_\+request\+\_\+rating (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{positivity }\end{DoxyParamCaption})}

\begin{DoxyVerb}Decide whether to request a rating this turn.
\end{DoxyVerb}
 

Definition at line 695 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
695     \textcolor{keyword}{def }do\_request\_rating(self, positivity):
696         \textcolor{stringliteral}{"""}
697 \textcolor{stringliteral}{        Decide whether to request a rating this turn.}
698 \textcolor{stringliteral}{        """}
699         \textcolor{comment}{# If --request-rating=False, then don't request a rating}
700         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.opt[\textcolor{stringliteral}{'request\_rating'}]:
701             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
702         \textcolor{comment}{# If no previous bot utterance is on record, can't ask about it}
703         \textcolor{keywordflow}{elif} len(self.history.history\_strings) < 2:
704             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
705         \textcolor{comment}{# Only request a rating a maximum of once per episode}
706         \textcolor{keywordflow}{elif} self.requested\_rating:
707             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
708         \textcolor{comment}{# Some percentage of the time, we ask for a rating randomly (to aid exploration)}
709         \textcolor{keywordflow}{elif} random.random() < self.opt[\textcolor{stringliteral}{'rating\_frequency'}]:
710             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
711         \textcolor{comment}{# Lastly, ask for a rating based on confidence (proximity to threshold)}
712         \textcolor{keywordflow}{else}:
713             gap = abs(positivity - self.opt[\textcolor{stringliteral}{'rating\_threshold'}])
714             \textcolor{keywordflow}{return} gap < self.opt[\textcolor{stringliteral}{'rating\_gap'}]
715 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a3208c69de4a2452cafa3d7feeec85218}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a3208c69de4a2452cafa3d7feeec85218}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!encode\+\_\+candidates@{encode\+\_\+candidates}}
\index{encode\+\_\+candidates@{encode\+\_\+candidates}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{encode\+\_\+candidates()}{encode\_candidates()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+encode\+\_\+candidates (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{cands }\end{DoxyParamCaption})}

\begin{DoxyVerb}Encodes a tensor of vectorized candidates.

:param cands: a [bs, seq_len] or [bs, num_cands, seq_len](?) of vectorized
    candidates
\end{DoxyVerb}
 

Definition at line 676 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
676     \textcolor{keyword}{def }encode\_candidates(self, cands):
677         \textcolor{stringliteral}{"""}
678 \textcolor{stringliteral}{        Encodes a tensor of vectorized candidates.}
679 \textcolor{stringliteral}{}
680 \textcolor{stringliteral}{        :param cands: a [bs, seq\_len] or [bs, num\_cands, seq\_len](?) of vectorized}
681 \textcolor{stringliteral}{            candidates}
682 \textcolor{stringliteral}{        """}
683         \textcolor{keywordflow}{return} self.model.encode\_dia\_y(cands)
684 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af50200b087a797a01b5e5ccdd1be63ba}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af50200b087a797a01b5e5ccdd1be63ba}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!eval\+\_\+step@{eval\+\_\+step}}
\index{eval\+\_\+step@{eval\+\_\+step}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{eval\+\_\+step()}{eval\_step()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+eval\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 438 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
438     \textcolor{keyword}{def }eval\_step(self, batch):
439         \textcolor{keywordflow}{if} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
440             \textcolor{keywordflow}{return}
441 
442         self.model.eval()
443 
444         batchsize = batch.text\_vec.size(0)
445         self.metrics[\textcolor{stringliteral}{'examples'}] += batchsize
446 
447         \textcolor{keywordflow}{if} self.subtask == \textcolor{stringliteral}{'dialog'}:
448             \_, preds, cand\_ranked = self.dialog\_step(batch)
449             \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'interactive'}]:
450                 \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'prev\_response\_filter'}]:
451                     preds = self.check\_prev\_response(preds, cand\_ranked)
452                 \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds)
453             \textcolor{keywordflow}{else}:
454                 \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds, cand\_ranked)
455 
456         \textcolor{keywordflow}{elif} self.subtask == \textcolor{stringliteral}{'feedback'}:
457             \_, preds, cand\_ranked = self.feedback\_step(batch)
458             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds, cand\_ranked)
459 
460         \textcolor{keywordflow}{elif} self.subtask == \textcolor{stringliteral}{'satisfaction'}:
461             \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'uncertainty\_predictor'}]:
462                 \textcolor{comment}{# Use uncertainty of dialog model to classify bot's previous utterance}
463                 preds = self.predict\_satisfaction\_by\_uncertainty(batch)
464             \textcolor{keywordflow}{else}:
465                 \textcolor{comment}{# Use satisfaction of user response to classify bot's previous response}
466                 \_, preds = self.satisfaction\_step(batch)
467             preds = [\hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(p) \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} preds]
468             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds)
469 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a9c1c1e9435e1b56420fee71a31c5d57e}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a9c1c1e9435e1b56420fee71a31c5d57e}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!extract\+\_\+rating@{extract\+\_\+rating}}
\index{extract\+\_\+rating@{extract\+\_\+rating}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{extract\+\_\+rating()}{extract\_rating()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+extract\+\_\+rating (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert user response to rating request from text to an integer rating.
\end{DoxyVerb}
 

Definition at line 716 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
716     \textcolor{keyword}{def }extract\_rating(self):
717         \textcolor{stringliteral}{"""}
718 \textcolor{stringliteral}{        Convert user response to rating request from text to an integer rating.}
719 \textcolor{stringliteral}{        """}
720         \textcolor{comment}{# TODO: Make this more robust!}
721         \textcolor{keywordflow}{if} self.last\_rating == \textcolor{stringliteral}{'positive'}:
722             \textcolor{keywordflow}{return} 1
723         \textcolor{keywordflow}{elif} self.last\_rating == \textcolor{stringliteral}{'negative'}:
724             \textcolor{keywordflow}{return} -1
725         \textcolor{keywordflow}{else}:
726             \textcolor{keywordflow}{return} 0
727 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ae98cf6c1345c3cff3278339ef1c855a4}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ae98cf6c1345c3cff3278339ef1c855a4}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!feedback\+\_\+step@{feedback\+\_\+step}}
\index{feedback\+\_\+step@{feedback\+\_\+step}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{feedback\+\_\+step()}{feedback\_step()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+feedback\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 519 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
519     \textcolor{keyword}{def }feedback\_step(self, batch):
520         batchsize = batch.text\_vec.size(0)
521 
522         \hyperlink{namespaceparlai_1_1utils_1_1misc_a884a3aefa90581f53bc592fa6a78dc43}{warn\_once}(\textcolor{stringliteral}{"WARNING: feedback candidates are hardcoded to batch"})
523         \textcolor{keywordflow}{if} self.model.training:
524             cands, cand\_vecs, label\_inds = self.\_build\_candidates(
525                 batch, source=\textcolor{stringliteral}{'batch'}, mode=\textcolor{stringliteral}{'train'}
526             )
527         \textcolor{keywordflow}{else}:
528             cands, cand\_vecs, label\_inds = self.\_build\_candidates(
529                 batch, source=\textcolor{stringliteral}{'batch'}, mode=\textcolor{stringliteral}{'eval'}
530             )
531 
532         scores = self.model.score\_feedback(batch.text\_vec, cand\_vecs)
533         \_, ranks = scores.sort(1, descending=\textcolor{keyword}{True})
534 
535         \textcolor{keywordflow}{if} self.model.training:
536             \textcolor{comment}{# Get predictions but not full rankings for the sake of speed}
537             cand\_ranked = \textcolor{keywordtype}{None}
538             preds = [cands[ordering[0]] \textcolor{keywordflow}{for} ordering \textcolor{keywordflow}{in} ranks]
539         \textcolor{keywordflow}{else}:
540             \textcolor{comment}{# Return full rankings to calculate hits@ metrics}
541             cand\_ranked = []
542             \textcolor{keywordflow}{for} ordering \textcolor{keywordflow}{in} ranks:
543                 cand\_ranked.append([cands[rank] \textcolor{keywordflow}{for} rank \textcolor{keywordflow}{in} ordering])
544             preds = [cand\_ranked[i][0] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(batchsize)]
545 
546         \textcolor{keywordflow}{if} label\_inds \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
547             loss = \textcolor{keywordtype}{None}
548         \textcolor{keywordflow}{else}:
549             loss = self.criterion(scores, label\_inds)
550             self.update\_fee\_metrics(loss, ranks, label\_inds, batchsize)
551         \textcolor{keywordflow}{return} loss, preds, cand\_ranked
552 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa6011af735a855f23a7630f464abbd9a}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa6011af735a855f23a7630f464abbd9a}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!load@{load}}
\index{load@{load}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{load()}{load()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+load (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return opt and model states.

Overriding TorchAgent.load() to enable partial loading
\end{DoxyVerb}
 

Definition at line 835 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
835     \textcolor{keyword}{def }load(self, path):
836         \textcolor{stringliteral}{"""}
837 \textcolor{stringliteral}{        Return opt and model states.}
838 \textcolor{stringliteral}{}
839 \textcolor{stringliteral}{        Overriding TorchAgent.load() to enable partial loading}
840 \textcolor{stringliteral}{        """}
841         states = torch.load(path, map\_location=\textcolor{keyword}{lambda} cpu, \_: cpu)
842         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'model'} \textcolor{keywordflow}{in} states:
843             \textcolor{keywordflow}{try}:
844                 self.model.load\_state\_dict(states[\textcolor{stringliteral}{'model'}])
845             \textcolor{keywordflow}{except} RuntimeError \textcolor{keyword}{as} e:
846                 \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'partial\_load'}]:
847                     print(
848                         \textcolor{stringliteral}{"WARNING: could not load entire --init-model; "}
849                         \textcolor{stringliteral}{"loading partially instead."}
850                     )
851                     pretrained\_state = states[\textcolor{stringliteral}{'model'}]
852                     current\_state = self.model.state\_dict()
853                     \textcolor{comment}{# 1. filter out unnecessary keys}
854                     pretrained\_dict = \{
855                         k: v \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} pretrained\_state.items() \textcolor{keywordflow}{if} k \textcolor{keywordflow}{in} current\_state
856                     \}
857                     \textcolor{comment}{# 2. overwrite entries in the existing state dict}
858                     current\_state.update(pretrained\_dict)
859                     \textcolor{comment}{# 3. load the new state dict}
860                     self.model.load\_state\_dict(current\_state)
861                 \textcolor{keywordflow}{else}:
862                     \textcolor{keywordflow}{raise} Exception(
863                         f\textcolor{stringliteral}{"The designated model could not be loaded. "}
864                         f\textcolor{stringliteral}{"Consider using --partial-load=True.\(\backslash\)n \{e\}"}
865                     )
866 
867         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'optimizer'} \textcolor{keywordflow}{in} states \textcolor{keywordflow}{and} hasattr(self, \textcolor{stringliteral}{'optimizer'}):
868             self.optimizer.load\_state\_dict(states[\textcolor{stringliteral}{'optimizer'}])
869         \textcolor{keywordflow}{return} states
870 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a57bd8a3eaeecc56d5df86c8bedc6d2d2}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a57bd8a3eaeecc56d5df86c8bedc6d2d2}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!make\+\_\+action@{make\+\_\+action}}
\index{make\+\_\+action@{make\+\_\+action}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{make\+\_\+action()}{make\_action()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+make\+\_\+action (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{text,  }\item[{}]{reward = {\ttfamily 0} }\end{DoxyParamCaption})}



Definition at line 789 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
789     \textcolor{keyword}{def }make\_action(self, text, reward=0):
790         action = \{\textcolor{stringliteral}{'id'}: self.id, \textcolor{stringliteral}{'text'}: text\}
791         \textcolor{keywordflow}{if} reward:
792             action[\textcolor{stringliteral}{'reward'}] = reward
793         \textcolor{keywordflow}{return} action
794 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a65e172c7c2dff330e0a92ce361acdc45}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a65e172c7c2dff330e0a92ce361acdc45}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!make\+\_\+feedback\+\_\+request@{make\+\_\+feedback\+\_\+request}}
\index{make\+\_\+feedback\+\_\+request@{make\+\_\+feedback\+\_\+request}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{make\+\_\+feedback\+\_\+request()}{make\_feedback\_request()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+make\+\_\+feedback\+\_\+request (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 795 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
795     \textcolor{keyword}{def }make\_feedback\_request(self):
796         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'Oops! I think I messed up. '} \textcolor{stringliteral}{'What could I have said instead?'}
797 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa97b64df930c600bd7be1b69779849e7}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa97b64df930c600bd7be1b69779849e7}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!make\+\_\+rating\+\_\+request@{make\+\_\+rating\+\_\+request}}
\index{make\+\_\+rating\+\_\+request@{make\+\_\+rating\+\_\+request}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{make\+\_\+rating\+\_\+request()}{make\_rating\_request()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+make\+\_\+rating\+\_\+request (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 798 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
798     \textcolor{keyword}{def }make\_rating\_request(self):
799         \textcolor{keywordflow}{return} RAT\_REQUEST
800 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a0c79b5c366eded0b21f90674837d6d93}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a0c79b5c366eded0b21f90674837d6d93}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!make\+\_\+rating\+\_\+response@{make\+\_\+rating\+\_\+response}}
\index{make\+\_\+rating\+\_\+response@{make\+\_\+rating\+\_\+response}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{make\+\_\+rating\+\_\+response()}{make\_rating\_response()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+make\+\_\+rating\+\_\+response (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{rating }\end{DoxyParamCaption})}



Definition at line 801 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
801     \textcolor{keyword}{def }make\_rating\_response(self, rating):
802         action = super().act()
803         reply = \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(action[\textcolor{stringliteral}{'text'}])
804         action[\textcolor{stringliteral}{'reward'}] = rating
805         last\_message = self.history.history\_strings[-1]
806         \textcolor{keywordflow}{if} rating == 0:
807             action[\textcolor{stringliteral}{'text'}] = f\textcolor{stringliteral}{'Okay, thanks! \{CONTINUE\} ("\{last\_message\}"): \{reply\}'}
808         \textcolor{keywordflow}{elif} rating == 1:
809             action[\textcolor{stringliteral}{'text'}] = f\textcolor{stringliteral}{'Great, thanks! \{CONTINUE\} ("\{last\_message\}"): \{reply\}'}
810         \textcolor{keywordflow}{return} action, reply
811 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a083d8cde4e9351b2f41c52a6205fe92b}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a083d8cde4e9351b2f41c52a6205fe92b}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!observe@{observe}}
\index{observe@{observe}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{observe()}{observe()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+observe (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observation }\end{DoxyParamCaption})}

\begin{DoxyVerb}Add to history, concatenate history-size utterances, and add person tokens.
\end{DoxyVerb}
 

Definition at line 363 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
363     \textcolor{keyword}{def }observe(self, observation):
364         \textcolor{stringliteral}{"""}
365 \textcolor{stringliteral}{        Add to history, concatenate history-size utterances, and add person tokens.}
366 \textcolor{stringliteral}{        """}
367 
368         \textcolor{comment}{# If their response is a response to a rating request, no work required}
369         \textcolor{keywordflow}{if} self.status == RATING\_REQUESTED:
370             self.last\_rating = observation[\textcolor{stringliteral}{'text'}]
371 
372         \textcolor{keywordflow}{return} super().observe(observation)
373 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abf84c3ae5ee4a7f80dfe3e441ad170b2}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abf84c3ae5ee4a7f80dfe3e441ad170b2}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!predict\+\_\+satisfaction@{predict\+\_\+satisfaction}}
\index{predict\+\_\+satisfaction@{predict\+\_\+satisfaction}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{predict\+\_\+satisfaction()}{predict\_satisfaction()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+predict\+\_\+satisfaction (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observation }\end{DoxyParamCaption})}



Definition at line 728 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
728     \textcolor{keyword}{def }predict\_satisfaction(self, observation):
729         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'regex'}]:
730             prob = self.rating\_classifier.predict\_proba(observation[\textcolor{stringliteral}{'text\_vec'}])
731         \textcolor{keywordflow}{else}:
732             prob = self.model.score\_satisfaction(observation[\textcolor{stringliteral}{'text\_vec'}].reshape(1, -1))
733         \textcolor{keywordflow}{return} prob.item()
734 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a2788bb764560c9d021ac0b8a5596e1e0}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a2788bb764560c9d021ac0b8a5596e1e0}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty@{predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty}}
\index{predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty@{predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty()}{predict\_satisfaction\_by\_uncertainty()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 735 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
735     \textcolor{keyword}{def }predict\_satisfaction\_by\_uncertainty(self, batch):
736         \textcolor{comment}{# Use the dialog model's confidence to predict the rating on previous response}
737         \textcolor{comment}{# HACK: this test is run using a model that was trained on dialog but is now}
738         \textcolor{comment}{# being evaluated on satisfaction. We use a satisfaction dataset so that we have}
739         \textcolor{comment}{# access to the satisfaction labels. Therefore, we do a sloppy hack here to pull}
740         \textcolor{comment}{# out what would have been the candidates for the dialog task. We use histsz=4}
741         \textcolor{comment}{# and ignore the last response (the user's feedback) and use the penultimate}
742         \textcolor{comment}{# utterances as the candidates. The (up to) two utterances before that are}
743         \textcolor{comment}{# context.}
744 
745         \textcolor{comment}{# pull out dialog candidates from text\_vecs since this is a satisfaction task}
746         \textcolor{keyword}{assert} self.opt[\textcolor{stringliteral}{'history\_size'}] > 2
747         text\_vecs = []
748         cand\_vecs = []
749         \textcolor{keywordflow}{for} vec \textcolor{keywordflow}{in} batch.text\_vec:
750             last\_p1 = (vec == self.dict.txt2vec(\textcolor{stringliteral}{'\_\_p1\_\_'})[0]).nonzero()[-1].item()
751             last\_p2 = (vec == self.dict.txt2vec(\textcolor{stringliteral}{'\_\_p2\_\_'})[0]).nonzero()[-1].item()
752             text\_vecs.append(vec[:last\_p2])
753             cand\_vecs.append(vec[last\_p2 + 1 : last\_p1])
754         text\_padded, \_ = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1_adb5a414ae439f14c54e8c760b91cc4c8}{padded\_tensor}(text\_vecs)
755         cand\_padded, \_ = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1_adb5a414ae439f14c54e8c760b91cc4c8}{padded\_tensor}(cand\_vecs)
756         scores = self.model.score\_dialog(text\_padded, cand\_padded)
757         confidences = F.softmax(scores, dim=1).cpu().detach().numpy()
758 
759         preds = []
760         \textcolor{keywordflow}{for} example \textcolor{keywordflow}{in} confidences:
761             ranked\_confidences = sorted(list(example), reverse=\textcolor{keyword}{True})
762             \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'uncertainty\_style'}] == \textcolor{stringliteral}{'mag'}:
763                 \textcolor{comment}{# If the most confident choice isn't confident enough, predict that}
764                 \textcolor{comment}{# the response the bot gives will be bad (pred=0)}
765                 mag = ranked\_confidences[0]
766                 preds.append(mag > self.opt[\textcolor{stringliteral}{'uncertainty\_threshold'}])
767             \textcolor{keywordflow}{elif} self.opt[\textcolor{stringliteral}{'uncertainty\_style'}] == \textcolor{stringliteral}{'gap'}:
768                 \textcolor{comment}{# If the gap between the first and second most confident choices isn't}
769                 \textcolor{comment}{# large enough, predict that the response the bot gives will be bad}
770                 \textcolor{comment}{# (pred=0)}
771                 gap = ranked\_confidences[0] - ranked\_confidences[1]
772                 preds.append(gap > self.opt[\textcolor{stringliteral}{'uncertainty\_threshold'}])
773 
774         loss = torch.tensor(0)
775         preds = torch.LongTensor(preds)
776         labels = torch.LongTensor([\hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(l) == 1 \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} batch.labels])
777         batchsize = len(labels)
778         self.update\_sat\_metrics(loss, preds, labels, batchsize)
779         \textcolor{keywordflow}{return} preds
780 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a456725f7e04d7452bd14f733fb3cea35}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a456725f7e04d7452bd14f733fb3cea35}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!report@{report}}
\index{report@{report}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{report()}{report()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+report (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Report metrics from model's perspective.
\end{DoxyVerb}
 

Definition at line 635 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
635     \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1convai2_1_1eval__f1_a01a47b9c08dad189837a51f085defc45}{report}(self):
636         \textcolor{stringliteral}{"""}
637 \textcolor{stringliteral}{        Report metrics from model's perspective.}
638 \textcolor{stringliteral}{        """}
639         m = TorchAgent.report(self)  \textcolor{comment}{# Skip TorchRankerAgent; totally redundant}
640         examples = self.metrics[\textcolor{stringliteral}{'examples'}]
641         \textcolor{keywordflow}{if} examples > 0:
642             m[\textcolor{stringliteral}{'examples'}] = examples
643             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'dialog'} \textcolor{keywordflow}{in} self.subtasks \textcolor{keywordflow}{and} self.metrics[\textcolor{stringliteral}{'dia\_exs'}] > 0:
644                 m[\textcolor{stringliteral}{'dia\_loss'}] = self.metrics[\textcolor{stringliteral}{'dia\_loss'}] / self.metrics[\textcolor{stringliteral}{'dia\_exs'}]
645                 m[\textcolor{stringliteral}{'dia\_rank'}] = self.metrics[\textcolor{stringliteral}{'dia\_rank'}] / self.metrics[\textcolor{stringliteral}{'dia\_exs'}]
646                 m[\textcolor{stringliteral}{'dia\_acc'}] = self.metrics[\textcolor{stringliteral}{'dia\_correct'}] / self.metrics[\textcolor{stringliteral}{'dia\_exs'}]
647                 m[\textcolor{stringliteral}{'dia\_exs'}] = self.metrics[\textcolor{stringliteral}{'dia\_exs'}]
648             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'feedback'} \textcolor{keywordflow}{in} self.subtasks \textcolor{keywordflow}{and} self.metrics[\textcolor{stringliteral}{'fee\_exs'}] > 0:
649                 m[\textcolor{stringliteral}{'fee\_loss'}] = self.metrics[\textcolor{stringliteral}{'fee\_loss'}] / self.metrics[\textcolor{stringliteral}{'fee\_exs'}]
650                 m[\textcolor{stringliteral}{'fee\_rank'}] = self.metrics[\textcolor{stringliteral}{'fee\_rank'}] / self.metrics[\textcolor{stringliteral}{'fee\_exs'}]
651                 m[\textcolor{stringliteral}{'fee\_acc'}] = self.metrics[\textcolor{stringliteral}{'fee\_correct'}] / self.metrics[\textcolor{stringliteral}{'fee\_exs'}]
652                 m[\textcolor{stringliteral}{'fee\_exs'}] = self.metrics[\textcolor{stringliteral}{'fee\_exs'}]
653                 m[\textcolor{stringliteral}{'fee\_exs'}] = self.metrics[\textcolor{stringliteral}{'fee\_exs'}]
654             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'satisfaction'} \textcolor{keywordflow}{in} self.subtasks \textcolor{keywordflow}{and} self.metrics[\textcolor{stringliteral}{'sat\_exs'}] > 0:
655                 tp = self.metrics[\textcolor{stringliteral}{'sat\_tp'}]
656                 tn = self.metrics[\textcolor{stringliteral}{'sat\_tn'}]
657                 fp = self.metrics[\textcolor{stringliteral}{'sat\_fp'}]
658                 fn = self.metrics[\textcolor{stringliteral}{'sat\_fn'}]
659                 \textcolor{keyword}{assert} tp + tn + fp + fn == self.metrics[\textcolor{stringliteral}{'sat\_exs'}]
660                 m[\textcolor{stringliteral}{'sat\_loss'}] = self.metrics[\textcolor{stringliteral}{'sat\_loss'}] / self.metrics[\textcolor{stringliteral}{'sat\_exs'}]
661                 m[\textcolor{stringliteral}{'sat\_pr'}] = tp / (tp + fp + EPS)
662                 m[\textcolor{stringliteral}{'sat\_re'}] = tp / (tp + fn + EPS)
663                 pr = m[\textcolor{stringliteral}{'sat\_pr'}]
664                 re = m[\textcolor{stringliteral}{'sat\_re'}]
665                 m[\textcolor{stringliteral}{'sat\_f1'}] = (2 * pr * re) / (pr + re) \textcolor{keywordflow}{if} (pr \textcolor{keywordflow}{and} re) \textcolor{keywordflow}{else} 0.0
666                 m[\textcolor{stringliteral}{'sat\_acc'}] = (tp + tn) / self.metrics[\textcolor{stringliteral}{'sat\_exs'}]
667                 m[\textcolor{stringliteral}{'sat\_exs'}] = self.metrics[\textcolor{stringliteral}{'sat\_exs'}]
668         \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} m.items():
669             \textcolor{comment}{# clean up: rounds to sigfigs and converts tensors to floats}
670             \textcolor{keywordflow}{if} isinstance(v, float):
671                 m[k] = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}{round\_sigfigs}(v, 4)
672             \textcolor{keywordflow}{else}:
673                 m[k] = v
674         \textcolor{keywordflow}{return} m
675 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa94174029fa282fd301ae01ea2ac90de}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa94174029fa282fd301ae01ea2ac90de}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!reset@{reset}}
\index{reset@{reset}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+reset (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 607 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
607     \textcolor{keyword}{def }reset(self):
608         super().reset()
609         self.requested\_rating = \textcolor{keyword}{False}
610 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ada3fee611be323fc660f634f7e33d83e}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ada3fee611be323fc660f634f7e33d83e}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!reset\+\_\+metrics@{reset\+\_\+metrics}}
\index{reset\+\_\+metrics@{reset\+\_\+metrics}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{reset\+\_\+metrics()}{reset\_metrics()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+reset\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Reset metrics.
\end{DoxyVerb}
 

Definition at line 611 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
611     \textcolor{keyword}{def }reset\_metrics(self):
612         \textcolor{stringliteral}{"""}
613 \textcolor{stringliteral}{        Reset metrics.}
614 \textcolor{stringliteral}{        """}
615         super().reset\_metrics()
616         self.metrics[\textcolor{stringliteral}{'examples'}] = 0
617         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'dialog'} \textcolor{keywordflow}{in} self.subtasks:
618             self.metrics[\textcolor{stringliteral}{'dia\_exs'}] = 0
619             self.metrics[\textcolor{stringliteral}{'dia\_loss'}] = 0.0
620             self.metrics[\textcolor{stringliteral}{'dia\_rank'}] = 0
621             self.metrics[\textcolor{stringliteral}{'dia\_correct'}] = 0
622         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'feedback'} \textcolor{keywordflow}{in} self.subtasks:
623             self.metrics[\textcolor{stringliteral}{'fee\_exs'}] = 0
624             self.metrics[\textcolor{stringliteral}{'fee\_loss'}] = 0.0
625             self.metrics[\textcolor{stringliteral}{'fee\_rank'}] = 0
626             self.metrics[\textcolor{stringliteral}{'fee\_correct'}] = 0.0
627         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'satisfaction'} \textcolor{keywordflow}{in} self.subtasks:
628             self.metrics[\textcolor{stringliteral}{'sat\_exs'}] = 0
629             self.metrics[\textcolor{stringliteral}{'sat\_loss'}] = 0
630             self.metrics[\textcolor{stringliteral}{'sat\_tp'}] = 0
631             self.metrics[\textcolor{stringliteral}{'sat\_fp'}] = 0
632             self.metrics[\textcolor{stringliteral}{'sat\_tn'}] = 0
633             self.metrics[\textcolor{stringliteral}{'sat\_fn'}] = 0
634 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4e504bd6e7179930122bcec4a658e30f}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4e504bd6e7179930122bcec4a658e30f}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!satisfaction\+\_\+step@{satisfaction\+\_\+step}}
\index{satisfaction\+\_\+step@{satisfaction\+\_\+step}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{satisfaction\+\_\+step()}{satisfaction\_step()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+satisfaction\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 553 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
553     \textcolor{keyword}{def }satisfaction\_step(self, batch):
554         batchsize = batch.text\_vec.size(0)
555         \textcolor{comment}{# probs is a [batchsize] torch.FloatTensor with values in [0, 1]}
556         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'regex'}]:
557             contexts = [self.dict.vec2txt(vec) \textcolor{keywordflow}{for} vec \textcolor{keywordflow}{in} batch.text\_vec]
558             \textcolor{comment}{# HACK: --use-cuda flag}
559             probs = self.rating\_classifier.predict\_proba(contexts).cuda()
560         \textcolor{keywordflow}{else}:
561             probs = self.model.score\_satisfaction(batch.text\_vec)
562         \textcolor{comment}{# preds is a [batchsize] torch.LongTensor with values in \{0, 1\}}
563         preds = (probs > self.opt[\textcolor{stringliteral}{'rating\_threshold'}]).long()
564 
565         \textcolor{keywordflow}{if} batch.labels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:  \textcolor{comment}{# TODO: not sure if it's None, list of Nones, etc.}
566             loss = \textcolor{keywordtype}{None}
567         \textcolor{keywordflow}{else}:
568             \textcolor{comment}{# labels will be a [batchsize] torch.LongTensor with values in \{0, 1\}}
569             labels = torch.LongTensor([\hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(l) == 1 \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} batch.labels]).cuda()
570 
571             loss = self.satisfaction\_criterion(probs, labels.float())
572             self.update\_sat\_metrics(loss, preds, labels, batchsize)
573 
574         \textcolor{keywordflow}{return} loss, preds
575 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad0e1cbdcc32b0c50e15de866efd963f3}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad0e1cbdcc32b0c50e15de866efd963f3}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!set\+\_\+subtasks@{set\+\_\+subtasks}}
\index{set\+\_\+subtasks@{set\+\_\+subtasks}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{set\+\_\+subtasks()}{set\_subtasks()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+set\+\_\+subtasks (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 812 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
812     \textcolor{keyword}{def }set\_subtasks(self, opt):
813         \textcolor{comment}{# Find assigned subtasks}
814         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'subtasks'}, \textcolor{keywordtype}{None}):
815             \textcolor{comment}{# First check if it was passed explicitly as a flag or otherwise in opt}
816             \textcolor{keywordflow}{if} isinstance(opt[\textcolor{stringliteral}{'subtasks'}], list):
817                 subtasks = opt[\textcolor{stringliteral}{'subtasks'}]
818             \textcolor{keywordflow}{else}:
819                 subtasks = opt[\textcolor{stringliteral}{'subtasks'}].split(\textcolor{stringliteral}{','})
820         \textcolor{keywordflow}{else}:
821             \textcolor{comment}{# Otherwise, try to infer from the task name.}
822             subtasks = [task.split(\textcolor{stringliteral}{':'})[1] \textcolor{keywordflow}{for} task \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'task'}].split(\textcolor{stringliteral}{','})]
823 
824         \textcolor{comment}{# Expand any abbreviations}
825         \textcolor{keywordflow}{if} subtasks[0] == \textcolor{stringliteral}{'diafee'}:
826             subtasks = [\textcolor{stringliteral}{'dialog'}, \textcolor{stringliteral}{'feedback'}]
827         \textcolor{keywordflow}{elif} subtasks[0] == \textcolor{stringliteral}{'diasat'}:
828             subtasks = [\textcolor{stringliteral}{'dialog'}, \textcolor{stringliteral}{'satisfaction'}]
829         \textcolor{keywordflow}{elif} subtasks[0] == \textcolor{stringliteral}{'all'}:
830             subtasks = [\textcolor{stringliteral}{'dialog'}, \textcolor{stringliteral}{'feedback'}, \textcolor{stringliteral}{'satisfaction'}]
831 
832         self.subtasks = subtasks
833         opt[\textcolor{stringliteral}{'subtasks'}] = subtasks  \textcolor{comment}{# Add to opt so that model module can see the list}
834 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa650efc924cd97c7ac6303fad46aeee6}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa650efc924cd97c7ac6303fad46aeee6}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!train\+\_\+step@{train\+\_\+step}}
\index{train\+\_\+step@{train\+\_\+step}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{train\+\_\+step()}{train\_step()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+train\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}Train on a single batch of examples.
\end{DoxyVerb}
 

Definition at line 409 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
409     \textcolor{keyword}{def }train\_step(self, batch):
410         \textcolor{stringliteral}{"""}
411 \textcolor{stringliteral}{        Train on a single batch of examples.}
412 \textcolor{stringliteral}{        """}
413         \textcolor{keywordflow}{if} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
414             \textcolor{keywordflow}{return}
415 
416         self.model.\hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a36a5f4f6f9df0611a6818610518d2cf0}{train}()
417         self.optimizer.zero\_grad()
418 
419         batchsize = batch.text\_vec.size(0)
420         self.metrics[\textcolor{stringliteral}{'examples'}] += batchsize
421 
422         \textcolor{keywordflow}{if} self.subtask == \textcolor{stringliteral}{'dialog'}:
423             loss, preds, \_ = self.dialog\_step(batch)
424         \textcolor{keywordflow}{elif} self.subtask == \textcolor{stringliteral}{'feedback'}:
425             loss, preds, \_ = self.feedback\_step(batch)
426         \textcolor{keywordflow}{elif} self.subtask == \textcolor{stringliteral}{'satisfaction'}:
427             loss, preds = self.satisfaction\_step(batch)
428             preds = [\hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(p) \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} preds]
429 
430         \textcolor{comment}{# Weight loss by task-weight}
431         loss *= self.task\_weight[self.subtask]
432 
433         loss.backward()
434         self.update\_params()
435 
436         \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds)
437 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a6891c2c3b9782cc190dad6f3f89c8390}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a6891c2c3b9782cc190dad6f3f89c8390}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!update\+\_\+dia\+\_\+metrics@{update\+\_\+dia\+\_\+metrics}}
\index{update\+\_\+dia\+\_\+metrics@{update\+\_\+dia\+\_\+metrics}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{update\+\_\+dia\+\_\+metrics()}{update\_dia\_metrics()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+update\+\_\+dia\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{loss,  }\item[{}]{ranks,  }\item[{}]{label\+\_\+inds,  }\item[{}]{batchsize }\end{DoxyParamCaption})}



Definition at line 576 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
576     \textcolor{keyword}{def }update\_dia\_metrics(self, loss, ranks, label\_inds, batchsize):
577         self.metrics[\textcolor{stringliteral}{'dia\_exs'}] += batchsize
578         self.metrics[\textcolor{stringliteral}{'dia\_loss'}] += loss.item()
579         \textcolor{keywordflow}{if} label\_inds \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
580             \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} range(batchsize):
581                 rank = (ranks[b] == label\_inds[b]).nonzero().item()
582                 self.metrics[\textcolor{stringliteral}{'dia\_rank'}] += 1 + rank
583                 self.metrics[\textcolor{stringliteral}{'dia\_correct'}] += rank == 0
584 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a39ce3bfde7b4bcf692133012a7a3bcbc}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a39ce3bfde7b4bcf692133012a7a3bcbc}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!update\+\_\+fee\+\_\+metrics@{update\+\_\+fee\+\_\+metrics}}
\index{update\+\_\+fee\+\_\+metrics@{update\+\_\+fee\+\_\+metrics}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{update\+\_\+fee\+\_\+metrics()}{update\_fee\_metrics()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+update\+\_\+fee\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{loss,  }\item[{}]{ranks,  }\item[{}]{label\+\_\+inds,  }\item[{}]{batchsize }\end{DoxyParamCaption})}



Definition at line 585 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
585     \textcolor{keyword}{def }update\_fee\_metrics(self, loss, ranks, label\_inds, batchsize):
586         self.metrics[\textcolor{stringliteral}{'fee\_exs'}] += batchsize
587         self.metrics[\textcolor{stringliteral}{'fee\_loss'}] += loss.item()
588         \textcolor{keywordflow}{if} label\_inds \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
589             \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} range(batchsize):
590                 rank = (ranks[b] == label\_inds[b]).nonzero().item()
591                 self.metrics[\textcolor{stringliteral}{'fee\_rank'}] += 1 + rank
592                 self.metrics[\textcolor{stringliteral}{'fee\_correct'}] += rank == 0
593 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab41a6e0b9f7ba0163ebb1152eadfdeb1}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab41a6e0b9f7ba0163ebb1152eadfdeb1}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!update\+\_\+sat\+\_\+metrics@{update\+\_\+sat\+\_\+metrics}}
\index{update\+\_\+sat\+\_\+metrics@{update\+\_\+sat\+\_\+metrics}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{update\+\_\+sat\+\_\+metrics()}{update\_sat\_metrics()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+update\+\_\+sat\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{loss,  }\item[{}]{preds,  }\item[{}]{labels,  }\item[{}]{batchsize }\end{DoxyParamCaption})}



Definition at line 594 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
594     \textcolor{keyword}{def }update\_sat\_metrics(self, loss, preds, labels, batchsize):
595         \textcolor{comment}{# tp/fp/tn/fn are w/r/t the rarer class (negative responses)}
596         self.metrics[\textcolor{stringliteral}{'sat\_exs'}] += batchsize
597         self.metrics[\textcolor{stringliteral}{'sat\_loss'}] += loss.item()
598         a = self.opt[\textcolor{stringliteral}{'target\_class'}]
599         b = \textcolor{keywordflow}{not} self.opt[\textcolor{stringliteral}{'target\_class'}]
600         \textcolor{keyword}{assert} a \textcolor{keywordflow}{in} [0, 1]
601         \textcolor{keyword}{assert} b \textcolor{keywordflow}{in} [0, 1]
602         self.metrics[\textcolor{stringliteral}{'sat\_tp'}] += ((preds == labels) * (labels == a)).sum().item()
603         self.metrics[\textcolor{stringliteral}{'sat\_fp'}] += ((preds != labels) * (labels == b)).sum().item()
604         self.metrics[\textcolor{stringliteral}{'sat\_tn'}] += ((preds == labels) * (labels == b)).sum().item()
605         self.metrics[\textcolor{stringliteral}{'sat\_fn'}] += ((preds != labels) * (labels == a)).sum().item()
606 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a89a2bb3f299fe29c018ea39af72446c6}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a89a2bb3f299fe29c018ea39af72446c6}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!upgrade\+\_\+opt@{upgrade\+\_\+opt}}
\index{upgrade\+\_\+opt@{upgrade\+\_\+opt}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{upgrade\+\_\+opt()}{upgrade\_opt()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+upgrade\+\_\+opt (\begin{DoxyParamCaption}\item[{}]{cls,  }\item[{}]{opt\+\_\+on\+\_\+disk }\end{DoxyParamCaption})}

\begin{DoxyVerb}Upgrade opts from older model files.
\end{DoxyVerb}
 

Definition at line 284 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
284     \textcolor{keyword}{def }upgrade\_opt(cls, opt\_on\_disk):
285         \textcolor{stringliteral}{"""}
286 \textcolor{stringliteral}{        Upgrade opts from older model files.}
287 \textcolor{stringliteral}{        """}
288         super(SelfFeedingAgent, cls).upgrade\_opt(opt\_on\_disk)
289 
290         \textcolor{comment}{# 2019-06-25: previous versions of the model did not add a CLS token}
291         \textcolor{comment}{# to the beginning of text\_vec.}
292         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'add\_double\_person\_tokens'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt\_on\_disk:
293             \hyperlink{namespaceparlai_1_1utils_1_1misc_a884a3aefa90581f53bc592fa6a78dc43}{warn\_once}(\textcolor{stringliteral}{'Old model: overriding `add\_double\_person\_tokens` to True.'})
294             opt\_on\_disk[\textcolor{stringliteral}{'add\_double\_person\_tokens'}] = \textcolor{keyword}{True}
295 
296         \textcolor{keywordflow}{return} opt\_on\_disk
297 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a02d034bc0c9208fb3d6561b90f176ddf}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a02d034bc0c9208fb3d6561b90f176ddf}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!eval\+\_\+candidates@{eval\+\_\+candidates}}
\index{eval\+\_\+candidates@{eval\+\_\+candidates}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{eval\+\_\+candidates}{eval\_candidates}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+eval\+\_\+candidates}



Definition at line 486 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4f3aa2b94dedfa052d15e80e046070d4}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4f3aa2b94dedfa052d15e80e046070d4}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!last\+\_\+rating@{last\+\_\+rating}}
\index{last\+\_\+rating@{last\+\_\+rating}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{last\+\_\+rating}{last\_rating}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+last\+\_\+rating}



Definition at line 370 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a810afc1857cbf598661e845ee00c0483}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a810afc1857cbf598661e845ee00c0483}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!model@{model}}
\index{model@{model}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{model}{model}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+model}



Definition at line 300 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59261a9ada05e97b6b9e9f10c193e9b7}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59261a9ada05e97b6b9e9f10c193e9b7}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!multitask@{multitask}}
\index{multitask@{multitask}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{multitask}{multitask}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+multitask}



Definition at line 233 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a30211c1fec9722594aca49c18670c711}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a30211c1fec9722594aca49c18670c711}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!prev\+\_\+response@{prev\+\_\+response}}
\index{prev\+\_\+response@{prev\+\_\+response}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{prev\+\_\+response}{prev\_response}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+prev\+\_\+response}



Definition at line 254 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a27184d7df8f89fd0643b4973674826d7}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a27184d7df8f89fd0643b4973674826d7}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!prev\+\_\+responses@{prev\+\_\+responses}}
\index{prev\+\_\+responses@{prev\+\_\+responses}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{prev\+\_\+responses}{prev\_responses}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+prev\+\_\+responses}



Definition at line 245 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ace46abbade806237aef24a58a76d554f}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ace46abbade806237aef24a58a76d554f}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!rating\+\_\+classifier@{rating\+\_\+classifier}}
\index{rating\+\_\+classifier@{rating\+\_\+classifier}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{rating\+\_\+classifier}{rating\_classifier}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+rating\+\_\+classifier}



Definition at line 278 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a91168bac37bb10ada694c29d47039c35}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a91168bac37bb10ada694c29d47039c35}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!requested\+\_\+rating@{requested\+\_\+rating}}
\index{requested\+\_\+rating@{requested\+\_\+rating}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{requested\+\_\+rating}{requested\_rating}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+requested\+\_\+rating}



Definition at line 332 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad8190f0d70c2f3415e48d23252be3834}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad8190f0d70c2f3415e48d23252be3834}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!satisfaction\+\_\+criterion@{satisfaction\+\_\+criterion}}
\index{satisfaction\+\_\+criterion@{satisfaction\+\_\+criterion}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{satisfaction\+\_\+criterion}{satisfaction\_criterion}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+satisfaction\+\_\+criterion}



Definition at line 274 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59ba1da30dacc1c8c7a7a321d94c25d6}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59ba1da30dacc1c8c7a7a321d94c25d6}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!status@{status}}
\index{status@{status}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{status}{status}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+status}



Definition at line 258 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a25ee430dd49391cc8265f2a3e789bbf0}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a25ee430dd49391cc8265f2a3e789bbf0}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!subtask@{subtask}}
\index{subtask@{subtask}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{subtask}{subtask}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+subtask}



Definition at line 235 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a47fd708e2c3e2c5a5e48e32126543c8c}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a47fd708e2c3e2c5a5e48e32126543c8c}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!subtasks@{subtasks}}
\index{subtasks@{subtasks}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{subtasks}{subtasks}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+subtasks}



Definition at line 832 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab2d87eedf68d027424673ada89954fc1}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab2d87eedf68d027424673ada89954fc1}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!task\+\_\+weight@{task\+\_\+weight}}
\index{task\+\_\+weight@{task\+\_\+weight}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{task\+\_\+weight}{task\_weight}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+task\+\_\+weight}



Definition at line 266 of file self\+\_\+feeding\+\_\+agent.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
projects/self\+\_\+feeding/\hyperlink{self__feeding__agent_8py}{self\+\_\+feeding\+\_\+agent.\+py}\end{DoxyCompactItemize}
