\hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent}{}\section{projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent Class Reference}
\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent}\index{projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent@{projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent}}


Inheritance diagram for projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=280pt]{d6/d74/classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=318pt]{de/d2d/classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a22f9ef0ce5fb83da14d404296476ad0f}{add\+\_\+cmdline\+\_\+args} (cls, argparser)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abfcd542bf7b9c1fa8922d31459b12e2e}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1core_1_1torch__agent_1_1TorchAgent_a785bb920cf8c8afc3e9bf6a8b77e335a}{opt}, shared=None)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a89a2bb3f299fe29c018ea39af72446c6}{upgrade\+\_\+opt} (cls, opt\+\_\+on\+\_\+disk)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af80537d5c439bd9c475e252e533e24cc}{build\+\_\+model} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aeb85e03ea2d8dfebd9cb29d717bea763}{act} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a083d8cde4e9351b2f41c52a6205fe92b}{observe} (self, \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ac78fd692baee6b61bcf079b0a3d11cab}{observation})
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a72c574a9342e5cf9e268ad0cb7a1e721}{batchify} (self, observations)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa650efc924cd97c7ac6303fad46aeee6}{train\+\_\+step} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af50200b087a797a01b5e5ccdd1be63ba}{eval\+\_\+step} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a29d503e95d996bbe351fe860631c3162}{dialog\+\_\+step} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ae98cf6c1345c3cff3278339ef1c855a4}{feedback\+\_\+step} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4e504bd6e7179930122bcec4a658e30f}{satisfaction\+\_\+step} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a6891c2c3b9782cc190dad6f3f89c8390}{update\+\_\+dia\+\_\+metrics} (self, loss, ranks, label\+\_\+inds, batchsize)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a39ce3bfde7b4bcf692133012a7a3bcbc}{update\+\_\+fee\+\_\+metrics} (self, loss, ranks, label\+\_\+inds, batchsize)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab41a6e0b9f7ba0163ebb1152eadfdeb1}{update\+\_\+sat\+\_\+metrics} (self, loss, preds, labels, batchsize)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa94174029fa282fd301ae01ea2ac90de}{reset} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ada3fee611be323fc660f634f7e33d83e}{reset\+\_\+metrics} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a456725f7e04d7452bd14f733fb3cea35}{report} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a3208c69de4a2452cafa3d7feeec85218}{encode\+\_\+candidates} (self, cands)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a8d1ee3e56b88c0efaed910cc867970d3}{do\+\_\+request\+\_\+feedback} (self, positivity)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af0cd2239c4610157ac513163eb9437a3}{do\+\_\+request\+\_\+rating} (self, positivity)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a9c1c1e9435e1b56420fee71a31c5d57e}{extract\+\_\+rating} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abf84c3ae5ee4a7f80dfe3e441ad170b2}{predict\+\_\+satisfaction} (self, \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ac78fd692baee6b61bcf079b0a3d11cab}{observation})
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a2788bb764560c9d021ac0b8a5596e1e0}{predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty} (self, batch)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af23daff9436acdeadd63b74396870255}{check\+\_\+prev\+\_\+response} (self, preds, cand\+\_\+ranked)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a57bd8a3eaeecc56d5df86c8bedc6d2d2}{make\+\_\+action} (self, text, reward=0)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a65e172c7c2dff330e0a92ce361acdc45}{make\+\_\+feedback\+\_\+request} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa97b64df930c600bd7be1b69779849e7}{make\+\_\+rating\+\_\+request} (self)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a0c79b5c366eded0b21f90674837d6d93}{make\+\_\+rating\+\_\+response} (self, rating)
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad0e1cbdcc32b0c50e15de866efd963f3}{set\+\_\+subtasks} (self, \hyperlink{classparlai_1_1core_1_1torch__agent_1_1TorchAgent_a785bb920cf8c8afc3e9bf6a8b77e335a}{opt})
\item 
def \hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa6011af735a855f23a7630f464abbd9a}{load} (self, path)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59261a9ada05e97b6b9e9f10c193e9b7}{multitask}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a25ee430dd49391cc8265f2a3e789bbf0}{subtask}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a27184d7df8f89fd0643b4973674826d7}{prev\+\_\+responses}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a30211c1fec9722594aca49c18670c711}{prev\+\_\+response}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59ba1da30dacc1c8c7a7a321d94c25d6}{status}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab2d87eedf68d027424673ada89954fc1}{task\+\_\+weight}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad8190f0d70c2f3415e48d23252be3834}{satisfaction\+\_\+criterion}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ace46abbade806237aef24a58a76d554f}{rating\+\_\+classifier}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a810afc1857cbf598661e845ee00c0483}{model}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a91168bac37bb10ada694c29d47039c35}{requested\+\_\+rating}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4f3aa2b94dedfa052d15e80e046070d4}{last\+\_\+rating}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ac78fd692baee6b61bcf079b0a3d11cab}{observation}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a02d034bc0c9208fb3d6561b90f176ddf}{eval\+\_\+candidates}
\item 
\hyperlink{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a47fd708e2c3e2c5a5e48e32126543c8c}{subtasks}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 55 of file self\+\_\+feeding\+\_\+agent.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abfcd542bf7b9c1fa8922d31459b12e2e}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abfcd542bf7b9c1fa8922d31459b12e2e}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 226 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
226     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
227         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'interactive'}]:
228             print(\textcolor{stringliteral}{"[ Setting interactive mode defaults... ]"})
229             opt[\textcolor{stringliteral}{'prev\_response\_filter'}] = \textcolor{keyword}{True}
230 
231         \textcolor{comment}{# Set subtasks first so that opt['subtasks'] is set before build\_model()}
232         self.set\_subtasks(opt)
233         self.multitask = len(self.subtasks) > 1
234         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.multitask:
235             self.subtask = self.subtasks[0]
236 
237         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'prev\_response\_negatives'}]:
238             \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'candidates'}] \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'fixed'}, \textcolor{stringliteral}{'vocab'}]:
239                 msg = (
240                     \textcolor{stringliteral}{"[ Option --prev-response-negatives=True is incompatible with "}
241                     \textcolor{stringliteral}{"--candidates=['fixed','vocab']. Overriding it to False. ]"}
242                 )
243                 \hyperlink{namespaceparlai_1_1utils_1_1misc_acf146e70ea7f6867969a7c2b545d4b4b}{warn\_once}(msg)
244                 self.opt[\textcolor{stringliteral}{'prev\_response\_negatives'}] = \textcolor{keyword}{False}
245             self.prev\_responses = \textcolor{keywordtype}{None}
246         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'prev\_response\_filter'}]:
247             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} opt[\textcolor{stringliteral}{'interactive'}]:
248                 msg = (
249                     \textcolor{stringliteral}{"[ Option --prev-response-filter=True can only be used when "}
250                     \textcolor{stringliteral}{"--interactive=True. Overriding it to False. ]"}
251                 )
252                 \hyperlink{namespaceparlai_1_1utils_1_1misc_acf146e70ea7f6867969a7c2b545d4b4b}{warn\_once}(msg)
253                 self.opt[\textcolor{stringliteral}{'prev\_response\_filter'}] = \textcolor{keyword}{False}
254             self.prev\_response = \textcolor{keywordtype}{None}
255 
256         super().\_\_init\_\_(opt, shared)
257 
258         self.status = NORMAL
259         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'interactive'}]:
260             \textcolor{keyword}{assert} \textcolor{stringliteral}{'dialog'} \textcolor{keywordflow}{in} self.subtasks
261             \textcolor{keyword}{assert} \textcolor{stringliteral}{'satisfaction'} \textcolor{keywordflow}{in} self.subtasks
262         \textcolor{keywordflow}{else}:
263             \textcolor{keyword}{assert} \textcolor{keywordflow}{not} self.opt[\textcolor{stringliteral}{'request\_feedback'}]
264             \textcolor{keyword}{assert} \textcolor{keywordflow}{not} self.opt[\textcolor{stringliteral}{'request\_rating'}]
265 
266         self.task\_weight = \{
267             \textcolor{stringliteral}{'dialog'}: opt[\textcolor{stringliteral}{'dia\_weight'}],
268             \textcolor{stringliteral}{'feedback'}: opt[\textcolor{stringliteral}{'fee\_weight'}],
269             \textcolor{stringliteral}{'satisfaction'}: opt[\textcolor{stringliteral}{'sat\_weight'}],
270         \}
271 
272         \textcolor{comment}{# dialog/feedback tasks use self.rank\_loss from TorchRankerAgent}
273         \textcolor{comment}{# Don't do BCEWithLogitsLoss since we need the probs from the sigmoid anyway}
274         self.satisfaction\_criterion = nn.BCELoss(reduce=\textcolor{keyword}{True}, size\_average=\textcolor{keyword}{False})
275 
276         \textcolor{comment}{# Set rating classifier}
277         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'regex'}]:
278             self.rating\_classifier = FeedbackClassifierRegex()
279 
280         random.seed()
281         self.reset()
282 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aeb85e03ea2d8dfebd9cb29d717bea763}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aeb85e03ea2d8dfebd9cb29d717bea763}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!act@{act}}
\index{act@{act}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{act()}{act()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+act (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 311 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
311     \textcolor{keyword}{def }act(self):
312         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'request\_feedback'}] \textcolor{keywordflow}{or} self.opt[\textcolor{stringliteral}{'request\_rating'}]:
313             \textcolor{comment}{# rating request ->}
314             \textcolor{comment}{#   0/+1 -> normal}
315             \textcolor{comment}{#   -1 -> feedback request}
316             \textcolor{comment}{# feedback request -> topic request -> normal}
317             positivity = -1  \textcolor{comment}{# actual positivity values are in [0, 1]}
318 
319             \textcolor{comment}{# Preprocessing (for special states that transition to NORMAL)}
320             \textcolor{keywordflow}{if} self.status \textcolor{keywordflow}{in} [NEWTOPIC\_REQUESTED, RATING\_ACCEPTED]:
321                 self.status = NORMAL
322 
323             \textcolor{keywordflow}{if} self.status == NORMAL:
324                 positivity = self.predict\_satisfaction(self.observation)
325                 \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{"display\_sat\_estimate"}]:
326                     print(f\textcolor{stringliteral}{"[ satisfaction estimate ]: \{positivity\}"})
327                 \textcolor{keywordflow}{if} self.do\_request\_feedback(positivity):
328                     action = self.make\_action(self.make\_feedback\_request())
329                     self.status = FEEDBACK\_REQUESTED
330                 \textcolor{keywordflow}{elif} self.do\_request\_rating(positivity):
331                     action = self.make\_action(self.make\_rating\_request())
332                     self.requested\_rating = \textcolor{keyword}{True}
333                     self.status = RATING\_REQUESTED
334 
335             \textcolor{keywordflow}{elif} self.status == RATING\_REQUESTED:
336                 rating = self.extract\_rating()
337                 \textcolor{keywordflow}{if} rating == -1:
338                     action = self.make\_action(
339                         self.make\_feedback\_request(), reward=rating
340                     )
341                     self.status = FEEDBACK\_REQUESTED
342 
343                 \textcolor{keywordflow}{else}:
344                     action, reply = self.make\_rating\_response(rating)
345                     self.status = RATING\_ACCEPTED
346                     \textcolor{comment}{# Store just the non-template part of the response in the history}
347                     self.history.update\_history(\{\textcolor{stringliteral}{"text"}: reply\})
348 
349             \textcolor{keywordflow}{elif} self.status == FEEDBACK\_REQUESTED:
350                 action = self.make\_action(THANKS + \textcolor{stringliteral}{' '} + NEWTOPIC)
351                 self.status = NEWTOPIC\_REQUESTED
352                 self.history.reset()
353 
354             \textcolor{keywordflow}{else}:
355                 \textcolor{keywordflow}{raise} Exception(f\textcolor{stringliteral}{"Unrecognized status: \{self.status\}"})
356 
357         \textcolor{keywordflow}{if} self.status == NORMAL:
358             action = super().act()
359             self.history.update\_history(action)
360 
361         \textcolor{keywordflow}{return} action
362 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a22f9ef0ce5fb83da14d404296476ad0f}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a22f9ef0ce5fb83da14d404296476ad0f}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}}
\index{add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+cmdline\+\_\+args()}{add\_cmdline\_args()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+add\+\_\+cmdline\+\_\+args (\begin{DoxyParamCaption}\item[{}]{cls,  }\item[{}]{argparser }\end{DoxyParamCaption})}

\begin{DoxyVerb}Add command-line arguments specifically for this agent.
\end{DoxyVerb}
 

Definition at line 57 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
57     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(cls, argparser):
58         \textcolor{stringliteral}{"""}
59 \textcolor{stringliteral}{        Add command-line arguments specifically for this agent.}
60 \textcolor{stringliteral}{        """}
61         super().\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(argparser)
62         SelfFeedingModel.add\_cmdline\_args(argparser)
63 
64         agent = argparser.add\_argument\_group(\textcolor{stringliteral}{'Self-feeding Agent'})
65         agent.add\_argument(
66             \textcolor{stringliteral}{'--request-rating'},
67             type=\textcolor{stringliteral}{'bool'},
68             default=\textcolor{keyword}{False},
69             help=\textcolor{stringliteral}{"If True, ocassionally request ratings"},
70         )
71         agent.add\_argument(
72             \textcolor{stringliteral}{'--rating-frequency'},
73             type=float,
74             default=0.01,
75             help=\textcolor{stringliteral}{"The fraction of the time that a rating will be "}
76             \textcolor{stringliteral}{"randomly requested, regardless of classifier confidence"},
77         )
78         agent.add\_argument(
79             \textcolor{stringliteral}{'--rating-gap'},
80             type=float,
81             default=0.05,
82             help=\textcolor{stringliteral}{"A positivity rating must be within this amount of "}
83             \textcolor{stringliteral}{"the rating-threshold to trigger the confidence-based "}
84             \textcolor{stringliteral}{"rating request"},
85         )
86 
87         agent.add\_argument(
88             \textcolor{stringliteral}{'--request-feedback'},
89             type=\textcolor{stringliteral}{'bool'},
90             default=\textcolor{keyword}{False},
91             help=\textcolor{stringliteral}{"If True, recognize mistakes and request feedback"},
92         )
93         agent.add\_argument(
94             \textcolor{stringliteral}{'--rating-threshold'},
95             type=float,
96             default=0.5,
97             help=\textcolor{stringliteral}{"Treat feedback below this threshold as negative"},
98         )
99         agent.add\_argument(
100             \textcolor{stringliteral}{'--display-sat-estimate'},
101             type=\textcolor{stringliteral}{'bool'},
102             default=\textcolor{keyword}{False},
103             help=\textcolor{stringliteral}{"If True, print estimated satisfaction after each response"},
104         )
105         agent.add\_argument(
106             \textcolor{stringliteral}{'--target-class'},
107             type=int,
108             default=0,
109             help=\textcolor{stringliteral}{"The label (in [0,1]) to treat as the target rarer "}
110             \textcolor{stringliteral}{"class when calculating tp/fp/tn/fn"},
111         )
112 
113         agent.add\_argument(
114             \textcolor{stringliteral}{'--freeze-base'},
115             type=\textcolor{stringliteral}{'bool'},
116             default=\textcolor{keyword}{False},
117             help=\textcolor{stringliteral}{"If True, freeze all but the satisfaction linear layer"},
118         )
119         agent.add\_argument(
120             \textcolor{stringliteral}{'--partial-load'},
121             type=\textcolor{stringliteral}{'bool'},
122             default=\textcolor{keyword}{False},
123             help=\textcolor{stringliteral}{"If True, allow a model to be partially loaded (i.e., "}
124             \textcolor{stringliteral}{"a model need not be a perfect match to be loaded"},
125         )
126 
127         agent.add\_argument(
128             \textcolor{stringliteral}{'-subtasks'},
129             \textcolor{stringliteral}{'--subtasks'},
130             type=str,
131             help=\textcolor{stringliteral}{"A comma-separated list of active subtasks"},
132         )
133 
134         agent.add\_argument(
135             \textcolor{stringliteral}{'--dia-weight'},
136             type=float,
137             default=1.0,
138             help=\textcolor{stringliteral}{"The dialog task loss is multiplied by this"},
139         )
140         agent.add\_argument(
141             \textcolor{stringliteral}{'--fee-weight'},
142             type=float,
143             default=1.0,
144             help=\textcolor{stringliteral}{"The feedback task loss is multiplied by this"},
145         )
146         agent.add\_argument(
147             \textcolor{stringliteral}{'--sat-weight'},
148             type=float,
149             default=1.0,
150             help=\textcolor{stringliteral}{"The satisfaction task loss is multiplied by this"},
151         )
152 
153         agent.add\_argument(
154             \textcolor{stringliteral}{'--prev-response-negatives'},
155             type=\textcolor{stringliteral}{'bool'},
156             default=\textcolor{keyword}{False},
157             help=\textcolor{stringliteral}{"If True, during training add the previous agent response as a "}
158             \textcolor{stringliteral}{"negative candidate for the current response (as a way to "}
159             \textcolor{stringliteral}{"organically teach the model to not repeat itself). This option is "}
160             \textcolor{stringliteral}{"ignored when candidate set is 'fixed' or 'vocab', as these already "}
161             \textcolor{stringliteral}{"include all candidates"},
162         )
163         agent.add\_argument(
164             \textcolor{stringliteral}{'--prev-response-filter'},
165             type=\textcolor{stringliteral}{'bool'},
166             default=\textcolor{keyword}{False},
167             help=\textcolor{stringliteral}{"If True and --interactive=True, do not allow the model to output its "}
168             \textcolor{stringliteral}{"previous response. This is a hackier solution than using "}
169             \textcolor{stringliteral}{"--prev-response-negatives, but MUCH faster/simpler"},
170         )
171         agent.add\_argument(
172             \textcolor{stringliteral}{'--interactive'},
173             type=\textcolor{stringliteral}{'bool'},
174             default=\textcolor{keyword}{False},
175             help=\textcolor{stringliteral}{"Mark as true if you are in a setting where you are only doing "}
176             \textcolor{stringliteral}{"evaluation, and always with the same fixed candidate set."},
177         )
178 
179         agent.add\_argument(
180             \textcolor{stringliteral}{'--add-double-person-tokens'},
181             type=\textcolor{stringliteral}{'bool'},
182             default=\textcolor{keyword}{False},
183             help=\textcolor{stringliteral}{"For backwards compatibility with old models only. For new "}
184             \textcolor{stringliteral}{"models, this should always be False."},
185         )
186 
187         agent.set\_defaults(person\_tokens=\textcolor{keyword}{False})  \textcolor{comment}{# add these in a special way}
188 
189         variants = argparser.add\_argument\_group(\textcolor{stringliteral}{'Self-feeding Variants'})
190         variants.add\_argument(
191             \textcolor{stringliteral}{'-rgx'},
192             \textcolor{stringliteral}{'--regex'},
193             type=\textcolor{stringliteral}{'bool'},
194             default=\textcolor{keyword}{False},
195             help=\textcolor{stringliteral}{"If True, classify satisfaction using regexes instead "} \textcolor{stringliteral}{"of model"},
196         )
197         variants.add\_argument(
198             \textcolor{stringliteral}{'-up'},
199             \textcolor{stringliteral}{'--uncertainty-predictor'},
200             type=\textcolor{stringliteral}{'bool'},
201             default=\textcolor{keyword}{False},
202             help=\textcolor{stringliteral}{"If True, classify satisfaction using uncertainty of "}
203             \textcolor{stringliteral}{"dialog models predictions instead of classifer"}
204             \textcolor{stringliteral}{"model"},
205         )
206         variants.add\_argument(
207             \textcolor{stringliteral}{'-ut'},
208             \textcolor{stringliteral}{'--uncertainty-threshold'},
209             type=float,
210             default=0.5,
211             help=\textcolor{stringliteral}{"If model confidence is smaller than this number and"}
212             \textcolor{stringliteral}{" --uncertainty-predictor=True, classify as bot mistake"},
213         )
214         variants.add\_argument(
215             \textcolor{stringliteral}{'-us'},
216             \textcolor{stringliteral}{'--uncertainty-style'},
217             type=str,
218             default=\textcolor{stringliteral}{'gap'},
219             choices=[\textcolor{stringliteral}{'gap'}, \textcolor{stringliteral}{'mag'}],
220             help=\textcolor{stringliteral}{"Whether the uncertainty threshold measures the "}
221             \textcolor{stringliteral}{"magnitude of the top confidence, or the gap between the "}
222             \textcolor{stringliteral}{"two most confident answers"},
223         )
224         \textcolor{keywordflow}{return} agent
225 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a72c574a9342e5cf9e268ad0cb7a1e721}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a72c574a9342e5cf9e268ad0cb7a1e721}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!batchify@{batchify}}
\index{batchify@{batchify}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{batchify()}{batchify()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+batchify (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observations }\end{DoxyParamCaption})}



Definition at line 388 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
388     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1utils_aca22dd97c5b6dcda2a7479c1cb22ef1e}{batchify}(self, observations):
389         batch = super().\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1utils_aca22dd97c5b6dcda2a7479c1cb22ef1e}{batchify}(observations)
390         \textcolor{keywordflow}{if} self.multitask \textcolor{keywordflow}{and} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
391             \textcolor{comment}{# Dialog is the default task; e.g., in interactive mode}
392             subtasks = [o.get(\textcolor{stringliteral}{'subtask'}, \textcolor{stringliteral}{'dialog'}) \textcolor{keywordflow}{for} o \textcolor{keywordflow}{in} observations]
393             \textcolor{comment}{# Catch error here for debugging}
394             \textcolor{keyword}{assert} len(set(subtasks)) == 1
395             self.subtask = subtasks[0]
396         \textcolor{comment}{# print(f"[ context ]: \{observations[0]['text']\}")}
397         \textcolor{keywordflow}{return} batch
398 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af80537d5c439bd9c475e252e533e24cc}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af80537d5c439bd9c475e252e533e24cc}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!build\+\_\+model@{build\+\_\+model}}
\index{build\+\_\+model@{build\+\_\+model}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{build\+\_\+model()}{build\_model()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+build\+\_\+model (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 299 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
299     \textcolor{keyword}{def }build\_model(self):
300         self.model = SelfFeedingModel(self.opt, self.dict)
301         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'embedding\_type'}] != \textcolor{stringliteral}{'random'}:
302             \textcolor{keywordflow}{for} embeddings \textcolor{keywordflow}{in} [
303                 getattr(self.model, \textcolor{stringliteral}{'dia\_embeddings'}, \textcolor{keywordtype}{None}),
304                 getattr(self.model, \textcolor{stringliteral}{'fee\_embeddings'}, \textcolor{keywordtype}{None}),
305                 getattr(self.model, \textcolor{stringliteral}{'sat\_embeddings'}, \textcolor{keywordtype}{None}),
306             ]:
307                 \textcolor{keywordflow}{if} embeddings \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
308                     self.\_copy\_embeddings(embeddings.weight, self.opt[\textcolor{stringliteral}{'embedding\_type'}])
309         \textcolor{keywordflow}{return} self.model
310 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af23daff9436acdeadd63b74396870255}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af23daff9436acdeadd63b74396870255}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!check\+\_\+prev\+\_\+response@{check\+\_\+prev\+\_\+response}}
\index{check\+\_\+prev\+\_\+response@{check\+\_\+prev\+\_\+response}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{check\+\_\+prev\+\_\+response()}{check\_prev\_response()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+check\+\_\+prev\+\_\+response (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{preds,  }\item[{}]{cand\+\_\+ranked }\end{DoxyParamCaption})}



Definition at line 790 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
790     \textcolor{keyword}{def }check\_prev\_response(self, preds, cand\_ranked):
791         \textcolor{comment}{# Compare current prediction to previous (replacing if necessary)}
792         \textcolor{keywordflow}{if} self.prev\_response \textcolor{keywordflow}{and} (preds[0] == self.prev\_response):
793             preds[0] = cand\_ranked[0][1]
794         \textcolor{comment}{# Save current prediction for next turn}
795         self.prev\_response = preds[0]
796         \textcolor{keywordflow}{return} preds
797 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a29d503e95d996bbe351fe860631c3162}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a29d503e95d996bbe351fe860631c3162}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!dialog\+\_\+step@{dialog\+\_\+step}}
\index{dialog\+\_\+step@{dialog\+\_\+step}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{dialog\+\_\+step()}{dialog\_step()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+dialog\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 479 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
479     \textcolor{keyword}{def }dialog\_step(self, batch):
480         batchsize = batch.text\_vec.size(0)
481         \textcolor{keywordflow}{if} self.model.training:
482             cands, cand\_vecs, label\_inds = self.\_build\_candidates(
483                 batch, source=self.opt[\textcolor{stringliteral}{'candidates'}], mode=\textcolor{stringliteral}{'train'}
484             )
485         \textcolor{keywordflow}{else}:
486             cands, cand\_vecs, label\_inds = self.\_build\_candidates(
487                 batch, source=self.opt[\textcolor{stringliteral}{'eval\_candidates'}], mode=\textcolor{stringliteral}{'eval'}
488             )
489             \textcolor{keywordflow}{if} self.encode\_candidate\_vecs \textcolor{keywordflow}{and} self.eval\_candidates \textcolor{keywordflow}{in} [
490                 \textcolor{stringliteral}{'fixed'},
491                 \textcolor{stringliteral}{'vocab'},
492             ]:
493                 \textcolor{comment}{# if we cached candidate encodings for a fixed list of candidates,}
494                 \textcolor{comment}{# pass those into the score\_candidates function}
495                 \textcolor{keywordflow}{if} self.eval\_candidates == \textcolor{stringliteral}{'fixed'}:
496                     cand\_vecs = self.fixed\_candidate\_encs
497                 \textcolor{keywordflow}{elif} self.eval\_candidates == \textcolor{stringliteral}{'vocab'}:
498                     cand\_vecs = self.vocab\_candidate\_encs
499 
500         scores = self.model.score\_dialog(batch.text\_vec, cand\_vecs)
501         \_, ranks = scores.sort(1, descending=\textcolor{keyword}{True})
502 
503         \textcolor{keywordflow}{if} self.model.training:
504             \textcolor{comment}{# Get predictions but not full rankings for the sake of speed}
505             cand\_ranked = \textcolor{keywordtype}{None}
506             \textcolor{keywordflow}{if} cand\_vecs.dim() == 2:
507                 preds = [cands[ordering[0]] \textcolor{keywordflow}{for} ordering \textcolor{keywordflow}{in} ranks]
508             \textcolor{keywordflow}{elif} cand\_vecs.dim() == 3:
509                 preds = [cands[i][ordering[0]] \textcolor{keywordflow}{for} i, ordering \textcolor{keywordflow}{in} enumerate(ranks)]
510         \textcolor{keywordflow}{else}:
511             \textcolor{comment}{# Return full rankings to calculate hits@ metrics}
512             cand\_ranked = []
513             \textcolor{keywordflow}{for} i, ordering \textcolor{keywordflow}{in} enumerate(ranks):
514                 \textcolor{keywordflow}{if} cand\_vecs.dim() == 2:
515                     cand\_list = cands
516                 \textcolor{keywordflow}{elif} cand\_vecs.dim() == 3:
517                     cand\_list = cands[i]
518                 cand\_ranked.append([cand\_list[rank] \textcolor{keywordflow}{for} rank \textcolor{keywordflow}{in} ordering])
519             preds = [cand\_ranked[i][0] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(batchsize)]
520 
521         \textcolor{keywordflow}{if} label\_inds \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
522             loss = \textcolor{keywordtype}{None}
523         \textcolor{keywordflow}{else}:
524             loss = self.criterion(scores, label\_inds)
525             self.update\_dia\_metrics(loss, ranks, label\_inds, batchsize)
526         \textcolor{keywordflow}{return} loss, preds, cand\_ranked
527 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a8d1ee3e56b88c0efaed910cc867970d3}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a8d1ee3e56b88c0efaed910cc867970d3}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!do\+\_\+request\+\_\+feedback@{do\+\_\+request\+\_\+feedback}}
\index{do\+\_\+request\+\_\+feedback@{do\+\_\+request\+\_\+feedback}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{do\+\_\+request\+\_\+feedback()}{do\_request\_feedback()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+do\+\_\+request\+\_\+feedback (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{positivity }\end{DoxyParamCaption})}

\begin{DoxyVerb}Decide whether to request an feedback this turn.
\end{DoxyVerb}
 

Definition at line 694 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
694     \textcolor{keyword}{def }do\_request\_feedback(self, positivity):
695         \textcolor{stringliteral}{"""}
696 \textcolor{stringliteral}{        Decide whether to request an feedback this turn.}
697 \textcolor{stringliteral}{        """}
698         \textcolor{comment}{# If --request-feedback=False, then don't request an feedback}
699         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.opt[\textcolor{stringliteral}{'request\_feedback'}] \textcolor{keywordflow}{or} len(self.history.history\_strings) == 1:
700             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
701         \textcolor{keywordflow}{else}:
702             \textcolor{keywordflow}{return} positivity < self.opt[\textcolor{stringliteral}{'rating\_threshold'}]
703 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af0cd2239c4610157ac513163eb9437a3}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af0cd2239c4610157ac513163eb9437a3}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!do\+\_\+request\+\_\+rating@{do\+\_\+request\+\_\+rating}}
\index{do\+\_\+request\+\_\+rating@{do\+\_\+request\+\_\+rating}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{do\+\_\+request\+\_\+rating()}{do\_request\_rating()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+do\+\_\+request\+\_\+rating (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{positivity }\end{DoxyParamCaption})}

\begin{DoxyVerb}Decide whether to request a rating this turn.
\end{DoxyVerb}
 

Definition at line 704 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
704     \textcolor{keyword}{def }do\_request\_rating(self, positivity):
705         \textcolor{stringliteral}{"""}
706 \textcolor{stringliteral}{        Decide whether to request a rating this turn.}
707 \textcolor{stringliteral}{        """}
708         \textcolor{comment}{# If --request-rating=False, then don't request a rating}
709         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.opt[\textcolor{stringliteral}{'request\_rating'}]:
710             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
711         \textcolor{comment}{# If no previous bot utterance is on record, can't ask about it}
712         \textcolor{keywordflow}{elif} len(self.history.history\_strings) < 2:
713             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
714         \textcolor{comment}{# Only request a rating a maximum of once per episode}
715         \textcolor{keywordflow}{elif} self.requested\_rating:
716             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
717         \textcolor{comment}{# Some percentage of the time, we ask for a rating randomly (to aid exploration)}
718         \textcolor{keywordflow}{elif} random.random() < self.opt[\textcolor{stringliteral}{'rating\_frequency'}]:
719             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
720         \textcolor{comment}{# Lastly, ask for a rating based on confidence (proximity to threshold)}
721         \textcolor{keywordflow}{else}:
722             gap = abs(positivity - self.opt[\textcolor{stringliteral}{'rating\_threshold'}])
723             \textcolor{keywordflow}{return} gap < self.opt[\textcolor{stringliteral}{'rating\_gap'}]
724 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a3208c69de4a2452cafa3d7feeec85218}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a3208c69de4a2452cafa3d7feeec85218}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!encode\+\_\+candidates@{encode\+\_\+candidates}}
\index{encode\+\_\+candidates@{encode\+\_\+candidates}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{encode\+\_\+candidates()}{encode\_candidates()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+encode\+\_\+candidates (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{cands }\end{DoxyParamCaption})}

\begin{DoxyVerb}Encodes a tensor of vectorized candidates.

:param cands: a [bs, seq_len] or [bs, num_cands, seq_len](?) of vectorized
    candidates
\end{DoxyVerb}
 

Definition at line 685 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
685     \textcolor{keyword}{def }encode\_candidates(self, cands):
686         \textcolor{stringliteral}{"""}
687 \textcolor{stringliteral}{        Encodes a tensor of vectorized candidates.}
688 \textcolor{stringliteral}{}
689 \textcolor{stringliteral}{        :param cands: a [bs, seq\_len] or [bs, num\_cands, seq\_len](?) of vectorized}
690 \textcolor{stringliteral}{            candidates}
691 \textcolor{stringliteral}{        """}
692         \textcolor{keywordflow}{return} self.model.encode\_dia\_y(cands)
693 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af50200b087a797a01b5e5ccdd1be63ba}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_af50200b087a797a01b5e5ccdd1be63ba}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!eval\+\_\+step@{eval\+\_\+step}}
\index{eval\+\_\+step@{eval\+\_\+step}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{eval\+\_\+step()}{eval\_step()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+eval\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 447 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
447     \textcolor{keyword}{def }eval\_step(self, batch):
448         \textcolor{keywordflow}{if} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
449             \textcolor{keywordflow}{return}
450 
451         self.model.eval()
452 
453         batchsize = batch.text\_vec.size(0)
454         self.metrics[\textcolor{stringliteral}{'examples'}] += batchsize
455 
456         \textcolor{keywordflow}{if} self.subtask == \textcolor{stringliteral}{'dialog'}:
457             \_, preds, cand\_ranked = self.dialog\_step(batch)
458             \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'interactive'}]:
459                 \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'prev\_response\_filter'}]:
460                     preds = self.check\_prev\_response(preds, cand\_ranked)
461                 \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds)
462             \textcolor{keywordflow}{else}:
463                 \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds, cand\_ranked)
464 
465         \textcolor{keywordflow}{elif} self.subtask == \textcolor{stringliteral}{'feedback'}:
466             \_, preds, cand\_ranked = self.feedback\_step(batch)
467             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds, cand\_ranked)
468 
469         \textcolor{keywordflow}{elif} self.subtask == \textcolor{stringliteral}{'satisfaction'}:
470             \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'uncertainty\_predictor'}]:
471                 \textcolor{comment}{# Use uncertainty of dialog model to classify bot's previous utterance}
472                 preds = self.predict\_satisfaction\_by\_uncertainty(batch)
473             \textcolor{keywordflow}{else}:
474                 \textcolor{comment}{# Use satisfaction of user response to classify bot's previous response}
475                 \_, preds = self.satisfaction\_step(batch)
476             preds = [\hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(p) \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} preds]
477             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds)
478 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a9c1c1e9435e1b56420fee71a31c5d57e}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a9c1c1e9435e1b56420fee71a31c5d57e}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!extract\+\_\+rating@{extract\+\_\+rating}}
\index{extract\+\_\+rating@{extract\+\_\+rating}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{extract\+\_\+rating()}{extract\_rating()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+extract\+\_\+rating (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert user response to rating request from text to an integer rating.
\end{DoxyVerb}
 

Definition at line 725 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
725     \textcolor{keyword}{def }extract\_rating(self):
726         \textcolor{stringliteral}{"""}
727 \textcolor{stringliteral}{        Convert user response to rating request from text to an integer rating.}
728 \textcolor{stringliteral}{        """}
729         \textcolor{comment}{# TODO: Make this more robust!}
730         \textcolor{keywordflow}{if} self.last\_rating == \textcolor{stringliteral}{'positive'}:
731             \textcolor{keywordflow}{return} 1
732         \textcolor{keywordflow}{elif} self.last\_rating == \textcolor{stringliteral}{'negative'}:
733             \textcolor{keywordflow}{return} -1
734         \textcolor{keywordflow}{else}:
735             \textcolor{keywordflow}{return} 0
736 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ae98cf6c1345c3cff3278339ef1c855a4}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ae98cf6c1345c3cff3278339ef1c855a4}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!feedback\+\_\+step@{feedback\+\_\+step}}
\index{feedback\+\_\+step@{feedback\+\_\+step}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{feedback\+\_\+step()}{feedback\_step()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+feedback\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 528 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
528     \textcolor{keyword}{def }feedback\_step(self, batch):
529         batchsize = batch.text\_vec.size(0)
530 
531         \hyperlink{namespaceparlai_1_1utils_1_1misc_acf146e70ea7f6867969a7c2b545d4b4b}{warn\_once}(\textcolor{stringliteral}{"WARNING: feedback candidates are hardcoded to batch"})
532         \textcolor{keywordflow}{if} self.model.training:
533             cands, cand\_vecs, label\_inds = self.\_build\_candidates(
534                 batch, source=\textcolor{stringliteral}{'batch'}, mode=\textcolor{stringliteral}{'train'}
535             )
536         \textcolor{keywordflow}{else}:
537             cands, cand\_vecs, label\_inds = self.\_build\_candidates(
538                 batch, source=\textcolor{stringliteral}{'batch'}, mode=\textcolor{stringliteral}{'eval'}
539             )
540 
541         scores = self.model.score\_feedback(batch.text\_vec, cand\_vecs)
542         \_, ranks = scores.sort(1, descending=\textcolor{keyword}{True})
543 
544         \textcolor{keywordflow}{if} self.model.training:
545             \textcolor{comment}{# Get predictions but not full rankings for the sake of speed}
546             cand\_ranked = \textcolor{keywordtype}{None}
547             preds = [cands[ordering[0]] \textcolor{keywordflow}{for} ordering \textcolor{keywordflow}{in} ranks]
548         \textcolor{keywordflow}{else}:
549             \textcolor{comment}{# Return full rankings to calculate hits@ metrics}
550             cand\_ranked = []
551             \textcolor{keywordflow}{for} ordering \textcolor{keywordflow}{in} ranks:
552                 cand\_ranked.append([cands[rank] \textcolor{keywordflow}{for} rank \textcolor{keywordflow}{in} ordering])
553             preds = [cand\_ranked[i][0] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(batchsize)]
554 
555         \textcolor{keywordflow}{if} label\_inds \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
556             loss = \textcolor{keywordtype}{None}
557         \textcolor{keywordflow}{else}:
558             loss = self.criterion(scores, label\_inds)
559             self.update\_fee\_metrics(loss, ranks, label\_inds, batchsize)
560         \textcolor{keywordflow}{return} loss, preds, cand\_ranked
561 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa6011af735a855f23a7630f464abbd9a}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa6011af735a855f23a7630f464abbd9a}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!load@{load}}
\index{load@{load}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{load()}{load()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+load (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return opt and model states.

Overriding TorchAgent.load() to enable partial loading
\end{DoxyVerb}
 

Definition at line 844 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
844     \textcolor{keyword}{def }load(self, path):
845         \textcolor{stringliteral}{"""}
846 \textcolor{stringliteral}{        Return opt and model states.}
847 \textcolor{stringliteral}{}
848 \textcolor{stringliteral}{        Overriding TorchAgent.load() to enable partial loading}
849 \textcolor{stringliteral}{        """}
850         states = torch.load(path, map\_location=\textcolor{keyword}{lambda} cpu, \_: cpu)
851         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'model'} \textcolor{keywordflow}{in} states:
852             \textcolor{keywordflow}{try}:
853                 self.model.load\_state\_dict(states[\textcolor{stringliteral}{'model'}])
854             \textcolor{keywordflow}{except} RuntimeError \textcolor{keyword}{as} e:
855                 \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'partial\_load'}]:
856                     print(
857                         \textcolor{stringliteral}{"WARNING: could not load entire --init-model; "}
858                         \textcolor{stringliteral}{"loading partially instead."}
859                     )
860                     pretrained\_state = states[\textcolor{stringliteral}{'model'}]
861                     current\_state = self.model.state\_dict()
862                     \textcolor{comment}{# 1. filter out unnecessary keys}
863                     pretrained\_dict = \{
864                         k: v \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} pretrained\_state.items() \textcolor{keywordflow}{if} k \textcolor{keywordflow}{in} current\_state
865                     \}
866                     \textcolor{comment}{# 2. overwrite entries in the existing state dict}
867                     current\_state.update(pretrained\_dict)
868                     \textcolor{comment}{# 3. load the new state dict}
869                     self.model.load\_state\_dict(current\_state)
870                 \textcolor{keywordflow}{else}:
871                     \textcolor{keywordflow}{raise} Exception(
872                         f\textcolor{stringliteral}{"The designated model could not be loaded. "}
873                         f\textcolor{stringliteral}{"Consider using --partial-load=True.\(\backslash\)n \{e\}"}
874                     )
875 
876         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'optimizer'} \textcolor{keywordflow}{in} states \textcolor{keywordflow}{and} hasattr(self, \textcolor{stringliteral}{'optimizer'}):
877             self.optimizer.load\_state\_dict(states[\textcolor{stringliteral}{'optimizer'}])
878         \textcolor{keywordflow}{return} states
879 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a57bd8a3eaeecc56d5df86c8bedc6d2d2}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a57bd8a3eaeecc56d5df86c8bedc6d2d2}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!make\+\_\+action@{make\+\_\+action}}
\index{make\+\_\+action@{make\+\_\+action}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{make\+\_\+action()}{make\_action()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+make\+\_\+action (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{text,  }\item[{}]{reward = {\ttfamily 0} }\end{DoxyParamCaption})}



Definition at line 798 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
798     \textcolor{keyword}{def }make\_action(self, text, reward=0):
799         action = \{\textcolor{stringliteral}{'id'}: self.id, \textcolor{stringliteral}{'text'}: text\}
800         \textcolor{keywordflow}{if} reward:
801             action[\textcolor{stringliteral}{'reward'}] = reward
802         \textcolor{keywordflow}{return} action
803 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a65e172c7c2dff330e0a92ce361acdc45}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a65e172c7c2dff330e0a92ce361acdc45}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!make\+\_\+feedback\+\_\+request@{make\+\_\+feedback\+\_\+request}}
\index{make\+\_\+feedback\+\_\+request@{make\+\_\+feedback\+\_\+request}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{make\+\_\+feedback\+\_\+request()}{make\_feedback\_request()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+make\+\_\+feedback\+\_\+request (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 804 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
804     \textcolor{keyword}{def }make\_feedback\_request(self):
805         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'Oops! I think I messed up. '} \textcolor{stringliteral}{'What could I have said instead?'}
806 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa97b64df930c600bd7be1b69779849e7}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa97b64df930c600bd7be1b69779849e7}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!make\+\_\+rating\+\_\+request@{make\+\_\+rating\+\_\+request}}
\index{make\+\_\+rating\+\_\+request@{make\+\_\+rating\+\_\+request}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{make\+\_\+rating\+\_\+request()}{make\_rating\_request()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+make\+\_\+rating\+\_\+request (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 807 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
807     \textcolor{keyword}{def }make\_rating\_request(self):
808         \textcolor{keywordflow}{return} RAT\_REQUEST
809 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a0c79b5c366eded0b21f90674837d6d93}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a0c79b5c366eded0b21f90674837d6d93}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!make\+\_\+rating\+\_\+response@{make\+\_\+rating\+\_\+response}}
\index{make\+\_\+rating\+\_\+response@{make\+\_\+rating\+\_\+response}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{make\+\_\+rating\+\_\+response()}{make\_rating\_response()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+make\+\_\+rating\+\_\+response (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{rating }\end{DoxyParamCaption})}



Definition at line 810 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
810     \textcolor{keyword}{def }make\_rating\_response(self, rating):
811         action = super().act()
812         reply = \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(action[\textcolor{stringliteral}{'text'}])
813         action[\textcolor{stringliteral}{'reward'}] = rating
814         last\_message = self.history.history\_strings[-1]
815         \textcolor{keywordflow}{if} rating == 0:
816             action[\textcolor{stringliteral}{'text'}] = f\textcolor{stringliteral}{'Okay, thanks! \{CONTINUE\} ("\{last\_message\}"): \{reply\}'}
817         \textcolor{keywordflow}{elif} rating == 1:
818             action[\textcolor{stringliteral}{'text'}] = f\textcolor{stringliteral}{'Great, thanks! \{CONTINUE\} ("\{last\_message\}"): \{reply\}'}
819         \textcolor{keywordflow}{return} action, reply
820 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a083d8cde4e9351b2f41c52a6205fe92b}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a083d8cde4e9351b2f41c52a6205fe92b}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!observe@{observe}}
\index{observe@{observe}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{observe()}{observe()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+observe (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observation }\end{DoxyParamCaption})}

\begin{DoxyVerb}Add to history, concatenate history-size utterances, and add person tokens.
\end{DoxyVerb}
 

Definition at line 363 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
363     \textcolor{keyword}{def }observe(self, observation):
364         \textcolor{stringliteral}{"""}
365 \textcolor{stringliteral}{        Add to history, concatenate history-size utterances, and add person tokens.}
366 \textcolor{stringliteral}{        """}
367 
368         \textcolor{comment}{# If their response is a response to a rating request, no work required}
369         \textcolor{keywordflow}{if} self.status == RATING\_REQUESTED:
370             self.last\_rating = observation[\textcolor{stringliteral}{'text'}]
371 
372         self.history.update\_history(observation)
373         \textcolor{keywordflow}{if} (
374             self.opt[\textcolor{stringliteral}{'add\_double\_person\_tokens'}]
375             \textcolor{keywordflow}{and} len(self.history.history\_strings) > 0
376         ):
377             observation.force\_set(
378                 \textcolor{stringliteral}{'text'},
379                 \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a3f3d055dc6c4058057baae7b240de5ec}{add\_person\_tokens}(
380                     self.history.history\_strings[-self.opt[\textcolor{stringliteral}{'history\_size'}] :],
381                     last\_speaker=1,
382                 ),
383             )
384 
385         self.observation = observation
386         \textcolor{keywordflow}{return} self.vectorize(self.observation, self.history)
387 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abf84c3ae5ee4a7f80dfe3e441ad170b2}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_abf84c3ae5ee4a7f80dfe3e441ad170b2}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!predict\+\_\+satisfaction@{predict\+\_\+satisfaction}}
\index{predict\+\_\+satisfaction@{predict\+\_\+satisfaction}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{predict\+\_\+satisfaction()}{predict\_satisfaction()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+predict\+\_\+satisfaction (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observation }\end{DoxyParamCaption})}



Definition at line 737 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
737     \textcolor{keyword}{def }predict\_satisfaction(self, observation):
738         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'regex'}]:
739             prob = self.rating\_classifier.predict\_proba(observation[\textcolor{stringliteral}{'text\_vec'}])
740         \textcolor{keywordflow}{else}:
741             prob = self.model.score\_satisfaction(observation[\textcolor{stringliteral}{'text\_vec'}].reshape(1, -1))
742         \textcolor{keywordflow}{return} prob.item()
743 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a2788bb764560c9d021ac0b8a5596e1e0}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a2788bb764560c9d021ac0b8a5596e1e0}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty@{predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty}}
\index{predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty@{predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty()}{predict\_satisfaction\_by\_uncertainty()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+predict\+\_\+satisfaction\+\_\+by\+\_\+uncertainty (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 744 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
744     \textcolor{keyword}{def }predict\_satisfaction\_by\_uncertainty(self, batch):
745         \textcolor{comment}{# Use the dialog model's confidence to predict the rating on previous response}
746         \textcolor{comment}{# HACK: this test is run using a model that was trained on dialog but is now}
747         \textcolor{comment}{# being evaluated on satisfaction. We use a satisfaction dataset so that we have}
748         \textcolor{comment}{# access to the satisfaction labels. Therefore, we do a sloppy hack here to pull}
749         \textcolor{comment}{# out what would have been the candidates for the dialog task. We use histsz=4}
750         \textcolor{comment}{# and ignore the last response (the user's feedback) and use the penultimate}
751         \textcolor{comment}{# utterances as the candidates. The (up to) two utterances before that are}
752         \textcolor{comment}{# context.}
753 
754         \textcolor{comment}{# pull out dialog candidates from text\_vecs since this is a satisfaction task}
755         \textcolor{keyword}{assert} self.opt[\textcolor{stringliteral}{'history\_size'}] > 2
756         text\_vecs = []
757         cand\_vecs = []
758         \textcolor{keywordflow}{for} vec \textcolor{keywordflow}{in} batch.text\_vec:
759             last\_p1 = (vec == self.dict.txt2vec(\textcolor{stringliteral}{'\_\_p1\_\_'})[0]).nonzero()[-1].item()
760             last\_p2 = (vec == self.dict.txt2vec(\textcolor{stringliteral}{'\_\_p2\_\_'})[0]).nonzero()[-1].item()
761             text\_vecs.append(vec[:last\_p2])
762             cand\_vecs.append(vec[last\_p2 + 1 : last\_p1])
763         text\_padded, \_ = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1_adb5a414ae439f14c54e8c760b91cc4c8}{padded\_tensor}(text\_vecs)
764         cand\_padded, \_ = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1_adb5a414ae439f14c54e8c760b91cc4c8}{padded\_tensor}(cand\_vecs)
765         scores = self.model.score\_dialog(text\_padded, cand\_padded)
766         confidences = F.softmax(scores, dim=1).cpu().detach().numpy()
767 
768         preds = []
769         \textcolor{keywordflow}{for} example \textcolor{keywordflow}{in} confidences:
770             ranked\_confidences = sorted(list(example), reverse=\textcolor{keyword}{True})
771             \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'uncertainty\_style'}] == \textcolor{stringliteral}{'mag'}:
772                 \textcolor{comment}{# If the most confident choice isn't confident enough, predict that}
773                 \textcolor{comment}{# the response the bot gives will be bad (pred=0)}
774                 mag = ranked\_confidences[0]
775                 preds.append(mag > self.opt[\textcolor{stringliteral}{'uncertainty\_threshold'}])
776             \textcolor{keywordflow}{elif} self.opt[\textcolor{stringliteral}{'uncertainty\_style'}] == \textcolor{stringliteral}{'gap'}:
777                 \textcolor{comment}{# If the gap between the first and second most confident choices isn't}
778                 \textcolor{comment}{# large enough, predict that the response the bot gives will be bad}
779                 \textcolor{comment}{# (pred=0)}
780                 gap = ranked\_confidences[0] - ranked\_confidences[1]
781                 preds.append(gap > self.opt[\textcolor{stringliteral}{'uncertainty\_threshold'}])
782 
783         loss = torch.tensor(0)
784         preds = torch.LongTensor(preds)
785         labels = torch.LongTensor([\hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(l) == 1 \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} batch.labels])
786         batchsize = len(labels)
787         self.update\_sat\_metrics(loss, preds, labels, batchsize)
788         \textcolor{keywordflow}{return} preds
789 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a456725f7e04d7452bd14f733fb3cea35}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a456725f7e04d7452bd14f733fb3cea35}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!report@{report}}
\index{report@{report}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{report()}{report()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+report (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Report metrics from model's perspective.
\end{DoxyVerb}
 

Definition at line 644 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
644     \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1convai2_1_1eval__f1_a01a47b9c08dad189837a51f085defc45}{report}(self):
645         \textcolor{stringliteral}{"""}
646 \textcolor{stringliteral}{        Report metrics from model's perspective.}
647 \textcolor{stringliteral}{        """}
648         m = TorchAgent.report(self)  \textcolor{comment}{# Skip TorchRankerAgent; totally redundant}
649         examples = self.metrics[\textcolor{stringliteral}{'examples'}]
650         \textcolor{keywordflow}{if} examples > 0:
651             m[\textcolor{stringliteral}{'examples'}] = examples
652             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'dialog'} \textcolor{keywordflow}{in} self.subtasks \textcolor{keywordflow}{and} self.metrics[\textcolor{stringliteral}{'dia\_exs'}] > 0:
653                 m[\textcolor{stringliteral}{'dia\_loss'}] = self.metrics[\textcolor{stringliteral}{'dia\_loss'}] / self.metrics[\textcolor{stringliteral}{'dia\_exs'}]
654                 m[\textcolor{stringliteral}{'dia\_rank'}] = self.metrics[\textcolor{stringliteral}{'dia\_rank'}] / self.metrics[\textcolor{stringliteral}{'dia\_exs'}]
655                 m[\textcolor{stringliteral}{'dia\_acc'}] = self.metrics[\textcolor{stringliteral}{'dia\_correct'}] / self.metrics[\textcolor{stringliteral}{'dia\_exs'}]
656                 m[\textcolor{stringliteral}{'dia\_exs'}] = self.metrics[\textcolor{stringliteral}{'dia\_exs'}]
657             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'feedback'} \textcolor{keywordflow}{in} self.subtasks \textcolor{keywordflow}{and} self.metrics[\textcolor{stringliteral}{'fee\_exs'}] > 0:
658                 m[\textcolor{stringliteral}{'fee\_loss'}] = self.metrics[\textcolor{stringliteral}{'fee\_loss'}] / self.metrics[\textcolor{stringliteral}{'fee\_exs'}]
659                 m[\textcolor{stringliteral}{'fee\_rank'}] = self.metrics[\textcolor{stringliteral}{'fee\_rank'}] / self.metrics[\textcolor{stringliteral}{'fee\_exs'}]
660                 m[\textcolor{stringliteral}{'fee\_acc'}] = self.metrics[\textcolor{stringliteral}{'fee\_correct'}] / self.metrics[\textcolor{stringliteral}{'fee\_exs'}]
661                 m[\textcolor{stringliteral}{'fee\_exs'}] = self.metrics[\textcolor{stringliteral}{'fee\_exs'}]
662                 m[\textcolor{stringliteral}{'fee\_exs'}] = self.metrics[\textcolor{stringliteral}{'fee\_exs'}]
663             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'satisfaction'} \textcolor{keywordflow}{in} self.subtasks \textcolor{keywordflow}{and} self.metrics[\textcolor{stringliteral}{'sat\_exs'}] > 0:
664                 tp = self.metrics[\textcolor{stringliteral}{'sat\_tp'}]
665                 tn = self.metrics[\textcolor{stringliteral}{'sat\_tn'}]
666                 fp = self.metrics[\textcolor{stringliteral}{'sat\_fp'}]
667                 fn = self.metrics[\textcolor{stringliteral}{'sat\_fn'}]
668                 \textcolor{keyword}{assert} tp + tn + fp + fn == self.metrics[\textcolor{stringliteral}{'sat\_exs'}]
669                 m[\textcolor{stringliteral}{'sat\_loss'}] = self.metrics[\textcolor{stringliteral}{'sat\_loss'}] / self.metrics[\textcolor{stringliteral}{'sat\_exs'}]
670                 m[\textcolor{stringliteral}{'sat\_pr'}] = tp / (tp + fp + EPS)
671                 m[\textcolor{stringliteral}{'sat\_re'}] = tp / (tp + fn + EPS)
672                 pr = m[\textcolor{stringliteral}{'sat\_pr'}]
673                 re = m[\textcolor{stringliteral}{'sat\_re'}]
674                 m[\textcolor{stringliteral}{'sat\_f1'}] = (2 * pr * re) / (pr + re) \textcolor{keywordflow}{if} (pr \textcolor{keywordflow}{and} re) \textcolor{keywordflow}{else} 0.0
675                 m[\textcolor{stringliteral}{'sat\_acc'}] = (tp + tn) / self.metrics[\textcolor{stringliteral}{'sat\_exs'}]
676                 m[\textcolor{stringliteral}{'sat\_exs'}] = self.metrics[\textcolor{stringliteral}{'sat\_exs'}]
677         \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} m.items():
678             \textcolor{comment}{# clean up: rounds to sigfigs and converts tensors to floats}
679             \textcolor{keywordflow}{if} isinstance(v, float):
680                 m[k] = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}{round\_sigfigs}(v, 4)
681             \textcolor{keywordflow}{else}:
682                 m[k] = v
683         \textcolor{keywordflow}{return} m
684 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa94174029fa282fd301ae01ea2ac90de}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa94174029fa282fd301ae01ea2ac90de}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!reset@{reset}}
\index{reset@{reset}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+reset (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 616 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
616     \textcolor{keyword}{def }reset(self):
617         super().reset()
618         self.requested\_rating = \textcolor{keyword}{False}
619 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ada3fee611be323fc660f634f7e33d83e}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ada3fee611be323fc660f634f7e33d83e}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!reset\+\_\+metrics@{reset\+\_\+metrics}}
\index{reset\+\_\+metrics@{reset\+\_\+metrics}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{reset\+\_\+metrics()}{reset\_metrics()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+reset\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Reset metrics.
\end{DoxyVerb}
 

Definition at line 620 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
620     \textcolor{keyword}{def }reset\_metrics(self):
621         \textcolor{stringliteral}{"""}
622 \textcolor{stringliteral}{        Reset metrics.}
623 \textcolor{stringliteral}{        """}
624         super().reset\_metrics()
625         self.metrics[\textcolor{stringliteral}{'examples'}] = 0
626         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'dialog'} \textcolor{keywordflow}{in} self.subtasks:
627             self.metrics[\textcolor{stringliteral}{'dia\_exs'}] = 0
628             self.metrics[\textcolor{stringliteral}{'dia\_loss'}] = 0.0
629             self.metrics[\textcolor{stringliteral}{'dia\_rank'}] = 0
630             self.metrics[\textcolor{stringliteral}{'dia\_correct'}] = 0
631         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'feedback'} \textcolor{keywordflow}{in} self.subtasks:
632             self.metrics[\textcolor{stringliteral}{'fee\_exs'}] = 0
633             self.metrics[\textcolor{stringliteral}{'fee\_loss'}] = 0.0
634             self.metrics[\textcolor{stringliteral}{'fee\_rank'}] = 0
635             self.metrics[\textcolor{stringliteral}{'fee\_correct'}] = 0.0
636         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'satisfaction'} \textcolor{keywordflow}{in} self.subtasks:
637             self.metrics[\textcolor{stringliteral}{'sat\_exs'}] = 0
638             self.metrics[\textcolor{stringliteral}{'sat\_loss'}] = 0
639             self.metrics[\textcolor{stringliteral}{'sat\_tp'}] = 0
640             self.metrics[\textcolor{stringliteral}{'sat\_fp'}] = 0
641             self.metrics[\textcolor{stringliteral}{'sat\_tn'}] = 0
642             self.metrics[\textcolor{stringliteral}{'sat\_fn'}] = 0
643 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4e504bd6e7179930122bcec4a658e30f}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4e504bd6e7179930122bcec4a658e30f}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!satisfaction\+\_\+step@{satisfaction\+\_\+step}}
\index{satisfaction\+\_\+step@{satisfaction\+\_\+step}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{satisfaction\+\_\+step()}{satisfaction\_step()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+satisfaction\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 562 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
562     \textcolor{keyword}{def }satisfaction\_step(self, batch):
563         batchsize = batch.text\_vec.size(0)
564         \textcolor{comment}{# probs is a [batchsize] torch.FloatTensor with values in [0, 1]}
565         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'regex'}]:
566             contexts = [self.dict.vec2txt(vec) \textcolor{keywordflow}{for} vec \textcolor{keywordflow}{in} batch.text\_vec]
567             \textcolor{comment}{# HACK: --use-cuda flag}
568             probs = self.rating\_classifier.predict\_proba(contexts).cuda()
569         \textcolor{keywordflow}{else}:
570             probs = self.model.score\_satisfaction(batch.text\_vec)
571         \textcolor{comment}{# preds is a [batchsize] torch.LongTensor with values in \{0, 1\}}
572         preds = (probs > self.opt[\textcolor{stringliteral}{'rating\_threshold'}]).long()
573 
574         \textcolor{keywordflow}{if} batch.labels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:  \textcolor{comment}{# TODO: not sure if it's None, list of Nones, etc.}
575             loss = \textcolor{keywordtype}{None}
576         \textcolor{keywordflow}{else}:
577             \textcolor{comment}{# labels will be a [batchsize] torch.LongTensor with values in \{0, 1\}}
578             labels = torch.LongTensor([\hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(l) == 1 \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} batch.labels]).cuda()
579 
580             loss = self.satisfaction\_criterion(probs, labels.float())
581             self.update\_sat\_metrics(loss, preds, labels, batchsize)
582 
583         \textcolor{keywordflow}{return} loss, preds
584 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad0e1cbdcc32b0c50e15de866efd963f3}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad0e1cbdcc32b0c50e15de866efd963f3}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!set\+\_\+subtasks@{set\+\_\+subtasks}}
\index{set\+\_\+subtasks@{set\+\_\+subtasks}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{set\+\_\+subtasks()}{set\_subtasks()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+set\+\_\+subtasks (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 821 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
821     \textcolor{keyword}{def }set\_subtasks(self, opt):
822         \textcolor{comment}{# Find assigned subtasks}
823         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'subtasks'}, \textcolor{keywordtype}{None}):
824             \textcolor{comment}{# First check if it was passed explicitly as a flag or otherwise in opt}
825             \textcolor{keywordflow}{if} isinstance(opt[\textcolor{stringliteral}{'subtasks'}], list):
826                 subtasks = opt[\textcolor{stringliteral}{'subtasks'}]
827             \textcolor{keywordflow}{else}:
828                 subtasks = opt[\textcolor{stringliteral}{'subtasks'}].split(\textcolor{stringliteral}{','})
829         \textcolor{keywordflow}{else}:
830             \textcolor{comment}{# Otherwise, try to infer from the task name.}
831             subtasks = [task.split(\textcolor{stringliteral}{':'})[1] \textcolor{keywordflow}{for} task \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'task'}].split(\textcolor{stringliteral}{','})]
832 
833         \textcolor{comment}{# Expand any abbreviations}
834         \textcolor{keywordflow}{if} subtasks[0] == \textcolor{stringliteral}{'diafee'}:
835             subtasks = [\textcolor{stringliteral}{'dialog'}, \textcolor{stringliteral}{'feedback'}]
836         \textcolor{keywordflow}{elif} subtasks[0] == \textcolor{stringliteral}{'diasat'}:
837             subtasks = [\textcolor{stringliteral}{'dialog'}, \textcolor{stringliteral}{'satisfaction'}]
838         \textcolor{keywordflow}{elif} subtasks[0] == \textcolor{stringliteral}{'all'}:
839             subtasks = [\textcolor{stringliteral}{'dialog'}, \textcolor{stringliteral}{'feedback'}, \textcolor{stringliteral}{'satisfaction'}]
840 
841         self.subtasks = subtasks
842         opt[\textcolor{stringliteral}{'subtasks'}] = subtasks  \textcolor{comment}{# Add to opt so that model module can see the list}
843 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa650efc924cd97c7ac6303fad46aeee6}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_aa650efc924cd97c7ac6303fad46aeee6}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!train\+\_\+step@{train\+\_\+step}}
\index{train\+\_\+step@{train\+\_\+step}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{train\+\_\+step()}{train\_step()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+train\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}Train on a single batch of examples.
\end{DoxyVerb}
 

Definition at line 418 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
418     \textcolor{keyword}{def }train\_step(self, batch):
419         \textcolor{stringliteral}{"""}
420 \textcolor{stringliteral}{        Train on a single batch of examples.}
421 \textcolor{stringliteral}{        """}
422         \textcolor{keywordflow}{if} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
423             \textcolor{keywordflow}{return}
424 
425         self.model.\hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a36a5f4f6f9df0611a6818610518d2cf0}{train}()
426         self.optimizer.zero\_grad()
427 
428         batchsize = batch.text\_vec.size(0)
429         self.metrics[\textcolor{stringliteral}{'examples'}] += batchsize
430 
431         \textcolor{keywordflow}{if} self.subtask == \textcolor{stringliteral}{'dialog'}:
432             loss, preds, \_ = self.dialog\_step(batch)
433         \textcolor{keywordflow}{elif} self.subtask == \textcolor{stringliteral}{'feedback'}:
434             loss, preds, \_ = self.feedback\_step(batch)
435         \textcolor{keywordflow}{elif} self.subtask == \textcolor{stringliteral}{'satisfaction'}:
436             loss, preds = self.satisfaction\_step(batch)
437             preds = [\hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(p) \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} preds]
438 
439         \textcolor{comment}{# Weight loss by task-weight}
440         loss *= self.task\_weight[self.subtask]
441 
442         loss.backward()
443         self.update\_params()
444 
445         \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds)
446 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a6891c2c3b9782cc190dad6f3f89c8390}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a6891c2c3b9782cc190dad6f3f89c8390}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!update\+\_\+dia\+\_\+metrics@{update\+\_\+dia\+\_\+metrics}}
\index{update\+\_\+dia\+\_\+metrics@{update\+\_\+dia\+\_\+metrics}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{update\+\_\+dia\+\_\+metrics()}{update\_dia\_metrics()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+update\+\_\+dia\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{loss,  }\item[{}]{ranks,  }\item[{}]{label\+\_\+inds,  }\item[{}]{batchsize }\end{DoxyParamCaption})}



Definition at line 585 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
585     \textcolor{keyword}{def }update\_dia\_metrics(self, loss, ranks, label\_inds, batchsize):
586         self.metrics[\textcolor{stringliteral}{'dia\_exs'}] += batchsize
587         self.metrics[\textcolor{stringliteral}{'dia\_loss'}] += loss.item()
588         \textcolor{keywordflow}{if} label\_inds \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
589             \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} range(batchsize):
590                 rank = (ranks[b] == label\_inds[b]).nonzero().item()
591                 self.metrics[\textcolor{stringliteral}{'dia\_rank'}] += 1 + rank
592                 self.metrics[\textcolor{stringliteral}{'dia\_correct'}] += rank == 0
593 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a39ce3bfde7b4bcf692133012a7a3bcbc}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a39ce3bfde7b4bcf692133012a7a3bcbc}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!update\+\_\+fee\+\_\+metrics@{update\+\_\+fee\+\_\+metrics}}
\index{update\+\_\+fee\+\_\+metrics@{update\+\_\+fee\+\_\+metrics}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{update\+\_\+fee\+\_\+metrics()}{update\_fee\_metrics()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+update\+\_\+fee\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{loss,  }\item[{}]{ranks,  }\item[{}]{label\+\_\+inds,  }\item[{}]{batchsize }\end{DoxyParamCaption})}



Definition at line 594 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
594     \textcolor{keyword}{def }update\_fee\_metrics(self, loss, ranks, label\_inds, batchsize):
595         self.metrics[\textcolor{stringliteral}{'fee\_exs'}] += batchsize
596         self.metrics[\textcolor{stringliteral}{'fee\_loss'}] += loss.item()
597         \textcolor{keywordflow}{if} label\_inds \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
598             \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} range(batchsize):
599                 rank = (ranks[b] == label\_inds[b]).nonzero().item()
600                 self.metrics[\textcolor{stringliteral}{'fee\_rank'}] += 1 + rank
601                 self.metrics[\textcolor{stringliteral}{'fee\_correct'}] += rank == 0
602 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab41a6e0b9f7ba0163ebb1152eadfdeb1}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab41a6e0b9f7ba0163ebb1152eadfdeb1}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!update\+\_\+sat\+\_\+metrics@{update\+\_\+sat\+\_\+metrics}}
\index{update\+\_\+sat\+\_\+metrics@{update\+\_\+sat\+\_\+metrics}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{update\+\_\+sat\+\_\+metrics()}{update\_sat\_metrics()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+update\+\_\+sat\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{loss,  }\item[{}]{preds,  }\item[{}]{labels,  }\item[{}]{batchsize }\end{DoxyParamCaption})}



Definition at line 603 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
603     \textcolor{keyword}{def }update\_sat\_metrics(self, loss, preds, labels, batchsize):
604         \textcolor{comment}{# tp/fp/tn/fn are w/r/t the rarer class (negative responses)}
605         self.metrics[\textcolor{stringliteral}{'sat\_exs'}] += batchsize
606         self.metrics[\textcolor{stringliteral}{'sat\_loss'}] += loss.item()
607         a = self.opt[\textcolor{stringliteral}{'target\_class'}]
608         b = \textcolor{keywordflow}{not} self.opt[\textcolor{stringliteral}{'target\_class'}]
609         \textcolor{keyword}{assert} a \textcolor{keywordflow}{in} [0, 1]
610         \textcolor{keyword}{assert} b \textcolor{keywordflow}{in} [0, 1]
611         self.metrics[\textcolor{stringliteral}{'sat\_tp'}] += ((preds == labels) * (labels == a)).sum().item()
612         self.metrics[\textcolor{stringliteral}{'sat\_fp'}] += ((preds != labels) * (labels == b)).sum().item()
613         self.metrics[\textcolor{stringliteral}{'sat\_tn'}] += ((preds == labels) * (labels == b)).sum().item()
614         self.metrics[\textcolor{stringliteral}{'sat\_fn'}] += ((preds != labels) * (labels == a)).sum().item()
615 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a89a2bb3f299fe29c018ea39af72446c6}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a89a2bb3f299fe29c018ea39af72446c6}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!upgrade\+\_\+opt@{upgrade\+\_\+opt}}
\index{upgrade\+\_\+opt@{upgrade\+\_\+opt}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{upgrade\+\_\+opt()}{upgrade\_opt()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+upgrade\+\_\+opt (\begin{DoxyParamCaption}\item[{}]{cls,  }\item[{}]{opt\+\_\+on\+\_\+disk }\end{DoxyParamCaption})}

\begin{DoxyVerb}Upgrade opts from older model files.
\end{DoxyVerb}
 

Definition at line 284 of file self\+\_\+feeding\+\_\+agent.\+py.


\begin{DoxyCode}
284     \textcolor{keyword}{def }upgrade\_opt(cls, opt\_on\_disk):
285         \textcolor{stringliteral}{"""}
286 \textcolor{stringliteral}{        Upgrade opts from older model files.}
287 \textcolor{stringliteral}{        """}
288         super(SelfFeedingAgent, cls).upgrade\_opt(opt\_on\_disk)
289 
290         \textcolor{comment}{# 2019-06-25: previous versions of the model did not add a CLS token}
291         \textcolor{comment}{# to the beginning of text\_vec.}
292         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'add\_double\_person\_tokens'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt\_on\_disk:
293             \hyperlink{namespaceparlai_1_1utils_1_1misc_acf146e70ea7f6867969a7c2b545d4b4b}{warn\_once}(\textcolor{stringliteral}{'Old model: overriding `add\_double\_person\_tokens` to True.'})
294             opt\_on\_disk[\textcolor{stringliteral}{'add\_double\_person\_tokens'}] = \textcolor{keyword}{True}
295 
296         \textcolor{keywordflow}{return} opt\_on\_disk
297 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a02d034bc0c9208fb3d6561b90f176ddf}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a02d034bc0c9208fb3d6561b90f176ddf}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!eval\+\_\+candidates@{eval\+\_\+candidates}}
\index{eval\+\_\+candidates@{eval\+\_\+candidates}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{eval\+\_\+candidates}{eval\_candidates}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+eval\+\_\+candidates}



Definition at line 495 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4f3aa2b94dedfa052d15e80e046070d4}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a4f3aa2b94dedfa052d15e80e046070d4}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!last\+\_\+rating@{last\+\_\+rating}}
\index{last\+\_\+rating@{last\+\_\+rating}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{last\+\_\+rating}{last\_rating}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+last\+\_\+rating}



Definition at line 370 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a810afc1857cbf598661e845ee00c0483}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a810afc1857cbf598661e845ee00c0483}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!model@{model}}
\index{model@{model}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{model}{model}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+model}



Definition at line 300 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59261a9ada05e97b6b9e9f10c193e9b7}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59261a9ada05e97b6b9e9f10c193e9b7}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!multitask@{multitask}}
\index{multitask@{multitask}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{multitask}{multitask}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+multitask}



Definition at line 233 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ac78fd692baee6b61bcf079b0a3d11cab}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ac78fd692baee6b61bcf079b0a3d11cab}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!observation@{observation}}
\index{observation@{observation}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{observation}{observation}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+observation}



Definition at line 385 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a30211c1fec9722594aca49c18670c711}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a30211c1fec9722594aca49c18670c711}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!prev\+\_\+response@{prev\+\_\+response}}
\index{prev\+\_\+response@{prev\+\_\+response}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{prev\+\_\+response}{prev\_response}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+prev\+\_\+response}



Definition at line 254 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a27184d7df8f89fd0643b4973674826d7}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a27184d7df8f89fd0643b4973674826d7}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!prev\+\_\+responses@{prev\+\_\+responses}}
\index{prev\+\_\+responses@{prev\+\_\+responses}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{prev\+\_\+responses}{prev\_responses}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+prev\+\_\+responses}



Definition at line 245 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ace46abbade806237aef24a58a76d554f}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ace46abbade806237aef24a58a76d554f}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!rating\+\_\+classifier@{rating\+\_\+classifier}}
\index{rating\+\_\+classifier@{rating\+\_\+classifier}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{rating\+\_\+classifier}{rating\_classifier}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+rating\+\_\+classifier}



Definition at line 278 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a91168bac37bb10ada694c29d47039c35}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a91168bac37bb10ada694c29d47039c35}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!requested\+\_\+rating@{requested\+\_\+rating}}
\index{requested\+\_\+rating@{requested\+\_\+rating}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{requested\+\_\+rating}{requested\_rating}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+requested\+\_\+rating}



Definition at line 332 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad8190f0d70c2f3415e48d23252be3834}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ad8190f0d70c2f3415e48d23252be3834}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!satisfaction\+\_\+criterion@{satisfaction\+\_\+criterion}}
\index{satisfaction\+\_\+criterion@{satisfaction\+\_\+criterion}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{satisfaction\+\_\+criterion}{satisfaction\_criterion}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+satisfaction\+\_\+criterion}



Definition at line 274 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59ba1da30dacc1c8c7a7a321d94c25d6}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a59ba1da30dacc1c8c7a7a321d94c25d6}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!status@{status}}
\index{status@{status}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{status}{status}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+status}



Definition at line 258 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a25ee430dd49391cc8265f2a3e789bbf0}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a25ee430dd49391cc8265f2a3e789bbf0}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!subtask@{subtask}}
\index{subtask@{subtask}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{subtask}{subtask}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+subtask}



Definition at line 235 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a47fd708e2c3e2c5a5e48e32126543c8c}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_a47fd708e2c3e2c5a5e48e32126543c8c}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!subtasks@{subtasks}}
\index{subtasks@{subtasks}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{subtasks}{subtasks}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+subtasks}



Definition at line 841 of file self\+\_\+feeding\+\_\+agent.\+py.

\mbox{\Hypertarget{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab2d87eedf68d027424673ada89954fc1}\label{classprojects_1_1self__feeding_1_1self__feeding__agent_1_1SelfFeedingAgent_ab2d87eedf68d027424673ada89954fc1}} 
\index{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}!task\+\_\+weight@{task\+\_\+weight}}
\index{task\+\_\+weight@{task\+\_\+weight}!projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent@{projects\+::self\+\_\+feeding\+::self\+\_\+feeding\+\_\+agent\+::\+Self\+Feeding\+Agent}}
\subsubsection{\texorpdfstring{task\+\_\+weight}{task\_weight}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+self\+\_\+feeding\+\_\+agent.\+Self\+Feeding\+Agent.\+task\+\_\+weight}



Definition at line 266 of file self\+\_\+feeding\+\_\+agent.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
projects/self\+\_\+feeding/\hyperlink{self__feeding__agent_8py}{self\+\_\+feeding\+\_\+agent.\+py}\end{DoxyCompactItemize}
