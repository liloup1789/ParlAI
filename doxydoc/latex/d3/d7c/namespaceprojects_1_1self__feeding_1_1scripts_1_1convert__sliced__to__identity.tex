\hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity}{}\section{projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+sliced\+\_\+to\+\_\+identity Namespace Reference}
\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity}\index{projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+sliced\+\_\+to\+\_\+identity@{projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+sliced\+\_\+to\+\_\+identity}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_aea494b2057e7cfdbd2ecd268327400c4}{setup\+\_\+args} ()
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_a330625b0a6e9b8fc90da17503b083312}{main} (\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_a33616a4dd26d8519ee4fcde480fc5fc2}{config})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_a33616a4dd26d8519ee4fcde480fc5fc2}{config}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_a330625b0a6e9b8fc90da17503b083312}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_a330625b0a6e9b8fc90da17503b083312}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity}!main@{main}}
\index{main@{main}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+sliced\+\_\+to\+\_\+identity.\+main (\begin{DoxyParamCaption}\item[{}]{config }\end{DoxyParamCaption})}

\begin{DoxyVerb}Creates .identity files from .sliced files.

input: a .sliced file of logs (in ParlaiDialog format) from Mturk task 1, each of
    which starts with an initial prompt or topic request, and ends with a y_exp
output: an .identity file (in self-feeding format) with y_exps used as though they
    were ys
\end{DoxyVerb}
 

Definition at line 25 of file convert\+\_\+sliced\+\_\+to\+\_\+identity.\+py.


\begin{DoxyCode}
25 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_a330625b0a6e9b8fc90da17503b083312}{main}(config):
26     \textcolor{stringliteral}{"""}
27 \textcolor{stringliteral}{    Creates .identity files from .sliced files.}
28 \textcolor{stringliteral}{}
29 \textcolor{stringliteral}{    input: a .sliced file of logs (in ParlaiDialog format) from Mturk task 1, each of}
30 \textcolor{stringliteral}{        which starts with an initial prompt or topic request, and ends with a y\_exp}
31 \textcolor{stringliteral}{    output: an .identity file (in self-feeding format) with y\_exps used as though they}
32 \textcolor{stringliteral}{        were ys}
33 \textcolor{stringliteral}{    """}
34     examples = []
35     episodes = [e \textcolor{keywordflow}{for} e \textcolor{keywordflow}{in} \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a7bfa2fe610a2d0da7968b1a2662e0c23}{extract\_parlai\_episodes}(config[\textcolor{stringliteral}{'infile'}])]
36     \textcolor{keywordflow}{for} episode \textcolor{keywordflow}{in} episodes:
37         history = []
38         num\_parleys = len(episode)
39         \textcolor{keywordflow}{for} i, parley \textcolor{keywordflow}{in} enumerate(episode):
40             \textcolor{keywordflow}{if} i == 0:  \textcolor{comment}{# Don't include the topic request}
41                 history.append(parley.response)
42                 \textcolor{keywordflow}{continue}
43             \textcolor{keywordflow}{elif} i == num\_parleys - 2:
44                 \textcolor{comment}{# penultimate turn was mistake and negative feedback}
45                 \textcolor{keywordflow}{continue}
46             \textcolor{keywordflow}{elif} i == num\_parleys - 1:
47                 \textcolor{comment}{# ultimate turn was correction request and y\_exp}
48                 example = Parley(
49                     context=\hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a3f3d055dc6c4058057baae7b240de5ec}{add\_person\_tokens}(history, last\_speaker=1),
50                     response=parley.response,  \textcolor{comment}{# y\_exp}
51                 )
52                 examples.append(example)
53             \textcolor{keywordflow}{else}:
54                 \textcolor{comment}{# normal turn; just add to history}
55                 history.append(parley.context)
56                 history.append(parley.response)
57 
58     \textcolor{comment}{# Write new episodes to self-feeding format}
59     with open(config[\textcolor{stringliteral}{'outfile'}], \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} outfile:
60         \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} examples:
61             outfile.write(json.dumps(ex.to\_dict()) + \textcolor{stringliteral}{'\(\backslash\)n'})
62 
63     print(
64         f\textcolor{stringliteral}{"Extracted \{len(examples)\} self-feeding episodes out of "}
65         f\textcolor{stringliteral}{"\{len(episodes)\} parlai episodes and wrote them to \{config['outfile']\}."}
66     )
67 
68 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_aea494b2057e7cfdbd2ecd268327400c4}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_aea494b2057e7cfdbd2ecd268327400c4}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity}!setup\+\_\+args@{setup\+\_\+args}}
\index{setup\+\_\+args@{setup\+\_\+args}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{setup\+\_\+args()}{setup\_args()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+sliced\+\_\+to\+\_\+identity.\+setup\+\_\+args (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 16 of file convert\+\_\+sliced\+\_\+to\+\_\+identity.\+py.


\begin{DoxyCode}
16 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_aea494b2057e7cfdbd2ecd268327400c4}{setup\_args}():
17     argparser = ArgumentParser()
18     argparser.add\_argument(\textcolor{stringliteral}{'-if'}, \textcolor{stringliteral}{'--infile'}, type=str)
19     argparser.add\_argument(\textcolor{stringliteral}{'-of'}, \textcolor{stringliteral}{'--outfile'}, type=str)
20     config = vars(argparser.parse\_args())
21 
22     \textcolor{keywordflow}{return} config
23 
24 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_a33616a4dd26d8519ee4fcde480fc5fc2}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__sliced__to__identity_a33616a4dd26d8519ee4fcde480fc5fc2}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity}!config@{config}}
\index{config@{config}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+sliced\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{config}{config}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+sliced\+\_\+to\+\_\+identity.\+config}



Definition at line 70 of file convert\+\_\+sliced\+\_\+to\+\_\+identity.\+py.

