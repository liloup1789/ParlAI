\hypertarget{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent}{}\section{projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Seq2\+Seq\+Model\+Agent Class Reference}
\label{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent}\index{projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Seq2\+Seq\+Model\+Agent@{projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Seq2\+Seq\+Model\+Agent}}


Inheritance diagram for projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Seq2\+Seq\+Model\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=257pt]{d5/dff/classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Seq2\+Seq\+Model\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=257pt]{d1/da0/classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent_a355995e11c4f10e710dab06afa743373}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1core_1_1agents_1_1Agent_ab3b45d2754244608c75d4068b90cd051}{opt}, shared=None, \hyperlink{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ModelAgentBase_a229b7901e20dced7e3b3c3e2d381d2ce}{data\+\_\+agent}=None)
\item 
def \hyperlink{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent_a4a6f60aa35a0fcf6e033cf2fef28342b}{batch\+\_\+act} (self, observations)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent_a97c080f3159cacb53bf3bd35109029d6}{model}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 708 of file agents.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent_a355995e11c4f10e710dab06afa743373}\label{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent_a355995e11c4f10e710dab06afa743373}} 
\index{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Seq2\+Seq\+Model\+Agent.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None},  }\item[{}]{data\+\_\+agent = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 709 of file agents.\+py.


\begin{DoxyCode}
709     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None, data\_agent=None):
710         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} shared:
711             self.model = Seq2SeqModel(opt, data\_agent)
712         super().\_\_init\_\_(opt, shared, data\_agent)
713 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent_a4a6f60aa35a0fcf6e033cf2fef28342b}\label{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent_a4a6f60aa35a0fcf6e033cf2fef28342b}} 
\index{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent}!batch\+\_\+act@{batch\+\_\+act}}
\index{batch\+\_\+act@{batch\+\_\+act}!projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent}}
\subsubsection{\texorpdfstring{batch\+\_\+act()}{batch\_act()}}
{\footnotesize\ttfamily def projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Seq2\+Seq\+Model\+Agent.\+batch\+\_\+act (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observations }\end{DoxyParamCaption})}



Definition at line 714 of file agents.\+py.


\begin{DoxyCode}
714     \textcolor{keyword}{def }batch\_act(self, observations):
715         ori\_len = len(observations)
716         observations = [obv \textcolor{keywordflow}{for} obv \textcolor{keywordflow}{in} observations \textcolor{keywordflow}{if} \textcolor{stringliteral}{'text'} \textcolor{keywordflow}{in} obv]
717         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'datatype'}] == \textcolor{stringliteral}{'train'}:
718             x, y = self.data\_agent.get\_data(observations)
719             x, y = self.\_get\_variable(x), self.\_get\_variable(y)
720 
721             loss = self.model.forward\_loss(x, y)
722             self.optimizer.zero\_grad()
723             loss.backward()
724             self.optimizer.step()
725 
726             reply = [\{\}] * ori\_len
727             reply[0][\textcolor{stringliteral}{'loss'}] = loss.data[0]
728             \textcolor{keywordflow}{return} reply
729         \textcolor{keywordflow}{else}:
730             x, y = self.data\_agent.get\_data(observations, \textcolor{stringliteral}{'valid'})
731             x, y = self.\_get\_variable(x), self.\_get\_variable(y)
732 
733             loss = self.model.forward\_loss(x, y)
734             reply = [
735                 \{
736                     \textcolor{stringliteral}{'loss'}: 0.0,
737                     \textcolor{stringliteral}{'cnt'}: 0.0,
738                     \textcolor{stringliteral}{'acc'}: 0,
739                     \textcolor{stringliteral}{'len'}: 0,
740                     \textcolor{stringliteral}{'f1'}: 0,
741                     \textcolor{stringliteral}{'correct\_data'}: [],
742                     \textcolor{stringliteral}{'wrong\_data'}: [],
743                 \}
744                 \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(ori\_len)
745             ]
746 
747             text\_out = self.model.forward\_predict(
748                 x, [obv[\textcolor{stringliteral}{'graph'}] \textcolor{keywordflow}{for} obv \textcolor{keywordflow}{in} observations], self.data\_agent
749             )
750 
751             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(observations)):
752                 data\_rep = \textcolor{stringliteral}{'\{\} ||| \{\} ||| \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
753                     observations[i][\textcolor{stringliteral}{'actions'}],
754                     \textcolor{stringliteral}{' '}.join(text\_out[i][:-1]),
755                     observations[i][\textcolor{stringliteral}{'text'}],
756                 )
757 
758                 graph\_a, graph\_b = (
759                     observations[i][\textcolor{stringliteral}{'graph'}].copy(),
760                     observations[i][\textcolor{stringliteral}{'graph'}].copy(),
761                 )
762                 graph\_a.parse\_exec(observations[i][\textcolor{stringliteral}{'actions'}])
763                 graph\_b.parse\_exec(\textcolor{stringliteral}{' '}.join(text\_out[i][:-1]))
764                 \textcolor{keywordflow}{if} graph\_a == graph\_b:
765                     reply[i][\textcolor{stringliteral}{'acc'}] = 1.0
766                     reply[i][\textcolor{stringliteral}{'correct\_data'}].append(data\_rep)
767                 \textcolor{keywordflow}{else}:
768                     reply[i][\textcolor{stringliteral}{'wrong\_data'}].append(data\_rep)
769 
770                 inst, symb\_points = observations[i][\textcolor{stringliteral}{'graph'}].parse(
771                     observations[i][\textcolor{stringliteral}{'actions'}]
772                 )
773                 text\_gt = []
774                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(len(symb\_points) - 1):
775                     k, l = symb\_points[j], symb\_points[j + 1]
776                     text\_gt.append(\textcolor{stringliteral}{' '}.join(inst[k:l]))
777                 reply[i][\textcolor{stringliteral}{'f1'}] = self.\_get\_f1(text\_gt, text\_out[i])
778 
779                 reply[i][\textcolor{stringliteral}{'loss'}] = loss.data[0]
780                 reply[i][\textcolor{stringliteral}{'cnt'}] = observations[i][\textcolor{stringliteral}{'weight'}]
781                 reply[i][\textcolor{stringliteral}{'len'}] = len(text\_gt)
782 
783             \textcolor{keywordflow}{return} reply
784 \end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent_a97c080f3159cacb53bf3bd35109029d6}\label{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1Seq2SeqModelAgent_a97c080f3159cacb53bf3bd35109029d6}} 
\index{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent}!model@{model}}
\index{model@{model}!projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Seq2\+Seq\+Model\+Agent}}
\subsubsection{\texorpdfstring{model}{model}}
{\footnotesize\ttfamily projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Seq2\+Seq\+Model\+Agent.\+model}



Definition at line 711 of file agents.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
projects/mastering\+\_\+the\+\_\+dungeon/agents/graph\+\_\+world2/\hyperlink{projects_2mastering__the__dungeon_2agents_2graph__world2_2agents_8py}{agents.\+py}\end{DoxyCompactItemize}
