\hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher}{}\section{parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher Class Reference}
\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher}\index{parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher@{parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher}}


Inheritance diagram for parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/dee/classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=222pt]{dc/d47/classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aab36cededc1817fee5109293bd62c51d}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa7ca0df94cb27a11487e40343cc84de6}{opt}, shared=None)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ab64513ca6c2b1c358f180ee0846b26e0}{get\+\_\+available\+\_\+image\+\_\+mode\+\_\+names} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a2735899e5787c14da39443179db6c84b}{add\+\_\+cmdline\+\_\+args} (cls, argparser)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ada83f1832b7c75f9daab8e4d196ba893}{image\+\_\+id\+\_\+key} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a95e578f9650f77c1d397319b9050af51}{text\+\_\+key} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa75286450850638274d7f076a81f7e90}{image\+\_\+id\+\_\+to\+\_\+image\+\_\+path} (self, image\+\_\+id)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa3c1da773025838ffa03b47c3fc21c7e}{get\+\_\+data\+\_\+path} (self, \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa7ca0df94cb27a11487e40343cc84de6}{opt})
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a22a280003b7f4202e0d917040bd56eb8}{get\+\_\+image\+\_\+path} (self, \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa7ca0df94cb27a11487e40343cc84de6}{opt})
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a29fce019ea9795947235ba208aa4bfb0}{get\+\_\+image\+\_\+features\+\_\+path} (self, \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a78dca77e43183d22d75140ca113d821c}{task}, image\+\_\+model\+\_\+name, dt)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a16c2be0ffe61e136dea2a63cbd918af5}{is\+\_\+image\+\_\+mode\+\_\+buildable} (self, model\+\_\+name)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ad110a80a077e9e1135d4241083786199}{load\+\_\+data} (self, \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a9fb2d3ab4b52f70872460c624bad1218}{data\+\_\+path}, \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa7ca0df94cb27a11487e40343cc84de6}{opt})
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa6ac386d509d428870124c27265363bb}{setup\+\_\+image\+\_\+features} (self, \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a9fb2d3ab4b52f70872460c624bad1218}{data\+\_\+path})
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a13b4576dd3a045944ff1b44cb88a2764}{reset} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a702999efa941a59854ee511fc99cd117}{num\+\_\+episodes} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a4f5565f49b0aef6d084257b5090a7e40}{num\+\_\+examples} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a3e1f85a8de230d8733272bd1e860cd92}{get\+\_\+image\+\_\+features} (self, \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a404b2e622780e94083ba9539ebaab609}{example})
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ae2f395708462355b28888be7a434ebf4}{get} (self, \hyperlink{classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_afd4ebab8063eb42d182d30a1a41f133e}{episode\+\_\+idx}, \hyperlink{classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_ae3201b15f3c3b46a2f3511bad9b43e7d}{entry\+\_\+idx}=0)
\item 
def \hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a6095f493a108e30fcf22d36c146cdb8e}{share} (self)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa7ca0df94cb27a11487e40343cc84de6}{opt}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a78dca77e43183d22d75140ca113d821c}{task}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a9fb2d3ab4b52f70872460c624bad1218}{data\+\_\+path}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a4015f3b73718e13896bb464378a269f1}{data}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a335cba069093a1e1cff8f73fad9f11d1}{datatype}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a72abb2921076e7597cc946275983028b}{image\+\_\+mode}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a0e4ee3692e19e0f1df2fef8f21d058ab}{include\+\_\+image}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aff2a7f405e051f014ece5cc124aa170c}{image\+\_\+path}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aaf426bd12c83e8f8d5a217481cbf854b}{image\+\_\+loader}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a708601003f79d10c98a1933501ce658f}{image\+\_\+features\+\_\+dim}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a0c48c489fee91d94cf8d62b902bd6b27}{blank\+\_\+image\+\_\+features}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a67fc5068ab7e2c1c718614cc737d6a75}{image\+\_\+features\+\_\+dict}
\item 
\hyperlink{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a404b2e622780e94083ba9539ebaab609}{example}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Abstract class to allow easier creation of image + dialogue tasks.

This class handles creating image features via ImageLoader if applicable
(resnet, resnext variants) or loading existing image features from a dict
path as per get_image_features_path().

Important methods and properties (override in subclass if needed):
- get_data_path(): where data file is found (default: <datapath>/<task>)
- get_image_path(): where images found (default: <datapath>/<task>/images)
- get_image_features_path(): dict of image features (default:
  <datapath>/<task>/image_features)
- @property image_id_key: which key in data file objects represents image_id
- @property text_key: which key in data file objects represents text

Note: Assumes data files are named <dt>.json

@abstractmethod image_id_to_image_path() must be implemented in subclass

Example with the key defaults (but the keys can be customized):
obs = {
    'text': <caption>,
    'image': <image features if specified else image>
}
\end{DoxyVerb}
 

Definition at line 1322 of file teachers.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aab36cededc1817fee5109293bd62c51d}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aab36cededc1817fee5109293bd62c51d}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 1349 of file teachers.\+py.


\begin{DoxyCode}
1349     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
1350         super().\_\_init\_\_(opt, shared)
1351         self.opt = opt
1352         self.task = opt[\textcolor{stringliteral}{'task'}].split(\textcolor{stringliteral}{':'})[1] \textcolor{keywordflow}{if} \textcolor{stringliteral}{':'} \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'task'}] \textcolor{keywordflow}{else} opt[\textcolor{stringliteral}{'task'}]
1353         self.data\_path = self.get\_data\_path(opt)
1354         self.data = self.load\_data(self.data\_path, self.opt)
1355         self.datatype = opt.get(\textcolor{stringliteral}{'datatype'}).split(\textcolor{stringliteral}{':'})[0]
1356 
1357         \textcolor{comment}{# Example of available models: 'resnet152', 'resnext101\_32x48d\_wsl',}
1358         \textcolor{comment}{# and ImageLoader supports other resnet and resnext models too}
1359         \textcolor{comment}{# Raises an Exception if not valid}
1360         self.\_validate\_image\_mode\_name(opt.get(\textcolor{stringliteral}{'image\_mode'}))
1361 
1362         \textcolor{comment}{# IMPORTANT NOTE: this teacher will be instantiated twice. The first}
1363         \textcolor{comment}{# by build\_dict in which case the image\_mode is to 'no\_image\_model' to}
1364         \textcolor{comment}{# avoid calculating image features twice.}
1365         self.image\_mode = opt.get(\textcolor{stringliteral}{'image\_mode'})
1366 
1367         \textcolor{comment}{# Not using default image\_mode paramater b/c there is a normalization}
1368         \textcolor{comment}{# (or bug) somewhere in build\_dict that is setting it to none}
1369         self.include\_image = opt.get(\textcolor{stringliteral}{'image\_mode'}) != \textcolor{stringliteral}{'no\_image\_model'}
1370 
1371         self.image\_path = self.get\_image\_path(opt)
1372         self.image\_loader = \textcolor{keywordtype}{None}
1373         self.image\_features\_dim = opt.get(\textcolor{stringliteral}{'image\_features\_dim'})
1374         self.blank\_image\_features = torch.FloatTensor(self.image\_features\_dim).fill\_(0)
1375 
1376         \textcolor{keywordflow}{if} shared \textcolor{keywordflow}{and} \textcolor{stringliteral}{'data'} \textcolor{keywordflow}{in} shared:
1377             self.data = shared[\textcolor{stringliteral}{'data'}]
1378             self.image\_loader = shared[\textcolor{stringliteral}{'image\_loader'}]
1379             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'image\_features\_dict'} \textcolor{keywordflow}{in} shared:
1380                 self.image\_features\_dict = shared[\textcolor{stringliteral}{'image\_features\_dict'}]
1381         \textcolor{keywordflow}{elif} self.include\_image:
1382             self.setup\_image\_features(self.data\_path)
1383         \textcolor{keywordflow}{else}:
1384             \textcolor{comment}{# This will happen when building the dictionary - is normal}
1385             \textcolor{comment}{# build\_dict sets image\_mode to 'none'}
1386             \hyperlink{namespaceparlai_1_1utils_1_1misc_a884a3aefa90581f53bc592fa6a78dc43}{warn\_once}(\textcolor{stringliteral}{'AbstractImageTeacher self.include\_image was False'})
1387             self.image\_features\_dict = \textcolor{keywordtype}{None}
1388 
1389         \textcolor{comment}{# TODO: won't need this after we have proper logging levels set}
1390         self.\_\_verbose = \textcolor{keyword}{False}
1391 
1392         self.reset()
1393 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a2735899e5787c14da39443179db6c84b}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a2735899e5787c14da39443179db6c84b}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}}
\index{add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{add\+\_\+cmdline\+\_\+args()}{add\_cmdline\_args()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+add\+\_\+cmdline\+\_\+args (\begin{DoxyParamCaption}\item[{}]{cls,  }\item[{}]{argparser }\end{DoxyParamCaption})}



Definition at line 1425 of file teachers.\+py.


\begin{DoxyCode}
1425     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(cls, argparser):
1426         \textcolor{comment}{# Be sure to call super() if overriding this method b/c}
1427         \textcolor{comment}{# AbstractImageTeacher has necessary params}
1428         agent = argparser.add\_argument\_group(\textcolor{stringliteral}{'AbstractImageTeacher Arguments'})
1429         agent.add\_argument(
1430             \textcolor{stringliteral}{'--image-path'},
1431             type=str,
1432             default=\textcolor{keywordtype}{None},
1433             help=\textcolor{stringliteral}{'Optional argument to specify where images for dataset are'}
1434             \textcolor{stringliteral}{'stored if already downloaded. Most tasks will download the images'}
1435             \textcolor{stringliteral}{'if not present on the < datapath > / < task > \_images / * and * if'}
1436             \textcolor{stringliteral}{'this argument is not specified.'},
1437         )
1438 
1439         agent.add\_argument(
1440             \textcolor{stringliteral}{'--image-features-dim'},
1441             type=int,
1442             default=2048,
1443             help=\textcolor{stringliteral}{'Specify the size of image features Tensors.'},
1444         )
1445 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ae2f395708462355b28888be7a434ebf4}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ae2f395708462355b28888be7a434ebf4}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!get@{get}}
\index{get@{get}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{get()}{get()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+get (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{episode\+\_\+idx,  }\item[{}]{entry\+\_\+idx = {\ttfamily 0} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Override this in subclass if your data should be handled in a different format.
\end{DoxyVerb}
 

Definition at line 1680 of file teachers.\+py.


\begin{DoxyCode}
1680     \textcolor{keyword}{def }get(self, episode\_idx, entry\_idx=0):
1681         \textcolor{stringliteral}{"""}
1682 \textcolor{stringliteral}{        Override this in subclass if your data should be handled in a different format.}
1683 \textcolor{stringliteral}{        """}
1684         example = self.data[episode\_idx]
1685         image\_features = self.get\_image\_features(example)
1686         \textcolor{keywordflow}{return} \{
1687             \textcolor{stringliteral}{'labels'}: [example[self.text\_key]],
1688             \textcolor{stringliteral}{'image'}: image\_features,
1689             \textcolor{stringliteral}{'episode\_idx'}: episode\_idx,
1690             \textcolor{stringliteral}{'episode\_done'}: \textcolor{keyword}{True},
1691         \}
1692 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ab64513ca6c2b1c358f180ee0846b26e0}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ab64513ca6c2b1c358f180ee0846b26e0}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!get\+\_\+available\+\_\+image\+\_\+mode\+\_\+names@{get\+\_\+available\+\_\+image\+\_\+mode\+\_\+names}}
\index{get\+\_\+available\+\_\+image\+\_\+mode\+\_\+names@{get\+\_\+available\+\_\+image\+\_\+mode\+\_\+names}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{get\+\_\+available\+\_\+image\+\_\+mode\+\_\+names()}{get\_available\_image\_mode\_names()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+get\+\_\+available\+\_\+image\+\_\+mode\+\_\+names (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Available image model names.

resnet and resnext variants available from the ImageLoader. resnext101_XXXXX_wsl
is the open-sourced FB AI model (960m images, 1.5k hashtags, finetuned on
ImageNet).
\end{DoxyVerb}
 

Definition at line 1394 of file teachers.\+py.


\begin{DoxyCode}
1394     \textcolor{keyword}{def }get\_available\_image\_mode\_names(self):
1395         \textcolor{stringliteral}{"""}
1396 \textcolor{stringliteral}{        Available image model names.}
1397 \textcolor{stringliteral}{}
1398 \textcolor{stringliteral}{        resnet and resnext variants available from the ImageLoader. resnext101\_XXXXX\_wsl}
1399 \textcolor{stringliteral}{        is the open-sourced FB AI model (960m images, 1.5k hashtags, finetuned on}
1400 \textcolor{stringliteral}{        ImageNet).}
1401 \textcolor{stringliteral}{        """}
1402         available\_model\_names = ImageLoader.get\_available\_model\_names()
1403         \textcolor{keywordflow}{return} [\textcolor{stringliteral}{'no\_image\_model'}, \textcolor{stringliteral}{'raw'}, \textcolor{stringliteral}{'ascii'}] + available\_model\_names
1404 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa3c1da773025838ffa03b47c3fc21c7e}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa3c1da773025838ffa03b47c3fc21c7e}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!get\+\_\+data\+\_\+path@{get\+\_\+data\+\_\+path}}
\index{get\+\_\+data\+\_\+path@{get\+\_\+data\+\_\+path}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{get\+\_\+data\+\_\+path()}{get\_data\_path()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+get\+\_\+data\+\_\+path (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Determines path to the data file.
\end{DoxyVerb}
 

Definition at line 1473 of file teachers.\+py.


\begin{DoxyCode}
1473     \textcolor{keyword}{def }get\_data\_path(self, opt):
1474         \textcolor{stringliteral}{"""}
1475 \textcolor{stringliteral}{        Determines path to the data file.}
1476 \textcolor{stringliteral}{        """}
1477         task\_name = opt[\textcolor{stringliteral}{'task'}].split(\textcolor{stringliteral}{':'})[1] \textcolor{keywordflow}{if} \textcolor{stringliteral}{':'} \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'task'}] \textcolor{keywordflow}{else} opt[\textcolor{stringliteral}{'task'}]
1478         data\_path = os.path.join(opt[\textcolor{stringliteral}{'datapath'}], task\_name)
1479         \textcolor{keywordflow}{return} data\_path
1480 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a3e1f85a8de230d8733272bd1e860cd92}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a3e1f85a8de230d8733272bd1e860cd92}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!get\+\_\+image\+\_\+features@{get\+\_\+image\+\_\+features}}
\index{get\+\_\+image\+\_\+features@{get\+\_\+image\+\_\+features}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{get\+\_\+image\+\_\+features()}{get\_image\_features()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+get\+\_\+image\+\_\+features (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{example }\end{DoxyParamCaption})}

\begin{DoxyVerb}Get image features for example.

Can be overrided in subclass for different behavior. For large datasets, it may
be more appropriate to use the ImageLoader.load() method to load image features
(as this is essentially streaming the features from disk, so that we do not have
to load a large image feature dict in memory). #TODO Could be the default option
if we are using -dt train:stream
\end{DoxyVerb}
 

Definition at line 1653 of file teachers.\+py.


\begin{DoxyCode}
1653     \textcolor{keyword}{def }get\_image\_features(self, example):
1654         \textcolor{stringliteral}{"""}
1655 \textcolor{stringliteral}{        Get image features for example.}
1656 \textcolor{stringliteral}{}
1657 \textcolor{stringliteral}{        Can be overrided in subclass for different behavior. For large datasets, it may}
1658 \textcolor{stringliteral}{        be more appropriate to use the ImageLoader.load() method to load image features}
1659 \textcolor{stringliteral}{        (as this is essentially streaming the features from disk, so that we do not have}
1660 \textcolor{stringliteral}{        to load a large image feature dict in memory). #TODO Could be the default option}
1661 \textcolor{stringliteral}{        if we are using -dt train:stream}
1662 \textcolor{stringliteral}{        """}
1663         \textcolor{keywordflow}{if} self.image\_mode \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'raw'}, \textcolor{stringliteral}{'ascii'}]:
1664             \textcolor{keywordflow}{try}:
1665                 image = self.image\_loader.load(
1666                     self.image\_id\_to\_image\_path(example[\textcolor{stringliteral}{'image\_id'}])
1667                 )
1668             \textcolor{keywordflow}{except} FileNotFoundError:
1669                 \textcolor{comment}{# No Image Here}
1670                 image = \textcolor{keywordtype}{None}
1671             \textcolor{keywordflow}{return} image
1672 
1673         key = \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(example[self.image\_id\_key])
1674         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.include\_image \textcolor{keywordflow}{or} key \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.image\_features\_dict:
1675             image\_features = self.blank\_image\_features
1676         \textcolor{keywordflow}{else}:
1677             image\_features = self.image\_features\_dict[key]
1678         \textcolor{keywordflow}{return} image\_features
1679 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a29fce019ea9795947235ba208aa4bfb0}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a29fce019ea9795947235ba208aa4bfb0}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!get\+\_\+image\+\_\+features\+\_\+path@{get\+\_\+image\+\_\+features\+\_\+path}}
\index{get\+\_\+image\+\_\+features\+\_\+path@{get\+\_\+image\+\_\+features\+\_\+path}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{get\+\_\+image\+\_\+features\+\_\+path()}{get\_image\_features\_path()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+get\+\_\+image\+\_\+features\+\_\+path (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{task,  }\item[{}]{image\+\_\+model\+\_\+name,  }\item[{}]{dt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Image features for the dataset images are stored here.

Can be overriden in subclass to use custom paths. Image features can be manually
copied into this directory or in the case of ImageLoader eligible models, they
will be built and stored here if not already there.
\end{DoxyVerb}
 

Definition at line 1498 of file teachers.\+py.


\begin{DoxyCode}
1498     \textcolor{keyword}{def }get\_image\_features\_path(self, task, image\_model\_name, dt):
1499         \textcolor{stringliteral}{"""}
1500 \textcolor{stringliteral}{        Image features for the dataset images are stored here.}
1501 \textcolor{stringliteral}{}
1502 \textcolor{stringliteral}{        Can be overriden in subclass to use custom paths. Image features can be manually}
1503 \textcolor{stringliteral}{        copied into this directory or in the case of ImageLoader eligible models, they}
1504 \textcolor{stringliteral}{        will be built and stored here if not already there.}
1505 \textcolor{stringliteral}{        """}
1506         \textcolor{comment}{# In default implementation, self.data\_path already has task name added}
1507         image\_features\_path = os.path.join(self.data\_path, \textcolor{stringliteral}{'image\_features'})
1508 
1509         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.isdir(image\_features\_path):
1510             os.makedirs(image\_features\_path)
1511 
1512         \textcolor{keywordflow}{return} os.path.join(
1513             image\_features\_path, \textcolor{stringliteral}{'%s\_%s\_%s\_features\_dict'} % (task, image\_model\_name, dt)
1514         )
1515 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a22a280003b7f4202e0d917040bd56eb8}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a22a280003b7f4202e0d917040bd56eb8}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!get\+\_\+image\+\_\+path@{get\+\_\+image\+\_\+path}}
\index{get\+\_\+image\+\_\+path@{get\+\_\+image\+\_\+path}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{get\+\_\+image\+\_\+path()}{get\_image\_path()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+get\+\_\+image\+\_\+path (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return the path to the data directory and to the image directory.

Is based on opt fields: task, datatype (train, valid, test), datapath.

Subclass can override this.
\end{DoxyVerb}
 

Definition at line 1481 of file teachers.\+py.


\begin{DoxyCode}
1481     \textcolor{keyword}{def }get\_image\_path(self, opt):
1482         \textcolor{stringliteral}{"""}
1483 \textcolor{stringliteral}{        Return the path to the data directory and to the image directory.}
1484 \textcolor{stringliteral}{}
1485 \textcolor{stringliteral}{        Is based on opt fields: task, datatype (train, valid, test), datapath.}
1486 \textcolor{stringliteral}{}
1487 \textcolor{stringliteral}{        Subclass can override this.}
1488 \textcolor{stringliteral}{        """}
1489         data\_path = self.get\_data\_path(opt)
1490         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'image\_path'}, \textcolor{keywordtype}{None}):
1491             image\_path = opt[\textcolor{stringliteral}{'image\_path'}]
1492         \textcolor{keywordflow}{else}:
1493             \textcolor{comment}{# other common choice: .join(opt['datapath'], task\_name + '\_images')}
1494             image\_path = os.path.join(data\_path, \textcolor{stringliteral}{'images'})
1495 
1496         \textcolor{keywordflow}{return} image\_path
1497 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ada83f1832b7c75f9daab8e4d196ba893}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ada83f1832b7c75f9daab8e4d196ba893}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!image\+\_\+id\+\_\+key@{image\+\_\+id\+\_\+key}}
\index{image\+\_\+id\+\_\+key@{image\+\_\+id\+\_\+key}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{image\+\_\+id\+\_\+key()}{image\_id\_key()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+image\+\_\+id\+\_\+key (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Which key in the input data dict objects uniquely identify each image.

Common image keys are "image_id" or "image_num". May be implemented by subclass.
\end{DoxyVerb}
 

Definition at line 1447 of file teachers.\+py.


\begin{DoxyCode}
1447     \textcolor{keyword}{def }image\_id\_key(self):
1448         \textcolor{stringliteral}{"""}
1449 \textcolor{stringliteral}{        Which key in the input data dict objects uniquely identify each image.}
1450 \textcolor{stringliteral}{}
1451 \textcolor{stringliteral}{        Common image keys are "image\_id" or "image\_num". May be implemented by subclass.}
1452 \textcolor{stringliteral}{        """}
1453         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'image\_id'}
1454 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa75286450850638274d7f076a81f7e90}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa75286450850638274d7f076a81f7e90}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!image\+\_\+id\+\_\+to\+\_\+image\+\_\+path@{image\+\_\+id\+\_\+to\+\_\+image\+\_\+path}}
\index{image\+\_\+id\+\_\+to\+\_\+image\+\_\+path@{image\+\_\+id\+\_\+to\+\_\+image\+\_\+path}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{image\+\_\+id\+\_\+to\+\_\+image\+\_\+path()}{image\_id\_to\_image\_path()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+image\+\_\+id\+\_\+to\+\_\+image\+\_\+path (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{image\+\_\+id }\end{DoxyParamCaption})}

\begin{DoxyVerb}Get the path of the image on disk.

Must be implemented by subclass.
\end{DoxyVerb}
 

Definition at line 1465 of file teachers.\+py.


\begin{DoxyCode}
1465     \textcolor{keyword}{def }image\_id\_to\_image\_path(self, image\_id):
1466         \textcolor{stringliteral}{"""}
1467 \textcolor{stringliteral}{        Get the path of the image on disk.}
1468 \textcolor{stringliteral}{}
1469 \textcolor{stringliteral}{        Must be implemented by subclass.}
1470 \textcolor{stringliteral}{        """}
1471         \textcolor{keywordflow}{pass}
1472 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a16c2be0ffe61e136dea2a63cbd918af5}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a16c2be0ffe61e136dea2a63cbd918af5}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!is\+\_\+image\+\_\+mode\+\_\+buildable@{is\+\_\+image\+\_\+mode\+\_\+buildable}}
\index{is\+\_\+image\+\_\+mode\+\_\+buildable@{is\+\_\+image\+\_\+mode\+\_\+buildable}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{is\+\_\+image\+\_\+mode\+\_\+buildable()}{is\_image\_mode\_buildable()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+is\+\_\+image\+\_\+mode\+\_\+buildable (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{model\+\_\+name }\end{DoxyParamCaption})}

\begin{DoxyVerb}Is buildable if features can be calculated by ImageLoader.

Users may wish to compute features for the dataset offline and use in the model,
in which case, the image model should return False and get_image_features()
should be overriden in subclass.
\end{DoxyVerb}
 

Definition at line 1516 of file teachers.\+py.


\begin{DoxyCode}
1516     \textcolor{keyword}{def }is\_image\_mode\_buildable(self, model\_name):
1517         \textcolor{stringliteral}{"""}
1518 \textcolor{stringliteral}{        Is buildable if features can be calculated by ImageLoader.}
1519 \textcolor{stringliteral}{}
1520 \textcolor{stringliteral}{        Users may wish to compute features for the dataset offline and use in the model,}
1521 \textcolor{stringliteral}{        in which case, the image model should return False and get\_image\_features()}
1522 \textcolor{stringliteral}{        should be overriden in subclass.}
1523 \textcolor{stringliteral}{        """}
1524         \textcolor{keywordflow}{return} model\_name \textcolor{keywordflow}{in} ImageLoader.get\_available\_model\_names()
1525 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ad110a80a077e9e1135d4241083786199}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_ad110a80a077e9e1135d4241083786199}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!load\+\_\+data@{load\+\_\+data}}
\index{load\+\_\+data@{load\+\_\+data}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{load\+\_\+data()}{load\_data()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+load\+\_\+data (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{data\+\_\+path,  }\item[{}]{opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Loading the data file, which is the index to the images and text.

It is often a .json file with the name of the <datatype>.json (i.e.
train.json). Stores in self.data.

Can be override by subclass.
\end{DoxyVerb}
 

Definition at line 1526 of file teachers.\+py.


\begin{DoxyCode}
1526     \textcolor{keyword}{def }load\_data(self, data\_path, opt):
1527         \textcolor{stringliteral}{"""}
1528 \textcolor{stringliteral}{        Loading the data file, which is the index to the images and text.}
1529 \textcolor{stringliteral}{}
1530 \textcolor{stringliteral}{        It is often a .json file with the name of the <datatype>.json (i.e.}
1531 \textcolor{stringliteral}{        train.json). Stores in self.data.}
1532 \textcolor{stringliteral}{}
1533 \textcolor{stringliteral}{        Can be override by subclass.}
1534 \textcolor{stringliteral}{        """}
1535 
1536         dt = opt[\textcolor{stringliteral}{'datatype'}].split(\textcolor{stringliteral}{':'})[0]
1537 
1538         \textcolor{comment}{# Sometimes file is named "val" instead of "valid"}
1539         \textcolor{keywordflow}{if} dt \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'train'}, \textcolor{stringliteral}{'valid'}, \textcolor{stringliteral}{'val'}, \textcolor{stringliteral}{'test'}]:
1540             \textcolor{keywordflow}{raise} Exception(
1541                 \textcolor{stringliteral}{'Unknown dt parameter: %s. Expected either "train", "valid", or "test".'}
1542                 % dt
1543             )
1544 
1545         \textcolor{comment}{# Assumes file is train.json or valid.json named}
1546         data\_file = os.path.join(self.data\_path, \textcolor{stringliteral}{'%s.json'} % dt)
1547 
1548         \textcolor{comment}{# Load the text data and image number indexes}
1549         with open(data\_file) \textcolor{keyword}{as} f:
1550             self.data = json.load(f)
1551 
1552         \textcolor{keywordflow}{if} len(self.data) > 0 \textcolor{keywordflow}{and} self.image\_id\_key \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.data[0]:
1553             \textcolor{comment}{# Data doesn't have a "image\_id" like field so add the index in the file to the data}
1554             \textcolor{keywordflow}{for} idx, d \textcolor{keywordflow}{in} enumerate(self.data):
1555                 d[self.image\_id\_key] = idx
1556 
1557         \textcolor{keywordflow}{return} self.data
1558 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a702999efa941a59854ee511fc99cd117}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a702999efa941a59854ee511fc99cd117}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!num\+\_\+episodes@{num\+\_\+episodes}}
\index{num\+\_\+episodes@{num\+\_\+episodes}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{num\+\_\+episodes()}{num\_episodes()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+num\+\_\+episodes (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1647 of file teachers.\+py.


\begin{DoxyCode}
1647     \textcolor{keyword}{def }num\_episodes(self):
1648         \textcolor{keywordflow}{return} self.num\_examples()
1649 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a4f5565f49b0aef6d084257b5090a7e40}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a4f5565f49b0aef6d084257b5090a7e40}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!num\+\_\+examples@{num\+\_\+examples}}
\index{num\+\_\+examples@{num\+\_\+examples}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{num\+\_\+examples()}{num\_examples()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+num\+\_\+examples (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1650 of file teachers.\+py.


\begin{DoxyCode}
1650     \textcolor{keyword}{def }num\_examples(self):
1651         \textcolor{keywordflow}{return} len(self.data)
1652 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a13b4576dd3a045944ff1b44cb88a2764}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a13b4576dd3a045944ff1b44cb88a2764}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!reset@{reset}}
\index{reset@{reset}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+reset (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1643 of file teachers.\+py.


\begin{DoxyCode}
1643     \textcolor{keyword}{def }reset(self):
1644         super().reset()
1645         self.example = \textcolor{keywordtype}{None}
1646 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa6ac386d509d428870124c27265363bb}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa6ac386d509d428870124c27265363bb}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!setup\+\_\+image\+\_\+features@{setup\+\_\+image\+\_\+features}}
\index{setup\+\_\+image\+\_\+features@{setup\+\_\+image\+\_\+features}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{setup\+\_\+image\+\_\+features()}{setup\_image\_features()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+setup\+\_\+image\+\_\+features (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{data\+\_\+path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Load text and image data.

The image features all live in dicts by default in <data_path>/
image_features/ but get_image_features_path() above can be overriden by
subclass to put them elsewhere.

In the (very odd) case that the resnet or resnext dicts (models
buildable using ImageLoader) are not found, we build them.
\end{DoxyVerb}
 

Definition at line 1559 of file teachers.\+py.


\begin{DoxyCode}
1559     \textcolor{keyword}{def }setup\_image\_features(self, data\_path):
1560         \textcolor{stringliteral}{"""}
1561 \textcolor{stringliteral}{        Load text and image data.}
1562 \textcolor{stringliteral}{}
1563 \textcolor{stringliteral}{        The image features all live in dicts by default in <data\_path>/}
1564 \textcolor{stringliteral}{        image\_features/ but get\_image\_features\_path() above can be overriden by}
1565 \textcolor{stringliteral}{        subclass to put them elsewhere.}
1566 \textcolor{stringliteral}{}
1567 \textcolor{stringliteral}{        In the (very odd) case that the resnet or resnext dicts (models}
1568 \textcolor{stringliteral}{        buildable using ImageLoader) are not found, we build them.}
1569 \textcolor{stringliteral}{        """}
1570         \textcolor{keywordflow}{if} self.image\_mode \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'raw'}, \textcolor{stringliteral}{'ascii'}]:
1571             self.image\_features\_dict = \textcolor{keywordtype}{None}
1572             self.image\_loader = ImageLoader(self.opt)
1573             \textcolor{keywordflow}{return}
1574         image\_mode\_features\_dict\_path = self.get\_image\_features\_path(
1575             self.task, self.image\_mode, self.datatype
1576         )
1577 
1578         \textcolor{keywordflow}{if} os.path.isfile(image\_mode\_features\_dict\_path):
1579             print(
1580                 f\textcolor{stringliteral}{'Loading existing image features dict for model: \{self.image\_mode\} at:
       \{image\_mode\_features\_dict\_path\}'}
1581             )
1582             self.image\_features\_dict = torch.load(
1583                 image\_mode\_features\_dict\_path, map\_location=\textcolor{stringliteral}{'cpu'}
1584             )
1585         \textcolor{keywordflow}{else}:
1586             print(f\textcolor{stringliteral}{'No existing image features, attempting to build.'})
1587             \textcolor{keywordflow}{if} self.is\_image\_mode\_buildable(self.image\_mode):
1588                 \textcolor{comment}{# TODO: Awkward to modify the input opt but needed to use}
1589                 \textcolor{comment}{# TODO: ImageLoader functionality. Is from comment\_battle,}
1590                 \textcolor{comment}{# TODO: will refactor this at some point soon most likely}
1591                 image\_loader\_opt = self.opt.copy()
1592                 image\_loader\_opt[\textcolor{stringliteral}{'image\_mode'}] = (
1593                     self.image\_mode \textcolor{keywordflow}{if} self.include\_image \textcolor{keywordflow}{else} \textcolor{stringliteral}{'no\_image\_model'}
1594                 )
1595 
1596                 image\_loader\_opt[\textcolor{stringliteral}{'image\_size'}] = 256
1597                 image\_loader\_opt[\textcolor{stringliteral}{'image\_cropsize'}] = 224
1598                 self.image\_loader = ImageLoader(image\_loader\_opt)
1599 
1600                 \textcolor{comment}{# try to build with ImageLoader (i.e. resenet/resnext variants)}
1601                 self.image\_features\_dict = self.\_build\_image\_features\_dict(
1602                     self.data\_path, self.datatype, image\_mode\_features\_dict\_path
1603                 )
1604             \textcolor{keywordflow}{else}:
1605                 \textcolor{keywordflow}{raise} RuntimeError(
1606                     \textcolor{stringliteral}{'Image model: %s is not buildable by ImageLoader but does'}
1607                     \textcolor{stringliteral}{'not already exist on disk as an image features dict for'}
1608                     \textcolor{stringliteral}{'this dataset.'} % self.image\_mode
1609                 )
1610 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a6095f493a108e30fcf22d36c146cdb8e}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a6095f493a108e30fcf22d36c146cdb8e}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!share@{share}}
\index{share@{share}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{share()}{share()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+share (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 1693 of file teachers.\+py.


\begin{DoxyCode}
1693     \textcolor{keyword}{def }share(self):
1694         shared = super().share()
1695         shared[\textcolor{stringliteral}{'data'}] = self.data
1696         shared[\textcolor{stringliteral}{'image\_loader'}] = self.image\_loader
1697         \textcolor{keywordflow}{if} hasattr(self, \textcolor{stringliteral}{'image\_features\_dict'}):
1698             shared[\textcolor{stringliteral}{'image\_features\_dict'}] = self.image\_features\_dict
1699         \textcolor{keywordflow}{return} shared
1700 \end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a95e578f9650f77c1d397319b9050af51}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a95e578f9650f77c1d397319b9050af51}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!text\+\_\+key@{text\+\_\+key}}
\index{text\+\_\+key@{text\+\_\+key}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{text\+\_\+key()}{text\_key()}}
{\footnotesize\ttfamily def parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+text\+\_\+key (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Which key in the input data dict objects identifies the text.

Common keys are "text" or "comment". May be implemented by subclass.
\end{DoxyVerb}
 

Definition at line 1456 of file teachers.\+py.


\begin{DoxyCode}
1456     \textcolor{keyword}{def }text\_key(self):
1457         \textcolor{stringliteral}{"""}
1458 \textcolor{stringliteral}{        Which key in the input data dict objects identifies the text.}
1459 \textcolor{stringliteral}{}
1460 \textcolor{stringliteral}{        Common keys are "text" or "comment". May be implemented by subclass.}
1461 \textcolor{stringliteral}{        """}
1462         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'text'}
1463 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a0c48c489fee91d94cf8d62b902bd6b27}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a0c48c489fee91d94cf8d62b902bd6b27}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!blank\+\_\+image\+\_\+features@{blank\+\_\+image\+\_\+features}}
\index{blank\+\_\+image\+\_\+features@{blank\+\_\+image\+\_\+features}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{blank\+\_\+image\+\_\+features}{blank\_image\_features}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+blank\+\_\+image\+\_\+features}



Definition at line 1374 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a4015f3b73718e13896bb464378a269f1}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a4015f3b73718e13896bb464378a269f1}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!data@{data}}
\index{data@{data}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{data}{data}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+data}



Definition at line 1354 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a9fb2d3ab4b52f70872460c624bad1218}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a9fb2d3ab4b52f70872460c624bad1218}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!data\+\_\+path@{data\+\_\+path}}
\index{data\+\_\+path@{data\+\_\+path}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{data\+\_\+path}{data\_path}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+data\+\_\+path}



Definition at line 1353 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a335cba069093a1e1cff8f73fad9f11d1}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a335cba069093a1e1cff8f73fad9f11d1}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!datatype@{datatype}}
\index{datatype@{datatype}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{datatype}{datatype}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+datatype}



Definition at line 1355 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a404b2e622780e94083ba9539ebaab609}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a404b2e622780e94083ba9539ebaab609}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!example@{example}}
\index{example@{example}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{example}{example}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+example}



Definition at line 1645 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a67fc5068ab7e2c1c718614cc737d6a75}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a67fc5068ab7e2c1c718614cc737d6a75}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!image\+\_\+features\+\_\+dict@{image\+\_\+features\+\_\+dict}}
\index{image\+\_\+features\+\_\+dict@{image\+\_\+features\+\_\+dict}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{image\+\_\+features\+\_\+dict}{image\_features\_dict}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+image\+\_\+features\+\_\+dict}



Definition at line 1380 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a708601003f79d10c98a1933501ce658f}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a708601003f79d10c98a1933501ce658f}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!image\+\_\+features\+\_\+dim@{image\+\_\+features\+\_\+dim}}
\index{image\+\_\+features\+\_\+dim@{image\+\_\+features\+\_\+dim}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{image\+\_\+features\+\_\+dim}{image\_features\_dim}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+image\+\_\+features\+\_\+dim}



Definition at line 1373 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aaf426bd12c83e8f8d5a217481cbf854b}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aaf426bd12c83e8f8d5a217481cbf854b}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!image\+\_\+loader@{image\+\_\+loader}}
\index{image\+\_\+loader@{image\+\_\+loader}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{image\+\_\+loader}{image\_loader}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+image\+\_\+loader}



Definition at line 1372 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a72abb2921076e7597cc946275983028b}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a72abb2921076e7597cc946275983028b}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!image\+\_\+mode@{image\+\_\+mode}}
\index{image\+\_\+mode@{image\+\_\+mode}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{image\+\_\+mode}{image\_mode}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+image\+\_\+mode}



Definition at line 1365 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aff2a7f405e051f014ece5cc124aa170c}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aff2a7f405e051f014ece5cc124aa170c}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!image\+\_\+path@{image\+\_\+path}}
\index{image\+\_\+path@{image\+\_\+path}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{image\+\_\+path}{image\_path}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+image\+\_\+path}



Definition at line 1371 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a0e4ee3692e19e0f1df2fef8f21d058ab}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a0e4ee3692e19e0f1df2fef8f21d058ab}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!include\+\_\+image@{include\+\_\+image}}
\index{include\+\_\+image@{include\+\_\+image}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{include\+\_\+image}{include\_image}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+include\+\_\+image}



Definition at line 1369 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa7ca0df94cb27a11487e40343cc84de6}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_aa7ca0df94cb27a11487e40343cc84de6}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!opt@{opt}}
\index{opt@{opt}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+opt}



Definition at line 1351 of file teachers.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a78dca77e43183d22d75140ca113d821c}\label{classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_a78dca77e43183d22d75140ca113d821c}} 
\index{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}!task@{task}}
\index{task@{task}!parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher@{parlai\+::core\+::teachers\+::\+Abstract\+Image\+Teacher}}
\subsubsection{\texorpdfstring{task}{task}}
{\footnotesize\ttfamily parlai.\+core.\+teachers.\+Abstract\+Image\+Teacher.\+task}



Definition at line 1352 of file teachers.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/core/\hyperlink{teachers_8py}{teachers.\+py}\end{DoxyCompactItemize}
