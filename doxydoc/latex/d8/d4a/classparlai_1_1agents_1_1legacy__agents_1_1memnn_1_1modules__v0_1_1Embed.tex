\hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed}{}\section{parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed Class Reference}
\label{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed}\index{parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed@{parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed}}


Inheritance diagram for parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=206pt]{d9/d0d/classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=206pt]{db/dd0/classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_aee1b369b4a7f6b23788e30e2dc3e439f}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, args, \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_ac0a34fe405b50e9d36e366d7b3b3913f}{position\+\_\+encoding}=False, kwargs)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_a4496856f88b3a68d1928ea500041c7c3}{forward} (self, lengths, indices)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_aac0da7cbc9d64949060c6c681172220f}{position\+\_\+matrix} (J, d)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_a40a4aebba88622f6734725da0a1fd12d}{position\+\_\+tensor} (sentence\+\_\+lengths, embeddings)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_ac0a34fe405b50e9d36e366d7b3b3913f}{position\+\_\+encoding}
\end{DoxyCompactItemize}
\subsection*{Static Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_ab1dcd9286ae9605d47d10760a1ed1676}{maxsize}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 102 of file modules\+\_\+v0.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_aee1b369b4a7f6b23788e30e2dc3e439f}\label{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_aee1b369b4a7f6b23788e30e2dc3e439f}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{args,  }\item[{}]{position\+\_\+encoding = {\ttfamily False},  }\item[{}]{kwargs }\end{DoxyParamCaption})}



Definition at line 103 of file modules\+\_\+v0.\+py.


\begin{DoxyCode}
103     \textcolor{keyword}{def }\_\_init\_\_(self, *args, position\_encoding=False, **kwargs):
104         self.position\_encoding = position\_encoding
105         super().\_\_init\_\_(*args, **kwargs)
106 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_a4496856f88b3a68d1928ea500041c7c3}\label{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_a4496856f88b3a68d1928ea500041c7c3}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}!forward@{forward}}
\index{forward@{forward}!parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}}
\subsubsection{\texorpdfstring{forward()}{forward()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed.\+forward (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{lengths,  }\item[{}]{indices }\end{DoxyParamCaption})}



Definition at line 107 of file modules\+\_\+v0.\+py.


\begin{DoxyCode}
107     \textcolor{keyword}{def }forward(self, lengths, indices):
108         lengths\_mat = lengths.data
109         \textcolor{keywordflow}{if} lengths.dim() == 1 \textcolor{keywordflow}{or} lengths.size(1) == 1:
110             lengths\_mat = lengths\_mat.unsqueeze(0)
111 
112         \textcolor{keywordflow}{if} lengths\_mat.dim() == 1:
113             \textcolor{keywordflow}{raise} RuntimeError(lengths.shape)
114 
115         input = torch.LongTensor(
116             lengths\_mat.size(0), lengths\_mat.size(1), torch.max(lengths\_mat)
117         )
118         pad = self.padding\_idx \textcolor{keywordflow}{if} self.padding\_idx \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None} \textcolor{keywordflow}{else} 0
119         input.fill\_(pad)
120         emb\_list = []
121         offset = 0
122         \textcolor{keywordflow}{for} i, row \textcolor{keywordflow}{in} enumerate(lengths\_mat):
123             \textcolor{keywordflow}{for} j, length \textcolor{keywordflow}{in} enumerate(row):
124                 length = length.item()
125                 \textcolor{keywordflow}{if} length > 0:
126                     input[i, j, :length] = indices[offset : offset + length]
127                 offset += length
128 
129         \textcolor{keywordflow}{for} i, row \textcolor{keywordflow}{in} enumerate(lengths\_mat):
130             emb = super().forward(input[i, :, :])
131             \textcolor{keywordflow}{if} self.position\_encoding:
132                 emb = emb * self.position\_tensor(row, emb)
133             emb = torch.sum(emb, dim=1).squeeze(1)
134             \textcolor{keywordflow}{for} j, length \textcolor{keywordflow}{in} enumerate(row):
135                 length = length.item()
136                 \textcolor{keywordflow}{if} length > 0:
137                     emb[j] /= length
138             emb\_list.append(emb)
139         embs = torch.stack(emb\_list)
140 
141         \textcolor{keywordflow}{if} lengths.dim() == 1:
142             embs = embs.squeeze(0)
143         \textcolor{keywordflow}{elif} lengths.size(1) == 1:
144             embs = embs.squeeze().unsqueeze(1)
145         \textcolor{keywordflow}{return} embs
146 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_aac0da7cbc9d64949060c6c681172220f}\label{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_aac0da7cbc9d64949060c6c681172220f}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}!position\+\_\+matrix@{position\+\_\+matrix}}
\index{position\+\_\+matrix@{position\+\_\+matrix}!parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}}
\subsubsection{\texorpdfstring{position\+\_\+matrix()}{position\_matrix()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed.\+position\+\_\+matrix (\begin{DoxyParamCaption}\item[{}]{J,  }\item[{}]{d }\end{DoxyParamCaption})}



Definition at line 149 of file modules\+\_\+v0.\+py.


\begin{DoxyCode}
149     \textcolor{keyword}{def }position\_matrix(J, d):
150         m = torch.Tensor(J, d)
151         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} range(1, d + 1):
152             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(1, J + 1):
153                 m[j - 1, k - 1] = (1 - j / J) - (k / d) * (1 - 2 * j / J)
154         \textcolor{keywordflow}{return} m
155 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_a40a4aebba88622f6734725da0a1fd12d}\label{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_a40a4aebba88622f6734725da0a1fd12d}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}!position\+\_\+tensor@{position\+\_\+tensor}}
\index{position\+\_\+tensor@{position\+\_\+tensor}!parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}}
\subsubsection{\texorpdfstring{position\+\_\+tensor()}{position\_tensor()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed.\+position\+\_\+tensor (\begin{DoxyParamCaption}\item[{}]{sentence\+\_\+lengths,  }\item[{}]{embeddings }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 157 of file modules\+\_\+v0.\+py.


\begin{DoxyCode}
157     \textcolor{keyword}{def }position\_tensor(sentence\_lengths, embeddings):
158         t = torch.zeros(embeddings.size())
159         embedding\_dim = embeddings.size()[-1]
160         \textcolor{keywordflow}{for} i, length \textcolor{keywordflow}{in} enumerate(sentence\_lengths):
161             \textcolor{keywordflow}{if} length > 0:
162                 t[i, :length, :] = Embed.position\_matrix(length, embedding\_dim)
163         \textcolor{keywordflow}{return} t
164 
165 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_ab1dcd9286ae9605d47d10760a1ed1676}\label{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_ab1dcd9286ae9605d47d10760a1ed1676}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}!maxsize@{maxsize}}
\index{maxsize@{maxsize}!parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}}
\subsubsection{\texorpdfstring{maxsize}{maxsize}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed.\+maxsize\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 148 of file modules\+\_\+v0.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_ac0a34fe405b50e9d36e366d7b3b3913f}\label{classparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1modules__v0_1_1Embed_ac0a34fe405b50e9d36e366d7b3b3913f}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}!position\+\_\+encoding@{position\+\_\+encoding}}
\index{position\+\_\+encoding@{position\+\_\+encoding}!parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed@{parlai\+::agents\+::legacy\+\_\+agents\+::memnn\+::modules\+\_\+v0\+::\+Embed}}
\subsubsection{\texorpdfstring{position\+\_\+encoding}{position\_encoding}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+memnn.\+modules\+\_\+v0.\+Embed.\+position\+\_\+encoding}



Definition at line 104 of file modules\+\_\+v0.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/legacy\+\_\+agents/memnn/\hyperlink{memnn_2modules__v0_8py}{modules\+\_\+v0.\+py}\end{DoxyCompactItemize}
