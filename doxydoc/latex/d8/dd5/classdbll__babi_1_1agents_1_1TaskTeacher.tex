\hypertarget{classdbll__babi_1_1agents_1_1TaskTeacher}{}\section{dbll\+\_\+babi.\+agents.\+Task\+Teacher Class Reference}
\label{classdbll__babi_1_1agents_1_1TaskTeacher}\index{dbll\+\_\+babi.\+agents.\+Task\+Teacher@{dbll\+\_\+babi.\+agents.\+Task\+Teacher}}


Inheritance diagram for dbll\+\_\+babi.\+agents.\+Task\+Teacher\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=227pt]{d5/da0/classdbll__babi_1_1agents_1_1TaskTeacher__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for dbll\+\_\+babi.\+agents.\+Task\+Teacher\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=227pt]{d2/d6e/classdbll__babi_1_1agents_1_1TaskTeacher__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classdbll__babi_1_1agents_1_1TaskTeacher_a98b7cf17bf8248372e08889b3fe30ac5}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classdbll__babi_1_1agents_1_1TaskTeacher_abe6872d5eda75ca8a15ecf4785086c48}{opt}, shared=None)
\item 
def \hyperlink{classdbll__babi_1_1agents_1_1TaskTeacher_adcbc1c54716e7b631e4a496f59df1f33}{setup\+\_\+data} (self, path)
\item 
def \hyperlink{classdbll__babi_1_1agents_1_1TaskTeacher_a3275c0a4a11a3f5e723259d487db03f8}{setup\+\_\+data\+\_\+with\+\_\+feedback} (self, path)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classdbll__babi_1_1agents_1_1TaskTeacher_abe6872d5eda75ca8a15ecf4785086c48}{opt}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 50 of file agents.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classdbll__babi_1_1agents_1_1TaskTeacher_a98b7cf17bf8248372e08889b3fe30ac5}\label{classdbll__babi_1_1agents_1_1TaskTeacher_a98b7cf17bf8248372e08889b3fe30ac5}} 
\index{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher@{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!dbll\+\_\+babi\+::agents\+::\+Task\+Teacher@{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def dbll\+\_\+babi.\+agents.\+Task\+Teacher.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 51 of file agents.\+py.


\begin{DoxyCode}
51     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
52         params = opt[\textcolor{stringliteral}{'task'}].split(\textcolor{stringliteral}{':'})[2]
53         opt = copy.deepcopy(opt)
54         opt[\textcolor{stringliteral}{'datafile'}] = \_path(os.path.join(\textcolor{stringliteral}{'babi'}, \textcolor{stringliteral}{'babi1'}), params, opt)
55         opt[\textcolor{stringliteral}{'cands\_datafile'}] = \_path(
56             os.path.join(\textcolor{stringliteral}{'babi'}, \textcolor{stringliteral}{'babi1'}), params, opt, \textcolor{stringliteral}{'train'}
57         )
58         self.opt = opt
59         super().\_\_init\_\_(opt, shared)
60 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classdbll__babi_1_1agents_1_1TaskTeacher_adcbc1c54716e7b631e4a496f59df1f33}\label{classdbll__babi_1_1agents_1_1TaskTeacher_adcbc1c54716e7b631e4a496f59df1f33}} 
\index{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher@{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher}!setup\+\_\+data@{setup\+\_\+data}}
\index{setup\+\_\+data@{setup\+\_\+data}!dbll\+\_\+babi\+::agents\+::\+Task\+Teacher@{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher}}
\subsubsection{\texorpdfstring{setup\+\_\+data()}{setup\_data()}}
{\footnotesize\ttfamily def dbll\+\_\+babi.\+agents.\+Task\+Teacher.\+setup\+\_\+data (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Reads feedback for an example along with text and labels if 'feedback' argument
is specified.
\end{DoxyVerb}
 

Definition at line 61 of file agents.\+py.


\begin{DoxyCode}
61     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1multinli_1_1agents_a4fa2cb0ba1ed745336ad8bceed36b841}{setup\_data}(self, path):
62         \textcolor{stringliteral}{"""}
63 \textcolor{stringliteral}{        Reads feedback for an example along with text and labels if 'feedback' argument}
64 \textcolor{stringliteral}{        is specified.}
65 \textcolor{stringliteral}{        """}
66         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'task'}].split(\textcolor{stringliteral}{':'})[-1] == \textcolor{stringliteral}{'feedback'}:
67             \textcolor{keywordflow}{return} self.setup\_data\_with\_feedback(path)
68         \textcolor{keywordflow}{else}:
69             \textcolor{keywordflow}{return} super().\hyperlink{namespaceparlai_1_1tasks_1_1multinli_1_1agents_a4fa2cb0ba1ed745336ad8bceed36b841}{setup\_data}(path)
70 
\end{DoxyCode}
\mbox{\Hypertarget{classdbll__babi_1_1agents_1_1TaskTeacher_a3275c0a4a11a3f5e723259d487db03f8}\label{classdbll__babi_1_1agents_1_1TaskTeacher_a3275c0a4a11a3f5e723259d487db03f8}} 
\index{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher@{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher}!setup\+\_\+data\+\_\+with\+\_\+feedback@{setup\+\_\+data\+\_\+with\+\_\+feedback}}
\index{setup\+\_\+data\+\_\+with\+\_\+feedback@{setup\+\_\+data\+\_\+with\+\_\+feedback}!dbll\+\_\+babi\+::agents\+::\+Task\+Teacher@{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher}}
\subsubsection{\texorpdfstring{setup\+\_\+data\+\_\+with\+\_\+feedback()}{setup\_data\_with\_feedback()}}
{\footnotesize\ttfamily def dbll\+\_\+babi.\+agents.\+Task\+Teacher.\+setup\+\_\+data\+\_\+with\+\_\+feedback (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Reads data in the fbdialog format. This method is very similar to
FbDialogTeacher.setup_data(..). The difference is that in this method the
feedback is appended to the query from the current example; in the default setup
the feedback is appended to the x from the next example.

The data would look something like this:

Mary moved to the bedroom.
Mary travelled to the garden.
Where is John?
No, that's wrong.
[labels: garden]

To append feedback to the current example, modify the task name like this:
  python examples/display_data.py -t dbll_babi:task:2_p0.5:f
Default setup:
  python examples/display_data.py -t dbll_babi:task:2_p0.5
\end{DoxyVerb}
 

Definition at line 71 of file agents.\+py.


\begin{DoxyCode}
71     \textcolor{keyword}{def }setup\_data\_with\_feedback(self, path):
72         \textcolor{stringliteral}{"""}
73 \textcolor{stringliteral}{        Reads data in the fbdialog format. This method is very similar to}
74 \textcolor{stringliteral}{        FbDialogTeacher.setup\_data(..). The difference is that in this method the}
75 \textcolor{stringliteral}{        feedback is appended to the query from the current example; in the default setup}
76 \textcolor{stringliteral}{        the feedback is appended to the x from the next example.}
77 \textcolor{stringliteral}{}
78 \textcolor{stringliteral}{        The data would look something like this:}
79 \textcolor{stringliteral}{}
80 \textcolor{stringliteral}{        Mary moved to the bedroom.}
81 \textcolor{stringliteral}{        Mary travelled to the garden.}
82 \textcolor{stringliteral}{        Where is John?}
83 \textcolor{stringliteral}{        No, that's wrong.}
84 \textcolor{stringliteral}{        [labels: garden]}
85 \textcolor{stringliteral}{}
86 \textcolor{stringliteral}{        To append feedback to the current example, modify the task name like this:}
87 \textcolor{stringliteral}{          python examples/display\_data.py -t dbll\_babi:task:2\_p0.5:f}
88 \textcolor{stringliteral}{        Default setup:}
89 \textcolor{stringliteral}{          python examples/display\_data.py -t dbll\_babi:task:2\_p0.5}
90 \textcolor{stringliteral}{        """}
91         print(\textcolor{stringliteral}{"[loading fbdialog data:"} + path + \textcolor{stringliteral}{"]"})
92         with open(path) \textcolor{keyword}{as} read:
93             start = \textcolor{keyword}{True}
94             x = \textcolor{stringliteral}{''}
95 
96             y = \textcolor{keywordtype}{None}
97 
98             reward = 0
99             dialog\_index = 0
100             read\_feedback = \textcolor{keyword}{False}
101             \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} read:
102                 line = line.strip().replace(\textcolor{stringliteral}{'\(\backslash\)\(\backslash\)n'}, \textcolor{stringliteral}{'\(\backslash\)n'})
103                 \textcolor{keywordflow}{if} len(line) == 0:
104                     \textcolor{keywordflow}{continue}
105 
106                 \textcolor{comment}{# first, get conversation index -- '1' means start of episode}
107                 space\_idx = line.find(\textcolor{stringliteral}{' '})
108                 conv\_id = line[:space\_idx]
109 
110                 \textcolor{comment}{# split line into constituent parts, if available:}
111                 \textcolor{comment}{# x<tab>y<tab>reward<tab>label\_candidates}
112                 \textcolor{comment}{# where y, reward, and label\_candidates are optional}
113                 split = line[space\_idx + 1 :].split(\textcolor{stringliteral}{'\(\backslash\)t'})
114 
115                 \textcolor{comment}{# remove empty items and strip each one}
116                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(split)):
117                     word = split[i].strip()
118                     \textcolor{keywordflow}{if} len(word) == 0:
119                         split[i] = \textcolor{stringliteral}{''}
120                     \textcolor{keywordflow}{else}:
121                         split[i] = word
122                 \textcolor{comment}{# Empty reward string same as None}
123                 \textcolor{keywordflow}{if} len(split) > 2 \textcolor{keywordflow}{and} split[2] == \textcolor{stringliteral}{''}:
124                     split[2] = \textcolor{keywordtype}{None}
125 
126                 \textcolor{comment}{# now check if we're at a new episode}
127                 \textcolor{keywordflow}{if} conv\_id == \textcolor{stringliteral}{'1'}:
128                     dialog\_index += 1
129                     x = x.strip()
130                     \textcolor{keywordflow}{if} x:
131                         \textcolor{keywordflow}{yield} [x, \textcolor{keywordtype}{None}, reward], start
132                     start = \textcolor{keyword}{True}
133                     reward = 0
134                     \textcolor{comment}{# start a new episode}
135                     \textcolor{keywordflow}{if} self.cloze:
136                         x = \textcolor{stringliteral}{'Fill in the blank in the last sentence.\(\backslash\)n\{x\}'}.
      \hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
137                             x=split[0]
138                         )
139                     \textcolor{keywordflow}{else}:
140                         x = split[0]
141                 \textcolor{keywordflow}{else}:
142                     \textcolor{keywordflow}{if} x:
143                         \textcolor{comment}{# otherwise add current x to what we have so far}
144                         x = \textcolor{stringliteral}{'\{x\}\(\backslash\)n\{next\_x\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(x=x, next\_x=split[0])
145                     \textcolor{keywordflow}{else}:
146                         x = split[0]
147                 \textcolor{keywordflow}{if} len(split) > 2 \textcolor{keywordflow}{and} split[2]:
148                     reward += \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(split[2])
149 
150                 \textcolor{keywordflow}{if} len(split) > 1 \textcolor{keywordflow}{and} split[1]:
151                     read\_feedback = \textcolor{keyword}{True}
152                     \textcolor{comment}{# split labels}
153                     y = split[1].split(\textcolor{stringliteral}{'|'})
154 
155                 \textcolor{keywordflow}{if} read\_feedback \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} split[1]:
156                     split[0] = x
157                     split[1] = y
158                     \textcolor{keywordflow}{if} len(split) > 2:
159                         split[2] = reward
160                     \textcolor{keywordflow}{else}:
161                         split.append(reward)
162                     \textcolor{keywordflow}{if} start:
163                         \textcolor{keywordflow}{yield} split, \textcolor{keyword}{True}
164                         start = \textcolor{keyword}{False}
165                     \textcolor{keywordflow}{else}:
166                         \textcolor{keywordflow}{yield} split, \textcolor{keyword}{False}
167                     \textcolor{comment}{# reset x in case there is unlabeled data still left}
168                     x = \textcolor{stringliteral}{''}
169                     reward = 0
170                     y = \textcolor{keywordtype}{None}
171                     read\_feedback = \textcolor{keyword}{False}
172 
173 
174 \textcolor{comment}{# Defaults to task 2 with p=0.5.}
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classdbll__babi_1_1agents_1_1TaskTeacher_abe6872d5eda75ca8a15ecf4785086c48}\label{classdbll__babi_1_1agents_1_1TaskTeacher_abe6872d5eda75ca8a15ecf4785086c48}} 
\index{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher@{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher}!opt@{opt}}
\index{opt@{opt}!dbll\+\_\+babi\+::agents\+::\+Task\+Teacher@{dbll\+\_\+babi\+::agents\+::\+Task\+Teacher}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily dbll\+\_\+babi.\+agents.\+Task\+Teacher.\+opt}



Definition at line 58 of file agents.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
projects/memnn\+\_\+feedback/tasks/dbll\+\_\+babi/\hyperlink{projects_2memnn__feedback_2tasks_2dbll__babi_2agents_8py}{agents.\+py}\end{DoxyCompactItemize}
