\hypertarget{namespaceparlai_1_1tasks_1_1taskntalk_1_1build}{}\section{parlai.\+tasks.\+taskntalk.\+build Namespace Reference}
\label{namespaceparlai_1_1tasks_1_1taskntalk_1_1build}\index{parlai.\+tasks.\+taskntalk.\+build@{parlai.\+tasks.\+taskntalk.\+build}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1taskntalk_1_1build_a92a0de8038feadf9e3980d7ad49f2083}{build} (opt)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1taskntalk_1_1build_a92a0de8038feadf9e3980d7ad49f2083}\label{namespaceparlai_1_1tasks_1_1taskntalk_1_1build_a92a0de8038feadf9e3980d7ad49f2083}} 
\index{parlai\+::tasks\+::taskntalk\+::build@{parlai\+::tasks\+::taskntalk\+::build}!build@{build}}
\index{build@{build}!parlai\+::tasks\+::taskntalk\+::build@{parlai\+::tasks\+::taskntalk\+::build}}
\subsubsection{\texorpdfstring{build()}{build()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+taskntalk.\+build.\+build (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create train and validation data for synthetic shapes described by attributes.
\end{DoxyVerb}
 

Definition at line 15 of file build.\+py.


\begin{DoxyCode}
15 \textcolor{keyword}{def }\hyperlink{namespacedialog__babi__feedback_1_1build_a7a9d289f7493a5ded13c4b7f071b6184}{build}(opt):
16     \textcolor{stringliteral}{"""}
17 \textcolor{stringliteral}{    Create train and validation data for synthetic shapes described by attributes.}
18 \textcolor{stringliteral}{    """}
19     dpath = os.path.join(opt[\textcolor{stringliteral}{'datapath'}], \textcolor{stringliteral}{'taskntalk'})
20 
21     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} build\_data.built(dpath):
22         print(\textcolor{stringliteral}{'[building data: '} + dpath + \textcolor{stringliteral}{']'})
23         build\_data.make\_dir(os.path.join(dpath, \textcolor{stringliteral}{'large'}))
24         build\_data.make\_dir(os.path.join(dpath, \textcolor{stringliteral}{'small'}))
25 
26         \textcolor{comment}{# save training and validation data}
27         to\_save = \{
28             \textcolor{stringliteral}{'attributes'}: [\textcolor{stringliteral}{'color'}, \textcolor{stringliteral}{'shape'}, \textcolor{stringliteral}{'style'}],
29             \textcolor{stringliteral}{'task\_defn'}: [
30                 [\textcolor{stringliteral}{'color'}, \textcolor{stringliteral}{'shape'}],
31                 [\textcolor{stringliteral}{'shape'}, \textcolor{stringliteral}{'color'}],
32                 [\textcolor{stringliteral}{'color'}, \textcolor{stringliteral}{'style'}],
33                 [\textcolor{stringliteral}{'style'}, \textcolor{stringliteral}{'color'}],
34                 [\textcolor{stringliteral}{'shape'}, \textcolor{stringliteral}{'style'}],
35                 [\textcolor{stringliteral}{'style'}, \textcolor{stringliteral}{'shape'}],
36             ],
37         \}
38         split\_data = \{\}
39 
40         \textcolor{comment}{# small dataset properties}
41         properties = \{
42             \textcolor{stringliteral}{'color'}: [\textcolor{stringliteral}{'red'}, \textcolor{stringliteral}{'green'}, \textcolor{stringliteral}{'blue'}, \textcolor{stringliteral}{'purple'}],
43             \textcolor{stringliteral}{'shape'}: [\textcolor{stringliteral}{'square'}, \textcolor{stringliteral}{'triangle'}, \textcolor{stringliteral}{'circle'}, \textcolor{stringliteral}{'star'}],
44             \textcolor{stringliteral}{'style'}: [\textcolor{stringliteral}{'dotted'}, \textcolor{stringliteral}{'solid'}, \textcolor{stringliteral}{'filled'}, \textcolor{stringliteral}{'dashed'}],
45         \}
46         to\_save[\textcolor{stringliteral}{'properties'}] = properties
47         \textcolor{comment}{# properties.values() not used directly to maintain order}
48         data\_verbose = list(
49             itertools.product(*[properties[key] \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} to\_save[\textcolor{stringliteral}{'attributes'}]])
50         )
51 
52         \textcolor{comment}{# randomly select train and rest of it is valid}
53         split\_data[\textcolor{stringliteral}{'valid'}] = random.sample(data\_verbose, \hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(0.2 * len(data\_verbose)))
54         split\_data[\textcolor{stringliteral}{'train'}] = [s \textcolor{keywordflow}{for} s \textcolor{keywordflow}{in} data\_verbose \textcolor{keywordflow}{if} s \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} split\_data[\textcolor{stringliteral}{'valid'}]]
55 
56         to\_save[\textcolor{stringliteral}{'data'}] = split\_data[\textcolor{stringliteral}{'train'}]
57         with open(os.path.join(dpath, \textcolor{stringliteral}{'small'}, \textcolor{stringliteral}{'train.json'}), \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} outfile:
58             json.dump(
59                 to\_save, outfile, indent=4, separators=(\textcolor{stringliteral}{','}, \textcolor{stringliteral}{': '}), sort\_keys=\textcolor{keyword}{True}
60             )
61 
62         to\_save[\textcolor{stringliteral}{'data'}] = split\_data[\textcolor{stringliteral}{'valid'}]
63         with open(os.path.join(dpath, \textcolor{stringliteral}{'small'}, \textcolor{stringliteral}{'valid.json'}), \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} outfile:
64             json.dump(
65                 to\_save, outfile, indent=4, separators=(\textcolor{stringliteral}{','}, \textcolor{stringliteral}{': '}), sort\_keys=\textcolor{keyword}{True}
66             )
67 
68         \textcolor{comment}{# large dataset properties}
69         properties = \{
70             \textcolor{stringliteral}{'color'}: [
71                 \textcolor{stringliteral}{'red'},
72                 \textcolor{stringliteral}{'green'},
73                 \textcolor{stringliteral}{'blue'},
74                 \textcolor{stringliteral}{'purple'},
75                 \textcolor{stringliteral}{'yellow'},
76                 \textcolor{stringliteral}{'cyan'},
77                 \textcolor{stringliteral}{'orange'},
78                 \textcolor{stringliteral}{'teal'},
79             ],
80             \textcolor{stringliteral}{'shape'}: [
81                 \textcolor{stringliteral}{'square'},
82                 \textcolor{stringliteral}{'triangle'},
83                 \textcolor{stringliteral}{'circle'},
84                 \textcolor{stringliteral}{'star'},
85                 \textcolor{stringliteral}{'heart'},
86                 \textcolor{stringliteral}{'spade'},
87                 \textcolor{stringliteral}{'club'},
88                 \textcolor{stringliteral}{'diamond'},
89             ],
90             \textcolor{stringliteral}{'style'}: [
91                 \textcolor{stringliteral}{'dotted'},
92                 \textcolor{stringliteral}{'solid'},
93                 \textcolor{stringliteral}{'filled'},
94                 \textcolor{stringliteral}{'dashed'},
95                 \textcolor{stringliteral}{'hstripe'},
96                 \textcolor{stringliteral}{'vstripe'},
97                 \textcolor{stringliteral}{'hgrad'},
98                 \textcolor{stringliteral}{'vgrad'},
99             ],
100         \}
101         to\_save[\textcolor{stringliteral}{'properties'}] = properties
102         data\_verbose = list(
103             itertools.product(*[properties[key] \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} to\_save[\textcolor{stringliteral}{'attributes'}]])
104         )
105         split\_data[\textcolor{stringliteral}{'valid'}] = random.sample(data\_verbose, \hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(0.8 * len(data\_verbose)))
106         split\_data[\textcolor{stringliteral}{'train'}] = [s \textcolor{keywordflow}{for} s \textcolor{keywordflow}{in} data\_verbose \textcolor{keywordflow}{if} s \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} split\_data[\textcolor{stringliteral}{'valid'}]]
107 
108         to\_save[\textcolor{stringliteral}{'data'}] = split\_data[\textcolor{stringliteral}{'train'}]
109         with open(os.path.join(dpath, \textcolor{stringliteral}{'large'}, \textcolor{stringliteral}{'train.json'}), \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} outfile:
110             json.dump(
111                 to\_save, outfile, indent=4, separators=(\textcolor{stringliteral}{','}, \textcolor{stringliteral}{': '}), sort\_keys=\textcolor{keyword}{True}
112             )
113 
114         to\_save[\textcolor{stringliteral}{'data'}] = split\_data[\textcolor{stringliteral}{'valid'}]
115         with open(os.path.join(dpath, \textcolor{stringliteral}{'large'}, \textcolor{stringliteral}{'valid.json'}), \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} outfile:
116             json.dump(
117                 to\_save, outfile, indent=4, separators=(\textcolor{stringliteral}{','}, \textcolor{stringliteral}{': '}), sort\_keys=\textcolor{keyword}{True}
118             )
119 
120         \textcolor{comment}{# Mark the data as built.}
121         build\_data.mark\_done(dpath)
122 \end{DoxyCode}
