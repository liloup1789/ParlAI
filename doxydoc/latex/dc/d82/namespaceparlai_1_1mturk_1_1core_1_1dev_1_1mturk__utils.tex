\hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils}{}\section{parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils Namespace Reference}
\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils}\index{parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils@{parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a086d7381c328214587d3ec28bbcd19ab}{setup\+\_\+aws\+\_\+credentials} ()
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ab0dab541f46c0b18e96bcbbb536bddf6}{calculate\+\_\+mturk\+\_\+cost} (payment\+\_\+opt)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_af89757251500a96195029eb22e58e516}{check\+\_\+mturk\+\_\+balance} (balance\+\_\+needed, is\+\_\+sandbox)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_aad5b4cc1ff4815272164f620b952d037}{create\+\_\+hit\+\_\+config} (opt, task\+\_\+description, unique\+\_\+worker, is\+\_\+sandbox)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ad9e4ecfca00663796f26ca16a2778f29}{get\+\_\+mturk\+\_\+client} (is\+\_\+sandbox)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a1a4243aaafd94de8087e0d6ae06ad45c}{delete\+\_\+qualification} (qualification\+\_\+id, is\+\_\+sandbox)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_acd636315cbbf11cc5d9d641173e51586}{find\+\_\+qualification} (qualification\+\_\+name, is\+\_\+sandbox, must\+\_\+be\+\_\+owned=True)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ab4c0dfc58f9fe37c28c9d23628d1de4e}{find\+\_\+or\+\_\+create\+\_\+qualification} (qualification\+\_\+name, description, is\+\_\+sandbox, must\+\_\+be\+\_\+owned=True)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a631fbce36ff4d09422f29513460bc744}{give\+\_\+worker\+\_\+qualification} (worker\+\_\+id, qualification\+\_\+id, value=None, is\+\_\+sandbox=True)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_abc2c057b91641179f7c4bb50dd916488}{remove\+\_\+worker\+\_\+qualification} (worker\+\_\+id, qualification\+\_\+id, is\+\_\+sandbox=True, reason=\textquotesingle{}\textquotesingle{})
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_acd08d4459a8231afa32daccd82c5c957}{create\+\_\+hit\+\_\+type} (hit\+\_\+title, hit\+\_\+description, hit\+\_\+keywords, hit\+\_\+reward, assignment\+\_\+duration\+\_\+in\+\_\+seconds, is\+\_\+sandbox, qualifications=None, auto\+\_\+approve\+\_\+delay=7 $\ast$24 $\ast$3600)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a471ced1f7df897dcf3414dd49b84ddeb}{create\+\_\+hit\+\_\+with\+\_\+hit\+\_\+type} (opt, page\+\_\+url, hit\+\_\+type\+\_\+id, num\+\_\+assignments, is\+\_\+sandbox)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a26e9e405bc015ef647ef58a133c88f40}{expire\+\_\+hit} (is\+\_\+sandbox, hit\+\_\+id)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a01315ef04ead23e4c1a84c027dcccf3f}{setup\+\_\+sns\+\_\+topic} (task\+\_\+name, server\+\_\+url, task\+\_\+group\+\_\+id)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a06d86a6c70c953fda4ae13db4d43bc79}{subscribe\+\_\+to\+\_\+hits} (hit\+\_\+type\+\_\+id, is\+\_\+sandbox, sns\+\_\+arn)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_abfc17443a7c8018fc56dcc058e7b86f1}{send\+\_\+test\+\_\+notif} (topic\+\_\+arn, event\+\_\+type)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_aa321f5dc5e9700bc3906fca85490e25e}{delete\+\_\+sns\+\_\+topic} (topic\+\_\+arn)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a3dff8dba3aad1cc7f2e7cfbbc3984bc2}{region\+\_\+name}
\item 
\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ab502738358dcb1b59d34a1443b21834e}{aws\+\_\+profile\+\_\+name}
\item 
\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a09d7c0fc880089c5194ddc68af118f15}{client}
\item 
\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a5813bb15ba851c7bbbf0871a7979720d}{parent\+\_\+dir}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ab0dab541f46c0b18e96bcbbb536bddf6}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ab0dab541f46c0b18e96bcbbb536bddf6}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!calculate\+\_\+mturk\+\_\+cost@{calculate\+\_\+mturk\+\_\+cost}}
\index{calculate\+\_\+mturk\+\_\+cost@{calculate\+\_\+mturk\+\_\+cost}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{calculate\+\_\+mturk\+\_\+cost()}{calculate\_mturk\_cost()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+calculate\+\_\+mturk\+\_\+cost (\begin{DoxyParamCaption}\item[{}]{payment\+\_\+opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}MTurk Pricing: https://requester.mturk.com/pricing 20% fee on the reward and bonus
amount (if any) you pay Workers. HITs with 10 or more assignments will be charged an
additional 20% fee on the reward you pay Workers.

Example payment_opt format for paying reward:
{
    'type': 'reward',
    'num_total_assignments': 1,
    'reward': 0.05  # in dollars
}

Example payment_opt format for paying bonus:
{
    'type': 'bonus',
    'amount': 1000  # in dollars
}
\end{DoxyVerb}
 

Definition at line 73 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
73 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a4add40f6a463a3feb100a3c960ba3405}{calculate\_mturk\_cost}(payment\_opt):
74     \textcolor{stringliteral}{"""}
75 \textcolor{stringliteral}{    MTurk Pricing: https://requester.mturk.com/pricing 20% fee on the reward and bonus}
76 \textcolor{stringliteral}{    amount (if any) you pay Workers. HITs with 10 or more assignments will be charged an}
77 \textcolor{stringliteral}{    additional 20% fee on the reward you pay Workers.}
78 \textcolor{stringliteral}{}
79 \textcolor{stringliteral}{    Example payment\_opt format for paying reward:}
80 \textcolor{stringliteral}{    \{}
81 \textcolor{stringliteral}{        'type': 'reward',}
82 \textcolor{stringliteral}{        'num\_total\_assignments': 1,}
83 \textcolor{stringliteral}{        'reward': 0.05  # in dollars}
84 \textcolor{stringliteral}{    \}}
85 \textcolor{stringliteral}{}
86 \textcolor{stringliteral}{    Example payment\_opt format for paying bonus:}
87 \textcolor{stringliteral}{    \{}
88 \textcolor{stringliteral}{        'type': 'bonus',}
89 \textcolor{stringliteral}{        'amount': 1000  # in dollars}
90 \textcolor{stringliteral}{    \}}
91 \textcolor{stringliteral}{    """}
92     total\_cost = 0
93     \textcolor{keywordflow}{if} payment\_opt[\textcolor{stringliteral}{'type'}] == \textcolor{stringliteral}{'reward'}:
94         mult = 1.2
95         total\_cost = payment\_opt[\textcolor{stringliteral}{'num\_total\_assignments'}] * payment\_opt[\textcolor{stringliteral}{'reward'}] * mult
96     \textcolor{keywordflow}{elif} payment\_opt[\textcolor{stringliteral}{'type'}] == \textcolor{stringliteral}{'bonus'}:
97         total\_cost = payment\_opt[\textcolor{stringliteral}{'amount'}] * 1.2
98     \textcolor{keywordflow}{return} total\_cost
99 
100 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_af89757251500a96195029eb22e58e516}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_af89757251500a96195029eb22e58e516}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!check\+\_\+mturk\+\_\+balance@{check\+\_\+mturk\+\_\+balance}}
\index{check\+\_\+mturk\+\_\+balance@{check\+\_\+mturk\+\_\+balance}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{check\+\_\+mturk\+\_\+balance()}{check\_mturk\_balance()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+check\+\_\+mturk\+\_\+balance (\begin{DoxyParamCaption}\item[{}]{balance\+\_\+needed,  }\item[{}]{is\+\_\+sandbox }\end{DoxyParamCaption})}

\begin{DoxyVerb}Checks to see if there is at least balance_needed amount in the requester account,
returns True if the balance is greater than balance_needed.
\end{DoxyVerb}
 

Definition at line 101 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
101 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a68fb1962cbfa751d20f701da94ada62b}{check\_mturk\_balance}(balance\_needed, is\_sandbox):
102     \textcolor{stringliteral}{"""}
103 \textcolor{stringliteral}{    Checks to see if there is at least balance\_needed amount in the requester account,}
104 \textcolor{stringliteral}{    returns True if the balance is greater than balance\_needed.}
105 \textcolor{stringliteral}{    """}
106     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox)
107 
108     \textcolor{comment}{# Test that you can connect to the API by checking your account balance}
109     \textcolor{comment}{# In Sandbox this always returns $10,000}
110     \textcolor{keywordflow}{try}:
111         user\_balance = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(client.get\_account\_balance()[\textcolor{stringliteral}{'AvailableBalance'}])
112     \textcolor{keywordflow}{except} ClientError \textcolor{keyword}{as} e:
113         \textcolor{keywordflow}{if} e.response[\textcolor{stringliteral}{'Error'}][\textcolor{stringliteral}{'Code'}] == \textcolor{stringliteral}{'RequestError'}:
114             print(
115                 \textcolor{stringliteral}{'ERROR: To use the MTurk API, you will need an Amazon Web '}
116                 \textcolor{stringliteral}{'Services (AWS) Account. Your AWS account must be linked to '}
117                 \textcolor{stringliteral}{'your Amazon Mechanical Turk Account. Visit '}
118                 \textcolor{stringliteral}{'https://requestersandbox.mturk.com/developer to get started. '}
119                 \textcolor{stringliteral}{'(Note: if you have recently linked your account, please wait '}
120                 \textcolor{stringliteral}{'for a couple minutes before trying again.)\(\backslash\)n'}
121             )
122             quit()
123         \textcolor{keywordflow}{else}:
124             \textcolor{keywordflow}{raise}
125 
126     \textcolor{keywordflow}{if} user\_balance < balance\_needed:
127         print(
128             \textcolor{stringliteral}{'You might not have enough money in your MTurk account. Please go '}
129             \textcolor{stringliteral}{'to https://requester.mturk.com/account and increase your balance '}
130             \textcolor{stringliteral}{'to at least $\{\}, and then try again.'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(balance\_needed)
131         )
132         \textcolor{keywordflow}{return} \textcolor{keyword}{False}
133     \textcolor{keywordflow}{else}:
134         \textcolor{keywordflow}{return} \textcolor{keyword}{True}
135 
136 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_aad5b4cc1ff4815272164f620b952d037}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_aad5b4cc1ff4815272164f620b952d037}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!create\+\_\+hit\+\_\+config@{create\+\_\+hit\+\_\+config}}
\index{create\+\_\+hit\+\_\+config@{create\+\_\+hit\+\_\+config}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{create\+\_\+hit\+\_\+config()}{create\_hit\_config()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+create\+\_\+hit\+\_\+config (\begin{DoxyParamCaption}\item[{}]{opt,  }\item[{}]{task\+\_\+description,  }\item[{}]{unique\+\_\+worker,  }\item[{}]{is\+\_\+sandbox }\end{DoxyParamCaption})}

\begin{DoxyVerb}Writes a HIT config to file.
\end{DoxyVerb}
 

Definition at line 137 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
137 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a3f54e0bc76066fc3a784d6b2e3fc13bb}{create\_hit\_config}(opt, task\_description, unique\_worker, is\_sandbox):
138     \textcolor{stringliteral}{"""}
139 \textcolor{stringliteral}{    Writes a HIT config to file.}
140 \textcolor{stringliteral}{    """}
141     mturk\_submit\_url = \textcolor{stringliteral}{'https://workersandbox.mturk.com/mturk/externalSubmit'}
142     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} is\_sandbox:
143         mturk\_submit\_url = \textcolor{stringliteral}{'https://www.mturk.com/mturk/externalSubmit'}
144     hit\_config = \{
145         \textcolor{stringliteral}{'task\_description'}: task\_description,
146         \textcolor{stringliteral}{'is\_sandbox'}: is\_sandbox,
147         \textcolor{stringliteral}{'mturk\_submit\_url'}: mturk\_submit\_url,
148         \textcolor{stringliteral}{'unique\_worker'}: unique\_worker,
149         \textcolor{stringliteral}{'frame\_height'}: opt.get(\textcolor{stringliteral}{'frame\_height'}, 650),
150         \textcolor{stringliteral}{'allow\_reviews'}: opt.get(\textcolor{stringliteral}{'allow\_reviews'}, \textcolor{keyword}{False}),
151         \textcolor{stringliteral}{'block\_mobile'}: opt.get(\textcolor{stringliteral}{'block\_mobile'}, \textcolor{keyword}{True}),
152         \textcolor{comment}{# Populate the chat pane title from chat\_title, defaulting to the}
153         \textcolor{comment}{# hit\_title if the task provides no chat\_title}
154         \textcolor{stringliteral}{'chat\_title'}: opt.get(\textcolor{stringliteral}{'chat\_title'}, opt.get(\textcolor{stringliteral}{'hit\_title'}, \textcolor{stringliteral}{'Live Chat'})),
155         \textcolor{stringliteral}{'template\_type'}: opt.get(\textcolor{stringliteral}{'frontend\_template\_type'}, \textcolor{stringliteral}{'default'}),
156     \}
157     hit\_config\_file\_path = os.path.join(opt[\textcolor{stringliteral}{'tmp\_dir'}], \textcolor{stringliteral}{'hit\_config.json'})
158     \textcolor{keywordflow}{if} os.path.exists(hit\_config\_file\_path):
159         os.remove(hit\_config\_file\_path)
160     with open(hit\_config\_file\_path, \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} hit\_config\_file:
161         hit\_config\_file.write(json.dumps(hit\_config))
162 
163 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_acd08d4459a8231afa32daccd82c5c957}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_acd08d4459a8231afa32daccd82c5c957}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!create\+\_\+hit\+\_\+type@{create\+\_\+hit\+\_\+type}}
\index{create\+\_\+hit\+\_\+type@{create\+\_\+hit\+\_\+type}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{create\+\_\+hit\+\_\+type()}{create\_hit\_type()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+create\+\_\+hit\+\_\+type (\begin{DoxyParamCaption}\item[{}]{hit\+\_\+title,  }\item[{}]{hit\+\_\+description,  }\item[{}]{hit\+\_\+keywords,  }\item[{}]{hit\+\_\+reward,  }\item[{}]{assignment\+\_\+duration\+\_\+in\+\_\+seconds,  }\item[{}]{is\+\_\+sandbox,  }\item[{}]{qualifications = {\ttfamily None},  }\item[{}]{auto\+\_\+approve\+\_\+delay = {\ttfamily 7~$\ast$~24~$\ast$~3600} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create a HIT type to be used to generate HITs of the requested params.
\end{DoxyVerb}
 

Definition at line 297 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
297 ):
298     \textcolor{stringliteral}{"""}
299 \textcolor{stringliteral}{    Create a HIT type to be used to generate HITs of the requested params.}
300 \textcolor{stringliteral}{    """}
301     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox)
302 
303     \textcolor{comment}{# If the user hasn't specified a location qualification, we assume to}
304     \textcolor{comment}{# restrict the HIT to some english-speaking countries.}
305     locale\_requirements = []
306     has\_locale\_qual = \textcolor{keyword}{False}
307     \textcolor{keywordflow}{if} qualifications \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
308         \textcolor{keywordflow}{for} q \textcolor{keywordflow}{in} qualifications:
309             \textcolor{keywordflow}{if} q[\textcolor{stringliteral}{'QualificationTypeId'}] == \textcolor{stringliteral}{'00000000000000000071'}:
310                 has\_locale\_qual = \textcolor{keyword}{True}
311         locale\_requirements += qualifications
312 
313     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} has\_locale\_qual:
314         locale\_requirements.append(
315             \{
316                 \textcolor{stringliteral}{'QualificationTypeId'}: \textcolor{stringliteral}{'00000000000000000071'},
317                 \textcolor{stringliteral}{'Comparator'}: \textcolor{stringliteral}{'In'},
318                 \textcolor{stringliteral}{'LocaleValues'}: [
319                     \{\textcolor{stringliteral}{'Country'}: \textcolor{stringliteral}{'US'}\},
320                     \{\textcolor{stringliteral}{'Country'}: \textcolor{stringliteral}{'CA'}\},
321                     \{\textcolor{stringliteral}{'Country'}: \textcolor{stringliteral}{'GB'}\},
322                     \{\textcolor{stringliteral}{'Country'}: \textcolor{stringliteral}{'AU'}\},
323                     \{\textcolor{stringliteral}{'Country'}: \textcolor{stringliteral}{'NZ'}\},
324                 ],
325                 \textcolor{stringliteral}{'RequiredToPreview'}: \textcolor{keyword}{True},
326             \}
327         )
328 
329     \textcolor{comment}{# Create the HIT type}
330     response = client.create\_hit\_type(
331         AutoApprovalDelayInSeconds=auto\_approve\_delay,
332         AssignmentDurationInSeconds=assignment\_duration\_in\_seconds,
333         Reward=\hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(hit\_reward),
334         Title=hit\_title,
335         Keywords=hit\_keywords,
336         Description=hit\_description,
337         QualificationRequirements=locale\_requirements,
338     )
339     hit\_type\_id = response[\textcolor{stringliteral}{'HITTypeId'}]
340     \textcolor{keywordflow}{return} hit\_type\_id
341 
342 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a471ced1f7df897dcf3414dd49b84ddeb}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a471ced1f7df897dcf3414dd49b84ddeb}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!create\+\_\+hit\+\_\+with\+\_\+hit\+\_\+type@{create\+\_\+hit\+\_\+with\+\_\+hit\+\_\+type}}
\index{create\+\_\+hit\+\_\+with\+\_\+hit\+\_\+type@{create\+\_\+hit\+\_\+with\+\_\+hit\+\_\+type}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{create\+\_\+hit\+\_\+with\+\_\+hit\+\_\+type()}{create\_hit\_with\_hit\_type()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+create\+\_\+hit\+\_\+with\+\_\+hit\+\_\+type (\begin{DoxyParamCaption}\item[{}]{opt,  }\item[{}]{page\+\_\+url,  }\item[{}]{hit\+\_\+type\+\_\+id,  }\item[{}]{num\+\_\+assignments,  }\item[{}]{is\+\_\+sandbox }\end{DoxyParamCaption})}

\begin{DoxyVerb}Creates the actual HIT given the type and page to direct clients to.
\end{DoxyVerb}
 

Definition at line 343 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
343 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a2e92dde4f8ec17749f22f83b6d362d4f}{create\_hit\_with\_hit\_type}(opt, page\_url, hit\_type\_id, num\_assignments, 
      is\_sandbox):
344     \textcolor{stringliteral}{"""}
345 \textcolor{stringliteral}{    Creates the actual HIT given the type and page to direct clients to.}
346 \textcolor{stringliteral}{    """}
347     page\_url = page\_url.replace(\textcolor{stringliteral}{'&'}, \textcolor{stringliteral}{'&amp;'})
348     amazon\_ext\_url = (
349         \textcolor{stringliteral}{'http://mechanicalturk.amazonaws.com/'}
350         \textcolor{stringliteral}{'AWSMechanicalTurkDataSchemas/2006-07-14/ExternalQuestion.xsd'}
351     )
352     question\_data\_struture = (
353         \textcolor{stringliteral}{'<ExternalQuestion xmlns="\{\}">'}
354         \textcolor{stringliteral}{'<ExternalURL>\{\}</ExternalURL>'}  \textcolor{comment}{# noqa: E131}
355         \textcolor{stringliteral}{'<FrameHeight>\{\}</FrameHeight>'}
356         \textcolor{stringliteral}{'</ExternalQuestion>'}
357         \textcolor{stringliteral}{''}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(amazon\_ext\_url, page\_url, opt.get(\textcolor{stringliteral}{'frame\_height'}, 650))
358     )
359 
360     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox)
361 
362     \textcolor{comment}{# Create the HIT}
363     response = client.create\_hit\_with\_hit\_type(
364         HITTypeId=hit\_type\_id,
365         MaxAssignments=num\_assignments,
366         LifetimeInSeconds=31536000,
367         Question=question\_data\_struture,
368     )
369 
370     \textcolor{comment}{# The response included several fields that will be helpful later}
371     hit\_type\_id = response[\textcolor{stringliteral}{'HIT'}][\textcolor{stringliteral}{'HITTypeId'}]
372     hit\_id = response[\textcolor{stringliteral}{'HIT'}][\textcolor{stringliteral}{'HITId'}]
373 
374     \textcolor{comment}{# Construct the hit URL}
375     url\_target = \textcolor{stringliteral}{'workersandbox'}
376     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} is\_sandbox:
377         url\_target = \textcolor{stringliteral}{'www'}
378     hit\_link = \textcolor{stringliteral}{'https://\{\}.mturk.com/mturk/preview?groupId=\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
379         url\_target, hit\_type\_id
380     )
381     \textcolor{keywordflow}{return} hit\_link, hit\_id, response
382 
383 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a1a4243aaafd94de8087e0d6ae06ad45c}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a1a4243aaafd94de8087e0d6ae06ad45c}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!delete\+\_\+qualification@{delete\+\_\+qualification}}
\index{delete\+\_\+qualification@{delete\+\_\+qualification}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{delete\+\_\+qualification()}{delete\_qualification()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+delete\+\_\+qualification (\begin{DoxyParamCaption}\item[{}]{qualification\+\_\+id,  }\item[{}]{is\+\_\+sandbox }\end{DoxyParamCaption})}

\begin{DoxyVerb}Deletes a qualification by id.
\end{DoxyVerb}
 

Definition at line 181 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
181 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a389ca1d743e6319cb35916a6b0d7867d}{delete\_qualification}(qualification\_id, is\_sandbox):
182     \textcolor{stringliteral}{"""}
183 \textcolor{stringliteral}{    Deletes a qualification by id.}
184 \textcolor{stringliteral}{    """}
185     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox)
186     client.delete\_qualification\_type(QualificationTypeId=qualification\_id)
187 
188 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_aa321f5dc5e9700bc3906fca85490e25e}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_aa321f5dc5e9700bc3906fca85490e25e}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!delete\+\_\+sns\+\_\+topic@{delete\+\_\+sns\+\_\+topic}}
\index{delete\+\_\+sns\+\_\+topic@{delete\+\_\+sns\+\_\+topic}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{delete\+\_\+sns\+\_\+topic()}{delete\_sns\_topic()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+delete\+\_\+sns\+\_\+topic (\begin{DoxyParamCaption}\item[{}]{topic\+\_\+arn }\end{DoxyParamCaption})}



Definition at line 459 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
459 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a669fa20824749469221df338aa8a0e8e}{delete\_sns\_topic}(topic\_arn):
460     client = boto3.client(\textcolor{stringliteral}{'sns'}, region\_name=\textcolor{stringliteral}{'us-east-1'})
461     client.delete\_topic(TopicArn=topic\_arn)
462 \end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a26e9e405bc015ef647ef58a133c88f40}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a26e9e405bc015ef647ef58a133c88f40}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!expire\+\_\+hit@{expire\+\_\+hit}}
\index{expire\+\_\+hit@{expire\+\_\+hit}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{expire\+\_\+hit()}{expire\_hit()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+expire\+\_\+hit (\begin{DoxyParamCaption}\item[{}]{is\+\_\+sandbox,  }\item[{}]{hit\+\_\+id }\end{DoxyParamCaption})}



Definition at line 384 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
384 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a960c8639f5fa43ab8be109eb48ea1925}{expire\_hit}(is\_sandbox, hit\_id):
385     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox)
386     \textcolor{comment}{# Update expiration to a time in the past, the HIT expires instantly}
387     past\_time = datetime(2015, 1, 1)
388     client.update\_expiration\_for\_hit(HITId=hit\_id, ExpireAt=past\_time)
389 
390 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ab4c0dfc58f9fe37c28c9d23628d1de4e}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ab4c0dfc58f9fe37c28c9d23628d1de4e}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!find\+\_\+or\+\_\+create\+\_\+qualification@{find\+\_\+or\+\_\+create\+\_\+qualification}}
\index{find\+\_\+or\+\_\+create\+\_\+qualification@{find\+\_\+or\+\_\+create\+\_\+qualification}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{find\+\_\+or\+\_\+create\+\_\+qualification()}{find\_or\_create\_qualification()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+find\+\_\+or\+\_\+create\+\_\+qualification (\begin{DoxyParamCaption}\item[{}]{qualification\+\_\+name,  }\item[{}]{description,  }\item[{}]{is\+\_\+sandbox,  }\item[{}]{must\+\_\+be\+\_\+owned = {\ttfamily True} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Query amazon to find the existing qualification name, return the Id.

If it exists and must_be_owned is true but we don't own it, this prints an error and
returns none. If it doesn't exist, the qualification is created
\end{DoxyVerb}
 

Definition at line 228 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
228 ):
229     \textcolor{stringliteral}{"""}
230 \textcolor{stringliteral}{    Query amazon to find the existing qualification name, return the Id.}
231 \textcolor{stringliteral}{}
232 \textcolor{stringliteral}{    If it exists and must\_be\_owned is true but we don't own it, this prints an error and}
233 \textcolor{stringliteral}{    returns none. If it doesn't exist, the qualification is created}
234 \textcolor{stringliteral}{    """}
235     qual\_id = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a54121023abc81124ba03cc50d5f23af3}{find\_qualification}(
236         qualification\_name, is\_sandbox, must\_be\_owned=must\_be\_owned
237     )
238 
239     \textcolor{keywordflow}{if} qual\_id \textcolor{keywordflow}{is} \textcolor{keyword}{False}:
240         \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
241     \textcolor{keywordflow}{if} qual\_id \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
242         \textcolor{keywordflow}{return} qual\_id
243 
244     \textcolor{comment}{# Create the qualification, as it doesn't exist yet}
245     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox)
246     response = client.create\_qualification\_type(
247         Name=qualification\_name,
248         Description=description,
249         QualificationTypeStatus=\textcolor{stringliteral}{'Active'},
250     )
251     \textcolor{keywordflow}{return} response[\textcolor{stringliteral}{'QualificationType'}][\textcolor{stringliteral}{'QualificationTypeId'}]
252 
253 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_acd636315cbbf11cc5d9d641173e51586}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_acd636315cbbf11cc5d9d641173e51586}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!find\+\_\+qualification@{find\+\_\+qualification}}
\index{find\+\_\+qualification@{find\+\_\+qualification}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{find\+\_\+qualification()}{find\_qualification()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+find\+\_\+qualification (\begin{DoxyParamCaption}\item[{}]{qualification\+\_\+name,  }\item[{}]{is\+\_\+sandbox,  }\item[{}]{must\+\_\+be\+\_\+owned = {\ttfamily True} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Query amazon to find the existing qualification name, return the Id, otherwise
return none.

If must_be_owned is true, it only returns qualifications owned by the user. Will
return False if it finds another's qualification
\end{DoxyVerb}
 

Definition at line 189 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
189 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a54121023abc81124ba03cc50d5f23af3}{find\_qualification}(qualification\_name, is\_sandbox, must\_be\_owned=True):
190     \textcolor{stringliteral}{"""}
191 \textcolor{stringliteral}{    Query amazon to find the existing qualification name, return the Id, otherwise}
192 \textcolor{stringliteral}{    return none.}
193 \textcolor{stringliteral}{}
194 \textcolor{stringliteral}{    If must\_be\_owned is true, it only returns qualifications owned by the user. Will}
195 \textcolor{stringliteral}{    return False if it finds another's qualification}
196 \textcolor{stringliteral}{    """}
197     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox)
198 
199     \textcolor{comment}{# Search for the qualification owned by the current user}
200     response = client.list\_qualification\_types(
201         Query=qualification\_name, MustBeRequestable=\textcolor{keyword}{True}, MustBeOwnedByCaller=\textcolor{keyword}{True}
202     )
203 
204     \textcolor{keywordflow}{for} qualification \textcolor{keywordflow}{in} response[\textcolor{stringliteral}{'QualificationTypes'}]:
205         \textcolor{keywordflow}{if} qualification[\textcolor{stringliteral}{'Name'}] == qualification\_name:
206             \textcolor{keywordflow}{return} qualification[\textcolor{stringliteral}{'QualificationTypeId'}]
207 
208     \textcolor{comment}{# Qualification was not found to exist, check to see if someone else has it}
209     response = client.list\_qualification\_types(
210         Query=qualification\_name, MustBeRequestable=\textcolor{keyword}{True}, MustBeOwnedByCaller=\textcolor{keyword}{False}
211     )
212 
213     \textcolor{keywordflow}{for} qualification \textcolor{keywordflow}{in} response[\textcolor{stringliteral}{'QualificationTypes'}]:
214         \textcolor{keywordflow}{if} qualification[\textcolor{stringliteral}{'Name'}] == qualification\_name:
215             \textcolor{keywordflow}{if} must\_be\_owned:
216                 print(
217                     \textcolor{stringliteral}{'Sorry, the qualification name \{\} is already owned, '}
218                     \textcolor{stringliteral}{'please use a different name for your qualification.'}
219                     \textcolor{stringliteral}{''}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(qualification\_name)
220                 )
221                 \textcolor{keywordflow}{return} \textcolor{keyword}{False}
222             \textcolor{keywordflow}{return} qualification[\textcolor{stringliteral}{'QualificationTypeId'}]
223     \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
224 
225 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ad9e4ecfca00663796f26ca16a2778f29}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ad9e4ecfca00663796f26ca16a2778f29}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!get\+\_\+mturk\+\_\+client@{get\+\_\+mturk\+\_\+client}}
\index{get\+\_\+mturk\+\_\+client@{get\+\_\+mturk\+\_\+client}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{get\+\_\+mturk\+\_\+client()}{get\_mturk\_client()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+get\+\_\+mturk\+\_\+client (\begin{DoxyParamCaption}\item[{}]{is\+\_\+sandbox }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns the appropriate mturk client given sandbox option.
\end{DoxyVerb}
 

Definition at line 164 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
164 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox):
165     \textcolor{stringliteral}{"""}
166 \textcolor{stringliteral}{    Returns the appropriate mturk client given sandbox option.}
167 \textcolor{stringliteral}{    """}
168     \textcolor{keyword}{global} client
169     \textcolor{keywordflow}{if} client \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
170         client = boto3.client(
171             service\_name=\textcolor{stringliteral}{'mturk'},
172             region\_name=\textcolor{stringliteral}{'us-east-1'},
173             endpoint\_url=\textcolor{stringliteral}{'https://mturk-requester-sandbox.us-east-1.amazonaws.com'},
174         )
175         \textcolor{comment}{# Region is always us-east-1}
176         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} is\_sandbox:
177             client = boto3.client(service\_name=\textcolor{stringliteral}{'mturk'}, region\_name=\textcolor{stringliteral}{'us-east-1'})
178     \textcolor{keywordflow}{return} client
179 
180 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a631fbce36ff4d09422f29513460bc744}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a631fbce36ff4d09422f29513460bc744}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!give\+\_\+worker\+\_\+qualification@{give\+\_\+worker\+\_\+qualification}}
\index{give\+\_\+worker\+\_\+qualification@{give\+\_\+worker\+\_\+qualification}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{give\+\_\+worker\+\_\+qualification()}{give\_worker\_qualification()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+give\+\_\+worker\+\_\+qualification (\begin{DoxyParamCaption}\item[{}]{worker\+\_\+id,  }\item[{}]{qualification\+\_\+id,  }\item[{}]{value = {\ttfamily None},  }\item[{}]{is\+\_\+sandbox = {\ttfamily True} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Give a qualification to the given worker.
\end{DoxyVerb}
 

Definition at line 254 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
254 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a640e2d9d121507f92649cccbd27e3af9}{give\_worker\_qualification}(worker\_id, qualification\_id, value=None, 
      is\_sandbox=True):
255     \textcolor{stringliteral}{"""}
256 \textcolor{stringliteral}{    Give a qualification to the given worker.}
257 \textcolor{stringliteral}{    """}
258     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox)
259 
260     \textcolor{keywordflow}{if} value \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
261         client.associate\_qualification\_with\_worker(
262             QualificationTypeId=qualification\_id,
263             WorkerId=worker\_id,
264             IntegerValue=value,
265             SendNotification=\textcolor{keyword}{False},
266         )
267     \textcolor{keywordflow}{else}:
268         client.associate\_qualification\_with\_worker(
269             QualificationTypeId=qualification\_id,
270             WorkerId=worker\_id,
271             IntegerValue=1,
272             SendNotification=\textcolor{keyword}{False},
273         )
274 
275 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_abc2c057b91641179f7c4bb50dd916488}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_abc2c057b91641179f7c4bb50dd916488}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!remove\+\_\+worker\+\_\+qualification@{remove\+\_\+worker\+\_\+qualification}}
\index{remove\+\_\+worker\+\_\+qualification@{remove\+\_\+worker\+\_\+qualification}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{remove\+\_\+worker\+\_\+qualification()}{remove\_worker\_qualification()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+remove\+\_\+worker\+\_\+qualification (\begin{DoxyParamCaption}\item[{}]{worker\+\_\+id,  }\item[{}]{qualification\+\_\+id,  }\item[{}]{is\+\_\+sandbox = {\ttfamily True},  }\item[{}]{reason = {\ttfamily \textquotesingle{}\textquotesingle{}} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Give a qualification to the given worker.
\end{DoxyVerb}
 

Definition at line 278 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
278 ):
279     \textcolor{stringliteral}{"""}
280 \textcolor{stringliteral}{    Give a qualification to the given worker.}
281 \textcolor{stringliteral}{    """}
282     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox)
283     client.disassociate\_qualification\_from\_worker(
284         QualificationTypeId=qualification\_id, WorkerId=worker\_id, Reason=reason
285     )
286 
287 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_abfc17443a7c8018fc56dcc058e7b86f1}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_abfc17443a7c8018fc56dcc058e7b86f1}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!send\+\_\+test\+\_\+notif@{send\+\_\+test\+\_\+notif}}
\index{send\+\_\+test\+\_\+notif@{send\+\_\+test\+\_\+notif}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{send\+\_\+test\+\_\+notif()}{send\_test\_notif()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+send\+\_\+test\+\_\+notif (\begin{DoxyParamCaption}\item[{}]{topic\+\_\+arn,  }\item[{}]{event\+\_\+type }\end{DoxyParamCaption})}



Definition at line 442 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
442 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a03b8f25675cb76e8b27205ca5d26e623}{send\_test\_notif}(topic\_arn, event\_type):
443     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(\textcolor{keyword}{True})
444     client.send\_test\_event\_notification(
445         Notification=\{
446             \textcolor{stringliteral}{'Destination'}: topic\_arn,
447             \textcolor{stringliteral}{'Transport'}: \textcolor{stringliteral}{'SNS'},
448             \textcolor{stringliteral}{'Version'}: \textcolor{stringliteral}{'2006-05-05'},
449             \textcolor{stringliteral}{'EventTypes'}: [
450                 \textcolor{stringliteral}{'AssignmentAbandoned'},
451                 \textcolor{stringliteral}{'AssignmentReturned'},
452                 \textcolor{stringliteral}{'AssignmentSubmitted'},
453             ],
454         \},
455         TestEventType=event\_type,
456     )
457 
458 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a086d7381c328214587d3ec28bbcd19ab}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a086d7381c328214587d3ec28bbcd19ab}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!setup\+\_\+aws\+\_\+credentials@{setup\+\_\+aws\+\_\+credentials}}
\index{setup\+\_\+aws\+\_\+credentials@{setup\+\_\+aws\+\_\+credentials}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{setup\+\_\+aws\+\_\+credentials()}{setup\_aws\_credentials()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+setup\+\_\+aws\+\_\+credentials (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 23 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
23 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a018a49fdf2cf6ff4c0b279d2f5b1bff0}{setup\_aws\_credentials}():
24     \textcolor{keywordflow}{try}:
25         \textcolor{comment}{# Use existing credentials}
26         boto3.Session(profile\_name=aws\_profile\_name)
27     \textcolor{keywordflow}{except} ProfileNotFound:
28         \textcolor{comment}{# Setup new credentials}
29         print(
30             \textcolor{stringliteral}{'AWS credentials not found. Please create an IAM user with '}
31             \textcolor{stringliteral}{'programmatic access and AdministratorAccess policy at '}
32             \textcolor{stringliteral}{'https://console.aws.amazon.com/iam/ (On the "Set permissions" '}
33             \textcolor{stringliteral}{'page, choose "Attach existing policies directly" and then select '}
34             \textcolor{stringliteral}{'"AdministratorAccess" policy). After creating the IAM user, '}
35             \textcolor{stringliteral}{'please enter the user\(\backslash\)'s Access Key ID and Secret Access '}
36             \textcolor{stringliteral}{'Key below:'}
37         )
38         aws\_access\_key\_id = input(\textcolor{stringliteral}{'Access Key ID: '})
39         aws\_secret\_access\_key = input(\textcolor{stringliteral}{'Secret Access Key: '})
40         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(os.path.expanduser(\textcolor{stringliteral}{'~/.aws/'})):
41             os.makedirs(os.path.expanduser(\textcolor{stringliteral}{'~/.aws/'}))
42         aws\_credentials\_file\_path = \textcolor{stringliteral}{'~/.aws/credentials'}
43         aws\_credentials\_file\_string = \textcolor{keywordtype}{None}
44         expanded\_aws\_file\_path = os.path.expanduser(aws\_credentials\_file\_path)
45         \textcolor{keywordflow}{if} os.path.exists(expanded\_aws\_file\_path):
46             with open(expanded\_aws\_file\_path, \textcolor{stringliteral}{'r') as aws\_credentials\_file:}
47 \textcolor{stringliteral}{                aws\_credentials\_file\_string = aws\_credentials\_file.read()}
48 \textcolor{stringliteral}{        with open(expanded\_aws\_file\_path, 'a+'}) \textcolor{keyword}{as} aws\_credentials\_file:
49             \textcolor{comment}{# Clean up file}
50             \textcolor{keywordflow}{if} aws\_credentials\_file\_string:
51                 \textcolor{keywordflow}{if} aws\_credentials\_file\_string.endswith(\textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)n"}):
52                     \textcolor{keywordflow}{pass}
53                 \textcolor{keywordflow}{elif} aws\_credentials\_file\_string.endswith(\textcolor{stringliteral}{"\(\backslash\)n"}):
54                     aws\_credentials\_file.write(\textcolor{stringliteral}{"\(\backslash\)n"})
55                 \textcolor{keywordflow}{else}:
56                     aws\_credentials\_file.write(\textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)n"})
57             \textcolor{comment}{# Write login details}
58             aws\_credentials\_file.write(\textcolor{stringliteral}{'[\{\}]\(\backslash\)n'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(aws\_profile\_name))
59             aws\_credentials\_file.write(
60                 \textcolor{stringliteral}{'aws\_access\_key\_id=\{\}\(\backslash\)n'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(aws\_access\_key\_id)
61             )
62             aws\_credentials\_file.write(
63                 \textcolor{stringliteral}{'aws\_secret\_access\_key=\{\}\(\backslash\)n'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(aws\_secret\_access\_key)
64             )
65         print(
66             \textcolor{stringliteral}{'AWS credentials successfully saved in \{\} file.\(\backslash\)n'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
67                 aws\_credentials\_file\_path
68             )
69         )
70     os.environ[\textcolor{stringliteral}{'AWS\_PROFILE'}] = aws\_profile\_name
71 
72 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a01315ef04ead23e4c1a84c027dcccf3f}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a01315ef04ead23e4c1a84c027dcccf3f}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!setup\+\_\+sns\+\_\+topic@{setup\+\_\+sns\+\_\+topic}}
\index{setup\+\_\+sns\+\_\+topic@{setup\+\_\+sns\+\_\+topic}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{setup\+\_\+sns\+\_\+topic()}{setup\_sns\_topic()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+setup\+\_\+sns\+\_\+topic (\begin{DoxyParamCaption}\item[{}]{task\+\_\+name,  }\item[{}]{server\+\_\+url,  }\item[{}]{task\+\_\+group\+\_\+id }\end{DoxyParamCaption})}



Definition at line 391 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
391 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a98c01409407393818d100c21a4e07742}{setup\_sns\_topic}(task\_name, server\_url, task\_group\_id):
392     \textcolor{comment}{# Create the topic and subscribe to it so that our server receives notifs}
393     client = boto3.client(\textcolor{stringliteral}{'sns'}, region\_name=\textcolor{stringliteral}{'us-east-1'})
394     pattern = re.compile(\textcolor{stringliteral}{'[^a-zA-Z0-9\_-]+'})
395     filtered\_task\_name = pattern.sub(\textcolor{stringliteral}{''}, task\_name)
396     response = client.create\_topic(Name=filtered\_task\_name)
397     arn = response[\textcolor{stringliteral}{'TopicArn'}]
398     topic\_sub\_url = \textcolor{stringliteral}{'\{\}/sns\_posts?task\_group\_id=\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(server\_url, task\_group\_id)
399     client.subscribe(TopicArn=arn, Protocol=\textcolor{stringliteral}{'https'}, Endpoint=topic\_sub\_url)
400     response = client.get\_topic\_attributes(TopicArn=arn)
401     policy\_json = \textcolor{stringliteral}{'''\{\{}
402 \textcolor{stringliteral}{    "Version": "2008-10-17",}
403 \textcolor{stringliteral}{    "Id": "\{\}/MTurkOnlyPolicy",}
404 \textcolor{stringliteral}{    "Statement": [}
405 \textcolor{stringliteral}{        \{\{}
406 \textcolor{stringliteral}{            "Sid": "MTurkOnlyPolicy",}
407 \textcolor{stringliteral}{            "Effect": "Allow",}
408 \textcolor{stringliteral}{            "Principal": \{\{}
409 \textcolor{stringliteral}{                "Service": "mturk-requester.amazonaws.com"}
410 \textcolor{stringliteral}{            \}\},}
411 \textcolor{stringliteral}{            "Action": "SNS:Publish",}
412 \textcolor{stringliteral}{            "Resource": "\{\}"}
413 \textcolor{stringliteral}{        \}\}}
414 \textcolor{stringliteral}{    ]\}\}'''}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
415         arn, arn
416     )
417     client.set\_topic\_attributes(
418         TopicArn=arn, AttributeName=\textcolor{stringliteral}{'Policy'}, AttributeValue=policy\_json
419     )
420     \textcolor{keywordflow}{return} arn
421 
422 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a06d86a6c70c953fda4ae13db4d43bc79}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a06d86a6c70c953fda4ae13db4d43bc79}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!subscribe\+\_\+to\+\_\+hits@{subscribe\+\_\+to\+\_\+hits}}
\index{subscribe\+\_\+to\+\_\+hits@{subscribe\+\_\+to\+\_\+hits}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{subscribe\+\_\+to\+\_\+hits()}{subscribe\_to\_hits()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+subscribe\+\_\+to\+\_\+hits (\begin{DoxyParamCaption}\item[{}]{hit\+\_\+type\+\_\+id,  }\item[{}]{is\+\_\+sandbox,  }\item[{}]{sns\+\_\+arn }\end{DoxyParamCaption})}



Definition at line 423 of file mturk\+\_\+utils.\+py.


\begin{DoxyCode}
423 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_accc5838e30ccf9ab95050ab11ac0d973}{subscribe\_to\_hits}(hit\_type\_id, is\_sandbox, sns\_arn):
424     \textcolor{comment}{# Get the mturk client and create notifications for our hits}
425     client = \hyperlink{namespaceparlai_1_1mturk_1_1core_1_1mturk__utils_a577e2527c04682284394b0951a090695}{get\_mturk\_client}(is\_sandbox)
426     client.update\_notification\_settings(
427         HITTypeId=hit\_type\_id,
428         Notification=\{
429             \textcolor{stringliteral}{'Destination'}: sns\_arn,
430             \textcolor{stringliteral}{'Transport'}: \textcolor{stringliteral}{'SNS'},
431             \textcolor{stringliteral}{'Version'}: \textcolor{stringliteral}{'2006-05-05'},
432             \textcolor{stringliteral}{'EventTypes'}: [
433                 \textcolor{stringliteral}{'AssignmentAbandoned'},
434                 \textcolor{stringliteral}{'AssignmentReturned'},
435                 \textcolor{stringliteral}{'AssignmentSubmitted'},
436             ],
437         \},
438         Active=\textcolor{keyword}{True},
439     )
440 
441 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ab502738358dcb1b59d34a1443b21834e}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_ab502738358dcb1b59d34a1443b21834e}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!aws\+\_\+profile\+\_\+name@{aws\+\_\+profile\+\_\+name}}
\index{aws\+\_\+profile\+\_\+name@{aws\+\_\+profile\+\_\+name}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{aws\+\_\+profile\+\_\+name}{aws\_profile\_name}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+aws\+\_\+profile\+\_\+name}



Definition at line 17 of file mturk\+\_\+utils.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a09d7c0fc880089c5194ddc68af118f15}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a09d7c0fc880089c5194ddc68af118f15}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!client@{client}}
\index{client@{client}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{client}{client}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+client}



Definition at line 18 of file mturk\+\_\+utils.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a5813bb15ba851c7bbbf0871a7979720d}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a5813bb15ba851c7bbbf0871a7979720d}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!parent\+\_\+dir@{parent\+\_\+dir}}
\index{parent\+\_\+dir@{parent\+\_\+dir}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{parent\+\_\+dir}{parent\_dir}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+parent\+\_\+dir}



Definition at line 20 of file mturk\+\_\+utils.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a3dff8dba3aad1cc7f2e7cfbbc3984bc2}\label{namespaceparlai_1_1mturk_1_1core_1_1dev_1_1mturk__utils_a3dff8dba3aad1cc7f2e7cfbbc3984bc2}} 
\index{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}!region\+\_\+name@{region\+\_\+name}}
\index{region\+\_\+name@{region\+\_\+name}!parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils@{parlai\+::mturk\+::core\+::dev\+::mturk\+\_\+utils}}
\subsubsection{\texorpdfstring{region\+\_\+name}{region\_name}}
{\footnotesize\ttfamily parlai.\+mturk.\+core.\+dev.\+mturk\+\_\+utils.\+region\+\_\+name}



Definition at line 16 of file mturk\+\_\+utils.\+py.

