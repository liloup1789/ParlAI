\hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run}{}\section{parlai.\+mturk.\+tasks.\+wizard\+\_\+of\+\_\+wikipedia.\+run Namespace Reference}
\label{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run}\index{parlai.\+mturk.\+tasks.\+wizard\+\_\+of\+\_\+wikipedia.\+run@{parlai.\+mturk.\+tasks.\+wizard\+\_\+of\+\_\+wikipedia.\+run}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a22eb017ecd8f1a211fc5aac511d3102e}{setup\+\_\+retriever} (opt)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a59836c3be93d4b491fa9ddecbb4e83c0}{setup\+\_\+title\+\_\+to\+\_\+passage} (opt)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a5c16caa932230f93c418facd793be473}{setup\+\_\+personas\+\_\+with\+\_\+wiki\+\_\+links} (opt)
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a2292712790bc7b0c052359562a4f0943}{main} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a2292712790bc7b0c052359562a4f0943}\label{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a2292712790bc7b0c052359562a4f0943}} 
\index{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run@{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run}!main@{main}}
\index{main@{main}!parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run@{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+wizard\+\_\+of\+\_\+wikipedia.\+run.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}Wizard of Wikipedia Data Collection Task.

The task involves two people holding a conversation. One dialog partner
chooses a topic to discuss, and then dialog proceeds.

One partner is the Wizard, who has access to retrieved external
information conditioned on the last two utterances, as well as
information regarding the chosen topic.

The other partner is the Apprentice, who assumes the role of someone
eager to learn about the chosen topic.
\end{DoxyVerb}
 

Definition at line 91 of file run.\+py.


\begin{DoxyCode}
91 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run_ad3ab2c71f8083c3112815c0b363d316b}{main}():
92     \textcolor{stringliteral}{"""}
93 \textcolor{stringliteral}{    Wizard of Wikipedia Data Collection Task.}
94 \textcolor{stringliteral}{}
95 \textcolor{stringliteral}{    The task involves two people holding a conversation. One dialog partner}
96 \textcolor{stringliteral}{    chooses a topic to discuss, and then dialog proceeds.}
97 \textcolor{stringliteral}{}
98 \textcolor{stringliteral}{    One partner is the Wizard, who has access to retrieved external}
99 \textcolor{stringliteral}{    information conditioned on the last two utterances, as well as}
100 \textcolor{stringliteral}{    information regarding the chosen topic.}
101 \textcolor{stringliteral}{}
102 \textcolor{stringliteral}{    The other partner is the Apprentice, who assumes the role of someone}
103 \textcolor{stringliteral}{    eager to learn about the chosen topic.}
104 \textcolor{stringliteral}{    """}
105     argparser = ParlaiParser(\textcolor{keyword}{False}, \textcolor{keyword}{False})
106     DictionaryAgent.add\_cmdline\_args(argparser)
107     argparser.add\_parlai\_data\_path()
108     argparser.add\_mturk\_args()
109     argparser.add\_argument(
110         \textcolor{stringliteral}{'-min\_t'}, \textcolor{stringliteral}{'--min\_turns'}, default=3, type=int, help=\textcolor{stringliteral}{'minimum number of turns'}
111     )
112     argparser.add\_argument(
113         \textcolor{stringliteral}{'-max\_t'},
114         \textcolor{stringliteral}{'--max\_turns'},
115         default=5,
116         type=int,
117         help=\textcolor{stringliteral}{'maximal number of chat turns'},
118     )
119     argparser.add\_argument(
120         \textcolor{stringliteral}{'-mx\_rsp\_time'},
121         \textcolor{stringliteral}{'--max\_resp\_time'},
122         default=120,
123         type=int,
124         help=\textcolor{stringliteral}{'time limit for entering a dialog message'},
125     )
126     argparser.add\_argument(
127         \textcolor{stringliteral}{'-mx\_onb\_time'},
128         \textcolor{stringliteral}{'--max\_onboard\_time'},
129         type=int,
130         default=300,
131         help=\textcolor{stringliteral}{'time limit for turker'} \textcolor{stringliteral}{'in onboarding'},
132     )
133     argparser.add\_argument(
134         \textcolor{stringliteral}{'--persona-type'},
135         default=\textcolor{stringliteral}{'both'},
136         type=str,
137         choices=[\textcolor{stringliteral}{'both'}, \textcolor{stringliteral}{'self'}, \textcolor{stringliteral}{'other'}],
138         help=\textcolor{stringliteral}{'Which personas to load from personachat'},
139     )
140     argparser.add\_argument(
141         \textcolor{stringliteral}{'--auto-approve-delay'},
142         type=int,
143         default=3600 * 24 * 1,
144         help=\textcolor{stringliteral}{'how long to wait for  \(\backslash\)}
145 \textcolor{stringliteral}{                           auto approval'},
146     )
147     argparser.add\_argument(
148         \textcolor{stringliteral}{'--word-overlap-threshold'},
149         type=int,
150         default=2,
151         help=\textcolor{stringliteral}{'How much word overlap we want between message \(\backslash\)}
152 \textcolor{stringliteral}{                           and checked sentence'},
153     )
154     argparser.add\_argument(
155         \textcolor{stringliteral}{'--num-good-sentence-threshold'},
156         type=int,
157         default=2,
158         help=\textcolor{stringliteral}{'How many good sentences with sufficient overlap \(\backslash\)}
159 \textcolor{stringliteral}{                           are necessary for turker to be considered good.'},
160     )
161     argparser.add\_argument(
162         \textcolor{stringliteral}{'--num-passages-retrieved'},
163         type=int,
164         default=7,
165         help=\textcolor{stringliteral}{'How many passages to retrieve per dialog \(\backslash\)}
166 \textcolor{stringliteral}{                           message'},
167     )
168 
169     opt = argparser.parse\_args()
170     directory\_path = os.path.dirname(os.path.abspath(\_\_file\_\_))
171     opt[\textcolor{stringliteral}{'task'}] = os.path.basename(directory\_path)
172     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'data\_path'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt:
173         opt[\textcolor{stringliteral}{'data\_path'}] = os.getcwd() + \textcolor{stringliteral}{'/data/'} + opt[\textcolor{stringliteral}{'task'}]
174         opt[\textcolor{stringliteral}{'current\_working\_dir'}] = os.getcwd()
175     opt.update(task\_config)
176 
177     mturk\_agent\_ids = [APPRENTICE, WIZARD]
178     opt[\textcolor{stringliteral}{'min\_messages'}] = 2
179 
180     mturk\_manager = MTurkManager(opt=opt, mturk\_agent\_ids=mturk\_agent\_ids)
181     \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a5c16caa932230f93c418facd793be473}{setup\_personas\_with\_wiki\_links}(opt)
182     ir\_agent, task = \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a22eb017ecd8f1a211fc5aac511d3102e}{setup\_retriever}(opt)
183     persona\_generator = PersonasGenerator(opt)
184     wiki\_title\_to\_passage = \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a59836c3be93d4b491fa9ddecbb4e83c0}{setup\_title\_to\_passage}(opt)
185     mturk\_manager.setup\_server(task\_directory\_path=directory\_path)
186     worker\_roles = \{\}
187     connect\_counter = AttrDict(value=0)
188 
189     \textcolor{keywordflow}{try}:
190         mturk\_manager.start\_new\_run()
191         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} opt[\textcolor{stringliteral}{'is\_sandbox'}]:
192             with open(os.path.join(opt[\textcolor{stringliteral}{'current\_working\_dir'}], \textcolor{stringliteral}{'mtdont.txt'})) \textcolor{keyword}{as} f:
193                 lines = [l.replace(\textcolor{stringliteral}{'\(\backslash\)n'}, \textcolor{stringliteral}{''}) \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} f.readlines()]
194                 \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} lines:
195                     mturk\_manager.soft\_block\_worker(w)
196 
197         \textcolor{keyword}{def }run\_onboard(worker):
198             role = mturk\_agent\_ids[connect\_counter.value % len(mturk\_agent\_ids)]
199             connect\_counter.value += 1
200             worker\_roles[worker.worker\_id] = role
201             worker.persona\_generator = persona\_generator
202             world = RoleOnboardWorld(opt, worker, role)
203             world.parley()
204             world.shutdown()
205 
206         mturk\_manager.set\_onboard\_function(onboard\_function=run\_onboard)
207         mturk\_manager.ready\_to\_accept\_workers()
208         mturk\_manager.create\_hits()
209 
210         \textcolor{keyword}{def }check\_workers\_eligibility(workers):
211             \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'is\_sandbox'}]:
212                 \textcolor{keywordflow}{return} workers
213             valid\_workers = \{\}
214             \textcolor{keywordflow}{for} worker \textcolor{keywordflow}{in} workers:
215                 worker\_id = worker.worker\_id
216                 \textcolor{keywordflow}{if} worker\_id \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} worker\_roles:
217                     \textcolor{stringliteral}{"""}
218 \textcolor{stringliteral}{                    Something went wrong...}
219 \textcolor{stringliteral}{                    """}
220                     \textcolor{keywordflow}{continue}
221                 role = worker\_roles[worker\_id]
222                 \textcolor{keywordflow}{if} role \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} valid\_workers:
223                     valid\_workers[role] = worker
224                 \textcolor{keywordflow}{if} len(valid\_workers) == 2:
225                     \textcolor{keywordflow}{break}
226             \textcolor{keywordflow}{return} valid\_workers.values() \textcolor{keywordflow}{if} len(valid\_workers) == 2 \textcolor{keywordflow}{else} []
227 
228         eligibility\_function = \{\textcolor{stringliteral}{'func'}: check\_workers\_eligibility, \textcolor{stringliteral}{'multiple'}: \textcolor{keyword}{True}\}
229 
230         \textcolor{keyword}{def }assign\_worker\_roles(workers):
231             \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'is\_sandbox'}]:
232                 \textcolor{keywordflow}{for} i, worker \textcolor{keywordflow}{in} enumerate(workers):
233                     worker.id = mturk\_agent\_ids[i % len(mturk\_agent\_ids)]
234             \textcolor{keywordflow}{else}:
235                 \textcolor{keywordflow}{for} worker \textcolor{keywordflow}{in} workers:
236                     worker.id = worker\_roles[worker.worker\_id]
237 
238         \textcolor{keyword}{def }run\_conversation(mturk\_manager, opt, workers):
239             agents = workers[:]
240             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} opt[\textcolor{stringliteral}{'is\_sandbox'}]:
241                 \textcolor{keywordflow}{for} agent \textcolor{keywordflow}{in} agents:
242                     worker\_roles.pop(agent.worker\_id)
243             conv\_idx = mturk\_manager.conversation\_index
244             world = MTurkWizardOfWikipediaWorld(
245                 opt,
246                 agents=agents,
247                 world\_tag=\textcolor{stringliteral}{'conversation t\_\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(conv\_idx),
248                 ir\_agent=ir\_agent,
249                 wiki\_title\_to\_passage=wiki\_title\_to\_passage,
250                 task=task,
251             )
252             world.reset\_random()
253             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world.episode\_done():
254                 world.parley()
255             world.save\_data()
256             \textcolor{keywordflow}{if} world.convo\_finished \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} world.good\_wiz \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} opt[\textcolor{stringliteral}{'is\_sandbox'}]:
257                 mturk\_manager.soft\_block\_worker(world.wizard\_worker)
258             world.shutdown()
259             world.review\_work()
260 
261         mturk\_manager.start\_task(
262             eligibility\_function=eligibility\_function,
263             assign\_role\_function=assign\_worker\_roles,
264             task\_function=run\_conversation,
265         )
266 
267     \textcolor{keywordflow}{except} BaseException:
268         \textcolor{keywordflow}{raise}
269     \textcolor{keywordflow}{finally}:
270         mturk\_manager.expire\_all\_unassigned\_hits()
271         mturk\_manager.shutdown()
272 
273 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a5c16caa932230f93c418facd793be473}\label{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a5c16caa932230f93c418facd793be473}} 
\index{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run@{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run}!setup\+\_\+personas\+\_\+with\+\_\+wiki\+\_\+links@{setup\+\_\+personas\+\_\+with\+\_\+wiki\+\_\+links}}
\index{setup\+\_\+personas\+\_\+with\+\_\+wiki\+\_\+links@{setup\+\_\+personas\+\_\+with\+\_\+wiki\+\_\+links}!parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run@{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run}}
\subsubsection{\texorpdfstring{setup\+\_\+personas\+\_\+with\+\_\+wiki\+\_\+links()}{setup\_personas\_with\_wiki\_links()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+wizard\+\_\+of\+\_\+wikipedia.\+run.\+setup\+\_\+personas\+\_\+with\+\_\+wiki\+\_\+links (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 83 of file run.\+py.


\begin{DoxyCode}
83 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a5c16caa932230f93c418facd793be473}{setup\_personas\_with\_wiki\_links}(opt):
84     fname = \textcolor{stringliteral}{'personas\_with\_wiki\_links.txt'}
85     file\_path = \textcolor{stringliteral}{'\{\}/\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(os.getcwd(), fname)
86     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(file\_path):
87         url = \textcolor{stringliteral}{'http://parl.ai/downloads/wizard\_of\_wikipedia/'} + fname
88         build\_data.download(url, os.getcwd(), fname)
89 
90 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a22eb017ecd8f1a211fc5aac511d3102e}\label{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a22eb017ecd8f1a211fc5aac511d3102e}} 
\index{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run@{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run}!setup\+\_\+retriever@{setup\+\_\+retriever}}
\index{setup\+\_\+retriever@{setup\+\_\+retriever}!parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run@{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run}}
\subsubsection{\texorpdfstring{setup\+\_\+retriever()}{setup\_retriever()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+wizard\+\_\+of\+\_\+wikipedia.\+run.\+setup\+\_\+retriever (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 26 of file run.\+py.


\begin{DoxyCode}
26 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a22eb017ecd8f1a211fc5aac511d3102e}{setup\_retriever}(opt):
27     print(\textcolor{stringliteral}{'[ Setting up Retriever ]'})
28     task = \textcolor{stringliteral}{'wikipedia:full'}
29     ret\_opt = copy.deepcopy(opt)
30     ret\_opt[\textcolor{stringliteral}{'model\_file'}] = \textcolor{stringliteral}{'models:wikipedia\_full/tfidf\_retriever/model'}
31     ret\_opt[\textcolor{stringliteral}{'retriever\_num\_retrieved'}] = opt.get(\textcolor{stringliteral}{'num\_passages\_retrieved'}, 7)
32     ret\_opt[\textcolor{stringliteral}{'retriever\_mode'}] = \textcolor{stringliteral}{'keys'}
33     ret\_opt[\textcolor{stringliteral}{'override'}] = \{\textcolor{stringliteral}{'remove\_title'}: \textcolor{keyword}{False}\}
34     ir\_agent = \hyperlink{namespaceparlai_1_1core_1_1agents_a00d77a7e26fb89e8bd900f7b2a02982a}{create\_agent}(ret\_opt)
35     \textcolor{keywordflow}{return} ir\_agent, task
36 
37 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a59836c3be93d4b491fa9ddecbb4e83c0}\label{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a59836c3be93d4b491fa9ddecbb4e83c0}} 
\index{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run@{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run}!setup\+\_\+title\+\_\+to\+\_\+passage@{setup\+\_\+title\+\_\+to\+\_\+passage}}
\index{setup\+\_\+title\+\_\+to\+\_\+passage@{setup\+\_\+title\+\_\+to\+\_\+passage}!parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run@{parlai\+::mturk\+::tasks\+::wizard\+\_\+of\+\_\+wikipedia\+::run}}
\subsubsection{\texorpdfstring{setup\+\_\+title\+\_\+to\+\_\+passage()}{setup\_title\_to\_passage()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+wizard\+\_\+of\+\_\+wikipedia.\+run.\+setup\+\_\+title\+\_\+to\+\_\+passage (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 38 of file run.\+py.


\begin{DoxyCode}
38 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1wizard__of__wikipedia_1_1run_a59836c3be93d4b491fa9ddecbb4e83c0}{setup\_title\_to\_passage}(opt):
39     print(\textcolor{stringliteral}{'[ Setting up Title to Passage Dict ]'})
40     saved\_dp = os.path.join(os.getcwd() + \textcolor{stringliteral}{'/data/'}, \textcolor{stringliteral}{'title\_to\_passage.pkl'})
41     \textcolor{keywordflow}{if} os.path.exists(saved\_dp):
42         print(\textcolor{stringliteral}{'[ Loading from saved location, \{\} ]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(saved\_dp))
43         with open(saved\_dp, \textcolor{stringliteral}{'rb'}) \textcolor{keyword}{as} f:
44             title\_to\_passage = pickle.load(f)
45             \textcolor{keywordflow}{return} title\_to\_passage
46     topics\_path = \textcolor{stringliteral}{'\{\}/personas\_with\_wiki\_links.txt'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(os.getcwd())
47     topics = []
48     with open(topics\_path) \textcolor{keyword}{as} f:
49         text = f.read()
50         personas = text.split(\textcolor{stringliteral}{'\(\backslash\)n\(\backslash\)n'})
51         \textcolor{keywordflow}{for} persona \textcolor{keywordflow}{in} personas:
52             persona = persona.split(\textcolor{stringliteral}{'\(\backslash\)n'})
53             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, len(persona)):
54                 p\_i = persona[i]
55                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'https'} \textcolor{keywordflow}{in} p\_i:
56                     topic = unquote(p\_i[p\_i.rfind(\textcolor{stringliteral}{'/'}) + 1 :]).replace(\textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{' '})
57                     topics.append(topic)
58     ordered\_opt = opt.copy()
59     ordered\_opt[\textcolor{stringliteral}{'datatype'}] = \textcolor{stringliteral}{'train:ordered:stream'}
60     ordered\_opt[\textcolor{stringliteral}{'batchsize'}] = 1
61     ordered\_opt[\textcolor{stringliteral}{'numthreads'}] = 1
62     ordered\_opt[\textcolor{stringliteral}{'task'}] = \textcolor{stringliteral}{'wikipedia:full:key-value'}
63     teacher = \hyperlink{namespaceparlai_1_1core_1_1agents_a76269fb567532a8fb7f29edcc20a6e47}{create\_task\_agent\_from\_taskname}(ordered\_opt)[0]
64     title\_to\_passage = \{\}
65     i = 0
66     length = teacher.num\_episodes()
67     pbar = tqdm.tqdm(total=length)
68     \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} teacher.epoch\_done():
69         pbar.update(1)
70         i += 1
71         action = teacher.act()
72         title = action[\textcolor{stringliteral}{'text'}]
73         \textcolor{keywordflow}{if} title \textcolor{keywordflow}{in} topics:
74             text = action[\textcolor{stringliteral}{'labels'}][0]
75             title\_to\_passage[title] = text
76     pbar.close()
77     print(\textcolor{stringliteral}{'[ Finished Building Title to Passage dict; saving now]'})
78     with open(saved\_dp, \textcolor{stringliteral}{'wb'}) \textcolor{keyword}{as} f:
79         pickle.dump(title\_to\_passage, f)
80     \textcolor{keywordflow}{return} title\_to\_passage
81 
82 
\end{DoxyCode}
