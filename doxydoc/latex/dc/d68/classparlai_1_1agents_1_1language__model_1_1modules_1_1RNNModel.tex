\hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel}{}\section{parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model Class Reference}
\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel}\index{parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model@{parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model}}


Inheritance diagram for parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=220pt]{d5/d9a/classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=220pt]{da/d07/classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_ac96297bc86b58ccebf74b151e27e7d75}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_aee5d42f2cfdada7a6cc2cad2b712cca8}{opt}, ntoken)
\item 
def \hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_af937a59e142e0fe2fa94cabdfc14a7d0}{forward} (self, input, hidden, no\+\_\+pack=False)
\item 
def \hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a5221545da5d46cb54bb2ab4d80246c35}{init\+\_\+hidden} (self, bsz)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_aee5d42f2cfdada7a6cc2cad2b712cca8}{opt}
\item 
\hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_aac342c5f6279b4de077793eecbdff823}{drop}
\item 
\hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a40a2e161a2f4f1d78b1a7f55e5d4fc26}{encoder}
\item 
\hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a961b0bd4d15bf0d858998e70eaf22f1d}{rnn}
\item 
\hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a66e097f286de6aa1607505440b3931a5}{decoder}
\item 
\hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_ac277c84d2fe07dfcf0f629d321c7316a}{rnn\+\_\+type}
\item 
\hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_ab3b1a3929b7179ad99a7d027a4835fb9}{nhid}
\item 
\hyperlink{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_aea0cbdfaccd4ee22812128cf06e31aeb}{nlayers}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Container module with an encoder, a recurrent module, and a decoder.
\end{DoxyVerb}
 

Definition at line 13 of file modules.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_ac96297bc86b58ccebf74b151e27e7d75}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_ac96297bc86b58ccebf74b151e27e7d75}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{ntoken }\end{DoxyParamCaption})}



Definition at line 18 of file modules.\+py.


\begin{DoxyCode}
18     \textcolor{keyword}{def }\_\_init\_\_(self, opt, ntoken):
19         super(RNNModel, self).\_\_init\_\_()
20         self.opt = opt
21 
22         \textcolor{comment}{# set hyperparameters from opt}
23         rnn\_type = opt[\textcolor{stringliteral}{'rnn\_class'}]
24         ninp = opt[\textcolor{stringliteral}{'embeddingsize'}]
25         nhid = opt[\textcolor{stringliteral}{'hiddensize'}]
26         nlayers = opt[\textcolor{stringliteral}{'numlayers'}]
27         dropout = opt[\textcolor{stringliteral}{'dropout'}]
28         tie\_weights = opt[\textcolor{stringliteral}{'emb\_tied'}]
29 
30         self.drop = nn.Dropout(dropout)
31         self.encoder = nn.Embedding(ntoken, ninp, padding\_idx=0)
32         \textcolor{keywordflow}{if} rnn\_type \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'LSTM'}, \textcolor{stringliteral}{'GRU'}]:
33             self.rnn = getattr(nn, rnn\_type)(ninp, nhid, nlayers, dropout=dropout)
34         \textcolor{keywordflow}{else}:
35             \textcolor{keywordflow}{try}:
36                 nonlinearity = \{\textcolor{stringliteral}{'RNN\_TANH'}: \textcolor{stringliteral}{'tanh'}, \textcolor{stringliteral}{'RNN\_RELU'}: \textcolor{stringliteral}{'relu'}\}[rnn\_type]
37             \textcolor{keywordflow}{except} KeyError:
38                 \textcolor{keywordflow}{raise} ValueError(
39                     \textcolor{stringliteral}{"An invalid option for `--model` was supplied, options are "}
40                     \textcolor{stringliteral}{"['LSTM', 'GRU', 'RNN\_TANH' or 'RNN\_RELU']"}
41                 )
42             self.rnn = nn.RNN(
43                 ninp, nhid, nlayers, nonlinearity=nonlinearity, dropout=dropout
44             )
45         self.decoder = nn.Linear(nhid, ntoken)
46 
47         \textcolor{comment}{# Optionally tie weights as in:}
48         \textcolor{comment}{# "Using the Output Embedding to Improve Language Models" (Press & Wolf 2016)}
49         \textcolor{comment}{# https://arxiv.org/abs/1608.05859}
50         \textcolor{comment}{# and}
51         \textcolor{comment}{# "Tying Word Vectors and Word Classifiers: A Loss Framework for}
52         \textcolor{comment}{#   Language Modeling" (Inan et al. 2016)}
53         \textcolor{comment}{# https://arxiv.org/abs/1611.01462}
54         \textcolor{keywordflow}{if} tie\_weights:
55             \textcolor{keywordflow}{if} nhid != ninp:
56                 \textcolor{keywordflow}{raise} ValueError(
57                     \textcolor{stringliteral}{'When using the tied flag, nhid must be equal to emsize'}
58                 )
59             self.decoder.weight = self.encoder.weight
60 
61         \textcolor{comment}{# initialize the weights of the model}
62         initrange = 0.1
63         self.encoder.weight.data.uniform\_(-initrange, initrange)
64         self.decoder.bias.data.fill\_(0)
65         self.decoder.weight.data.uniform\_(-initrange, initrange)
66 
67         self.rnn\_type = rnn\_type
68         self.nhid = nhid
69         self.nlayers = nlayers
70 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_af937a59e142e0fe2fa94cabdfc14a7d0}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_af937a59e142e0fe2fa94cabdfc14a7d0}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!forward@{forward}}
\index{forward@{forward}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{forward()}{forward()}}
{\footnotesize\ttfamily def parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+forward (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{input,  }\item[{}]{hidden,  }\item[{}]{no\+\_\+pack = {\ttfamily False} }\end{DoxyParamCaption})}



Definition at line 71 of file modules.\+py.


\begin{DoxyCode}
71     \textcolor{keyword}{def }forward(self, input, hidden, no\_pack=False):
72         emb = self.drop(self.encoder(input))
73         \textcolor{comment}{# if eval, pack padded sequence (we don't pack during training because}
74         \textcolor{comment}{# we have no padding in our input samples)}
75         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.training \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} no\_pack:
76             emb\_lens = [x \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} torch.sum((input > 0).\hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(), dim=0).data]
77             emb\_packed = pack\_padded\_sequence(emb, emb\_lens, batch\_first=\textcolor{keyword}{False})
78             packed\_output, hidden = self.rnn(emb\_packed, hidden)
79             output, \_ = pad\_packed\_sequence(packed\_output, batch\_first=\textcolor{keyword}{False})
80         \textcolor{keywordflow}{else}:
81             output, hidden = self.rnn(emb, hidden)
82         output = self.drop(output)
83         decoded = self.decoder(
84             output.view(output.size(0) * output.size(1), output.size(2))
85         )
86         \textcolor{keywordflow}{return} decoded.view(output.size(0), output.size(1), decoded.size(1)), hidden
87 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a5221545da5d46cb54bb2ab4d80246c35}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a5221545da5d46cb54bb2ab4d80246c35}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!init\+\_\+hidden@{init\+\_\+hidden}}
\index{init\+\_\+hidden@{init\+\_\+hidden}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{init\+\_\+hidden()}{init\_hidden()}}
{\footnotesize\ttfamily def parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+init\+\_\+hidden (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{bsz }\end{DoxyParamCaption})}



Definition at line 88 of file modules.\+py.


\begin{DoxyCode}
88     \textcolor{keyword}{def }init\_hidden(self, bsz):
89         weight = next(self.parameters()).data
90         \textcolor{keywordflow}{if} self.rnn\_type == \textcolor{stringliteral}{'LSTM'}:
91             \textcolor{keywordflow}{return} (
92                 Variable(weight.new(self.nlayers, bsz, self.nhid).zero\_()),
93                 Variable(weight.new(self.nlayers, bsz, self.nhid).zero\_()),
94             )
95         \textcolor{keywordflow}{else}:
96             \textcolor{keywordflow}{return} Variable(weight.new(self.nlayers, bsz, self.nhid).zero\_())
97 \end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a66e097f286de6aa1607505440b3931a5}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a66e097f286de6aa1607505440b3931a5}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!decoder@{decoder}}
\index{decoder@{decoder}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{decoder}{decoder}}
{\footnotesize\ttfamily parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+decoder}



Definition at line 45 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_aac342c5f6279b4de077793eecbdff823}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_aac342c5f6279b4de077793eecbdff823}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!drop@{drop}}
\index{drop@{drop}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{drop}{drop}}
{\footnotesize\ttfamily parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+drop}



Definition at line 30 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a40a2e161a2f4f1d78b1a7f55e5d4fc26}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a40a2e161a2f4f1d78b1a7f55e5d4fc26}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!encoder@{encoder}}
\index{encoder@{encoder}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{encoder}{encoder}}
{\footnotesize\ttfamily parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+encoder}



Definition at line 31 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_ab3b1a3929b7179ad99a7d027a4835fb9}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_ab3b1a3929b7179ad99a7d027a4835fb9}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!nhid@{nhid}}
\index{nhid@{nhid}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{nhid}{nhid}}
{\footnotesize\ttfamily parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+nhid}



Definition at line 68 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_aea0cbdfaccd4ee22812128cf06e31aeb}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_aea0cbdfaccd4ee22812128cf06e31aeb}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!nlayers@{nlayers}}
\index{nlayers@{nlayers}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{nlayers}{nlayers}}
{\footnotesize\ttfamily parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+nlayers}



Definition at line 69 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_aee5d42f2cfdada7a6cc2cad2b712cca8}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_aee5d42f2cfdada7a6cc2cad2b712cca8}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!opt@{opt}}
\index{opt@{opt}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+opt}



Definition at line 20 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a961b0bd4d15bf0d858998e70eaf22f1d}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_a961b0bd4d15bf0d858998e70eaf22f1d}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!rnn@{rnn}}
\index{rnn@{rnn}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{rnn}{rnn}}
{\footnotesize\ttfamily parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+rnn}



Definition at line 33 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_ac277c84d2fe07dfcf0f629d321c7316a}\label{classparlai_1_1agents_1_1language__model_1_1modules_1_1RNNModel_ac277c84d2fe07dfcf0f629d321c7316a}} 
\index{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}!rnn\+\_\+type@{rnn\+\_\+type}}
\index{rnn\+\_\+type@{rnn\+\_\+type}!parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model@{parlai\+::agents\+::language\+\_\+model\+::modules\+::\+R\+N\+N\+Model}}
\subsubsection{\texorpdfstring{rnn\+\_\+type}{rnn\_type}}
{\footnotesize\ttfamily parlai.\+agents.\+language\+\_\+model.\+modules.\+R\+N\+N\+Model.\+rnn\+\_\+type}



Definition at line 67 of file modules.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/language\+\_\+model/\hyperlink{parlai_2agents_2language__model_2modules_8py}{modules.\+py}\end{DoxyCompactItemize}
