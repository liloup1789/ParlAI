\hypertarget{classdialog__babi__feedback_1_1agents_1_1TaskTeacher}{}\section{dialog\+\_\+babi\+\_\+feedback.\+agents.\+Task\+Teacher Class Reference}
\label{classdialog__babi__feedback_1_1agents_1_1TaskTeacher}\index{dialog\+\_\+babi\+\_\+feedback.\+agents.\+Task\+Teacher@{dialog\+\_\+babi\+\_\+feedback.\+agents.\+Task\+Teacher}}


Inheritance diagram for dialog\+\_\+babi\+\_\+feedback.\+agents.\+Task\+Teacher\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=226pt]{d4/d0c/classdialog__babi__feedback_1_1agents_1_1TaskTeacher__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for dialog\+\_\+babi\+\_\+feedback.\+agents.\+Task\+Teacher\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=226pt]{da/d25/classdialog__babi__feedback_1_1agents_1_1TaskTeacher__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classdialog__babi__feedback_1_1agents_1_1TaskTeacher_a6b112b33b1ff89f9c19415a65d4e4387}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1core_1_1teachers_1_1FbDialogTeacher_af7a9ec497b9cd0292d7b8fa220da7c28}{opt}, shared=None)
\item 
def \hyperlink{classdialog__babi__feedback_1_1agents_1_1TaskTeacher_a447ce9e39879b80a3ee58311320afa20}{setup\+\_\+data} (self, path)
\item 
def \hyperlink{classdialog__babi__feedback_1_1agents_1_1TaskTeacher_a13fe8b4ae98a4a170b4885c40b611415}{setup\+\_\+data\+\_\+with\+\_\+feedback} (self, path)
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 67 of file agents.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classdialog__babi__feedback_1_1agents_1_1TaskTeacher_a6b112b33b1ff89f9c19415a65d4e4387}\label{classdialog__babi__feedback_1_1agents_1_1TaskTeacher_a6b112b33b1ff89f9c19415a65d4e4387}} 
\index{dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher@{dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher@{dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def dialog\+\_\+babi\+\_\+feedback.\+agents.\+Task\+Teacher.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 68 of file agents.\+py.


\begin{DoxyCode}
68     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
69         paths = \_path(opt[\textcolor{stringliteral}{'task'}].split(\textcolor{stringliteral}{':'})[2], opt)
70         opt[\textcolor{stringliteral}{'datafile'}], opt[\textcolor{stringliteral}{'cands\_datafile'}] = paths
71         super().\_\_init\_\_(opt, shared)
72 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classdialog__babi__feedback_1_1agents_1_1TaskTeacher_a447ce9e39879b80a3ee58311320afa20}\label{classdialog__babi__feedback_1_1agents_1_1TaskTeacher_a447ce9e39879b80a3ee58311320afa20}} 
\index{dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher@{dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher}!setup\+\_\+data@{setup\+\_\+data}}
\index{setup\+\_\+data@{setup\+\_\+data}!dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher@{dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher}}
\subsubsection{\texorpdfstring{setup\+\_\+data()}{setup\_data()}}
{\footnotesize\ttfamily def dialog\+\_\+babi\+\_\+feedback.\+agents.\+Task\+Teacher.\+setup\+\_\+data (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Reads feedback for an example along with text and labels if 'feedback' argument
is specified.
\end{DoxyVerb}
 

Definition at line 73 of file agents.\+py.


\begin{DoxyCode}
73     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1multinli_1_1agents_a4fa2cb0ba1ed745336ad8bceed36b841}{setup\_data}(self, path):
74         \textcolor{stringliteral}{"""}
75 \textcolor{stringliteral}{        Reads feedback for an example along with text and labels if 'feedback' argument}
76 \textcolor{stringliteral}{        is specified.}
77 \textcolor{stringliteral}{        """}
78         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'task'}].split(\textcolor{stringliteral}{':'})[-1] == \textcolor{stringliteral}{'feedback'}:
79             \textcolor{keywordflow}{return} self.setup\_data\_with\_feedback(path)
80         \textcolor{keywordflow}{else}:
81             \textcolor{keywordflow}{return} super().\hyperlink{namespaceparlai_1_1tasks_1_1multinli_1_1agents_a4fa2cb0ba1ed745336ad8bceed36b841}{setup\_data}(path)
82 
\end{DoxyCode}
\mbox{\Hypertarget{classdialog__babi__feedback_1_1agents_1_1TaskTeacher_a13fe8b4ae98a4a170b4885c40b611415}\label{classdialog__babi__feedback_1_1agents_1_1TaskTeacher_a13fe8b4ae98a4a170b4885c40b611415}} 
\index{dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher@{dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher}!setup\+\_\+data\+\_\+with\+\_\+feedback@{setup\+\_\+data\+\_\+with\+\_\+feedback}}
\index{setup\+\_\+data\+\_\+with\+\_\+feedback@{setup\+\_\+data\+\_\+with\+\_\+feedback}!dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher@{dialog\+\_\+babi\+\_\+feedback\+::agents\+::\+Task\+Teacher}}
\subsubsection{\texorpdfstring{setup\+\_\+data\+\_\+with\+\_\+feedback()}{setup\_data\_with\_feedback()}}
{\footnotesize\ttfamily def dialog\+\_\+babi\+\_\+feedback.\+agents.\+Task\+Teacher.\+setup\+\_\+data\+\_\+with\+\_\+feedback (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Reads data in the fbdialog format. This method is very similar to
FbDialogTeacher.setup_data(..). The difference is that in this method the
feedback is appended to the query from the current example; in the default setup
the feedback is appended to the x from the next example.

The data would look something like this:

Mary moved to the bedroom.
Mary travelled to the garden.
Where is John?
No, that's wrong.
[labels: garden]

To append feedback to the current example, modify the task name like this:
  python examples/display_data.py -t dbll_babi:task:2_p0.5:f
Default setup:
  python examples/display_data.py -t dbll_babi:task:2_p0.5
\end{DoxyVerb}
 

Definition at line 83 of file agents.\+py.


\begin{DoxyCode}
83     \textcolor{keyword}{def }setup\_data\_with\_feedback(self, path):
84         \textcolor{stringliteral}{"""}
85 \textcolor{stringliteral}{        Reads data in the fbdialog format. This method is very similar to}
86 \textcolor{stringliteral}{        FbDialogTeacher.setup\_data(..). The difference is that in this method the}
87 \textcolor{stringliteral}{        feedback is appended to the query from the current example; in the default setup}
88 \textcolor{stringliteral}{        the feedback is appended to the x from the next example.}
89 \textcolor{stringliteral}{}
90 \textcolor{stringliteral}{        The data would look something like this:}
91 \textcolor{stringliteral}{}
92 \textcolor{stringliteral}{        Mary moved to the bedroom.}
93 \textcolor{stringliteral}{        Mary travelled to the garden.}
94 \textcolor{stringliteral}{        Where is John?}
95 \textcolor{stringliteral}{        No, that's wrong.}
96 \textcolor{stringliteral}{        [labels: garden]}
97 \textcolor{stringliteral}{}
98 \textcolor{stringliteral}{        To append feedback to the current example, modify the task name like this:}
99 \textcolor{stringliteral}{          python examples/display\_data.py -t dbll\_babi:task:2\_p0.5:f}
100 \textcolor{stringliteral}{        Default setup:}
101 \textcolor{stringliteral}{          python examples/display\_data.py -t dbll\_babi:task:2\_p0.5}
102 \textcolor{stringliteral}{        """}
103         print(\textcolor{stringliteral}{"[loading fbdialog data:"} + path + \textcolor{stringliteral}{"]"})
104         with open(path) \textcolor{keyword}{as} read:
105             start = \textcolor{keyword}{True}
106             x = \textcolor{stringliteral}{''}
107 
108             y = \textcolor{keywordtype}{None}
109 
110             reward = 0
111             dialog\_index = 0
112             read\_feedback = \textcolor{keyword}{False}
113             \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} read:
114                 line = line.strip().replace(\textcolor{stringliteral}{'\(\backslash\)\(\backslash\)n'}, \textcolor{stringliteral}{'\(\backslash\)n'})
115                 \textcolor{keywordflow}{if} len(line) == 0:
116                     \textcolor{keywordflow}{continue}
117 
118                 \textcolor{comment}{# first, get conversation index -- '1' means start of episode}
119                 space\_idx = line.find(\textcolor{stringliteral}{' '})
120                 conv\_id = line[:space\_idx]
121 
122                 \textcolor{comment}{# split line into constituent parts, if available:}
123                 \textcolor{comment}{# x<tab>y<tab>reward<tab>label\_candidates}
124                 \textcolor{comment}{# where y, reward, and label\_candidates are optional}
125                 split = line[space\_idx + 1 :].split(\textcolor{stringliteral}{'\(\backslash\)t'})
126 
127                 \textcolor{comment}{# remove empty items and strip each one}
128                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(split)):
129                     word = split[i].strip()
130                     \textcolor{keywordflow}{if} len(word) == 0:
131                         split[i] = \textcolor{stringliteral}{''}
132                     \textcolor{keywordflow}{else}:
133                         split[i] = word
134                 \textcolor{comment}{# Empty reward string same as None}
135                 \textcolor{keywordflow}{if} len(split) > 2 \textcolor{keywordflow}{and} split[2] == \textcolor{stringliteral}{''}:
136                     split[2] = \textcolor{keywordtype}{None}
137 
138                 \textcolor{comment}{# now check if we're at a new episode}
139                 \textcolor{keywordflow}{if} conv\_id == \textcolor{stringliteral}{'1'}:
140                     dialog\_index += 1
141                     x = x.strip()
142                     \textcolor{keywordflow}{if} x:
143                         \textcolor{keywordflow}{yield} [x, \textcolor{keywordtype}{None}, reward], start
144                     start = \textcolor{keyword}{True}
145                     reward = 0
146                     \textcolor{comment}{# start a new episode}
147                     \textcolor{keywordflow}{if} self.cloze:
148                         x = \textcolor{stringliteral}{'Fill in the blank in the last sentence.\(\backslash\)n\{x\}'}.
      \hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
149                             x=split[0]
150                         )
151                     \textcolor{keywordflow}{else}:
152                         x = split[0]
153                 \textcolor{keywordflow}{else}:
154                     \textcolor{keywordflow}{if} x:
155                         \textcolor{comment}{# otherwise add current x to what we have so far}
156                         x = \textcolor{stringliteral}{'\{x\}\(\backslash\)n\{next\_x\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(x=x, next\_x=split[0])
157                     \textcolor{keywordflow}{else}:
158                         x = split[0]
159                 \textcolor{keywordflow}{if} len(split) > 2 \textcolor{keywordflow}{and} split[2]:
160                     reward += \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(split[2])
161 
162                 \textcolor{keywordflow}{if} len(split) > 1 \textcolor{keywordflow}{and} split[1]:
163                     read\_feedback = \textcolor{keyword}{True}
164                     \textcolor{comment}{# split labels}
165                     y = split[1].split(\textcolor{stringliteral}{'|'})
166 
167                 \textcolor{keywordflow}{if} read\_feedback \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} split[1]:
168                     split[0] = x
169                     split[1] = y
170                     \textcolor{keywordflow}{if} len(split) > 2:
171                         split[2] = reward
172                     \textcolor{keywordflow}{else}:
173                         split.append(reward)
174                     \textcolor{keywordflow}{if} start:
175                         \textcolor{keywordflow}{yield} split, \textcolor{keyword}{True}
176                         start = \textcolor{keyword}{False}
177                     \textcolor{keywordflow}{else}:
178                         \textcolor{keywordflow}{yield} split, \textcolor{keyword}{False}
179                     \textcolor{comment}{# reset x in case there is unlabeled data still left}
180                     x = \textcolor{stringliteral}{''}
181                     reward = 0
182                     y = \textcolor{keywordtype}{None}
183                     read\_feedback = \textcolor{keyword}{False}
184 \end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
projects/memnn\+\_\+feedback/tasks/dialog\+\_\+babi\+\_\+feedback/\hyperlink{projects_2memnn__feedback_2tasks_2dialog__babi__feedback_2agents_8py}{agents.\+py}\end{DoxyCompactItemize}
