\hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity}{}\section{projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity Namespace Reference}
\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity}\index{projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a2179caf1a41e96bb38cad058863084a3}{setup\+\_\+args} ()
\item 
def \hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_ac409d1c26364c39762dd2357afdaf64a}{main} (\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a20c8e6a1edf5dd1186afbb0f961f288f}{opt})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a59ec78cd0ffcde2e03b3d3c052e57451}{I\+N\+I\+T\+I\+A\+L\+\_\+\+P\+R\+O\+M\+PT}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a2273b0a6ff3e82c4ac1d94a7f03e43ee}{E\+X\+P\+\_\+\+R\+E\+Q\+U\+E\+ST}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a89d61bd2a5fa557367d63e513fcef1c6}{N\+E\+W\+T\+O\+P\+IC}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a9c4f3ab0ab792875644a8bfabe23a5da}{R\+A\+T\+\_\+\+R\+E\+Q\+U\+E\+ST}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_ac5c576d4b9952271c65abdbfab742c53}{C\+O\+N\+T\+I\+N\+UE}
\item 
\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a20c8e6a1edf5dd1186afbb0f961f288f}{opt}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_ac409d1c26364c39762dd2357afdaf64a}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_ac409d1c26364c39762dd2357afdaf64a}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}!main@{main}}
\index{main@{main}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity.\+main (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Extracts training data for the negative response classifier (NRC) from Mturk logs.

input: file of logs (in ParlaiDialog format) from Mturk task 1 with turn-by-turn
    quality ratings 1-5
output: file of episodes (self-feeding format) w/ +1/-1 ratings indicating
    positive/negative example
\end{DoxyVerb}
 

Definition at line 53 of file convert\+\_\+chatted\+\_\+to\+\_\+identity.\+py.


\begin{DoxyCode}
53 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_ac409d1c26364c39762dd2357afdaf64a}{main}(opt):
54     \textcolor{stringliteral}{"""}
55 \textcolor{stringliteral}{    Extracts training data for the negative response classifier (NRC) from Mturk logs.}
56 \textcolor{stringliteral}{}
57 \textcolor{stringliteral}{    input: file of logs (in ParlaiDialog format) from Mturk task 1 with turn-by-turn}
58 \textcolor{stringliteral}{        quality ratings 1-5}
59 \textcolor{stringliteral}{    output: file of episodes (self-feeding format) w/ +1/-1 ratings indicating}
60 \textcolor{stringliteral}{        positive/negative example}
61 \textcolor{stringliteral}{    """}
62     examples = []
63     positives = opt[\textcolor{stringliteral}{'positives'}].split(\textcolor{stringliteral}{','})
64     negatives = opt[\textcolor{stringliteral}{'negatives'}].split(\textcolor{stringliteral}{','})
65     \textcolor{keyword}{assert} len(set(positives).intersection(set(negatives))) == 0
66 
67     num\_episodes = 0
68     num\_parleys = 0
69     \textcolor{keywordflow}{for} episode \textcolor{keywordflow}{in} \hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a7bfa2fe610a2d0da7968b1a2662e0c23}{extract\_parlai\_episodes}(opt[\textcolor{stringliteral}{'infile'}]):
70         num\_episodes += 1
71         history = []
72         \textcolor{keywordflow}{for} parley \textcolor{keywordflow}{in} episode:
73             num\_parleys += 1
74 
75             \textcolor{comment}{# Update history (not including stock control flow responses)}
76             \textcolor{keywordflow}{if} parley.context.startswith(INITIAL\_PROMPT):
77                 \textcolor{comment}{# Conversation prompt, first utterance}
78                 \textcolor{comment}{# Begin history}
79                 history = [parley.response]
80             \textcolor{keywordflow}{elif} parley.context.startswith(EXP\_REQUEST):
81                 \textcolor{comment}{# Asked for y\_exp, got y\_exp}
82                 \textcolor{comment}{# Messed up, so blast history}
83                 example = Parley(
84                     context=\hyperlink{namespaceprojects_1_1self__feeding_1_1utils_a3f3d055dc6c4058057baae7b240de5ec}{add\_person\_tokens}(history[:-2], last\_speaker=1),
85                     response=parley.response,  \textcolor{comment}{# y\_exp}
86                 )
87                 examples.append(example)
88                 history = []
89             \textcolor{keywordflow}{elif} parley.context.startswith(NEWTOPIC):
90                 \textcolor{comment}{# Asked for new topic, got a first utterance}
91                 \textcolor{comment}{# Begin new history}
92                 history = [parley.response]
93             \textcolor{keywordflow}{elif} parley.context.startswith(RAT\_REQUEST):
94                 \textcolor{comment}{# Asked for rating, got one-word rating}
95                 \textcolor{comment}{# Nothing to update in history}
96                 \textcolor{keywordflow}{pass}
97             \textcolor{keywordflow}{elif} CONTINUE \textcolor{keywordflow}{in} parley.context:
98                 \textcolor{comment}{# if response was negative, history will get blasted in EXP\_REQUEST}
99                 \textcolor{comment}{# if we're here, response was neutral/positive, so continue the history}
100                 history.append(parley.context[parley.context.rindex(\textcolor{stringliteral}{':'}) + 1 :])
101                 history.append(parley.response)
102             \textcolor{keywordflow}{else}:
103                 \textcolor{comment}{# normal turn: maintain the history}
104                 history.append(parley.context)
105                 history.append(parley.response)
106 
107     with open(opt[\textcolor{stringliteral}{'outfile'}], \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} outfile:
108         \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} examples:
109             outfile.write(json.dumps(ex.to\_dict()) + \textcolor{stringliteral}{'\(\backslash\)n'})
110 
111     print(
112         f\textcolor{stringliteral}{"Extracted \{len(examples)\} ratings out of \{num\_episodes\} episodes "}
113         f\textcolor{stringliteral}{"(\{num\_parleys\} parleys) and wrote them to \{opt['outfile']\} with "}
114         f\textcolor{stringliteral}{"histsz == \{opt['history\_size']\}."}
115     )
116 
117 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a2179caf1a41e96bb38cad058863084a3}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a2179caf1a41e96bb38cad058863084a3}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}!setup\+\_\+args@{setup\+\_\+args}}
\index{setup\+\_\+args@{setup\+\_\+args}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{setup\+\_\+args()}{setup\_args()}}
{\footnotesize\ttfamily def projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity.\+setup\+\_\+args (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 23 of file convert\+\_\+chatted\+\_\+to\+\_\+identity.\+py.


\begin{DoxyCode}
23 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a2179caf1a41e96bb38cad058863084a3}{setup\_args}():
24     argparser = ArgumentParser()
25     argparser.add\_argument(\textcolor{stringliteral}{'-if'}, \textcolor{stringliteral}{'--infile'}, type=str)
26     argparser.add\_argument(\textcolor{stringliteral}{'-of'}, \textcolor{stringliteral}{'--outfile'}, type=str)
27     argparser.add\_argument(
28         \textcolor{stringliteral}{'-histsz'},
29         \textcolor{stringliteral}{'--history-size'},
30         type=int,
31         default=-1,
32         help=\textcolor{stringliteral}{"The number of turns to include in the prompt."},
33     )
34     argparser.add\_argument(
35         \textcolor{stringliteral}{'-pos'},
36         \textcolor{stringliteral}{'--positives'},
37         type=str,
38         default=\textcolor{stringliteral}{'positive'},
39         help=\textcolor{stringliteral}{"A comma-separated list of ratings with positive label"},
40     )
41     argparser.add\_argument(
42         \textcolor{stringliteral}{'-neg'},
43         \textcolor{stringliteral}{'--negatives'},
44         type=str,
45         default=\textcolor{stringliteral}{'negative'},
46         help=\textcolor{stringliteral}{"A comma-separated list of ratings with negative label"},
47     )
48     opt = vars(argparser.parse\_args())
49 
50     \textcolor{keywordflow}{return} opt
51 
52 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_ac5c576d4b9952271c65abdbfab742c53}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_ac5c576d4b9952271c65abdbfab742c53}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}!C\+O\+N\+T\+I\+N\+UE@{C\+O\+N\+T\+I\+N\+UE}}
\index{C\+O\+N\+T\+I\+N\+UE@{C\+O\+N\+T\+I\+N\+UE}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{C\+O\+N\+T\+I\+N\+UE}{CONTINUE}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity.\+C\+O\+N\+T\+I\+N\+UE}



Definition at line 20 of file convert\+\_\+chatted\+\_\+to\+\_\+identity.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a2273b0a6ff3e82c4ac1d94a7f03e43ee}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a2273b0a6ff3e82c4ac1d94a7f03e43ee}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}!E\+X\+P\+\_\+\+R\+E\+Q\+U\+E\+ST@{E\+X\+P\+\_\+\+R\+E\+Q\+U\+E\+ST}}
\index{E\+X\+P\+\_\+\+R\+E\+Q\+U\+E\+ST@{E\+X\+P\+\_\+\+R\+E\+Q\+U\+E\+ST}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{E\+X\+P\+\_\+\+R\+E\+Q\+U\+E\+ST}{EXP\_REQUEST}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity.\+E\+X\+P\+\_\+\+R\+E\+Q\+U\+E\+ST}



Definition at line 17 of file convert\+\_\+chatted\+\_\+to\+\_\+identity.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a59ec78cd0ffcde2e03b3d3c052e57451}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a59ec78cd0ffcde2e03b3d3c052e57451}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}!I\+N\+I\+T\+I\+A\+L\+\_\+\+P\+R\+O\+M\+PT@{I\+N\+I\+T\+I\+A\+L\+\_\+\+P\+R\+O\+M\+PT}}
\index{I\+N\+I\+T\+I\+A\+L\+\_\+\+P\+R\+O\+M\+PT@{I\+N\+I\+T\+I\+A\+L\+\_\+\+P\+R\+O\+M\+PT}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{I\+N\+I\+T\+I\+A\+L\+\_\+\+P\+R\+O\+M\+PT}{INITIAL\_PROMPT}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity.\+I\+N\+I\+T\+I\+A\+L\+\_\+\+P\+R\+O\+M\+PT}



Definition at line 16 of file convert\+\_\+chatted\+\_\+to\+\_\+identity.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a89d61bd2a5fa557367d63e513fcef1c6}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a89d61bd2a5fa557367d63e513fcef1c6}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}!N\+E\+W\+T\+O\+P\+IC@{N\+E\+W\+T\+O\+P\+IC}}
\index{N\+E\+W\+T\+O\+P\+IC@{N\+E\+W\+T\+O\+P\+IC}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{N\+E\+W\+T\+O\+P\+IC}{NEWTOPIC}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity.\+N\+E\+W\+T\+O\+P\+IC}



Definition at line 18 of file convert\+\_\+chatted\+\_\+to\+\_\+identity.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a20c8e6a1edf5dd1186afbb0f961f288f}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a20c8e6a1edf5dd1186afbb0f961f288f}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}!opt@{opt}}
\index{opt@{opt}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity.\+opt}



Definition at line 119 of file convert\+\_\+chatted\+\_\+to\+\_\+identity.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a9c4f3ab0ab792875644a8bfabe23a5da}\label{namespaceprojects_1_1self__feeding_1_1scripts_1_1convert__chatted__to__identity_a9c4f3ab0ab792875644a8bfabe23a5da}} 
\index{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}!R\+A\+T\+\_\+\+R\+E\+Q\+U\+E\+ST@{R\+A\+T\+\_\+\+R\+E\+Q\+U\+E\+ST}}
\index{R\+A\+T\+\_\+\+R\+E\+Q\+U\+E\+ST@{R\+A\+T\+\_\+\+R\+E\+Q\+U\+E\+ST}!projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity@{projects\+::self\+\_\+feeding\+::scripts\+::convert\+\_\+chatted\+\_\+to\+\_\+identity}}
\subsubsection{\texorpdfstring{R\+A\+T\+\_\+\+R\+E\+Q\+U\+E\+ST}{RAT\_REQUEST}}
{\footnotesize\ttfamily projects.\+self\+\_\+feeding.\+scripts.\+convert\+\_\+chatted\+\_\+to\+\_\+identity.\+R\+A\+T\+\_\+\+R\+E\+Q\+U\+E\+ST}



Definition at line 19 of file convert\+\_\+chatted\+\_\+to\+\_\+identity.\+py.

