\hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder}{}\section{parlai.\+tasks.\+light\+\_\+dialog.\+builder Namespace Reference}
\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder}\index{parlai.\+tasks.\+light\+\_\+dialog.\+builder@{parlai.\+tasks.\+light\+\_\+dialog.\+builder}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\+\_\+feat} (opt, field, ttype)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aafb760ba2e05ffe5cad429327d0dd347}{fix\+\_\+labels} (act, opt)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a51921236462b49d240bfde4a648c3ec3}{get\+\_\+no\+\_\+affordance\+\_\+actions} (in\+\_\+room, carrying, other\+\_\+carrying, other\+\_\+name)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a537e075c89058b67eb0db786f98491de}{gen\+\_\+no\+\_\+affordance\+\_\+actions\+\_\+for\+\_\+dialogue} (d)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a233ecce0ba4b1a0c023e855629986d69}{write\+\_\+dialog} (opt, fw, d, label\+\_\+type, split)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aeb144d0ebd2fd1727f73677e36f2c8b5}{write\+\_\+alldata} (opt, db, dpath, ltype, split)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a2f5cb4927740a90c9fba84df5e8e16b5}{add\+\_\+negs} (msg, d, ind, label\+\_\+type, split, num\+\_\+cands, use\+\_\+affordances)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a25aca9f28e4406290624e1d0c5cce0d6}{write\+\_\+out\+\_\+candidates} (db, dpath, dtype)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a6a049254e487c29d008f875476ffd76f}{build\+\_\+from\+\_\+db} (opt, db\+\_\+path, data\+\_\+path, fname, fname2)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a1a5f7c29e2ac62fb237eef07ae9815c1}{rand}
\item 
\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a8b4522952b8ecc117e46da456d5754b4}{mx}
\item 
\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ae50feb1d704c383270ea1e4b3a4c85d6}{cands}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a2f5cb4927740a90c9fba84df5e8e16b5}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a2f5cb4927740a90c9fba84df5e8e16b5}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!add\+\_\+negs@{add\+\_\+negs}}
\index{add\+\_\+negs@{add\+\_\+negs}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{add\+\_\+negs()}{add\_negs()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+add\+\_\+negs (\begin{DoxyParamCaption}\item[{}]{msg,  }\item[{}]{d,  }\item[{}]{ind,  }\item[{}]{label\+\_\+type,  }\item[{}]{split,  }\item[{}]{num\+\_\+cands,  }\item[{}]{use\+\_\+affordances }\end{DoxyParamCaption})}



Definition at line 263 of file builder.\+py.


\begin{DoxyCode}
263 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a2f5cb4927740a90c9fba84df5e8e16b5}{add\_negs}(msg, d, ind, label\_type, split, num\_cands, use\_affordances):
264     \textcolor{keywordflow}{if} label\_type == \textcolor{stringliteral}{'emote'}:
265         msg[\textcolor{stringliteral}{'label\_candidates'}] = cands[\textcolor{stringliteral}{'emote'}]
266     \textcolor{keywordflow}{if} label\_type == \textcolor{stringliteral}{'action'}:
267         \textcolor{keywordflow}{if} use\_affordances:
268             msg[\textcolor{stringliteral}{'label\_candidates'}] = d[\textcolor{stringliteral}{'available\_actions'}][ind]
269         \textcolor{keywordflow}{else}:
270             msg[\textcolor{stringliteral}{'label\_candidates'}] = d[\textcolor{stringliteral}{'no\_affordance\_actions'}][ind]
271     \textcolor{keywordflow}{if} label\_type == \textcolor{stringliteral}{'speech'}:
272         cnt = 0
273         label = msg[\textcolor{stringliteral}{'labels'}]
274         negs = []
275         \textcolor{comment}{# negs.append(label)}
276         used = \{\}
277         \textcolor{comment}{# find 99 random negs that are != gold label}
278         \textcolor{keywordflow}{while} \textcolor{keyword}{True}:
279             ind = rand.randint(0, len(cands[\textcolor{stringliteral}{'speech'}]) - 1)
280             txt = cands[\textcolor{stringliteral}{'speech'}][ind]
281             \textcolor{keywordflow}{if} txt != label \textcolor{keywordflow}{and} ind \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} used:
282                 negs.append(txt)
283                 used[ind] = \textcolor{keyword}{True}
284                 cnt += 1
285                 \textcolor{keywordflow}{if} cnt == num\_cands - 1:
286                     \textcolor{keywordflow}{break}
287         \textcolor{comment}{# insert label in a random position}
288         negs.insert(rand.randrange(len(negs) + 1), label)
289         msg[\textcolor{stringliteral}{'label\_candidates'}] = negs
290 
291 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a6a049254e487c29d008f875476ffd76f}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a6a049254e487c29d008f875476ffd76f}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!build\+\_\+from\+\_\+db@{build\+\_\+from\+\_\+db}}
\index{build\+\_\+from\+\_\+db@{build\+\_\+from\+\_\+db}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{build\+\_\+from\+\_\+db()}{build\_from\_db()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+build\+\_\+from\+\_\+db (\begin{DoxyParamCaption}\item[{}]{opt,  }\item[{}]{db\+\_\+path,  }\item[{}]{data\+\_\+path,  }\item[{}]{fname,  }\item[{}]{fname2 }\end{DoxyParamCaption})}



Definition at line 323 of file builder.\+py.


\begin{DoxyCode}
323 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a6a049254e487c29d008f875476ffd76f}{build\_from\_db}(opt, db\_path, data\_path, fname, fname2):
324     \textcolor{comment}{# set up database}
325     dbp = os.path.join(db\_path, fname)
326     file = open(dbp, \textcolor{stringliteral}{'rb'})
327     db = pickle.load(file)
328     \textcolor{comment}{# set up unseen database}
329     dbp = os.path.join(db\_path, fname2)
330     file = open(dbp, \textcolor{stringliteral}{'rb'})
331     db\_unseen = pickle.load(file)
332 
333     \textcolor{comment}{# add test set labeling}
334     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(0, len(db)):
335         db[i][\textcolor{stringliteral}{'split'}] = \textcolor{stringliteral}{'train'}
336     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(0, len(db\_unseen)):
337         db\_unseen[i][\textcolor{stringliteral}{'split'}] = \textcolor{stringliteral}{'test\_unseen'}
338     rand2 = random.Random(42)
339     x = []
340     \textcolor{comment}{# choose 1000 dialogues from the set that contain object manipulations}
341     \textcolor{comment}{# (hard-coded here).}
342     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1368, 4733):
343         x.append(i)
344     rand2.shuffle(x)
345     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(0, 1000):
346         db[x[i]][\textcolor{stringliteral}{'split'}] = \textcolor{stringliteral}{'test'}
347     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1000, 1500):
348         db[x[i]][\textcolor{stringliteral}{'split'}] = \textcolor{stringliteral}{'valid'}
349 
350     \textcolor{keywordflow}{for} split \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'train'}, \textcolor{stringliteral}{'valid'}, \textcolor{stringliteral}{'test'}]:
351         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a25aca9f28e4406290624e1d0c5cce0d6}{write\_out\_candidates}(db, data\_path, split)
352         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aeb144d0ebd2fd1727f73677e36f2c8b5}{write\_alldata}(opt, db, data\_path, \textcolor{stringliteral}{'speech'}, split)
353         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aeb144d0ebd2fd1727f73677e36f2c8b5}{write\_alldata}(opt, db, data\_path, \textcolor{stringliteral}{'action'}, split)
354         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aeb144d0ebd2fd1727f73677e36f2c8b5}{write\_alldata}(opt, db, data\_path, \textcolor{stringliteral}{'emote'}, split)
355 
356     \textcolor{keywordflow}{for} split \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'test\_unseen'}]:
357         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a25aca9f28e4406290624e1d0c5cce0d6}{write\_out\_candidates}(db\_unseen, data\_path, split)
358         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aeb144d0ebd2fd1727f73677e36f2c8b5}{write\_alldata}(opt, db\_unseen, data\_path, \textcolor{stringliteral}{'speech'}, split)
359         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aeb144d0ebd2fd1727f73677e36f2c8b5}{write\_alldata}(opt, db\_unseen, data\_path, \textcolor{stringliteral}{'action'}, split)
360         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aeb144d0ebd2fd1727f73677e36f2c8b5}{write\_alldata}(opt, db\_unseen, data\_path, \textcolor{stringliteral}{'emote'}, split)
361 \end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aafb760ba2e05ffe5cad429327d0dd347}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aafb760ba2e05ffe5cad429327d0dd347}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!fix\+\_\+labels@{fix\+\_\+labels}}
\index{fix\+\_\+labels@{fix\+\_\+labels}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{fix\+\_\+labels()}{fix\_labels()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+fix\+\_\+labels (\begin{DoxyParamCaption}\item[{}]{act,  }\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 26 of file builder.\+py.


\begin{DoxyCode}
26 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aafb760ba2e05ffe5cad429327d0dd347}{fix\_labels}(act, opt):
27     labels = act.get(\textcolor{stringliteral}{'labels'}, act.get(\textcolor{stringliteral}{'eval\_labels'}))
28     clip = \hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(opt.get(\textcolor{stringliteral}{'light\_use\_clip\_cands'}, 1000))
29     \textcolor{keywordflow}{while} len(act[\textcolor{stringliteral}{'label\_candidates'}]) >= clip:
30         act[\textcolor{stringliteral}{'label\_candidates'}].pop()
31     is\_label\_cand = \{\}
32     is\_label\_cand[labels] = \textcolor{keyword}{False}
33     \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} act[\textcolor{stringliteral}{'label\_candidates'}]:
34         \textcolor{keywordflow}{if} c \textcolor{keywordflow}{in} is\_label\_cand:
35             is\_label\_cand[c] = \textcolor{keyword}{True}
36     \textcolor{keywordflow}{for} l, has \textcolor{keywordflow}{in} is\_label\_cand.items():
37         \textcolor{keywordflow}{if} has \textcolor{keywordflow}{is} \textcolor{keyword}{False}:
38             print(\textcolor{stringliteral}{"***ADDING A LABEL CAND****"})
39             act[\textcolor{stringliteral}{'label\_candidates'}].append(l)
40 
41 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a537e075c89058b67eb0db786f98491de}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a537e075c89058b67eb0db786f98491de}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!gen\+\_\+no\+\_\+affordance\+\_\+actions\+\_\+for\+\_\+dialogue@{gen\+\_\+no\+\_\+affordance\+\_\+actions\+\_\+for\+\_\+dialogue}}
\index{gen\+\_\+no\+\_\+affordance\+\_\+actions\+\_\+for\+\_\+dialogue@{gen\+\_\+no\+\_\+affordance\+\_\+actions\+\_\+for\+\_\+dialogue}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{gen\+\_\+no\+\_\+affordance\+\_\+actions\+\_\+for\+\_\+dialogue()}{gen\_no\_affordance\_actions\_for\_dialogue()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+gen\+\_\+no\+\_\+affordance\+\_\+actions\+\_\+for\+\_\+dialogue (\begin{DoxyParamCaption}\item[{}]{d }\end{DoxyParamCaption})}



Definition at line 65 of file builder.\+py.


\begin{DoxyCode}
65 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a537e075c89058b67eb0db786f98491de}{gen\_no\_affordance\_actions\_for\_dialogue}(d):
66     characters = [d[\textcolor{stringliteral}{'agents'}][0][\textcolor{stringliteral}{'name'}], d[\textcolor{stringliteral}{'agents'}][1][\textcolor{stringliteral}{'name'}]]
67     other\_char = 1
68     no\_affordance\_actions = []
69     last\_carry = []
70     \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range(len(d[\textcolor{stringliteral}{'speech'}])):
71         char = characters[other\_char]
72         curr\_carry = d[\textcolor{stringliteral}{'carrying'}][idx] + d[\textcolor{stringliteral}{'wearing'}][idx] + d[\textcolor{stringliteral}{'wielding'}][idx]
73         no\_affordance\_actions\_turn = \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a51921236462b49d240bfde4a648c3ec3}{get\_no\_affordance\_actions}(
74             d[\textcolor{stringliteral}{'room\_objects'}][idx], curr\_carry, last\_carry, char
75         )
76         no\_affordance\_actions\_turn += d[\textcolor{stringliteral}{'available\_actions'}][idx]
77         no\_affordance\_actions.append(list(set(no\_affordance\_actions\_turn)))
78         last\_carry = curr\_carry
79         other\_char = 1 - other\_char
80     d[\textcolor{stringliteral}{'no\_affordance\_actions'}] = no\_affordance\_actions
81 
82 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a51921236462b49d240bfde4a648c3ec3}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a51921236462b49d240bfde4a648c3ec3}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!get\+\_\+no\+\_\+affordance\+\_\+actions@{get\+\_\+no\+\_\+affordance\+\_\+actions}}
\index{get\+\_\+no\+\_\+affordance\+\_\+actions@{get\+\_\+no\+\_\+affordance\+\_\+actions}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{get\+\_\+no\+\_\+affordance\+\_\+actions()}{get\_no\_affordance\_actions()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+get\+\_\+no\+\_\+affordance\+\_\+actions (\begin{DoxyParamCaption}\item[{}]{in\+\_\+room,  }\item[{}]{carrying,  }\item[{}]{other\+\_\+carrying,  }\item[{}]{other\+\_\+name }\end{DoxyParamCaption})}



Definition at line 42 of file builder.\+py.


\begin{DoxyCode}
42 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a51921236462b49d240bfde4a648c3ec3}{get\_no\_affordance\_actions}(in\_room, carrying, other\_carrying, other\_name):
43     all\_actions = []
44     \textcolor{comment}{# Drop "a" prefix from all}
45     in\_room = [i[2:] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} in\_room]
46     carrying = [i[2:] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} carrying]
47     other\_carrying = [i[2:] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} other\_carrying]
48     \textcolor{keywordflow}{for} obj \textcolor{keywordflow}{in} other\_carrying:
49         all\_actions.append(\textcolor{stringliteral}{'steal \{\} from \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(obj, other\_name))
50     \textcolor{keywordflow}{for} obj \textcolor{keywordflow}{in} in\_room:
51         all\_actions.append(\textcolor{stringliteral}{'get \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(obj))
52     \textcolor{keywordflow}{for} obj \textcolor{keywordflow}{in} carrying:
53         \textcolor{keywordflow}{for} f \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'drop \{\}'}, \textcolor{stringliteral}{'wield \{\}'}, \textcolor{stringliteral}{'wear \{\}'}, \textcolor{stringliteral}{'remove \{\}'}, \textcolor{stringliteral}{'eat \{\}'}, \textcolor{stringliteral}{'drink \{\}'}]:
54             all\_actions.append(f.format(obj))
55         all\_actions.append(\textcolor{stringliteral}{'give \{\} to \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(obj, other\_name))
56         \textcolor{keywordflow}{for} obj2 \textcolor{keywordflow}{in} in\_room:
57             all\_actions.append(\textcolor{stringliteral}{'put \{\} in \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(obj, obj2))
58         \textcolor{keywordflow}{for} obj2 \textcolor{keywordflow}{in} carrying:
59             \textcolor{keywordflow}{if} obj2 == obj:
60                 \textcolor{keywordflow}{continue}
61             all\_actions.append(\textcolor{stringliteral}{'put \{\} in \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(obj, obj2))
62     \textcolor{keywordflow}{return} list(set(all\_actions))
63 
64 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!use\+\_\+feat@{use\+\_\+feat}}
\index{use\+\_\+feat@{use\+\_\+feat}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{use\+\_\+feat()}{use\_feat()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+use\+\_\+feat (\begin{DoxyParamCaption}\item[{}]{opt,  }\item[{}]{field,  }\item[{}]{ttype }\end{DoxyParamCaption})}



Definition at line 16 of file builder.\+py.


\begin{DoxyCode}
16 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, field, ttype):
17     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'all'} \textcolor{keywordflow}{in} opt.get(field) \textcolor{keywordflow}{or} opt.get(field) == ttype:
18         \textcolor{keywordflow}{return} \textcolor{keyword}{True}
19     \textcolor{keywordflow}{else}:
20         \textcolor{keywordflow}{return} \textcolor{keyword}{False}
21 
22 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aeb144d0ebd2fd1727f73677e36f2c8b5}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aeb144d0ebd2fd1727f73677e36f2c8b5}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!write\+\_\+alldata@{write\+\_\+alldata}}
\index{write\+\_\+alldata@{write\+\_\+alldata}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{write\+\_\+alldata()}{write\_alldata()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+write\+\_\+alldata (\begin{DoxyParamCaption}\item[{}]{opt,  }\item[{}]{db,  }\item[{}]{dpath,  }\item[{}]{ltype,  }\item[{}]{split }\end{DoxyParamCaption})}



Definition at line 233 of file builder.\+py.


\begin{DoxyCode}
233 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aeb144d0ebd2fd1727f73677e36f2c8b5}{write\_alldata}(opt, db, dpath, ltype, split):
234     \textcolor{comment}{# for now train, valid and test will all be identical}
235     fname = os.path.join(dpath, ltype + \textcolor{stringliteral}{"\_"} + split + \textcolor{stringliteral}{".txt"})
236     fw\_tst = io.open(fname, \textcolor{stringliteral}{'w'})
237     \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} db:
238         \textcolor{keywordflow}{if} d[\textcolor{stringliteral}{'split'}] != split:
239             \textcolor{keywordflow}{continue}
240         d = d.copy()
241         d[\textcolor{stringliteral}{'self\_agent'}] = d[\textcolor{stringliteral}{'agents'}][1]
242         d[\textcolor{stringliteral}{'partner\_agent'}] = d[\textcolor{stringliteral}{'agents'}][0]
243         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a233ecce0ba4b1a0c023e855629986d69}{write\_dialog}(opt, fw\_tst, d, ltype, split)
244 
245         \textcolor{comment}{# now flip the conversation around so the target is the other speaker..}
246         d2 = d.copy()
247         d2[\textcolor{stringliteral}{'self\_agent'}] = d2[\textcolor{stringliteral}{'agents'}][0]
248         d2[\textcolor{stringliteral}{'partner\_agent'}] = d2[\textcolor{stringliteral}{'agents'}][1]
249         d2[\textcolor{stringliteral}{'speech'}] = list(d2[\textcolor{stringliteral}{'speech'}])
250         d2[\textcolor{stringliteral}{'speech'}].insert(0, \textcolor{keywordtype}{None})
251         d2[\textcolor{stringliteral}{'emote'}] = list(d2[\textcolor{stringliteral}{'emote'}])
252         d2[\textcolor{stringliteral}{'emote'}].insert(0, \textcolor{keywordtype}{None})
253         d2[\textcolor{stringliteral}{'action'}] = list(d2[\textcolor{stringliteral}{'action'}])
254         d2[\textcolor{stringliteral}{'action'}].insert(0, \textcolor{keywordtype}{None})
255         d2[\textcolor{stringliteral}{'available\_actions'}] = list(d2[\textcolor{stringliteral}{'available\_actions'}])
256         d2[\textcolor{stringliteral}{'available\_actions'}].insert(0, \textcolor{keywordtype}{None})
257         d2[\textcolor{stringliteral}{'no\_affordance\_actions'}] = list(d2[\textcolor{stringliteral}{'no\_affordance\_actions'}])
258         d2[\textcolor{stringliteral}{'no\_affordance\_actions'}].insert(0, \textcolor{keywordtype}{None})
259         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a233ecce0ba4b1a0c023e855629986d69}{write\_dialog}(opt, fw\_tst, d2, ltype, split)
260     fw\_tst.close()
261 
262 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a233ecce0ba4b1a0c023e855629986d69}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a233ecce0ba4b1a0c023e855629986d69}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!write\+\_\+dialog@{write\+\_\+dialog}}
\index{write\+\_\+dialog@{write\+\_\+dialog}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{write\+\_\+dialog()}{write\_dialog()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+write\+\_\+dialog (\begin{DoxyParamCaption}\item[{}]{opt,  }\item[{}]{fw,  }\item[{}]{d,  }\item[{}]{label\+\_\+type,  }\item[{}]{split }\end{DoxyParamCaption})}



Definition at line 83 of file builder.\+py.


\begin{DoxyCode}
83 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a233ecce0ba4b1a0c023e855629986d69}{write\_dialog}(opt, fw, d, label\_type, split):
84     l = len(d[\textcolor{stringliteral}{'speech'}])
85     msgs = []
86     text = \textcolor{stringliteral}{'\_task\_'} + label\_type + \textcolor{stringliteral}{'\(\backslash\)n'}
87     \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'light\_use\_setting'}]:
88         text += (
89             \textcolor{stringliteral}{'\_setting\_name '}
90             + d[\textcolor{stringliteral}{'setting'}][\textcolor{stringliteral}{'name'}]
91             + \textcolor{stringliteral}{", "}
92             + d[\textcolor{stringliteral}{'setting'}][\textcolor{stringliteral}{'category'}]
93             + \textcolor{stringliteral}{'\(\backslash\)n'}
94         )
95         text += \textcolor{stringliteral}{'\_setting\_desc '} + d[\textcolor{stringliteral}{'setting'}][\textcolor{stringliteral}{'description'}] + \textcolor{stringliteral}{'\(\backslash\)n'}
96     \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'light\_use\_person\_names'}]:
97         text += \textcolor{stringliteral}{'\_partner\_name '} + d[\textcolor{stringliteral}{'partner\_agent'}][\textcolor{stringliteral}{'name'}] + \textcolor{stringliteral}{'\(\backslash\)n'}
98         text += \textcolor{stringliteral}{'\_self\_name '} + d[\textcolor{stringliteral}{'self\_agent'}][\textcolor{stringliteral}{'name'}] + \textcolor{stringliteral}{'\(\backslash\)n'}
99     \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_persona'}, \textcolor{stringliteral}{'self'}):
100         text += \textcolor{stringliteral}{'\_self\_persona '} + d[\textcolor{stringliteral}{'self\_agent'}][\textcolor{stringliteral}{'persona'}] + \textcolor{stringliteral}{'\(\backslash\)n'}
101     \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_persona'}, \textcolor{stringliteral}{'other'}):
102         text += \textcolor{stringliteral}{'\_other\_persona '} + d[\textcolor{stringliteral}{'partner\_agent'}][\textcolor{stringliteral}{'persona'}] + \textcolor{stringliteral}{'\(\backslash\)n'}
103     \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'light\_use\_objects'}]:
104         \textcolor{keywordflow}{for} o, od \textcolor{keywordflow}{in} d[\textcolor{stringliteral}{'all\_descriptions'}].items():
105             text += \textcolor{stringliteral}{'\_object\_desc '} + o + \textcolor{stringliteral}{" : "} + od + \textcolor{stringliteral}{'\(\backslash\)n'}
106         \textcolor{keywordflow}{if} \textcolor{keyword}{False}:
107             \textcolor{keywordflow}{for} o \textcolor{keywordflow}{in} d[\textcolor{stringliteral}{'room\_objects'}][0]:
108                 text += \textcolor{stringliteral}{'\_object\_in\_room '} + o + \textcolor{stringliteral}{'\(\backslash\)n'}
109             \textcolor{keywordflow}{for} o \textcolor{keywordflow}{in} d[\textcolor{stringliteral}{'carrying'}][0]:
110                 text += \textcolor{stringliteral}{'\_object\_carrying '} + o + \textcolor{stringliteral}{'\(\backslash\)n'}
111             \textcolor{keywordflow}{for} o \textcolor{keywordflow}{in} d[\textcolor{stringliteral}{'wearing'}][0]:
112                 text += \textcolor{stringliteral}{'\_object\_wearing '} + o + \textcolor{stringliteral}{'\(\backslash\)n'}
113             \textcolor{keywordflow}{for} o \textcolor{keywordflow}{in} d[\textcolor{stringliteral}{'wielding'}][0]:
114                 text += \textcolor{stringliteral}{'\_object\_wielding '} + o + \textcolor{stringliteral}{'\(\backslash\)n'}
115     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(0, l, 2):
116         \textcolor{keywordflow}{if} i < l - 1:
117             \textcolor{keywordflow}{if} (
118                 \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_speech'}, \textcolor{stringliteral}{'partner'})
119                 \textcolor{keywordflow}{and} d[\textcolor{stringliteral}{'speech'}][i] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
120             ):
121                 \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'light\_use\_speech\_prefix'}]:
122                     text += \textcolor{stringliteral}{'\_partner\_say '}
123                 text += \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'speech'}][i]) + \textcolor{stringliteral}{'\(\backslash\)n'}
124             \textcolor{keywordflow}{if} (
125                 \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_action'}, \textcolor{stringliteral}{'partner'})
126                 \textcolor{keywordflow}{and} d[\textcolor{stringliteral}{'action'}][i] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
127             ):
128                 text += \textcolor{stringliteral}{'\_partner\_act '} + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'action'}][i]) + \textcolor{stringliteral}{'\(\backslash\)n'}
129             \textcolor{keywordflow}{if} (
130                 \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_emote'}, \textcolor{stringliteral}{'partner'})
131                 \textcolor{keywordflow}{and} d[\textcolor{stringliteral}{'emote'}][i] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
132             ):
133                 text += \textcolor{stringliteral}{'\_partner\_emote '} + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'emote'}][i]) + \textcolor{stringliteral}{'\(\backslash\)n'}
134             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'light\_use\_repeat'}) == \textcolor{stringliteral}{'self\_last'}:
135                 \textcolor{keywordflow}{if} i > 0:
136                     text = \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'speech'}][i - 1])
137                 \textcolor{keywordflow}{else}:
138                     text = \textcolor{stringliteral}{'nothing'}
139             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'light\_use\_repeat'}) == \textcolor{stringliteral}{'partner\_last'}:
140                 text = \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'speech'}][i])
141             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'light\_use\_repeat'}) == \textcolor{stringliteral}{'both\_last'}:
142                 text = \textcolor{stringliteral}{''}
143                 \textcolor{keywordflow}{if} i > 0:
144                     text += \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'speech'}][i - 1]) + \textcolor{stringliteral}{' '}
145                 text += \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'speech'}][i])
146             label = d[label\_type][i + 1]
147             used\_current = \textcolor{keyword}{False}
148             shown = \{\}
149             \textcolor{keywordflow}{if} (
150                 \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_current\_self\_output'}, \textcolor{stringliteral}{'all'})
151                 \textcolor{keywordflow}{and} label\_type != \textcolor{stringliteral}{'speech'}
152                 \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_speech'}, \textcolor{stringliteral}{'self'})
153                 \textcolor{keywordflow}{and} d[\textcolor{stringliteral}{'speech'}][i + 1] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
154             ):
155                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'remove'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'light\_use\_current\_self\_output'}]:
156                     \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'light\_use\_speech\_prefix'}]:
157                         text += \textcolor{stringliteral}{'\_self\_say '}
158                     text += \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'speech'}][i + 1]) + \textcolor{stringliteral}{'\(\backslash\)n'}
159                     shown[\textcolor{stringliteral}{'speech'}] = \textcolor{keyword}{True}
160                 used\_current = \textcolor{keyword}{True}
161             \textcolor{keywordflow}{if} (
162                 \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_current\_self\_output'}, \textcolor{stringliteral}{'all'})
163                 \textcolor{keywordflow}{and} label\_type != \textcolor{stringliteral}{'action'}
164                 \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_action'}, \textcolor{stringliteral}{'self'})
165                 \textcolor{keywordflow}{and} d[\textcolor{stringliteral}{'action'}][i + 1] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
166             ):
167                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'remove'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'light\_use\_current\_self\_output'}]:
168                     text += \textcolor{stringliteral}{'\_self\_act '} + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'action'}][i + 1]) + \textcolor{stringliteral}{'\(\backslash\)n'}
169                     shown[\textcolor{stringliteral}{'action'}] = \textcolor{keyword}{True}
170                 used\_current = \textcolor{keyword}{True}
171             \textcolor{keywordflow}{if} (
172                 \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_current\_self\_output'}, \textcolor{stringliteral}{'all'})
173                 \textcolor{keywordflow}{and} label\_type != \textcolor{stringliteral}{'emote'}
174                 \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_emote'}, \textcolor{stringliteral}{'self'})
175                 \textcolor{keywordflow}{and} d[\textcolor{stringliteral}{'emote'}][i + 1] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
176             ):
177                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'remove'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'light\_use\_current\_self\_output'}]:
178                     text += \textcolor{stringliteral}{'\_self\_emote '} + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'emote'}][i + 1]) + \textcolor{stringliteral}{'\(\backslash\)n'}
179                     shown[\textcolor{stringliteral}{'emote'}] = \textcolor{keyword}{True}
180                 used\_current = \textcolor{keyword}{True}
181             \textcolor{keywordflow}{if} (
182                 \textcolor{stringliteral}{'all\_filtered'} \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'light\_use\_current\_self\_output'}]
183                 \textcolor{keywordflow}{and} used\_current \textcolor{keywordflow}{is} \textcolor{keyword}{False}
184             ):
185                 label = \textcolor{keywordtype}{None}
186             \textcolor{keywordflow}{if} label \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
187                 msg = \{\}
188                 msg[\textcolor{stringliteral}{'text'}] = text
189                 msg[\textcolor{stringliteral}{'labels'}] = label
190                 \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a2f5cb4927740a90c9fba84df5e8e16b5}{add\_negs}(
191                     msg,
192                     d,
193                     i + 1,
194                     label\_type,
195                     split,
196                     \hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(opt.get(\textcolor{stringliteral}{'light\_use\_cands'}, 100)),
197                     opt.get(\textcolor{stringliteral}{'light\_use\_affordances'}, \textcolor{keyword}{True}),
198                 )
199                 msgs.append(msg)
200                 text = \textcolor{stringliteral}{''}
201             \textcolor{keywordflow}{if} (
202                 \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_speech'}, \textcolor{stringliteral}{'self'})
203                 \textcolor{keywordflow}{and} d[\textcolor{stringliteral}{'speech'}][i + 1] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
204                 \textcolor{keywordflow}{and} (\textcolor{stringliteral}{'speech'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} shown)
205             ):
206                 \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'light\_use\_speech\_prefix'}]:
207                     text += \textcolor{stringliteral}{'\_self\_say '}
208                 text += \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'speech'}][i + 1]) + \textcolor{stringliteral}{'\(\backslash\)n'}
209             \textcolor{keywordflow}{if} (
210                 \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_action'}, \textcolor{stringliteral}{'self'})
211                 \textcolor{keywordflow}{and} d[\textcolor{stringliteral}{'action'}][i + 1] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
212                 \textcolor{keywordflow}{and} (\textcolor{stringliteral}{'action'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} shown)
213             ):
214                 text += \textcolor{stringliteral}{'\_self\_act '} + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'action'}][i + 1]) + \textcolor{stringliteral}{'\(\backslash\)n'}
215             \textcolor{keywordflow}{if} (
216                 \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ad9de2827ebcf8386662e48c7fe011e43}{use\_feat}(opt, \textcolor{stringliteral}{'light\_use\_emote'}, \textcolor{stringliteral}{'self'})
217                 \textcolor{keywordflow}{and} d[\textcolor{stringliteral}{'emote'}][i + 1] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
218                 \textcolor{keywordflow}{and} (\textcolor{stringliteral}{'emote'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} shown)
219             ):
220                 text += \textcolor{stringliteral}{'\_self\_emote '} + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(d[\textcolor{stringliteral}{'emote'}][i + 1]) + \textcolor{stringliteral}{'\(\backslash\)n'}
221     \textcolor{keywordflow}{if} len(msgs) > 0:
222         msgs[-1][\textcolor{stringliteral}{'episode\_done'}] = \textcolor{keyword}{True}
223         \textcolor{keywordflow}{for} m \textcolor{keywordflow}{in} msgs:
224             \textcolor{comment}{# print(m.replace('\(\backslash\)n', '\(\backslash\)\(\backslash\)n'))}
225             \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_aafb760ba2e05ffe5cad429327d0dd347}{fix\_labels}(m, opt)
226             \textcolor{keyword}{global} mx
227             mx = max(len(m[\textcolor{stringliteral}{'label\_candidates'}]), mx)
228             \textcolor{comment}{# print(mx)}
229             txt = \hyperlink{namespaceparlai_1_1utils_1_1misc_ae5db473b41d3b49814e2566e866282b6}{msg\_to\_str}(m)
230             fw.write(txt + \textcolor{stringliteral}{'\(\backslash\)n'})
231 
232 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a25aca9f28e4406290624e1d0c5cce0d6}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a25aca9f28e4406290624e1d0c5cce0d6}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!write\+\_\+out\+\_\+candidates@{write\+\_\+out\+\_\+candidates}}
\index{write\+\_\+out\+\_\+candidates@{write\+\_\+out\+\_\+candidates}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{write\+\_\+out\+\_\+candidates()}{write\_out\_candidates()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+write\+\_\+out\+\_\+candidates (\begin{DoxyParamCaption}\item[{}]{db,  }\item[{}]{dpath,  }\item[{}]{dtype }\end{DoxyParamCaption})}



Definition at line 295 of file builder.\+py.


\begin{DoxyCode}
295 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a25aca9f28e4406290624e1d0c5cce0d6}{write\_out\_candidates}(db, dpath, dtype):
296     emotes = \{\}
297     acts = \{\}
298     cands[\textcolor{stringliteral}{'emote'}] = []
299     cands[\textcolor{stringliteral}{'action'}] = []
300     cands[\textcolor{stringliteral}{'speech'}] = []
301     \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} db:
302         \hyperlink{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a537e075c89058b67eb0db786f98491de}{gen\_no\_affordance\_actions\_for\_dialogue}(d)
303         \textcolor{keywordflow}{if} d[\textcolor{stringliteral}{'split'}] != dtype:
304             \textcolor{keywordflow}{continue}
305         \textcolor{keywordflow}{for} e \textcolor{keywordflow}{in} d[\textcolor{stringliteral}{'emote'}]:
306             \textcolor{keywordflow}{if} e \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None} \textcolor{keywordflow}{and} e \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} emotes:
307                 cands[\textcolor{stringliteral}{'emote'}].append(e)
308                 emotes[e] = \textcolor{keyword}{True}
309         \textcolor{keywordflow}{for} act \textcolor{keywordflow}{in} d[\textcolor{stringliteral}{'action'}]:
310             \textcolor{keywordflow}{if} act \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None} \textcolor{keywordflow}{and} act \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} acts:
311                 cands[\textcolor{stringliteral}{'action'}].append(act)
312                 acts[act] = \textcolor{keyword}{True}
313         \textcolor{keywordflow}{for} s \textcolor{keywordflow}{in} d[\textcolor{stringliteral}{'speech'}]:
314             \textcolor{keywordflow}{if} s \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
315                 cands[\textcolor{stringliteral}{'speech'}].append(s)
316     \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'emote'}, \textcolor{stringliteral}{'speech'}, \textcolor{stringliteral}{'action'}]:
317         fw = io.open(os.path.join(dpath, l + \textcolor{stringliteral}{"\_"} + dtype + \textcolor{stringliteral}{"\_cands.txt"}), \textcolor{stringliteral}{'w'})
318         \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} cands[l]:
319             fw.write(k + \textcolor{stringliteral}{"\(\backslash\)n"})
320         fw.close
321 
322 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ae50feb1d704c383270ea1e4b3a4c85d6}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_ae50feb1d704c383270ea1e4b3a4c85d6}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!cands@{cands}}
\index{cands@{cands}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{cands}{cands}}
{\footnotesize\ttfamily parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+cands}



Definition at line 292 of file builder.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a8b4522952b8ecc117e46da456d5754b4}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a8b4522952b8ecc117e46da456d5754b4}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!mx@{mx}}
\index{mx@{mx}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{mx}{mx}}
{\footnotesize\ttfamily parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+mx}



Definition at line 23 of file builder.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a1a5f7c29e2ac62fb237eef07ae9815c1}\label{namespaceparlai_1_1tasks_1_1light__dialog_1_1builder_a1a5f7c29e2ac62fb237eef07ae9815c1}} 
\index{parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}!rand@{rand}}
\index{rand@{rand}!parlai\+::tasks\+::light\+\_\+dialog\+::builder@{parlai\+::tasks\+::light\+\_\+dialog\+::builder}}
\subsubsection{\texorpdfstring{rand}{rand}}
{\footnotesize\ttfamily parlai.\+tasks.\+light\+\_\+dialog.\+builder.\+rand}



Definition at line 13 of file builder.\+py.

