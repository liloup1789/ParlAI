\hypertarget{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009}{}\section{parlai.\+tasks.\+opensubtitles.\+build\+\_\+2009 Namespace Reference}
\label{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009}\index{parlai.\+tasks.\+opensubtitles.\+build\+\_\+2009@{parlai.\+tasks.\+opensubtitles.\+build\+\_\+2009}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_ad149abe80311061e9b055102702633ed}{create\+\_\+fb\+\_\+format} (inpath, outpath)
\item 
def \hyperlink{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_a1b4aedcfe5cf20f4708277aba234e048}{build} (datapath)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_a850120232d120b52f2bef60aa580e398}{R\+E\+S\+O\+U\+R\+C\+ES}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_a1b4aedcfe5cf20f4708277aba234e048}\label{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_a1b4aedcfe5cf20f4708277aba234e048}} 
\index{parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009@{parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009}!build@{build}}
\index{build@{build}!parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009@{parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009}}
\subsubsection{\texorpdfstring{build()}{build()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+opensubtitles.\+build\+\_\+2009.\+build (\begin{DoxyParamCaption}\item[{}]{datapath }\end{DoxyParamCaption})}



Definition at line 84 of file build\+\_\+2009.\+py.


\begin{DoxyCode}
84 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_a1b4aedcfe5cf20f4708277aba234e048}{build}(datapath):
85     dpath = os.path.join(datapath, \textcolor{stringliteral}{'OpenSubtitles'})
86     version = \textcolor{stringliteral}{'2'}
87 
88     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} build\_data.built(dpath, version\_string=version):
89         print(\textcolor{stringliteral}{'[building data: '} + dpath + \textcolor{stringliteral}{']'})
90         \textcolor{keywordflow}{if} build\_data.built(dpath):
91             \textcolor{comment}{# An older version exists, so remove these outdated files.}
92             build\_data.remove\_dir(dpath)
93         build\_data.make\_dir(dpath)
94 
95         \textcolor{comment}{# Download the data.}
96         \textcolor{keywordflow}{for} downloadable\_file \textcolor{keywordflow}{in} RESOURCES:
97             downloadable\_file.download\_file(dpath)
98 
99         \hyperlink{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_ad149abe80311061e9b055102702633ed}{create\_fb\_format}(os.path.join(dpath, \textcolor{stringliteral}{'OpenSubtitles'}, \textcolor{stringliteral}{'en'}), dpath)
100 
101         \textcolor{comment}{# Mark the data as built.}
102         build\_data.mark\_done(dpath, version\_string=version)
103     \textcolor{keywordflow}{return} dpath
104 \end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_ad149abe80311061e9b055102702633ed}\label{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_ad149abe80311061e9b055102702633ed}} 
\index{parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009@{parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009}!create\+\_\+fb\+\_\+format@{create\+\_\+fb\+\_\+format}}
\index{create\+\_\+fb\+\_\+format@{create\+\_\+fb\+\_\+format}!parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009@{parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009}}
\subsubsection{\texorpdfstring{create\+\_\+fb\+\_\+format()}{create\_fb\_format()}}
{\footnotesize\ttfamily def parlai.\+tasks.\+opensubtitles.\+build\+\_\+2009.\+create\+\_\+fb\+\_\+format (\begin{DoxyParamCaption}\item[{}]{inpath,  }\item[{}]{outpath }\end{DoxyParamCaption})}



Definition at line 33 of file build\+\_\+2009.\+py.


\begin{DoxyCode}
33 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_ad149abe80311061e9b055102702633ed}{create\_fb\_format}(inpath, outpath):
34     print(\textcolor{stringliteral}{'[building fbformat]'})
35     with open(os.path.join(outpath, \textcolor{stringliteral}{'train.txt'}), \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} ftrain, open(
36         os.path.join(outpath, \textcolor{stringliteral}{'valid.txt'}), \textcolor{stringliteral}{'w'}
37     ) \textcolor{keyword}{as} fvalid, open(os.path.join(outpath, \textcolor{stringliteral}{'test.txt'}), \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} ftest:
38 
39         conv\_id = 0
40         \textcolor{comment}{# find all the files.}
41         \textcolor{keywordflow}{for} root, \_subfolder, files \textcolor{keywordflow}{in} os.walk(inpath):
42             \textcolor{keywordflow}{for} f \textcolor{keywordflow}{in} files:
43                 \textcolor{keywordflow}{if} f.endswith(\textcolor{stringliteral}{'.gz'}):
44                     dialog = []
45                     conv\_id = conv\_id + 1
46                     with gzip.open(os.path.join(root, f), \textcolor{stringliteral}{'r') as f1:}
47 \textcolor{stringliteral}{                        words = []}
48 \textcolor{stringliteral}{                        line\_id = 1}
49 \textcolor{stringliteral}{                        turn\_id = 0}
50 \textcolor{stringliteral}{                        }\textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} f1:
51                             line = \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(line)
52                             \textcolor{keywordflow}{if} line.find(\textcolor{stringliteral}{'<s id="'}) != -1:
53                                 \textcolor{comment}{# new sentence}
54                                 \textcolor{keywordflow}{if} len(words) > 0:
55                                     curr\_words = \_regularize(\textcolor{stringliteral}{''}.join(words))
56                                     \textcolor{keywordflow}{if} len(curr\_words) > 0:
57                                         \textcolor{keywordflow}{if} (turn\_id % 2) == 0:
58                                             dialog.append(\hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(line\_id))
59                                             dialog.append(\textcolor{stringliteral}{' '})
60                                             dialog.append(curr\_words)
61                                         \textcolor{keywordflow}{else}:
62                                             dialog.append(\textcolor{stringliteral}{'\(\backslash\)t'})
63                                             dialog.append(curr\_words)
64                                             dialog.append(\textcolor{stringliteral}{'\(\backslash\)n'})
65                                             line\_id += 1
66                                         turn\_id += +1
67                                 words.clear()
68                             \textcolor{keywordflow}{else}:
69                                 i1 = line.find(\textcolor{stringliteral}{'<w id="'})
70                                 \textcolor{keywordflow}{if} i1 >= 0:
71                                     line = line[i1:]
72                                     word = line[line.find(\textcolor{stringliteral}{'>'}) + 1 : line.find(\textcolor{stringliteral}{'</w'})]
73                                     words.append(\textcolor{stringliteral}{' '})
74                                     words.append(word.replace(\textcolor{stringliteral}{'\(\backslash\)t'}, \textcolor{stringliteral}{' '}))
75                     handle = ftrain
76                     \textcolor{keywordflow}{if} (conv\_id % 10) == 0:
77                         handle = ftest
78                     \textcolor{keywordflow}{if} (conv\_id % 10) == 1:
79                         handle = fvalid
80                     dialog.append(\textcolor{stringliteral}{'\(\backslash\)n'})
81                     handle.write(\textcolor{stringliteral}{''}.join(dialog))
82 
83 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_a850120232d120b52f2bef60aa580e398}\label{namespaceparlai_1_1tasks_1_1opensubtitles_1_1build__2009_a850120232d120b52f2bef60aa580e398}} 
\index{parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009@{parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009}!R\+E\+S\+O\+U\+R\+C\+ES@{R\+E\+S\+O\+U\+R\+C\+ES}}
\index{R\+E\+S\+O\+U\+R\+C\+ES@{R\+E\+S\+O\+U\+R\+C\+ES}!parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009@{parlai\+::tasks\+::opensubtitles\+::build\+\_\+2009}}
\subsubsection{\texorpdfstring{R\+E\+S\+O\+U\+R\+C\+ES}{RESOURCES}}
{\footnotesize\ttfamily parlai.\+tasks.\+opensubtitles.\+build\+\_\+2009.\+R\+E\+S\+O\+U\+R\+C\+ES}



Definition at line 14 of file build\+\_\+2009.\+py.

