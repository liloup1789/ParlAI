\hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf}{}\section{parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf Namespace Reference}
\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf}\index{parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf@{parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a297d8a6b3ed43b31feccf5707517fee3}{init} (tokenizer\+\_\+class, db\+\_\+opts)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8f16fdf4641c497d12c19f128ed4647a}{fetch\+\_\+text} (doc\+\_\+id)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a1fdb457e98eb4e4c26047e229686a616}{tokenize} (text)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a5bd546d494142d2d7e2772a3d60583f9}{truncate} (data, row, col)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a7ec5dffcb27b7ce23ea0a0e37ef2398d}{sparse\+\_\+nonzero} (sparse\+\_\+t)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8852c505db2852b5e39be3468a9c1733}{sparse\+\_\+sum} (sparse\+\_\+t)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a89650718966a5b0d1114e8b06b8c0dcc}{sparse\+\_\+log1p} (sparse\+\_\+t)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_af51dc8629608fd04435739ba76b1e8f2}{live\+\_\+count\+\_\+matrix} (\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_aa48318cbcc3882ee8fe371c672cbf941}{args}, cands)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_af6a82e7b8a6efb75fb73be53b55a7787}{live\+\_\+count\+\_\+matrix\+\_\+t} (\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_aa48318cbcc3882ee8fe371c672cbf941}{args}, cands)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a76bae1c966a21d123cb91949d6c8ec20}{count\+\_\+text} (ngram, hash\+\_\+size, doc\+\_\+id, text=\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad50f77b70c0e27d3304395c58e9212c4}{None})
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a7fc352c82f4a875b23fec3b046027039}{count} (ngram, hash\+\_\+size, doc\+\_\+id)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac277ce99c037a483df09e82cfdbe4665}{get\+\_\+count\+\_\+matrix\+\_\+t} (\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_aa48318cbcc3882ee8fe371c672cbf941}{args}, db\+\_\+opts)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0d95180be94e232e3ebc748c8aa7b9a0}{get\+\_\+count\+\_\+matrix} (\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_aa48318cbcc3882ee8fe371c672cbf941}{args}, db\+\_\+opts)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a3cd67edc9bfd76a8eeb49add2de75019}{get\+\_\+tfidf\+\_\+matrix\+\_\+t} (cnts)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_acce651a5b40c5a3b4009181f22c69eaa}{get\+\_\+tfidf\+\_\+matrix} (cnts)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a284d006ecb031c337c64d7debe1407d3}{get\+\_\+doc\+\_\+freqs\+\_\+t} (cnts)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac6883ed21006848661f6c748f91aff56}{get\+\_\+doc\+\_\+freqs} (cnts)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0d8cca9dbdf0fa23d25e81ec2a96b347}{run} (\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_aa48318cbcc3882ee8fe371c672cbf941}{args})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
string \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8dc725902934e0c460f5a82fa332c521}{fmt} = \textquotesingle{}\%(asctime)s\+: \mbox{[} \%(message)s \mbox{]}\textquotesingle{}
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ae5c3818e71ddea3c79328d8a4c423047}{P\+R\+O\+C\+E\+S\+S\+\_\+\+T\+OK} = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad50f77b70c0e27d3304395c58e9212c4}{None}
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a27ac3f448b895f9daae56e01bbf1be70}{P\+R\+O\+C\+E\+S\+S\+\_\+\+DB} = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad50f77b70c0e27d3304395c58e9212c4}{None}
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ae004cad36f1e393ce6c158058a526eeb}{M\+A\+X\+\_\+\+SZ} = int(math.\+pow(2, 30) $\ast$ 1.\+8)
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a21ca3f18c69cd5e11f4f9ec6505e0a24}{parser} = argparse.\+Argument\+Parser()
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a188ab17adbcc529b664e05f836f42918}{default}
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0e12682c80997535ca4f7f293b8c6d10}{help}
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a213e3a3970a4f1423c2cc41e5f31295e}{str}
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad50f77b70c0e27d3304395c58e9212c4}{None}
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_aa48318cbcc3882ee8fe371c672cbf941}{args} = parser.\+parse\+\_\+args()
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_afe20f2925824bab82a89672734347544}{count\+\_\+matrix}
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a09c3915a9ffe251347f232647caff959}{doc\+\_\+dict}
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a60001be3ae4369767886e45fa5937e55}{tfidf} = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_acce651a5b40c5a3b4009181f22c69eaa}{get\+\_\+tfidf\+\_\+matrix}(\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_afe20f2925824bab82a89672734347544}{count\+\_\+matrix})
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_abb3607652abdd76d57a6ae90e19e3828}{freqs} = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac6883ed21006848661f6c748f91aff56}{get\+\_\+doc\+\_\+freqs}(\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_afe20f2925824bab82a89672734347544}{count\+\_\+matrix})
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0a314a0288fcdf731f21e279e9f7b27a}{basename} = os.\+path.\+splitext(os.\+path.\+basename(args.\+db\+\_\+path))\mbox{[}0\mbox{]}
\item 
\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_afcbd4a0d6b9f9e9d88008c66912778cf}{filename} = os.\+path.\+join(args.\+out\+\_\+dir, \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0a314a0288fcdf731f21e279e9f7b27a}{basename})
\item 
dictionary \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a78c951c63ece0474919ceef5d15d7e5d}{metadata}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a7fc352c82f4a875b23fec3b046027039}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a7fc352c82f4a875b23fec3b046027039}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!count@{count}}
\index{count@{count}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{count()}{count()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+count (\begin{DoxyParamCaption}\item[{}]{ngram,  }\item[{}]{hash\+\_\+size,  }\item[{}]{doc\+\_\+id }\end{DoxyParamCaption})}

\begin{DoxyVerb}Fetch the text of a document and compute hashed ngrams counts.
\end{DoxyVerb}
 

Definition at line 150 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
150 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a7fc352c82f4a875b23fec3b046027039}{count}(ngram, hash\_size, doc\_id):
151     \textcolor{stringliteral}{"""}
152 \textcolor{stringliteral}{    Fetch the text of a document and compute hashed ngrams counts.}
153 \textcolor{stringliteral}{    """}
154     \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a76bae1c966a21d123cb91949d6c8ec20}{count\_text}(ngram, hash\_size, doc\_id, text=\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8f16fdf4641c497d12c19f128ed4647a}{fetch\_text}(doc\_id))
155 
156 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a76bae1c966a21d123cb91949d6c8ec20}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a76bae1c966a21d123cb91949d6c8ec20}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!count\+\_\+text@{count\+\_\+text}}
\index{count\+\_\+text@{count\+\_\+text}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{count\+\_\+text()}{count\_text()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+count\+\_\+text (\begin{DoxyParamCaption}\item[{}]{ngram,  }\item[{}]{hash\+\_\+size,  }\item[{}]{doc\+\_\+id,  }\item[{}]{text = {\ttfamily \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad50f77b70c0e27d3304395c58e9212c4}{None}} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Compute hashed ngram counts of text.
\end{DoxyVerb}
 

Definition at line 129 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
129 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a76bae1c966a21d123cb91949d6c8ec20}{count\_text}(ngram, hash\_size, doc\_id, text=None):
130     \textcolor{stringliteral}{"""}
131 \textcolor{stringliteral}{    Compute hashed ngram counts of text.}
132 \textcolor{stringliteral}{    """}
133     row, col, data = [], [], []
134     \textcolor{comment}{# Tokenize}
135     tokens = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a1fdb457e98eb4e4c26047e229686a616}{tokenize}(utils.normalize(text))
136 
137     \textcolor{comment}{# Get ngrams from tokens, with stopword/punctuation filtering.}
138     ngrams = tokens.ngrams(n=ngram, uncased=\textcolor{keyword}{True}, filter\_fn=utils.filter\_ngram)
139 
140     \textcolor{comment}{# Hash ngrams and count occurences}
141     counts = Counter([utils.hash(gram, hash\_size) \textcolor{keywordflow}{for} gram \textcolor{keywordflow}{in} ngrams])
142 
143     \textcolor{comment}{# Return in sparse matrix data format.}
144     row.extend(counts.keys())
145     col.extend([doc\_id] * len(counts))
146     data.extend(counts.values())
147     \textcolor{keywordflow}{return} row, col, data
148 
149 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8f16fdf4641c497d12c19f128ed4647a}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8f16fdf4641c497d12c19f128ed4647a}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!fetch\+\_\+text@{fetch\+\_\+text}}
\index{fetch\+\_\+text@{fetch\+\_\+text}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{fetch\+\_\+text()}{fetch\_text()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+fetch\+\_\+text (\begin{DoxyParamCaption}\item[{}]{doc\+\_\+id }\end{DoxyParamCaption})}



Definition at line 47 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
47 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8f16fdf4641c497d12c19f128ed4647a}{fetch\_text}(doc\_id):
48     \textcolor{keyword}{global} PROCESS\_DB
49     \textcolor{keywordflow}{return} PROCESS\_DB.get\_doc\_text(doc\_id)
50 
51 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0d95180be94e232e3ebc748c8aa7b9a0}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0d95180be94e232e3ebc748c8aa7b9a0}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!get\+\_\+count\+\_\+matrix@{get\+\_\+count\+\_\+matrix}}
\index{get\+\_\+count\+\_\+matrix@{get\+\_\+count\+\_\+matrix}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{get\+\_\+count\+\_\+matrix()}{get\_count\_matrix()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+get\+\_\+count\+\_\+matrix (\begin{DoxyParamCaption}\item[{}]{args,  }\item[{}]{db\+\_\+opts }\end{DoxyParamCaption})}

\begin{DoxyVerb}Form a sparse word to document count matrix (inverted index).

M[i, j] = # times word i appears in document j.
\end{DoxyVerb}
 

Definition at line 197 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
197 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0d95180be94e232e3ebc748c8aa7b9a0}{get\_count\_matrix}(args, db\_opts):
198     \textcolor{stringliteral}{"""}
199 \textcolor{stringliteral}{    Form a sparse word to document count matrix (inverted index).}
200 \textcolor{stringliteral}{}
201 \textcolor{stringliteral}{    M[i, j] = # times word i appears in document j.}
202 \textcolor{stringliteral}{    """}
203     \textcolor{keyword}{global} MAX\_SZ
204     with DocDB(**db\_opts) \textcolor{keyword}{as} doc\_db:
205         doc\_ids = doc\_db.get\_doc\_ids()
206 
207     \textcolor{comment}{# Setup worker pool}
208     tok\_class = tokenizers.get\_class(args.tokenizer)
209     workers = ProcessPool(
210         args.num\_workers, initializer=init, initargs=(tok\_class, db\_opts)
211     )
212 
213     \textcolor{comment}{# Compute the count matrix in steps (to keep in memory)}
214     logger.info(\textcolor{stringliteral}{'Mapping...'})
215     row, col, data = [], [], []
216     step = max(\hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(len(doc\_ids) / 10), 1)
217     batches = [doc\_ids[i : i + step] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(0, len(doc\_ids), step)]
218     \_count = partial(count, args.ngram, args.hash\_size)
219     \textcolor{keywordflow}{for} i, batch \textcolor{keywordflow}{in} enumerate(batches):
220         logger.info(\textcolor{stringliteral}{'-'} * 25 + \textcolor{stringliteral}{'Batch %d/%d'} % (i + 1, len(batches)) + \textcolor{stringliteral}{'-'} * 25)
221         \textcolor{keywordflow}{for} b\_row, b\_col, b\_data \textcolor{keywordflow}{in} workers.imap\_unordered(\_count, batch):
222             row.extend(b\_row)
223             col.extend(b\_col)
224             data.extend(b\_data)
225             \textcolor{keywordflow}{if} len(data) > MAX\_SZ:
226                 \textcolor{keywordflow}{break}
227         \textcolor{keywordflow}{if} len(data) > MAX\_SZ:
228             logger.info(\textcolor{stringliteral}{'Reached max indexable size, breaking.'})
229             \textcolor{keywordflow}{break}
230     workers.close()
231     workers.join()
232 
233     logger.info(\textcolor{stringliteral}{'Creating sparse matrix...'})
234     data, row, col = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a5bd546d494142d2d7e2772a3d60583f9}{truncate}(data, row, col)
235 
236     count\_matrix = sp.csr\_matrix(
237         (data, (row, col)), shape=(args.hash\_size, len(doc\_ids) + 1)
238     )
239     count\_matrix.sum\_duplicates()
240     \textcolor{keywordflow}{return} count\_matrix
241 
242 
243 \textcolor{comment}{# ------------------------------------------------------------------------------}
244 \textcolor{comment}{# Transform count matrix to different forms.}
245 \textcolor{comment}{# ------------------------------------------------------------------------------}
246 
247 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac277ce99c037a483df09e82cfdbe4665}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac277ce99c037a483df09e82cfdbe4665}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!get\+\_\+count\+\_\+matrix\+\_\+t@{get\+\_\+count\+\_\+matrix\+\_\+t}}
\index{get\+\_\+count\+\_\+matrix\+\_\+t@{get\+\_\+count\+\_\+matrix\+\_\+t}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{get\+\_\+count\+\_\+matrix\+\_\+t()}{get\_count\_matrix\_t()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+get\+\_\+count\+\_\+matrix\+\_\+t (\begin{DoxyParamCaption}\item[{}]{args,  }\item[{}]{db\+\_\+opts }\end{DoxyParamCaption})}

\begin{DoxyVerb}Form a sparse word to document count matrix (inverted index, torch ver).

M[i, j] = # times word i appears in document j.
\end{DoxyVerb}
 

Definition at line 157 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
157 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac277ce99c037a483df09e82cfdbe4665}{get\_count\_matrix\_t}(args, db\_opts):
158     \textcolor{stringliteral}{"""}
159 \textcolor{stringliteral}{    Form a sparse word to document count matrix (inverted index, torch ver).}
160 \textcolor{stringliteral}{}
161 \textcolor{stringliteral}{    M[i, j] = # times word i appears in document j.}
162 \textcolor{stringliteral}{    """}
163     \textcolor{keyword}{global} MAX\_SZ
164     with DocDB(**db\_opts) \textcolor{keyword}{as} doc\_db:
165         doc\_ids = doc\_db.get\_doc\_ids()
166 
167     \textcolor{comment}{# Setup worker pool}
168     tok\_class = tokenizers.get\_class(args.tokenizer)
169     workers = ProcessPool(
170         args.num\_workers, initializer=init, initargs=(tok\_class, db\_opts)
171     )
172 
173     \textcolor{comment}{# Compute the count matrix in steps (to keep in memory)}
174     logger.info(\textcolor{stringliteral}{'Mapping...'})
175     row, col, data = [], [], []
176     step = max(\hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(len(doc\_ids) / 10), 1)
177     batches = [doc\_ids[i : i + step] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(0, len(doc\_ids), step)]
178     \_count = partial(count, args.ngram, args.hash\_size)
179     \textcolor{keywordflow}{for} i, batch \textcolor{keywordflow}{in} enumerate(batches):
180         logger.info(\textcolor{stringliteral}{'-'} * 25 + \textcolor{stringliteral}{'Batch %d/%d'} % (i + 1, len(batches)) + \textcolor{stringliteral}{'-'} * 25)
181         \textcolor{keywordflow}{for} b\_row, b\_col, b\_data \textcolor{keywordflow}{in} workers.imap\_unordered(\_count, batch):
182             row.extend(b\_row)
183             col.extend(b\_col)
184             data.extend(b\_data)
185     workers.close()
186     workers.join()
187 
188     logger.info(\textcolor{stringliteral}{'Creating sparse matrix...'})
189     count\_matrix = torch.sparse.FloatTensor(
190         torch.LongTensor([row, col]),
191         torch.FloatTensor(data),
192         torch.Size([args.hash\_size, len(doc\_ids) + 1]),
193     ).coalesce()
194     \textcolor{keywordflow}{return} count\_matrix
195 
196 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac6883ed21006848661f6c748f91aff56}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac6883ed21006848661f6c748f91aff56}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!get\+\_\+doc\+\_\+freqs@{get\+\_\+doc\+\_\+freqs}}
\index{get\+\_\+doc\+\_\+freqs@{get\+\_\+doc\+\_\+freqs}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{get\+\_\+doc\+\_\+freqs()}{get\_doc\_freqs()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+get\+\_\+doc\+\_\+freqs (\begin{DoxyParamCaption}\item[{}]{cnts }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return word --> # of docs it appears in.
\end{DoxyVerb}
 

Definition at line 296 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
296 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac6883ed21006848661f6c748f91aff56}{get\_doc\_freqs}(cnts):
297     \textcolor{stringliteral}{"""}
298 \textcolor{stringliteral}{    Return word --> # of docs it appears in.}
299 \textcolor{stringliteral}{    """}
300     binary = (cnts > 0).astype(int)
301     freqs = np.array(binary.sum(1)).squeeze()
302     \textcolor{keywordflow}{return} freqs
303 
304 
305 \textcolor{comment}{# ------------------------------------------------------------------------------}
306 \textcolor{comment}{# Main.}
307 \textcolor{comment}{# ------------------------------------------------------------------------------}
308 
309 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a284d006ecb031c337c64d7debe1407d3}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a284d006ecb031c337c64d7debe1407d3}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!get\+\_\+doc\+\_\+freqs\+\_\+t@{get\+\_\+doc\+\_\+freqs\+\_\+t}}
\index{get\+\_\+doc\+\_\+freqs\+\_\+t@{get\+\_\+doc\+\_\+freqs\+\_\+t}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{get\+\_\+doc\+\_\+freqs\+\_\+t()}{get\_doc\_freqs\_t()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+get\+\_\+doc\+\_\+freqs\+\_\+t (\begin{DoxyParamCaption}\item[{}]{cnts }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return word --> # of docs it appears in (torch version).
\end{DoxyVerb}
 

Definition at line 287 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
287 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a284d006ecb031c337c64d7debe1407d3}{get\_doc\_freqs\_t}(cnts):
288     \textcolor{stringliteral}{"""}
289 \textcolor{stringliteral}{    Return word --> # of docs it appears in (torch version).}
290 \textcolor{stringliteral}{    """}
291     \textcolor{keywordflow}{return} torch.histc(
292         cnts.\_indices()[0].\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(), bins=cnts.size(0), min=0, max=cnts.size(0)
293     )
294 
295 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_acce651a5b40c5a3b4009181f22c69eaa}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_acce651a5b40c5a3b4009181f22c69eaa}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!get\+\_\+tfidf\+\_\+matrix@{get\+\_\+tfidf\+\_\+matrix}}
\index{get\+\_\+tfidf\+\_\+matrix@{get\+\_\+tfidf\+\_\+matrix}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{get\+\_\+tfidf\+\_\+matrix()}{get\_tfidf\_matrix()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+get\+\_\+tfidf\+\_\+matrix (\begin{DoxyParamCaption}\item[{}]{cnts }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert the word count matrix into tfidf one.

tfidf = log(tf + 1) * log((N - Nt + 0.5) / (Nt + 0.5))
* tf = term frequency in document
* N = number of documents
* Nt = number of occurences of term in all documents
\end{DoxyVerb}
 

Definition at line 268 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
268 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_acce651a5b40c5a3b4009181f22c69eaa}{get\_tfidf\_matrix}(cnts):
269     \textcolor{stringliteral}{"""}
270 \textcolor{stringliteral}{    Convert the word count matrix into tfidf one.}
271 \textcolor{stringliteral}{}
272 \textcolor{stringliteral}{    tfidf = log(tf + 1) * log((N - Nt + 0.5) / (Nt + 0.5))}
273 \textcolor{stringliteral}{    * tf = term frequency in document}
274 \textcolor{stringliteral}{    * N = number of documents}
275 \textcolor{stringliteral}{    * Nt = number of occurences of term in all documents}
276 \textcolor{stringliteral}{    """}
277     Nt = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac6883ed21006848661f6c748f91aff56}{get\_doc\_freqs}(cnts)
278     idfs = np.log((cnts.shape[1] - Nt + 0.5) / (Nt + 0.5))
279     idfs[idfs < 0] = 0
280     idfs = sp.diags(idfs, 0)
281     tfs = cnts.log1p()
282     tfidfs = idfs.dot(tfs)
283 
284     \textcolor{keywordflow}{return} tfidfs
285 
286 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a3cd67edc9bfd76a8eeb49add2de75019}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a3cd67edc9bfd76a8eeb49add2de75019}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!get\+\_\+tfidf\+\_\+matrix\+\_\+t@{get\+\_\+tfidf\+\_\+matrix\+\_\+t}}
\index{get\+\_\+tfidf\+\_\+matrix\+\_\+t@{get\+\_\+tfidf\+\_\+matrix\+\_\+t}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{get\+\_\+tfidf\+\_\+matrix\+\_\+t()}{get\_tfidf\_matrix\_t()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+get\+\_\+tfidf\+\_\+matrix\+\_\+t (\begin{DoxyParamCaption}\item[{}]{cnts }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert the word count matrix into tfidf one (torch version).

tfidf = log(tf + 1) * log((N - Nt + 0.5) / (Nt + 0.5))
* tf = term frequency in document
* N = number of documents
* Nt = number of occurences of term in all documents
\end{DoxyVerb}
 

Definition at line 248 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
248 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a3cd67edc9bfd76a8eeb49add2de75019}{get\_tfidf\_matrix\_t}(cnts):
249     \textcolor{stringliteral}{"""}
250 \textcolor{stringliteral}{    Convert the word count matrix into tfidf one (torch version).}
251 \textcolor{stringliteral}{}
252 \textcolor{stringliteral}{    tfidf = log(tf + 1) * log((N - Nt + 0.5) / (Nt + 0.5))}
253 \textcolor{stringliteral}{    * tf = term frequency in document}
254 \textcolor{stringliteral}{    * N = number of documents}
255 \textcolor{stringliteral}{    * Nt = number of occurences of term in all documents}
256 \textcolor{stringliteral}{    """}
257     Nt = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a284d006ecb031c337c64d7debe1407d3}{get\_doc\_freqs\_t}(cnts)
258     idft = ((cnts.size(1) - Nt + 0.5) / (Nt + 0.5)).log()
259     idft[idft < 0] = 0
260     tft = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a89650718966a5b0d1114e8b06b8c0dcc}{sparse\_log1p}(cnts)
261     inds, vals = tft.\_indices(), tft.\_values()
262     \textcolor{keywordflow}{for} i, ind \textcolor{keywordflow}{in} enumerate(inds[0]):
263         vals[i] *= idft[ind]
264     tfidft = tft
265     \textcolor{keywordflow}{return} tfidft
266 
267 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a297d8a6b3ed43b31feccf5707517fee3}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a297d8a6b3ed43b31feccf5707517fee3}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!init@{init}}
\index{init@{init}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+init (\begin{DoxyParamCaption}\item[{}]{tokenizer\+\_\+class,  }\item[{}]{db\+\_\+opts }\end{DoxyParamCaption})}



Definition at line 39 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
39 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a297d8a6b3ed43b31feccf5707517fee3}{init}(tokenizer\_class, db\_opts):
40     \textcolor{keyword}{global} PROCESS\_TOK, PROCESS\_DB
41     PROCESS\_TOK = tokenizer\_class()
42     Finalize(PROCESS\_TOK, PROCESS\_TOK.shutdown, exitpriority=100)
43     PROCESS\_DB = DocDB(**db\_opts)
44     Finalize(PROCESS\_DB, PROCESS\_DB.close, exitpriority=100)
45 
46 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_af51dc8629608fd04435739ba76b1e8f2}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_af51dc8629608fd04435739ba76b1e8f2}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!live\+\_\+count\+\_\+matrix@{live\+\_\+count\+\_\+matrix}}
\index{live\+\_\+count\+\_\+matrix@{live\+\_\+count\+\_\+matrix}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{live\+\_\+count\+\_\+matrix()}{live\_count\_matrix()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+live\+\_\+count\+\_\+matrix (\begin{DoxyParamCaption}\item[{}]{args,  }\item[{}]{cands }\end{DoxyParamCaption})}



Definition at line 93 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
93 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_af51dc8629608fd04435739ba76b1e8f2}{live\_count\_matrix}(args, cands):
94     \textcolor{keyword}{global} PROCESS\_TOK
95     \textcolor{keywordflow}{if} PROCESS\_TOK \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
96         PROCESS\_TOK = tokenizers.get\_class(args.tokenizer)()
97     row, col, data = [], [], []
98     \textcolor{keywordflow}{for} i, c \textcolor{keywordflow}{in} enumerate(cands):
99         cur\_row, cur\_col, cur\_data = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a76bae1c966a21d123cb91949d6c8ec20}{count\_text}(args.ngram, args.hash\_size, i, c)
100         row += cur\_row
101         col += cur\_col
102         data += cur\_data
103 
104     data, row, col = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a5bd546d494142d2d7e2772a3d60583f9}{truncate}(data, row, col)
105     count\_matrix = sp.csr\_matrix((data, (row, col)), shape=(args.hash\_size, len(cands)))
106     count\_matrix.sum\_duplicates()
107     \textcolor{keywordflow}{return} count\_matrix
108 
109 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_af6a82e7b8a6efb75fb73be53b55a7787}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_af6a82e7b8a6efb75fb73be53b55a7787}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!live\+\_\+count\+\_\+matrix\+\_\+t@{live\+\_\+count\+\_\+matrix\+\_\+t}}
\index{live\+\_\+count\+\_\+matrix\+\_\+t@{live\+\_\+count\+\_\+matrix\+\_\+t}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{live\+\_\+count\+\_\+matrix\+\_\+t()}{live\_count\_matrix\_t()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+live\+\_\+count\+\_\+matrix\+\_\+t (\begin{DoxyParamCaption}\item[{}]{args,  }\item[{}]{cands }\end{DoxyParamCaption})}



Definition at line 110 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
110 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_af6a82e7b8a6efb75fb73be53b55a7787}{live\_count\_matrix\_t}(args, cands):
111     \textcolor{keyword}{global} PROCESS\_TOK
112     \textcolor{keywordflow}{if} PROCESS\_TOK \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
113         PROCESS\_TOK = tokenizers.get\_class(args.tokenizer)()
114     row, col, data = [], [], []
115     \textcolor{keywordflow}{for} i, c \textcolor{keywordflow}{in} enumerate(cands):
116         cur\_row, cur\_col, cur\_data = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a76bae1c966a21d123cb91949d6c8ec20}{count\_text}(args.ngram, args.hash\_size, i, c)
117         row += cur\_row
118         col += cur\_col
119         data += cur\_data
120 
121     count\_matrix = torch.sparse.FloatTensor(
122         torch.LongTensor([row, col]),
123         torch.FloatTensor(data),
124         torch.Size([args.hash\_size, len(cands)]),
125     ).coalesce()
126     \textcolor{keywordflow}{return} count\_matrix
127 
128 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0d8cca9dbdf0fa23d25e81ec2a96b347}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0d8cca9dbdf0fa23d25e81ec2a96b347}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!run@{run}}
\index{run@{run}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{run()}{run()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+run (\begin{DoxyParamCaption}\item[{}]{args }\end{DoxyParamCaption})}



Definition at line 310 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
310 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0d8cca9dbdf0fa23d25e81ec2a96b347}{run}(args):
311     \textcolor{comment}{# ParlAI version of run method, modified slightly}
312     logger.info(\textcolor{stringliteral}{'Counting words...'})
313     count\_matrix = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0d95180be94e232e3ebc748c8aa7b9a0}{get\_count\_matrix}(args, \{\textcolor{stringliteral}{'db\_path'}: args.db\_path\})
314 
315     logger.info(\textcolor{stringliteral}{'Making tfidf vectors...'})
316     tfidf = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_acce651a5b40c5a3b4009181f22c69eaa}{get\_tfidf\_matrix}(count\_matrix)
317 
318     logger.info(\textcolor{stringliteral}{'Getting word-doc frequencies...'})
319     freqs = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac6883ed21006848661f6c748f91aff56}{get\_doc\_freqs}(count\_matrix)
320 
321     filename = args.out\_dir
322 
323     logger.info(\textcolor{stringliteral}{'Saving to %s'} % filename)
324     metadata = \{
325         \textcolor{stringliteral}{'doc\_freqs'}: freqs,
326         \textcolor{stringliteral}{'tokenizer'}: args.tokenizer,
327         \textcolor{stringliteral}{'hash\_size'}: args.hash\_size,
328         \textcolor{stringliteral}{'ngram'}: args.ngram,
329     \}
330 
331     utils.save\_sparse\_csr(filename, tfidf, metadata)
332 
333 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a89650718966a5b0d1114e8b06b8c0dcc}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a89650718966a5b0d1114e8b06b8c0dcc}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!sparse\+\_\+log1p@{sparse\+\_\+log1p}}
\index{sparse\+\_\+log1p@{sparse\+\_\+log1p}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{sparse\+\_\+log1p()}{sparse\_log1p()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+sparse\+\_\+log1p (\begin{DoxyParamCaption}\item[{}]{sparse\+\_\+t }\end{DoxyParamCaption})}



Definition at line 87 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
87 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a89650718966a5b0d1114e8b06b8c0dcc}{sparse\_log1p}(sparse\_t):
88     t = sparse\_t.coalesce()
89     t.\_values().log1p\_()
90     \textcolor{keywordflow}{return} t
91 
92 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a7ec5dffcb27b7ce23ea0a0e37ef2398d}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a7ec5dffcb27b7ce23ea0a0e37ef2398d}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!sparse\+\_\+nonzero@{sparse\+\_\+nonzero}}
\index{sparse\+\_\+nonzero@{sparse\+\_\+nonzero}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{sparse\+\_\+nonzero()}{sparse\_nonzero()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+sparse\+\_\+nonzero (\begin{DoxyParamCaption}\item[{}]{sparse\+\_\+t }\end{DoxyParamCaption})}



Definition at line 79 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
79 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a7ec5dffcb27b7ce23ea0a0e37ef2398d}{sparse\_nonzero}(sparse\_t):
80     \textcolor{keywordflow}{return} sparse\_t.coalesce().\_indices()
81 
82 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8852c505db2852b5e39be3468a9c1733}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8852c505db2852b5e39be3468a9c1733}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!sparse\+\_\+sum@{sparse\+\_\+sum}}
\index{sparse\+\_\+sum@{sparse\+\_\+sum}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{sparse\+\_\+sum()}{sparse\_sum()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+sparse\+\_\+sum (\begin{DoxyParamCaption}\item[{}]{sparse\+\_\+t }\end{DoxyParamCaption})}



Definition at line 83 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
83 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8852c505db2852b5e39be3468a9c1733}{sparse\_sum}(sparse\_t):
84     \textcolor{keywordflow}{return} sparse\_t.\_values().sum()
85 
86 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a1fdb457e98eb4e4c26047e229686a616}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a1fdb457e98eb4e4c26047e229686a616}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!tokenize@{tokenize}}
\index{tokenize@{tokenize}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{tokenize()}{tokenize()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+tokenize (\begin{DoxyParamCaption}\item[{}]{text }\end{DoxyParamCaption})}



Definition at line 52 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
52 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a1fdb457e98eb4e4c26047e229686a616}{tokenize}(text):
53     \textcolor{keyword}{global} PROCESS\_TOK
54     \textcolor{keywordflow}{return} PROCESS\_TOK.tokenize(text)
55 
56 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a5bd546d494142d2d7e2772a3d60583f9}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a5bd546d494142d2d7e2772a3d60583f9}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!truncate@{truncate}}
\index{truncate@{truncate}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{truncate()}{truncate()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+truncate (\begin{DoxyParamCaption}\item[{}]{data,  }\item[{}]{row,  }\item[{}]{col }\end{DoxyParamCaption})}



Definition at line 64 of file build\+\_\+tfidf.\+py.


\begin{DoxyCode}
64 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a5bd546d494142d2d7e2772a3d60583f9}{truncate}(data, row, col):
65     \textcolor{keyword}{global} MAX\_SZ
66     \textcolor{keywordflow}{if} len(data) > MAX\_SZ:
67         over = len(data) - MAX\_SZ
68         pct = over / len(data)
69         logger.info(
70             \textcolor{stringliteral}{'Data size is too large for scipy to index all of it. '}
71             \textcolor{stringliteral}{'Throwing out \{\} entries (\{\}%% of data).'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(over, pct)
72         )
73         data = data[:MAX\_SZ]
74         row = row[:MAX\_SZ]
75         col = col[:MAX\_SZ]
76     \textcolor{keywordflow}{return} data, row, col
77 
78 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_aa48318cbcc3882ee8fe371c672cbf941}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_aa48318cbcc3882ee8fe371c672cbf941}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!args@{args}}
\index{args@{args}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{args}{args}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+args = parser.\+parse\+\_\+args()}



Definition at line 370 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0a314a0288fcdf731f21e279e9f7b27a}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0a314a0288fcdf731f21e279e9f7b27a}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!basename@{basename}}
\index{basename@{basename}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{basename}{basename}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+basename = os.\+path.\+splitext(os.\+path.\+basename(args.\+db\+\_\+path))\mbox{[}0\mbox{]}}



Definition at line 381 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_afe20f2925824bab82a89672734347544}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_afe20f2925824bab82a89672734347544}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!count\+\_\+matrix@{count\+\_\+matrix}}
\index{count\+\_\+matrix@{count\+\_\+matrix}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{count\+\_\+matrix}{count\_matrix}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+count\+\_\+matrix}



Definition at line 373 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a188ab17adbcc529b664e05f836f42918}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a188ab17adbcc529b664e05f836f42918}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!default@{default}}
\index{default@{default}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{default}{default}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+default}



Definition at line 340 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a09c3915a9ffe251347f232647caff959}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a09c3915a9ffe251347f232647caff959}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!doc\+\_\+dict@{doc\+\_\+dict}}
\index{doc\+\_\+dict@{doc\+\_\+dict}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{doc\+\_\+dict}{doc\_dict}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+doc\+\_\+dict}



Definition at line 373 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_afcbd4a0d6b9f9e9d88008c66912778cf}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_afcbd4a0d6b9f9e9d88008c66912778cf}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!filename@{filename}}
\index{filename@{filename}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{filename}{filename}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+filename = os.\+path.\+join(args.\+out\+\_\+dir, \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0a314a0288fcdf731f21e279e9f7b27a}{basename})}



Definition at line 387 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8dc725902934e0c460f5a82fa332c521}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a8dc725902934e0c460f5a82fa332c521}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!fmt@{fmt}}
\index{fmt@{fmt}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{fmt}{fmt}}
{\footnotesize\ttfamily string parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+fmt = \textquotesingle{}\%(asctime)s\+: \mbox{[} \%(message)s \mbox{]}\textquotesingle{}}



Definition at line 29 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_abb3607652abdd76d57a6ae90e19e3828}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_abb3607652abdd76d57a6ae90e19e3828}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!freqs@{freqs}}
\index{freqs@{freqs}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{freqs}{freqs}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+freqs = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ac6883ed21006848661f6c748f91aff56}{get\+\_\+doc\+\_\+freqs}(\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_afe20f2925824bab82a89672734347544}{count\+\_\+matrix})}



Definition at line 379 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0e12682c80997535ca4f7f293b8c6d10}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a0e12682c80997535ca4f7f293b8c6d10}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!help@{help}}
\index{help@{help}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{help}{help}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+help}



Definition at line 341 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ae004cad36f1e393ce6c158058a526eeb}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ae004cad36f1e393ce6c158058a526eeb}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!M\+A\+X\+\_\+\+SZ@{M\+A\+X\+\_\+\+SZ}}
\index{M\+A\+X\+\_\+\+SZ@{M\+A\+X\+\_\+\+SZ}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{M\+A\+X\+\_\+\+SZ}{MAX\_SZ}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+M\+A\+X\+\_\+\+SZ = int(math.\+pow(2, 30) $\ast$ 1.\+8)}



Definition at line 57 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a78c951c63ece0474919ceef5d15d7e5d}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a78c951c63ece0474919ceef5d15d7e5d}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!metadata@{metadata}}
\index{metadata@{metadata}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{metadata}{metadata}}
{\footnotesize\ttfamily dictionary parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+metadata}

{\bfseries Initial value\+:}
\begin{DoxyCode}
1 =  \{
2         \textcolor{stringliteral}{'doc\_freqs'}: freqs,
3         \textcolor{stringliteral}{'tokenizer'}: args.tokenizer,
4         \textcolor{stringliteral}{'hash\_size'}: args.hash\_size,
5         \textcolor{stringliteral}{'ngram'}: args.ngram,
6         \textcolor{stringliteral}{'doc\_dict'}: doc\_dict,
7     \}
\end{DoxyCode}


Definition at line 390 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad50f77b70c0e27d3304395c58e9212c4}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad50f77b70c0e27d3304395c58e9212c4}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!None@{None}}
\index{None@{None}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{None}{None}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+None}



Definition at line 344 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a21ca3f18c69cd5e11f4f9ec6505e0a24}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a21ca3f18c69cd5e11f4f9ec6505e0a24}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!parser@{parser}}
\index{parser@{parser}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{parser}{parser}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+parser = argparse.\+Argument\+Parser()}



Definition at line 336 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a27ac3f448b895f9daae56e01bbf1be70}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a27ac3f448b895f9daae56e01bbf1be70}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!P\+R\+O\+C\+E\+S\+S\+\_\+\+DB@{P\+R\+O\+C\+E\+S\+S\+\_\+\+DB}}
\index{P\+R\+O\+C\+E\+S\+S\+\_\+\+DB@{P\+R\+O\+C\+E\+S\+S\+\_\+\+DB}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{P\+R\+O\+C\+E\+S\+S\+\_\+\+DB}{PROCESS\_DB}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+P\+R\+O\+C\+E\+S\+S\+\_\+\+DB = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad50f77b70c0e27d3304395c58e9212c4}{None}}



Definition at line 36 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ae5c3818e71ddea3c79328d8a4c423047}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ae5c3818e71ddea3c79328d8a4c423047}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!P\+R\+O\+C\+E\+S\+S\+\_\+\+T\+OK@{P\+R\+O\+C\+E\+S\+S\+\_\+\+T\+OK}}
\index{P\+R\+O\+C\+E\+S\+S\+\_\+\+T\+OK@{P\+R\+O\+C\+E\+S\+S\+\_\+\+T\+OK}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{P\+R\+O\+C\+E\+S\+S\+\_\+\+T\+OK}{PROCESS\_TOK}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+P\+R\+O\+C\+E\+S\+S\+\_\+\+T\+OK = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad50f77b70c0e27d3304395c58e9212c4}{None}}



Definition at line 35 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a213e3a3970a4f1423c2cc41e5f31295e}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a213e3a3970a4f1423c2cc41e5f31295e}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!str@{str}}
\index{str@{str}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{str}{str}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+str}



Definition at line 344 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a60001be3ae4369767886e45fa5937e55}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_a60001be3ae4369767886e45fa5937e55}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!tfidf@{tfidf}}
\index{tfidf@{tfidf}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{tfidf}{tfidf}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+tfidf = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_acce651a5b40c5a3b4009181f22c69eaa}{get\+\_\+tfidf\+\_\+matrix}(\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_afe20f2925824bab82a89672734347544}{count\+\_\+matrix})}



Definition at line 376 of file build\+\_\+tfidf.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}!type@{type}}
\index{type@{type}!parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf@{parlai\+::agents\+::tfidf\+\_\+retriever\+::build\+\_\+tfidf}}
\subsubsection{\texorpdfstring{type}{type}}
{\footnotesize\ttfamily parlai.\+agents.\+tfidf\+\_\+retriever.\+build\+\_\+tfidf.\+type}



Definition at line 339 of file build\+\_\+tfidf.\+py.

