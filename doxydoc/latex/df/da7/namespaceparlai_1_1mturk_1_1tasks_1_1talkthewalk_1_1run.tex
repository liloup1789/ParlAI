\hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1talkthewalk_1_1run}{}\section{parlai.\+mturk.\+tasks.\+talkthewalk.\+run Namespace Reference}
\label{namespaceparlai_1_1mturk_1_1tasks_1_1talkthewalk_1_1run}\index{parlai.\+mturk.\+tasks.\+talkthewalk.\+run@{parlai.\+mturk.\+tasks.\+talkthewalk.\+run}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1talkthewalk_1_1run_aa3dad7cff29347fafebfb3c91efee8cd}{main} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1talkthewalk_1_1run_aa3dad7cff29347fafebfb3c91efee8cd}\label{namespaceparlai_1_1mturk_1_1tasks_1_1talkthewalk_1_1run_aa3dad7cff29347fafebfb3c91efee8cd}} 
\index{parlai\+::mturk\+::tasks\+::talkthewalk\+::run@{parlai\+::mturk\+::tasks\+::talkthewalk\+::run}!main@{main}}
\index{main@{main}!parlai\+::mturk\+::tasks\+::talkthewalk\+::run@{parlai\+::mturk\+::tasks\+::talkthewalk\+::run}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+talkthewalk.\+run.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 22 of file run.\+py.


\begin{DoxyCode}
22 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run_ad3ab2c71f8083c3112815c0b363d316b}{main}():
23     argparser = ParlaiParser(\textcolor{keyword}{False}, \textcolor{keyword}{False})
24     argparser.add\_parlai\_data\_path()
25     argparser.add\_mturk\_args()
26     argparser.add\_argument(
27         \textcolor{stringliteral}{'--replay'}, action=\textcolor{stringliteral}{'store\_true'}, help=\textcolor{stringliteral}{'Set to replay old interactions'}
28     )
29     argparser.add\_argument(
30         \textcolor{stringliteral}{'--replay-log-file'},
31         type=str,
32         default=\textcolor{stringliteral}{''},
33         help=\textcolor{stringliteral}{'location of log to use if replay'},
34     )
35     argparser.add\_argument(
36         \textcolor{stringliteral}{'--real-time'}, action=\textcolor{stringliteral}{'store\_true'}, help=\textcolor{stringliteral}{'Set to replay in real time '}
37     )
38     argparser.add\_argument(
39         \textcolor{stringliteral}{'--replay-bot'},
40         action=\textcolor{stringliteral}{'store\_true'},
41         help=\textcolor{stringliteral}{'Set to replay bot actions instead of human'},
42     )
43     argparser.add\_argument(
44         \textcolor{stringliteral}{'--model-file'}, type=str, default=\textcolor{stringliteral}{''}, help=\textcolor{stringliteral}{'language generator model file'}
45     )
46     argparser.add\_argument(
47         \textcolor{stringliteral}{'--world-idx'}, type=int, default=-1, help=\textcolor{stringliteral}{'specify world to load'}
48     )
49     argparser.add\_argument(
50         \textcolor{stringliteral}{'--start-idx'},
51         type=int,
52         default=0,
53         help=\textcolor{stringliteral}{'where to start replay, if replaying actions'},
54     )
55     argparser.add\_argument(
56         \textcolor{stringliteral}{'--bot-type'},
57         type=str,
58         default=\textcolor{stringliteral}{'discrete'},
59         choices=[\textcolor{stringliteral}{'discrete'}, \textcolor{stringliteral}{'natural'}],
60         help=\textcolor{stringliteral}{'which bot log to use'},
61     )
62     opt = argparser.parse\_args()
63     opt.update(task\_config)
64 
65     mturk\_agent\_1\_id = \textcolor{stringliteral}{'Tourist'}
66     mturk\_agent\_2\_id = \textcolor{stringliteral}{'Guide'}
67     mturk\_agent\_ids = [mturk\_agent\_1\_id, mturk\_agent\_2\_id]
68     task\_directory\_path = os.path.dirname(os.path.abspath(\_\_file\_\_))
69     opt[\textcolor{stringliteral}{'task'}] = os.path.basename(task\_directory\_path)
70     opt[\textcolor{stringliteral}{'data\_path'}] = os.getcwd() + \textcolor{stringliteral}{'/data/'} + opt[\textcolor{stringliteral}{'task'}]
71     mturk\_manager = MTurkManager(opt=opt, mturk\_agent\_ids=mturk\_agent\_ids)
72     mturk\_manager.setup\_server(task\_directory\_path=task\_directory\_path)
73 
74     \textcolor{keywordflow}{try}:
75         mturk\_manager.start\_new\_run()
76         mturk\_manager.create\_hits()
77 
78         \textcolor{keyword}{def }run\_onboard(worker):
79             world = InstructionWorld(opt=opt, mturk\_agent=worker)
80             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world.episode\_done():
81                 world.parley()
82                 world.shutdown()
83 
84         mturk\_manager.set\_onboard\_function(onboard\_function=run\_onboard)
85         mturk\_manager.ready\_to\_accept\_workers()
86 
87         \textcolor{keyword}{def }check\_worker\_eligibility(worker):
88             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
89 
90         \textcolor{keyword}{global} worker\_count
91         worker\_count = 0
92 
93         \textcolor{keyword}{def }assign\_worker\_roles(workers):
94             workers[0].id = mturk\_agent\_ids[0]
95             workers[1].id = mturk\_agent\_ids[1]
96             \textcolor{keywordflow}{return} [workers[0], workers[1]]
97 
98         \textcolor{keyword}{def }run\_conversation(mturk\_manager, opt, workers):
99             \textcolor{comment}{# Create mturk agents}
100             mturk\_agent\_1 = workers[0]
101             mturk\_agent\_2 = workers[1]
102             conv\_idx = mturk\_manager.conversation\_index
103             world = TalkTheWalkWorld(
104                 opt=opt, agents=[mturk\_agent\_1, mturk\_agent\_2], world\_tag=conv\_idx
105             )
106 
107             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world.episode\_done():
108                 world.parley()
109             world.shutdown()
110             world.review\_work()
111             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} opt.get(\textcolor{stringliteral}{'replay'}):
112                 world.save()
113 
114         mturk\_manager.start\_task(
115             eligibility\_function=check\_worker\_eligibility,
116             assign\_role\_function=assign\_worker\_roles,
117             task\_function=run\_conversation,
118         )
119     \textcolor{keywordflow}{except} Exception:
120         \textcolor{keywordflow}{raise}
121     \textcolor{keywordflow}{finally}:
122         mturk\_manager.expire\_all\_unassigned\_hits()
123         mturk\_manager.shutdown()
124 
125 
\end{DoxyCode}
