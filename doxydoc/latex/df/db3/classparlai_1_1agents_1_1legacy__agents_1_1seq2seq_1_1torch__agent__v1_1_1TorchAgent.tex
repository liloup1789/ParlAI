\hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent}{}\section{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent Class Reference}
\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent}\index{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent@{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent}}


Inheritance diagram for parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=226pt]{d3/daf/classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=202pt]{d2/da6/classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a00701a40d62943dbd887525bf8e8002d}{add\+\_\+cmdline\+\_\+args} (cls, argparser)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a1c4eb91757ee23e75edfa957d05db338}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a4e938a91873bd6edde0ac7ed5299bc6a}{opt}, shared=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a1727b17db185dcc7237d893018c7b76c}{init\+\_\+optim} (self, params, optim\+\_\+states=None, saved\+\_\+optim\+\_\+type=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_af97699a6b03a17969830db378f09cac4}{receive\+\_\+metrics} (self, metrics\+\_\+dict)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a3d922c4a8452c9e44fa2478e6fecdfd1}{share} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a866838e1c81063a3ec18c5609e029f90}{vectorize} (self, obs, add\+\_\+start=True, add\+\_\+end=True, \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ac0286e4dbf6dc71bda0c364851de5f22}{truncate}=None, split\+\_\+lines=False)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ab8b2fa26aabfd9d7e7abb0abbcfe8044}{batchify} (self, obs\+\_\+batch, sort=False, is\+\_\+valid=lambda obs\+:\textquotesingle{}text\+\_\+vec\textquotesingle{} in obs or \textquotesingle{}image\textquotesingle{} in obs)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_acac419cfad0fc5988e7e796c244f3a9f}{match\+\_\+batch} (self, batch\+\_\+reply, valid\+\_\+inds, output=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a8984452b8b4e6194625530aeae49b243}{get\+\_\+dialog\+\_\+history} (self, \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a04fa334c086cf9afa815a44f1948e625}{observation}, reply=None, \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a81f970d715f2525ad342330a28703c5c}{add\+\_\+person\+\_\+tokens}=False, add\+\_\+p1\+\_\+after\+\_\+newln=False)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_abf7a50ea0eb319737123d2e46fde4c0f}{last\+\_\+reply} (self, use\+\_\+label=True)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ae4b2346c35e214a8028eb83d1fc5ffd7}{reply\+\_\+history} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a0eb23a78aea413ae4f90ce0628179920}{observe} (self, \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a04fa334c086cf9afa815a44f1948e625}{observation})
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a4a01defa1d669571f574fcfe021776a8}{save} (self, path=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a6d71ad7997e048e4f4f7d957fae64ac5}{load} (self, path)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a93e935c0d2d589d8990ff14d6e528c4d}{reset} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a3ab251071823f34358a569c1c2a11bf9}{act} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_af3929c1bedc50a48dcf8d1184321f4f5}{batch\+\_\+act} (self, observations)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aff9cc5c105bbf154075aa83e288582ca}{train\+\_\+step} (self, batch)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a801f2b9a359201fd0a395ab61fd61806}{eval\+\_\+step} (self, batch)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_abc77ad96264e7597c46bc001a9a6af90}{dictionary\+\_\+class} ()
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a91d101db75d3618e8240a44b258f3129}{replies}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_afa0def82ae9760fde7f60c0881b8a138}{dict}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a4e938a91873bd6edde0ac7ed5299bc6a}{opt}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aa8efd385be7532abd27359b5dbbbbb24}{use\+\_\+cuda}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a60d1038c25746d97d791b82a5c8e0492}{id}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aaed187f97f489122996e967206a01927}{E\+M\+P\+TY}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a6e6a5f2f7644a6cc273bfa25eca17df6}{N\+U\+L\+L\+\_\+\+I\+DX}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a37d6429a766547a68f72ffb6c27783db}{S\+T\+A\+R\+T\+\_\+\+I\+DX}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aa78932aa1b5886cd03f1592bfa6ed4f5}{E\+N\+D\+\_\+\+I\+DX}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a2f9045fdfe9f956ee5023de84dd25a06}{random}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a31b5e2e435a70f40ce155dabe831d41c}{batch\+\_\+idx}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_add94f2eee8d2a4aba14869587e9dd4d3}{histsz}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a858bd7d01a3d6298f2e2f72efcf73953}{history}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ac0286e4dbf6dc71bda0c364851de5f22}{truncate}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ab768649f4b4a30eb9a75fedde5a9935f}{rank\+\_\+candidates}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a81f970d715f2525ad342330a28703c5c}{add\+\_\+person\+\_\+tokens}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a99254a4351798f66797e0a5a8ff855d5}{clip}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a2524bfb4b01626290e6fa26be52f2a80}{optimizer}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aea16ae8f9536959afd6e7434d418a719}{scheduler}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a3f1da649c485f406076be7bf84b2d4ee}{proj\+\_\+rp}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a04fa334c086cf9afa815a44f1948e625}{observation}
\end{DoxyCompactItemize}
\subsection*{Static Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a57acf9a56d383f7257fd7f4b0ce21537}{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ad167df27f0b63077bf1d43e75c20301e}{P1\+\_\+\+T\+O\+K\+EN}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a002618d2202fb2dd61283f0a2b612a4c}{P2\+\_\+\+T\+O\+K\+EN}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}A provided base agent for any model that wants to use Torch.

Exists to make it easier to implement a new agent.
Not necessary, but reduces duplicated code.

Many methods are intended to be either used as is when the default is
acceptable, or to be overriden and called with super(), with the extra
functionality added to the initial result. See the method comment for
recommended behavior.

This agent serves as a common framework for all ParlAI models which want
to use PyTorch.
\end{DoxyVerb}
\begin{DoxyVerb}Utility mapping of simple names to optimizers.

For example:
'adagrad': optim.Adagrad, 'adam': optim.Adad, 'sgd': optim.SGD
\end{DoxyVerb}
 

Definition at line 111 of file torch\+\_\+agent\+\_\+v1.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a1c4eb91757ee23e75edfa957d05db338}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a1c4eb91757ee23e75edfa957d05db338}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Initialize agent.
\end{DoxyVerb}
 

Definition at line 286 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
286     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
287         \textcolor{stringliteral}{"""}
288 \textcolor{stringliteral}{        Initialize agent.}
289 \textcolor{stringliteral}{        """}
290         super().\_\_init\_\_(opt, shared)
291         opt = self.opt
292 
293         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} shared:
294             \textcolor{comment}{# intitialize any important structures from scratch}
295             self.replies = \{\}  \textcolor{comment}{# past replies}
296             self.dict = self.dictionary\_class()(opt)
297             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'person\_tokens'}):
298                 self.dict[self.P1\_TOKEN] = 999999999
299                 self.dict[self.P2\_TOKEN] = 999999998
300         \textcolor{keywordflow}{else}:
301             \textcolor{comment}{# copy initialized data from shared table}
302             self.opt = shared[\textcolor{stringliteral}{'opt'}]
303             self.dict = shared[\textcolor{stringliteral}{'dict'}]
304             self.replies = shared[\textcolor{stringliteral}{'replies'}]
305 
306         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'numthreads'}, 1) > 1:
307             torch.set\_num\_threads(1)
308 
309         \textcolor{comment}{# check for cuda}
310         self.use\_cuda = \textcolor{keywordflow}{not} opt[\textcolor{stringliteral}{'no\_cuda'}] \textcolor{keywordflow}{and} torch.cuda.is\_available()
311         \textcolor{keywordflow}{if} self.use\_cuda:
312             \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'multigpu'}] \textcolor{keywordflow}{and} opt[\textcolor{stringliteral}{'gpu'}] != -1:
313                 \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Can't use --multigpu and --gpu together."})
314             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} shared:
315                 print(\textcolor{stringliteral}{'[ Using CUDA ]'})
316             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} shared \textcolor{keywordflow}{and} opt[\textcolor{stringliteral}{'gpu'}] != -1:
317                 torch.cuda.set\_device(opt[\textcolor{stringliteral}{'gpu'}])
318             \textcolor{comment}{# It's up to the user of TorchAgent to handle multiple GPU issues.}
319             \textcolor{comment}{# A typical approach would be to employ nn.DataParallel}
320             \textcolor{comment}{# (https://pytorch.org/docs/0.4.1/nn.html?highlight=dataparallel#torch.nn.DataParallel)}
321 
322         \textcolor{comment}{# now set up any fields that all instances may need}
323         self.id = \textcolor{stringliteral}{'TorchAgent'}  \textcolor{comment}{# child can override}
324         self.EMPTY = torch.LongTensor([])
325         self.NULL\_IDX = self.dict[self.dict.null\_token]
326         self.START\_IDX = self.dict[self.dict.start\_token]
327         self.END\_IDX = self.dict[self.dict.end\_token]
328 
329         self.random = random.Random(42)  \textcolor{comment}{# fixed random seed}
330         \textcolor{comment}{# which row in the batch this instance is}
331         self.batch\_idx = shared \textcolor{keywordflow}{and} shared.get(\textcolor{stringliteral}{'batchindex'}) \textcolor{keywordflow}{or} 0
332         \textcolor{comment}{# can remember as few as zero utterances if desired}
333         self.histsz = opt[\textcolor{stringliteral}{'history\_size'}] \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'history\_size'}] >= 0 \textcolor{keywordflow}{else} \textcolor{keywordtype}{None}
334         \textcolor{comment}{# stores up to hist\_utt past observations within current dialog}
335         self.history = deque(maxlen=self.histsz)
336         \textcolor{comment}{# truncate == 0 might give funny behavior}
337         self.truncate = opt[\textcolor{stringliteral}{'truncate'}] \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'truncate'}] >= 0 \textcolor{keywordflow}{else} \textcolor{keywordtype}{None}
338         self.rank\_candidates = opt[\textcolor{stringliteral}{'rank\_candidates'}]
339         self.add\_person\_tokens = opt.get(\textcolor{stringliteral}{'person\_tokens'}, \textcolor{keyword}{False})
340 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a3ab251071823f34358a569c1c2a11bf9}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a3ab251071823f34358a569c1c2a11bf9}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!act@{act}}
\index{act@{act}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{act()}{act()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+act (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Call batch_act with the singleton batch.
\end{DoxyVerb}
 

Definition at line 1019 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
1019     \textcolor{keyword}{def }act(self):
1020         \textcolor{stringliteral}{"""}
1021 \textcolor{stringliteral}{        Call batch\_act with the singleton batch.}
1022 \textcolor{stringliteral}{        """}
1023         \textcolor{keywordflow}{return} self.batch\_act([self.observation])[0]
1024 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a00701a40d62943dbd887525bf8e8002d}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a00701a40d62943dbd887525bf8e8002d}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}}
\index{add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+cmdline\+\_\+args()}{add\_cmdline\_args()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+add\+\_\+cmdline\+\_\+args (\begin{DoxyParamCaption}\item[{}]{cls,  }\item[{}]{argparser }\end{DoxyParamCaption})}

\begin{DoxyVerb}Add the default commandline args we expect most agents to want.
\end{DoxyVerb}
 

Definition at line 151 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
151     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(cls, argparser):
152         \textcolor{stringliteral}{"""}
153 \textcolor{stringliteral}{        Add the default commandline args we expect most agents to want.}
154 \textcolor{stringliteral}{        """}
155         agent = argparser.add\_argument\_group(\textcolor{stringliteral}{'TorchAgent Arguments'})
156         \textcolor{comment}{# pretrained embedding arguments}
157         agent.add\_argument(
158             \textcolor{stringliteral}{'-emb'},
159             \textcolor{stringliteral}{'--embedding-type'},
160             default=\textcolor{stringliteral}{'random'},
161             choices=[
162                 \textcolor{stringliteral}{'random'},
163                 \textcolor{stringliteral}{'glove'},
164                 \textcolor{stringliteral}{'glove-fixed'},
165                 \textcolor{stringliteral}{'glove-twitter-fixed'},
166                 \textcolor{stringliteral}{'fasttext'},
167                 \textcolor{stringliteral}{'fasttext-fixed'},
168                 \textcolor{stringliteral}{'fasttext\_cc'},
169                 \textcolor{stringliteral}{'fasttext\_cc-fixed'},
170             ],
171             help=\textcolor{stringliteral}{'Choose between different strategies for initializing word '}
172             \textcolor{stringliteral}{'embeddings. Default is random, but can also preinitialize '}
173             \textcolor{stringliteral}{'from Glove or Fasttext. Preinitialized embeddings can also '}
174             \textcolor{stringliteral}{'be fixed so they are not updated during training.'},
175         )
176         agent.add\_argument(
177             \textcolor{stringliteral}{'-embp'},
178             \textcolor{stringliteral}{'--embedding-projection'},
179             default=\textcolor{stringliteral}{'random'},
180             help=\textcolor{stringliteral}{'If pretrained embeddings have a different dimensionality '}
181             \textcolor{stringliteral}{'than your embedding size, strategy for projecting to the '}
182             \textcolor{stringliteral}{'correct size. If the dimensions are the same, this is '}
183             \textcolor{stringliteral}{'ignored unless you append "-force" to your choice.'},
184         )
185         \textcolor{comment}{# optimizer arguments}
186         agent.add\_argument(
187             \textcolor{stringliteral}{'-opt'},
188             \textcolor{stringliteral}{'--optimizer'},
189             default=\textcolor{stringliteral}{'sgd'},
190             choices=cls.OPTIM\_OPTS,
191             help=\textcolor{stringliteral}{'Choose between pytorch optimizers. Any member of torch.optim'}
192             \textcolor{stringliteral}{' should be valid.'},
193         )
194         agent.add\_argument(
195             \textcolor{stringliteral}{'-lr'}, \textcolor{stringliteral}{'--learningrate'}, type=float, default=1, help=\textcolor{stringliteral}{'learning rate'}
196         )
197         agent.add\_argument(
198             \textcolor{stringliteral}{'-clip'},
199             \textcolor{stringliteral}{'--gradient-clip'},
200             type=float,
201             default=0.1,
202             help=\textcolor{stringliteral}{'gradient clipping using l2 norm'},
203         )
204         agent.add\_argument(
205             \textcolor{stringliteral}{'-mom'},
206             \textcolor{stringliteral}{'--momentum'},
207             default=0,
208             type=float,
209             help=\textcolor{stringliteral}{'if applicable, momentum value for optimizer.'},
210         )
211         \textcolor{comment}{# preprocessing arguments}
212         agent.add\_argument(
213             \textcolor{stringliteral}{'-rc'},
214             \textcolor{stringliteral}{'--rank-candidates'},
215             type=\textcolor{stringliteral}{'bool'},
216             default=\textcolor{keyword}{False},
217             help=\textcolor{stringliteral}{'Whether the model should parse candidates for ranking.'},
218         )
219         agent.add\_argument(
220             \textcolor{stringliteral}{'-tr'},
221             \textcolor{stringliteral}{'--truncate'},
222             default=-1,
223             type=int,
224             help=\textcolor{stringliteral}{'Truncate input lengths to increase speed / use less memory.'},
225         )
226         agent.add\_argument(
227             \textcolor{stringliteral}{'-histsz'},
228             \textcolor{stringliteral}{'--history-size'},
229             default=-1,
230             type=int,
231             help=\textcolor{stringliteral}{'Number of past dialog utterances to remember.'},
232         )
233         agent.add\_argument(
234             \textcolor{stringliteral}{'-pt'},
235             \textcolor{stringliteral}{'--person-tokens'},
236             type=\textcolor{stringliteral}{'bool'},
237             default=\textcolor{keyword}{False},
238             help=\textcolor{stringliteral}{'add person tokens to history. adds \_\_p1\_\_ in front of input '}
239             \textcolor{stringliteral}{'text and \_\_p2\_\_ in front of past labels when available or '}
240             \textcolor{stringliteral}{'past utterances generated by the model. these are added to '}
241             \textcolor{stringliteral}{'the dictionary during initialization.'},
242         )
243         agent.add\_argument(
244             \textcolor{stringliteral}{'--use-reply'},
245             default=\textcolor{stringliteral}{'label'},
246             hidden=\textcolor{keyword}{True},
247             choices=[\textcolor{stringliteral}{'label'}, \textcolor{stringliteral}{'model'}],
248             help=\textcolor{stringliteral}{'Which previous replies to use as history. If label, use '}
249             \textcolor{stringliteral}{'gold dataset replies. If model, use model\(\backslash\)'s own replies.'},
250         )
251         agent.add\_argument(
252             \textcolor{stringliteral}{'--add-p1-after-newln'},
253             type=\textcolor{stringliteral}{'bool'},
254             default=\textcolor{keyword}{False},
255             hidden=\textcolor{keyword}{True},
256             help=\textcolor{stringliteral}{'Add the other speaker token before the last newline in the '}
257             \textcolor{stringliteral}{'input instead of at the beginning of the input. this is '}
258             \textcolor{stringliteral}{'useful for tasks that include some kind of context before '}
259             \textcolor{stringliteral}{'the actual utterance (e.g. squad, babi, personachat).'},
260         )
261         \textcolor{comment}{# GPU arguments}
262         \textcolor{comment}{# these gpu options are all mutually exclusive, and should error if the}
263         \textcolor{comment}{# user tries to present multiple of them}
264         gpugroup = agent.add\_mutually\_exclusive\_group()
265         gpugroup.add\_argument(
266             \textcolor{stringliteral}{'-gpu'}, \textcolor{stringliteral}{'--gpu'}, type=int, default=-1, help=\textcolor{stringliteral}{'which GPU to use'}
267         )
268         gpugroup.add\_argument(
269             \textcolor{stringliteral}{'--multigpu'},
270             type=\textcolor{stringliteral}{'bool'},
271             default=\textcolor{keyword}{False},
272             help=\textcolor{stringliteral}{'Suggest model should employ multiple GPUs. Not all models '}
273             \textcolor{stringliteral}{'respect this flag.'},
274         )
275         gpugroup.add\_argument(
276             \textcolor{stringliteral}{'--no-cuda'},
277             default=\textcolor{keyword}{False},
278             action=\textcolor{stringliteral}{'store\_true'},
279             dest=\textcolor{stringliteral}{'no\_cuda'},
280             help=\textcolor{stringliteral}{'disable GPUs even if available. otherwise, will use GPUs if '}
281             \textcolor{stringliteral}{'available on the device.'},
282         )
283 
284         cls.dictionary\_class().\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(argparser)
285 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_af3929c1bedc50a48dcf8d1184321f4f5}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_af3929c1bedc50a48dcf8d1184321f4f5}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!batch\+\_\+act@{batch\+\_\+act}}
\index{batch\+\_\+act@{batch\+\_\+act}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{batch\+\_\+act()}{batch\_act()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+batch\+\_\+act (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observations }\end{DoxyParamCaption})}

\begin{DoxyVerb}Process a batch of observations (batchsize list of message dicts).

These observations have been preprocessed by the observe method.

Subclasses can override this for special functionality, but if the
default behaviors are fine then just override the ``train_step`` and
``eval_step`` methods instead. The former is called when labels are
present in the observations batch; otherwise, the latter is called.
\end{DoxyVerb}
 

Definition at line 1025 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
1025     \textcolor{keyword}{def }batch\_act(self, observations):
1026         \textcolor{stringliteral}{"""}
1027 \textcolor{stringliteral}{        Process a batch of observations (batchsize list of message dicts).}
1028 \textcolor{stringliteral}{}
1029 \textcolor{stringliteral}{        These observations have been preprocessed by the observe method.}
1030 \textcolor{stringliteral}{}
1031 \textcolor{stringliteral}{        Subclasses can override this for special functionality, but if the}
1032 \textcolor{stringliteral}{        default behaviors are fine then just override the ``train\_step`` and}
1033 \textcolor{stringliteral}{        ``eval\_step`` methods instead. The former is called when labels are}
1034 \textcolor{stringliteral}{        present in the observations batch; otherwise, the latter is called.}
1035 \textcolor{stringliteral}{        """}
1036         batch\_size = len(observations)
1037         \textcolor{comment}{# initialize a list of replies with this agent's id}
1038         batch\_reply = [\{\textcolor{stringliteral}{'id'}: self.getID()\} \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(batch\_size)]
1039 
1040         \textcolor{comment}{# check if there are any labels available, if so we will train on them}
1041         is\_training = any(\textcolor{stringliteral}{'labels'} \textcolor{keywordflow}{in} obs \textcolor{keywordflow}{for} obs \textcolor{keywordflow}{in} observations)
1042 
1043         \textcolor{comment}{# create a batch from the vectors}
1044         batch = self.batchify(observations)
1045 
1046         \textcolor{keywordflow}{if} is\_training:
1047             output = self.train\_step(batch)
1048         \textcolor{keywordflow}{else}:
1049             output = self.eval\_step(batch)
1050 
1051         \textcolor{keywordflow}{if} output \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
1052             self.replies[\textcolor{stringliteral}{'batch\_reply'}] = \textcolor{keywordtype}{None}
1053             \textcolor{keywordflow}{return} batch\_reply
1054 
1055         self.match\_batch(batch\_reply, batch.valid\_indices, output)
1056         self.replies[\textcolor{stringliteral}{'batch\_reply'}] = batch\_reply
1057         self.\_save\_history(observations, batch\_reply)  \textcolor{comment}{# save model predictions}
1058 
1059         \textcolor{keywordflow}{return} batch\_reply
1060 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ab8b2fa26aabfd9d7e7abb0abbcfe8044}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ab8b2fa26aabfd9d7e7abb0abbcfe8044}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!batchify@{batchify}}
\index{batchify@{batchify}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{batchify()}{batchify()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+batchify (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{obs\+\_\+batch,  }\item[{}]{sort = {\ttfamily False},  }\item[{}]{is\+\_\+valid = {\ttfamily lambda~obs\+:~\textquotesingle{}text\+\_\+vec\textquotesingle{}~in~obs~or~\textquotesingle{}image\textquotesingle{}~in~obs} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create a batch of valid observations from an unchecked batch.

A valid observation is one that passes the lambda provided to the
function, which defaults to checking if the preprocessed 'text_vec'
field is present which would have been set by this agent's 'vectorize'
function.

Returns a namedtuple Batch. See original definition above for in-depth
explanation of each field.

If you want to include additonal fields in the batch, you can subclass
this function and return your own "Batch" namedtuple: copy the Batch
namedtuple at the top of this class, and then add whatever additional
fields that you want to be able to access. You can then call
super().batchify(...) to set up the original fields and then set up the
additional fields in your subclass and return that batch instead.

:param obs_batch: List of vectorized observations
:param sort:      Default False, orders the observations by length of
          vectors. Set to true when using
          torch.nn.utils.rnn.pack_padded_sequence.
          Uses the text vectors if available, otherwise uses
          the label vectors if available.
:param is_valid:  Function that checks if 'text_vec' is in the
          observation, determines if an observation is valid
\end{DoxyVerb}
 

Definition at line 693 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
693     ):
694         \textcolor{stringliteral}{"""}
695 \textcolor{stringliteral}{        Create a batch of valid observations from an unchecked batch.}
696 \textcolor{stringliteral}{}
697 \textcolor{stringliteral}{        A valid observation is one that passes the lambda provided to the}
698 \textcolor{stringliteral}{        function, which defaults to checking if the preprocessed 'text\_vec'}
699 \textcolor{stringliteral}{        field is present which would have been set by this agent's 'vectorize'}
700 \textcolor{stringliteral}{        function.}
701 \textcolor{stringliteral}{}
702 \textcolor{stringliteral}{        Returns a namedtuple Batch. See original definition above for in-depth}
703 \textcolor{stringliteral}{        explanation of each field.}
704 \textcolor{stringliteral}{}
705 \textcolor{stringliteral}{        If you want to include additonal fields in the batch, you can subclass}
706 \textcolor{stringliteral}{        this function and return your own "Batch" namedtuple: copy the Batch}
707 \textcolor{stringliteral}{        namedtuple at the top of this class, and then add whatever additional}
708 \textcolor{stringliteral}{        fields that you want to be able to access. You can then call}
709 \textcolor{stringliteral}{        super().batchify(...) to set up the original fields and then set up the}
710 \textcolor{stringliteral}{        additional fields in your subclass and return that batch instead.}
711 \textcolor{stringliteral}{}
712 \textcolor{stringliteral}{        :param obs\_batch: List of vectorized observations}
713 \textcolor{stringliteral}{        :param sort:      Default False, orders the observations by length of}
714 \textcolor{stringliteral}{                          vectors. Set to true when using}
715 \textcolor{stringliteral}{                          torch.nn.utils.rnn.pack\_padded\_sequence.}
716 \textcolor{stringliteral}{                          Uses the text vectors if available, otherwise uses}
717 \textcolor{stringliteral}{                          the label vectors if available.}
718 \textcolor{stringliteral}{        :param is\_valid:  Function that checks if 'text\_vec' is in the}
719 \textcolor{stringliteral}{                          observation, determines if an observation is valid}
720 \textcolor{stringliteral}{        """}
721         \textcolor{keywordflow}{if} len(obs\_batch) == 0:
722             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a74cfde390a2b9861179ac0fcd59da28c}{Batch}()
723 
724         valid\_obs = [(i, ex) \textcolor{keywordflow}{for} i, ex \textcolor{keywordflow}{in} enumerate(obs\_batch) \textcolor{keywordflow}{if} is\_valid(ex)]
725 
726         \textcolor{keywordflow}{if} len(valid\_obs) == 0:
727             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a74cfde390a2b9861179ac0fcd59da28c}{Batch}()
728 
729         valid\_inds, exs = zip(*valid\_obs)
730 
731         \textcolor{comment}{# TEXT}
732         xs, x\_lens = \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}
733         \textcolor{keywordflow}{if} any(\textcolor{stringliteral}{'text\_vec'} \textcolor{keywordflow}{in} ex \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs):
734             \_xs = [ex.get(\textcolor{stringliteral}{'text\_vec'}, self.EMPTY) \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
735             xs, x\_lens = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1_adb5a414ae439f14c54e8c760b91cc4c8}{padded\_tensor}(\_xs, self.NULL\_IDX, self.use\_cuda)
736             \textcolor{keywordflow}{if} sort:
737                 sort = \textcolor{keyword}{False}  \textcolor{comment}{# now we won't sort on labels}
738                 xs, x\_lens, valid\_inds, exs = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1_a1521e559b740f741ebb47b8755202bb2}{argsort}(
739                     x\_lens, xs, x\_lens, valid\_inds, exs, descending=\textcolor{keyword}{True}
740                 )
741 
742         \textcolor{comment}{# LABELS}
743         labels\_avail = any(\textcolor{stringliteral}{'labels\_vec'} \textcolor{keywordflow}{in} ex \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs)
744         some\_labels\_avail = labels\_avail \textcolor{keywordflow}{or} any(\textcolor{stringliteral}{'eval\_labels\_vec'} \textcolor{keywordflow}{in} ex \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs)
745 
746         ys, y\_lens, labels = \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}
747         \textcolor{keywordflow}{if} some\_labels\_avail:
748             field = \textcolor{stringliteral}{'labels'} \textcolor{keywordflow}{if} labels\_avail \textcolor{keywordflow}{else} \textcolor{stringliteral}{'eval\_labels'}
749 
750             label\_vecs = [ex.get(field + \textcolor{stringliteral}{'\_vec'}, self.EMPTY) \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
751             labels = [ex.get(field + \textcolor{stringliteral}{'\_choice'}) \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
752             y\_lens = [y.shape[0] \textcolor{keywordflow}{for} y \textcolor{keywordflow}{in} label\_vecs]
753 
754             ys, y\_lens = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1_adb5a414ae439f14c54e8c760b91cc4c8}{padded\_tensor}(label\_vecs, self.NULL\_IDX, self.use\_cuda)
755             \textcolor{keywordflow}{if} sort \textcolor{keywordflow}{and} xs \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
756                 ys, valid\_inds, label\_vecs, labels, y\_lens = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v1_a1521e559b740f741ebb47b8755202bb2}{argsort}(
757                     y\_lens, ys, valid\_inds, label\_vecs, labels, y\_lens, descending=\textcolor{keyword}{True}
758                 )
759 
760         \textcolor{comment}{# LABEL\_CANDIDATES}
761         cands, cand\_vecs = \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}
762         \textcolor{keywordflow}{if} any(\textcolor{stringliteral}{'label\_candidates\_vecs'} \textcolor{keywordflow}{in} ex \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs):
763             cands = [ex.get(\textcolor{stringliteral}{'label\_candidates'}, \textcolor{keywordtype}{None}) \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
764             cand\_vecs = [ex.get(\textcolor{stringliteral}{'label\_candidates\_vecs'}, \textcolor{keywordtype}{None}) \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
765 
766         \textcolor{comment}{# IMAGE}
767         imgs = \textcolor{keywordtype}{None}
768         \textcolor{keywordflow}{if} any(\textcolor{stringliteral}{'image'} \textcolor{keywordflow}{in} ex \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs):
769             imgs = [ex.get(\textcolor{stringliteral}{'image'}, \textcolor{keywordtype}{None}) \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
770 
771         \textcolor{comment}{# MEMORIES}
772         mems = \textcolor{keywordtype}{None}
773         \textcolor{keywordflow}{if} any(\textcolor{stringliteral}{'memory\_vecs'} \textcolor{keywordflow}{in} ex \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs):
774             mems = [ex.get(\textcolor{stringliteral}{'memory\_vecs'}, \textcolor{keywordtype}{None}) \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
775 
776         \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a74cfde390a2b9861179ac0fcd59da28c}{Batch}(
777             text\_vec=xs,
778             text\_lengths=x\_lens,
779             label\_vec=ys,
780             label\_lengths=y\_lens,
781             labels=labels,
782             valid\_indices=valid\_inds,
783             candidates=cands,
784             candidate\_vecs=cand\_vecs,
785             image=imgs,
786             memory\_vecs=mems,
787         )
788 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_abc77ad96264e7597c46bc001a9a6af90}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_abc77ad96264e7597c46bc001a9a6af90}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!dictionary\+\_\+class@{dictionary\+\_\+class}}
\index{dictionary\+\_\+class@{dictionary\+\_\+class}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{dictionary\+\_\+class()}{dictionary\_class()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+dictionary\+\_\+class (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\begin{DoxyVerb}Return the dictionary class that this agent expects to use.

Can be overriden if a more complex dictionary is required.
\end{DoxyVerb}
 

Definition at line 142 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
142     \textcolor{keyword}{def }dictionary\_class():
143         \textcolor{stringliteral}{"""}
144 \textcolor{stringliteral}{        Return the dictionary class that this agent expects to use.}
145 \textcolor{stringliteral}{}
146 \textcolor{stringliteral}{        Can be overriden if a more complex dictionary is required.}
147 \textcolor{stringliteral}{        """}
148         \textcolor{keywordflow}{return} DictionaryAgent
149 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a801f2b9a359201fd0a395ab61fd61806}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a801f2b9a359201fd0a395ab61fd61806}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!eval\+\_\+step@{eval\+\_\+step}}
\index{eval\+\_\+step@{eval\+\_\+step}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{eval\+\_\+step()}{eval\_step()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+eval\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}Process one batch but do not train on it.
\end{DoxyVerb}
 

Definition at line 1067 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
1067     \textcolor{keyword}{def }eval\_step(self, batch):
1068         \textcolor{stringliteral}{"""}
1069 \textcolor{stringliteral}{        Process one batch but do not train on it.}
1070 \textcolor{stringliteral}{        """}
1071         \textcolor{keywordflow}{raise} NotImplementedError(\textcolor{stringliteral}{'Abstract class: user must implement eval\_step'})
1072 
1073 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a8984452b8b4e6194625530aeae49b243}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a8984452b8b4e6194625530aeae49b243}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!get\+\_\+dialog\+\_\+history@{get\+\_\+dialog\+\_\+history}}
\index{get\+\_\+dialog\+\_\+history@{get\+\_\+dialog\+\_\+history}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{get\+\_\+dialog\+\_\+history()}{get\_dialog\_history()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+get\+\_\+dialog\+\_\+history (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observation,  }\item[{}]{reply = {\ttfamily None},  }\item[{}]{add\+\_\+person\+\_\+tokens = {\ttfamily False},  }\item[{}]{add\+\_\+p1\+\_\+after\+\_\+newln = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Retrieve dialog history and add current observations to it.

:param observation:        current observation
:param reply:              past utterance from the model to add to the
                   history, such as the past label or response
                   generated by the model.
:param add_person_tokens:  add tokens identifying each speaking before
                   utterances in the text & history.
:param add_p1_after_newln: add the other speaker token before the last
                   newline in the input instead of at the
                   beginning of the input. this is useful for
                   tasks that include some kind of context
                   before the actual utterance (e.g. squad,
                   babi, personachat).

:return: observation with text replaced with full dialog
\end{DoxyVerb}
 

Definition at line 837 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
837     ):
838         \textcolor{stringliteral}{"""}
839 \textcolor{stringliteral}{        Retrieve dialog history and add current observations to it.}
840 \textcolor{stringliteral}{}
841 \textcolor{stringliteral}{        :param observation:        current observation}
842 \textcolor{stringliteral}{        :param reply:              past utterance from the model to add to the}
843 \textcolor{stringliteral}{                                   history, such as the past label or response}
844 \textcolor{stringliteral}{                                   generated by the model.}
845 \textcolor{stringliteral}{        :param add\_person\_tokens:  add tokens identifying each speaking before}
846 \textcolor{stringliteral}{                                   utterances in the text & history.}
847 \textcolor{stringliteral}{        :param add\_p1\_after\_newln: add the other speaker token before the last}
848 \textcolor{stringliteral}{                                   newline in the input instead of at the}
849 \textcolor{stringliteral}{                                   beginning of the input. this is useful for}
850 \textcolor{stringliteral}{                                   tasks that include some kind of context}
851 \textcolor{stringliteral}{                                   before the actual utterance (e.g. squad,}
852 \textcolor{stringliteral}{                                   babi, personachat).}
853 \textcolor{stringliteral}{}
854 \textcolor{stringliteral}{        :return: observation with text replaced with full dialog}
855 \textcolor{stringliteral}{        """}
856         obs = observation
857 
858         \textcolor{keywordflow}{if} reply \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
859             \textcolor{keywordflow}{if} add\_person\_tokens:
860                 \textcolor{comment}{# add person2 token to reply}
861                 reply = self.\_add\_person\_tokens(reply, self.P2\_TOKEN)
862             \textcolor{comment}{# add reply to history}
863             self.history.append(reply)
864 
865         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'text'} \textcolor{keywordflow}{in} obs:
866             \textcolor{keywordflow}{if} add\_person\_tokens:
867                 \textcolor{comment}{# add person1 token to text}
868                 obs[\textcolor{stringliteral}{'text'}] = self.\_add\_person\_tokens(
869                     obs[\textcolor{stringliteral}{'text'}], self.P1\_TOKEN, add\_p1\_after\_newln
870                 )
871             \textcolor{comment}{# add text to history}
872             self.history.append(obs[\textcolor{stringliteral}{'text'}])
873 
874         \textcolor{keywordflow}{if} len(self.history) > 0:
875             obs[\textcolor{stringliteral}{'text'}] = \textcolor{stringliteral}{'\(\backslash\)n'}.join(self.history)
876         \textcolor{keywordflow}{if} obs.get(\textcolor{stringliteral}{'episode\_done'}, \textcolor{keyword}{True}):
877             \textcolor{comment}{# end of this episode, clear the history}
878             self.history.clear()
879         \textcolor{keywordflow}{return} obs
880 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a1727b17db185dcc7237d893018c7b76c}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a1727b17db185dcc7237d893018c7b76c}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!init\+\_\+optim@{init\+\_\+optim}}
\index{init\+\_\+optim@{init\+\_\+optim}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{init\+\_\+optim()}{init\_optim()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+init\+\_\+optim (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{params,  }\item[{}]{optim\+\_\+states = {\ttfamily None},  }\item[{}]{saved\+\_\+optim\+\_\+type = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Initialize optimizer with model parameters.

:param params:       parameters from the model, for example:
             [p for p in model.parameters() if p.requires_grad]
:param optim_states: optional argument providing states of optimizer
             to load
:saved_optim_type:   type of optimizer being loaded, if changed will
             skip loading optimizer states
\end{DoxyVerb}
 

Definition at line 341 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
341     \textcolor{keyword}{def }init\_optim(self, params, optim\_states=None, saved\_optim\_type=None):
342         \textcolor{stringliteral}{"""}
343 \textcolor{stringliteral}{        Initialize optimizer with model parameters.}
344 \textcolor{stringliteral}{}
345 \textcolor{stringliteral}{        :param params:       parameters from the model, for example:}
346 \textcolor{stringliteral}{                             [p for p in model.parameters() if p.requires\_grad]}
347 \textcolor{stringliteral}{        :param optim\_states: optional argument providing states of optimizer}
348 \textcolor{stringliteral}{                             to load}
349 \textcolor{stringliteral}{        :saved\_optim\_type:   type of optimizer being loaded, if changed will}
350 \textcolor{stringliteral}{                             skip loading optimizer states}
351 \textcolor{stringliteral}{        """}
352         opt = self.opt
353         \textcolor{comment}{# we only set up optimizers when training}
354         self.clip = opt.get(\textcolor{stringliteral}{'gradient\_clip'}, -1)
355 
356         \textcolor{comment}{# set up optimizer args}
357         \textcolor{comment}{# TODO: move optimizer params to command line args}
358         lr = opt[\textcolor{stringliteral}{'learningrate'}]
359         kwargs = \{\textcolor{stringliteral}{'lr'}: lr\}
360         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'momentum'}) > 0 \textcolor{keywordflow}{and} opt[\textcolor{stringliteral}{'optimizer'}] \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'sgd'}, \textcolor{stringliteral}{'rmsprop'}]:
361             kwargs[\textcolor{stringliteral}{'momentum'}] = opt[\textcolor{stringliteral}{'momentum'}]
362             \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'optimizer'}] == \textcolor{stringliteral}{'sgd'}:
363                 kwargs[\textcolor{stringliteral}{'nesterov'}] = \textcolor{keyword}{True}
364         \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'optimizer'}] == \textcolor{stringliteral}{'adam'}:
365             \textcolor{comment}{# amsgrad paper: https://openreview.net/forum?id=ryQu7f-RZ}
366             kwargs[\textcolor{stringliteral}{'amsgrad'}] = \textcolor{keyword}{True}
367 
368         optim\_class = self.OPTIM\_OPTS[opt[\textcolor{stringliteral}{'optimizer'}]]
369         self.optimizer = optim\_class(params, **kwargs)
370         \textcolor{keywordflow}{if} optim\_states:
371             \textcolor{keywordflow}{if} saved\_optim\_type != opt[\textcolor{stringliteral}{'optimizer'}]:
372                 print(\textcolor{stringliteral}{'WARNING: not loading optim state since optim class '} \textcolor{stringliteral}{'changed.'})
373             \textcolor{keywordflow}{else}:
374                 \textcolor{keywordflow}{try}:
375                     self.optimizer.load\_state\_dict(optim\_states)
376                 \textcolor{keywordflow}{except} ValueError:
377                     print(
378                         \textcolor{stringliteral}{'WARNING: not loading optim state since model '}
379                         \textcolor{stringliteral}{'params changed.'}
380                     )
381                 \textcolor{keywordflow}{if} self.use\_cuda:
382                     \textcolor{keywordflow}{for} state \textcolor{keywordflow}{in} self.optimizer.state.values():
383                         \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} state.items():
384                             \textcolor{keywordflow}{if} isinstance(v, torch.Tensor):
385                                 state[k] = v.cuda()
386         \textcolor{comment}{# TODO: Move scheduler params to command line args}
387         self.scheduler = optim.lr\_scheduler.ReduceLROnPlateau(
388             self.optimizer, \textcolor{stringliteral}{'min'}, factor=0.5, patience=3, verbose=\textcolor{keyword}{True}
389         )
390 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_abf7a50ea0eb319737123d2e46fde4c0f}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_abf7a50ea0eb319737123d2e46fde4c0f}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!last\+\_\+reply@{last\+\_\+reply}}
\index{last\+\_\+reply@{last\+\_\+reply}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{last\+\_\+reply()}{last\_reply()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+last\+\_\+reply (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{use\+\_\+label = {\ttfamily True} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Retrieve the last reply from the model.

If available, we use the true label instead of the model's prediction.

By default, batch_act stores the batch of replies and this method
will extract the reply of the current instance from the batch.

:param use_label: default true, use the label when available instead of
          the model's generated response.
\end{DoxyVerb}
 

Definition at line 881 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
881     \textcolor{keyword}{def }last\_reply(self, use\_label=True):
882         \textcolor{stringliteral}{"""}
883 \textcolor{stringliteral}{        Retrieve the last reply from the model.}
884 \textcolor{stringliteral}{}
885 \textcolor{stringliteral}{        If available, we use the true label instead of the model's prediction.}
886 \textcolor{stringliteral}{}
887 \textcolor{stringliteral}{        By default, batch\_act stores the batch of replies and this method}
888 \textcolor{stringliteral}{        will extract the reply of the current instance from the batch.}
889 \textcolor{stringliteral}{}
890 \textcolor{stringliteral}{        :param use\_label: default true, use the label when available instead of}
891 \textcolor{stringliteral}{                          the model's generated response.}
892 \textcolor{stringliteral}{        """}
893         \textcolor{comment}{# if the last observation was the end of an episode,}
894         \textcolor{comment}{# then we shouldn't use it as history}
895         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.observation \textcolor{keywordflow}{or} self.observation.get(\textcolor{stringliteral}{'episode\_done'}, \textcolor{keyword}{True}):
896             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
897 
898         \textcolor{keywordflow}{if} use\_label:
899             \textcolor{comment}{# first look for the true label, if we aren't on a new episode}
900             label\_key = (
901                 \textcolor{stringliteral}{'labels'}
902                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'labels'} \textcolor{keywordflow}{in} self.observation
903                 \textcolor{keywordflow}{else} \textcolor{stringliteral}{'eval\_labels'}
904                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'eval\_labels'} \textcolor{keywordflow}{in} self.observation
905                 \textcolor{keywordflow}{else} \textcolor{keywordtype}{None}
906             )
907             \textcolor{keywordflow}{if} label\_key \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
908                 lbls = self.observation[label\_key]
909                 last\_reply = lbls[0] \textcolor{keywordflow}{if} len(lbls) == 1 \textcolor{keywordflow}{else} self.random.choice(lbls)
910                 \textcolor{keywordflow}{return} last\_reply
911         \textcolor{comment}{# otherwise, we use the last reply the model generated}
912         batch\_reply = self.replies.get(\textcolor{stringliteral}{'batch\_reply'})
913         \textcolor{keywordflow}{if} batch\_reply \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
914             \textcolor{keywordflow}{return} batch\_reply[self.batch\_idx].get(\textcolor{stringliteral}{'text'})
915         \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
916 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a6d71ad7997e048e4f4f7d957fae64ac5}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a6d71ad7997e048e4f4f7d957fae64ac5}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!load@{load}}
\index{load@{load}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{load()}{load()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+load (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return opt and model states.

Override this method for more specific loading.
\end{DoxyVerb}
 

Definition at line 997 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
997     \textcolor{keyword}{def }load(self, path):
998         \textcolor{stringliteral}{"""}
999 \textcolor{stringliteral}{        Return opt and model states.}
1000 \textcolor{stringliteral}{}
1001 \textcolor{stringliteral}{        Override this method for more specific loading.}
1002 \textcolor{stringliteral}{        """}
1003         states = torch.load(path, map\_location=\textcolor{keyword}{lambda} cpu, \_: cpu)
1004         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'model'} \textcolor{keywordflow}{in} states:
1005             self.model.load\_state\_dict(states[\textcolor{stringliteral}{'model'}])
1006         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'optimizer'} \textcolor{keywordflow}{in} states \textcolor{keywordflow}{and} hasattr(self, \textcolor{stringliteral}{'optimizer'}):
1007             self.optimizer.load\_state\_dict(states[\textcolor{stringliteral}{'optimizer'}])
1008         \textcolor{keywordflow}{return} states
1009 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_acac419cfad0fc5988e7e796c244f3a9f}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_acac419cfad0fc5988e7e796c244f3a9f}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!match\+\_\+batch@{match\+\_\+batch}}
\index{match\+\_\+batch@{match\+\_\+batch}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{match\+\_\+batch()}{match\_batch()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+match\+\_\+batch (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch\+\_\+reply,  }\item[{}]{valid\+\_\+inds,  }\item[{}]{output = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Match sub-batch of predictions to the original batch indices.

Batches may be only partially filled (i.e when completing the remainder
at the end of the validation or test set), or we may want to sort by
e.g the length of the input sequences if using pack_padded_sequence.

This matches rows back with their original row in the batch for
calculating metrics like accuracy.

If output is None (model choosing not to provide any predictions), we
will just return the batch of replies.

Otherwise, output should be a parlai.core.torch_agent.Output object.
This is a namedtuple, which can provide text predictions and/or
text_candidates predictions. If you would like to map additional
fields into the batch_reply, you can override this method as well as
providing your own namedtuple with additional fields.

:param batch_reply: Full-batchsize list of message dictionaries to put
    responses into.
:param valid_inds: Original indices of the predictions.
:param output: Output namedtuple which contains sub-batchsize list of
    text outputs from model. May be None (default) if model chooses not
    to answer. This method will check for ``text`` and
    ``text_candidates`` fields.
\end{DoxyVerb}
 

Definition at line 789 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
789     \textcolor{keyword}{def }match\_batch(self, batch\_reply, valid\_inds, output=None):
790         \textcolor{stringliteral}{"""}
791 \textcolor{stringliteral}{        Match sub-batch of predictions to the original batch indices.}
792 \textcolor{stringliteral}{}
793 \textcolor{stringliteral}{        Batches may be only partially filled (i.e when completing the remainder}
794 \textcolor{stringliteral}{        at the end of the validation or test set), or we may want to sort by}
795 \textcolor{stringliteral}{        e.g the length of the input sequences if using pack\_padded\_sequence.}
796 \textcolor{stringliteral}{}
797 \textcolor{stringliteral}{        This matches rows back with their original row in the batch for}
798 \textcolor{stringliteral}{        calculating metrics like accuracy.}
799 \textcolor{stringliteral}{}
800 \textcolor{stringliteral}{        If output is None (model choosing not to provide any predictions), we}
801 \textcolor{stringliteral}{        will just return the batch of replies.}
802 \textcolor{stringliteral}{}
803 \textcolor{stringliteral}{        Otherwise, output should be a parlai.core.torch\_agent.Output object.}
804 \textcolor{stringliteral}{        This is a namedtuple, which can provide text predictions and/or}
805 \textcolor{stringliteral}{        text\_candidates predictions. If you would like to map additional}
806 \textcolor{stringliteral}{        fields into the batch\_reply, you can override this method as well as}
807 \textcolor{stringliteral}{        providing your own namedtuple with additional fields.}
808 \textcolor{stringliteral}{}
809 \textcolor{stringliteral}{        :param batch\_reply: Full-batchsize list of message dictionaries to put}
810 \textcolor{stringliteral}{            responses into.}
811 \textcolor{stringliteral}{        :param valid\_inds: Original indices of the predictions.}
812 \textcolor{stringliteral}{        :param output: Output namedtuple which contains sub-batchsize list of}
813 \textcolor{stringliteral}{            text outputs from model. May be None (default) if model chooses not}
814 \textcolor{stringliteral}{            to answer. This method will check for ``text`` and}
815 \textcolor{stringliteral}{            ``text\_candidates`` fields.}
816 \textcolor{stringliteral}{        """}
817         \textcolor{keywordflow}{if} output \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
818             \textcolor{keywordflow}{return} batch\_reply
819         \textcolor{keywordflow}{if} output.text \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
820             \textcolor{keywordflow}{for} i, response \textcolor{keywordflow}{in} zip(valid\_inds, output.text):
821                 batch\_reply[i][\textcolor{stringliteral}{'text'}] = response
822         \textcolor{keywordflow}{if} output.text\_candidates \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
823             \textcolor{keywordflow}{for} i, cands \textcolor{keywordflow}{in} zip(valid\_inds, output.text\_candidates):
824                 batch\_reply[i][\textcolor{stringliteral}{'text\_candidates'}] = cands
825         \textcolor{keywordflow}{return} batch\_reply
826 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a0eb23a78aea413ae4f90ce0628179920}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a0eb23a78aea413ae4f90ce0628179920}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!observe@{observe}}
\index{observe@{observe}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{observe()}{observe()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+observe (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observation }\end{DoxyParamCaption})}

\begin{DoxyVerb}Process incoming message in preparation for producing a response.

This includes remembering the past history of the conversation.
\end{DoxyVerb}
 

Definition at line 955 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
955     \textcolor{keyword}{def }observe(self, observation):
956         \textcolor{stringliteral}{"""}
957 \textcolor{stringliteral}{        Process incoming message in preparation for producing a response.}
958 \textcolor{stringliteral}{}
959 \textcolor{stringliteral}{        This includes remembering the past history of the conversation.}
960 \textcolor{stringliteral}{        """}
961         reply = self.last\_reply(
962             use\_label=(self.opt.get(\textcolor{stringliteral}{'use\_reply'}, \textcolor{stringliteral}{'label'}) == \textcolor{stringliteral}{'label'})
963         )
964         self.observation = self.get\_dialog\_history(
965             observation,
966             reply=reply,
967             add\_person\_tokens=self.add\_person\_tokens,
968             add\_p1\_after\_newln=self.opt.get(\textcolor{stringliteral}{'add\_p1\_after\_newln'}, \textcolor{keyword}{False}),
969         )
970         \textcolor{keywordflow}{return} self.vectorize(self.observation, truncate=self.truncate)
971 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_af97699a6b03a17969830db378f09cac4}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_af97699a6b03a17969830db378f09cac4}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!receive\+\_\+metrics@{receive\+\_\+metrics}}
\index{receive\+\_\+metrics@{receive\+\_\+metrics}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{receive\+\_\+metrics()}{receive\_metrics()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+receive\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{metrics\+\_\+dict }\end{DoxyParamCaption})}

\begin{DoxyVerb}Use the metrics to decide when to adjust LR schedule.

This uses the loss as the validation metric if present, if not this function
does nothing. Note that the model must be reporting loss for this to work.
Override this to override the behavior.
\end{DoxyVerb}
 

Definition at line 391 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
391     \textcolor{keyword}{def }receive\_metrics(self, metrics\_dict):
392         \textcolor{stringliteral}{"""}
393 \textcolor{stringliteral}{        Use the metrics to decide when to adjust LR schedule.}
394 \textcolor{stringliteral}{}
395 \textcolor{stringliteral}{        This uses the loss as the validation metric if present, if not this function}
396 \textcolor{stringliteral}{        does nothing. Note that the model must be reporting loss for this to work.}
397 \textcolor{stringliteral}{        Override this to override the behavior.}
398 \textcolor{stringliteral}{        """}
399         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'loss'} \textcolor{keywordflow}{in} metrics\_dict:
400             self.scheduler.step(metrics\_dict[\textcolor{stringliteral}{'loss'}])
401 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ae4b2346c35e214a8028eb83d1fc5ffd7}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ae4b2346c35e214a8028eb83d1fc5ffd7}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!reply\+\_\+history@{reply\+\_\+history}}
\index{reply\+\_\+history@{reply\+\_\+history}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{reply\+\_\+history()}{reply\_history()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+reply\+\_\+history (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Get the model's predicted reply history within this episode.

:param batch: (default False) return the reply history for every
      row in the batch, otherwise will return just for this
      example.

:return: list of lists of strings, each of the past model replies in
 in the current episode. will be None wherever model did not
 reply.
\end{DoxyVerb}
 

Definition at line 939 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
939     \textcolor{keyword}{def }reply\_history(self):
940         \textcolor{stringliteral}{"""}
941 \textcolor{stringliteral}{        Get the model's predicted reply history within this episode.}
942 \textcolor{stringliteral}{}
943 \textcolor{stringliteral}{        :param batch: (default False) return the reply history for every}
944 \textcolor{stringliteral}{                      row in the batch, otherwise will return just for this}
945 \textcolor{stringliteral}{                      example.}
946 \textcolor{stringliteral}{}
947 \textcolor{stringliteral}{        :return: list of lists of strings, each of the past model replies in}
948 \textcolor{stringliteral}{                 in the current episode. will be None wherever model did not}
949 \textcolor{stringliteral}{                 reply.}
950 \textcolor{stringliteral}{        """}
951         \textcolor{comment}{# make sure in batch order}
952         preds = sorted((b, p) \textcolor{keywordflow}{for} b, p \textcolor{keywordflow}{in} self.replies[\textcolor{stringliteral}{'predictions'}].items())
953         \textcolor{keywordflow}{return} [p \textcolor{keywordflow}{for} b, p \textcolor{keywordflow}{in} preds]
954 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a93e935c0d2d589d8990ff14d6e528c4d}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a93e935c0d2d589d8990ff14d6e528c4d}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!reset@{reset}}
\index{reset@{reset}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+reset (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Clear internal states.
\end{DoxyVerb}
 

Definition at line 1010 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
1010     \textcolor{keyword}{def }reset(self):
1011         \textcolor{stringliteral}{"""}
1012 \textcolor{stringliteral}{        Clear internal states.}
1013 \textcolor{stringliteral}{        """}
1014         self.observation = \textcolor{keywordtype}{None}
1015         self.history.clear()
1016         self.replies.clear()
1017         self.reset\_metrics()
1018 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a4a01defa1d669571f574fcfe021776a8}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a4a01defa1d669571f574fcfe021776a8}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!save@{save}}
\index{save@{save}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+save (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Save model parameters to path (or default to model_file arg).

Override this method for more specific saving.
\end{DoxyVerb}
 

Definition at line 972 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
972     \textcolor{keyword}{def }save(self, path=None):
973         \textcolor{stringliteral}{"""}
974 \textcolor{stringliteral}{        Save model parameters to path (or default to model\_file arg).}
975 \textcolor{stringliteral}{}
976 \textcolor{stringliteral}{        Override this method for more specific saving.}
977 \textcolor{stringliteral}{        """}
978         path = self.opt.get(\textcolor{stringliteral}{'model\_file'}, \textcolor{keywordtype}{None}) \textcolor{keywordflow}{if} path \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{else} path
979 
980         \textcolor{keywordflow}{if} path:
981             states = \{\}
982             \textcolor{keywordflow}{if} hasattr(self, \textcolor{stringliteral}{'model'}):  \textcolor{comment}{# save model params}
983                 states[\textcolor{stringliteral}{'model'}] = self.model.state\_dict()
984             \textcolor{keywordflow}{if} hasattr(self, \textcolor{stringliteral}{'optimizer'}):  \textcolor{comment}{# save optimizer params}
985                 states[\textcolor{stringliteral}{'optimizer'}] = self.optimizer.state\_dict()
986 
987             \textcolor{keywordflow}{if} states:  \textcolor{comment}{# anything found to save?}
988                 with open(path, \textcolor{stringliteral}{'wb'}) \textcolor{keyword}{as} write:
989                     torch.save(states, write)
990 
991                 \textcolor{comment}{# save opt file}
992                 with open(path + \textcolor{stringliteral}{'.opt'}, \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} handle:
993                     \textcolor{keywordflow}{if} hasattr(self, \textcolor{stringliteral}{'model\_version'}):
994                         self.opt[\textcolor{stringliteral}{'model\_version'}] = self.model\_version()
995                     json.dump(self.opt, handle)
996 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a3d922c4a8452c9e44fa2478e6fecdfd1}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a3d922c4a8452c9e44fa2478e6fecdfd1}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!share@{share}}
\index{share@{share}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{share()}{share()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+share (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Share fields from parent as well as useful objects in this class.

Subclasses will likely want to share their model as well.
\end{DoxyVerb}
 

Definition at line 501 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
501     \textcolor{keyword}{def }share(self):
502         \textcolor{stringliteral}{"""}
503 \textcolor{stringliteral}{        Share fields from parent as well as useful objects in this class.}
504 \textcolor{stringliteral}{}
505 \textcolor{stringliteral}{        Subclasses will likely want to share their model as well.}
506 \textcolor{stringliteral}{        """}
507         shared = super().share()
508         shared[\textcolor{stringliteral}{'opt'}] = self.opt
509         shared[\textcolor{stringliteral}{'dict'}] = self.dict
510         shared[\textcolor{stringliteral}{'replies'}] = self.replies
511         \textcolor{keywordflow}{return} shared
512 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aff9cc5c105bbf154075aa83e288582ca}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aff9cc5c105bbf154075aa83e288582ca}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!train\+\_\+step@{train\+\_\+step}}
\index{train\+\_\+step@{train\+\_\+step}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{train\+\_\+step()}{train\_step()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+train\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}Process one batch with training labels.
\end{DoxyVerb}
 

Definition at line 1061 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
1061     \textcolor{keyword}{def }train\_step(self, batch):
1062         \textcolor{stringliteral}{"""}
1063 \textcolor{stringliteral}{        Process one batch with training labels.}
1064 \textcolor{stringliteral}{        """}
1065         \textcolor{keywordflow}{raise} NotImplementedError(\textcolor{stringliteral}{'Abstract class: user must implement train\_step'})
1066 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a866838e1c81063a3ec18c5609e029f90}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a866838e1c81063a3ec18c5609e029f90}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!vectorize@{vectorize}}
\index{vectorize@{vectorize}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{vectorize()}{vectorize()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+vectorize (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{obs,  }\item[{}]{add\+\_\+start = {\ttfamily True},  }\item[{}]{add\+\_\+end = {\ttfamily True},  }\item[{}]{truncate = {\ttfamily None},  }\item[{}]{split\+\_\+lines = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Make vectors out of observation fields and store in the observation.

In particular, the 'text' and 'labels'/'eval_labels' fields are
processed and a new field is added to the observation with the suffix
'_vec'.

If you want to use additional fields on your subclass, you can override
this function, call super().vectorize(...) to process the text and
labels, and then process the other fields in your subclass.

:param obs:         Single observation from observe function.
:param add_start:   default True, adds the start token to each label.
:param add_end:     default True, adds the end token to each label.
:param truncate:    default None, if set truncates all vectors to the
            specified length. Note that this truncates to the
            rightmost for inputs and the leftmost for labels
            and, when applicable, candidates.
:param split_lines: If set, returns list of vectors instead of a single
            vector for input text, one for each substring after
            splitting on newlines.
\end{DoxyVerb}
 

Definition at line 660 of file torch\+\_\+agent\+\_\+v1.\+py.


\begin{DoxyCode}
660     ):
661         \textcolor{stringliteral}{"""}
662 \textcolor{stringliteral}{        Make vectors out of observation fields and store in the observation.}
663 \textcolor{stringliteral}{}
664 \textcolor{stringliteral}{        In particular, the 'text' and 'labels'/'eval\_labels' fields are}
665 \textcolor{stringliteral}{        processed and a new field is added to the observation with the suffix}
666 \textcolor{stringliteral}{        '\_vec'.}
667 \textcolor{stringliteral}{}
668 \textcolor{stringliteral}{        If you want to use additional fields on your subclass, you can override}
669 \textcolor{stringliteral}{        this function, call super().vectorize(...) to process the text and}
670 \textcolor{stringliteral}{        labels, and then process the other fields in your subclass.}
671 \textcolor{stringliteral}{}
672 \textcolor{stringliteral}{        :param obs:         Single observation from observe function.}
673 \textcolor{stringliteral}{        :param add\_start:   default True, adds the start token to each label.}
674 \textcolor{stringliteral}{        :param add\_end:     default True, adds the end token to each label.}
675 \textcolor{stringliteral}{        :param truncate:    default None, if set truncates all vectors to the}
676 \textcolor{stringliteral}{                            specified length. Note that this truncates to the}
677 \textcolor{stringliteral}{                            rightmost for inputs and the leftmost for labels}
678 \textcolor{stringliteral}{                            and, when applicable, candidates.}
679 \textcolor{stringliteral}{        :param split\_lines: If set, returns list of vectors instead of a single}
680 \textcolor{stringliteral}{                            vector for input text, one for each substring after}
681 \textcolor{stringliteral}{                            splitting on newlines.}
682 \textcolor{stringliteral}{        """}
683         self.\_set\_text\_vec(obs, truncate, split\_lines)
684         self.\_set\_label\_vec(obs, add\_start, add\_end, truncate)
685         self.\_set\_label\_cands\_vec(obs, add\_start, add\_end, truncate)
686         \textcolor{keywordflow}{return} obs
687 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a81f970d715f2525ad342330a28703c5c}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a81f970d715f2525ad342330a28703c5c}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!add\+\_\+person\+\_\+tokens@{add\+\_\+person\+\_\+tokens}}
\index{add\+\_\+person\+\_\+tokens@{add\+\_\+person\+\_\+tokens}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+person\+\_\+tokens}{add\_person\_tokens}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+add\+\_\+person\+\_\+tokens}



Definition at line 339 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a31b5e2e435a70f40ce155dabe831d41c}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a31b5e2e435a70f40ce155dabe831d41c}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!batch\+\_\+idx@{batch\+\_\+idx}}
\index{batch\+\_\+idx@{batch\+\_\+idx}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{batch\+\_\+idx}{batch\_idx}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+batch\+\_\+idx}



Definition at line 331 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a99254a4351798f66797e0a5a8ff855d5}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a99254a4351798f66797e0a5a8ff855d5}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!clip@{clip}}
\index{clip@{clip}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{clip}{clip}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+clip}



Definition at line 354 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_afa0def82ae9760fde7f60c0881b8a138}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_afa0def82ae9760fde7f60c0881b8a138}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!dict@{dict}}
\index{dict@{dict}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{dict}{dict}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+dict}



Definition at line 296 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aaed187f97f489122996e967206a01927}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aaed187f97f489122996e967206a01927}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!E\+M\+P\+TY@{E\+M\+P\+TY}}
\index{E\+M\+P\+TY@{E\+M\+P\+TY}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{E\+M\+P\+TY}{EMPTY}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+E\+M\+P\+TY}



Definition at line 324 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aa78932aa1b5886cd03f1592bfa6ed4f5}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aa78932aa1b5886cd03f1592bfa6ed4f5}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!E\+N\+D\+\_\+\+I\+DX@{E\+N\+D\+\_\+\+I\+DX}}
\index{E\+N\+D\+\_\+\+I\+DX@{E\+N\+D\+\_\+\+I\+DX}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{E\+N\+D\+\_\+\+I\+DX}{END\_IDX}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+E\+N\+D\+\_\+\+I\+DX}



Definition at line 327 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a858bd7d01a3d6298f2e2f72efcf73953}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a858bd7d01a3d6298f2e2f72efcf73953}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!history@{history}}
\index{history@{history}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{history}{history}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+history}



Definition at line 335 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_add94f2eee8d2a4aba14869587e9dd4d3}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_add94f2eee8d2a4aba14869587e9dd4d3}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!histsz@{histsz}}
\index{histsz@{histsz}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{histsz}{histsz}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+histsz}



Definition at line 333 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a60d1038c25746d97d791b82a5c8e0492}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a60d1038c25746d97d791b82a5c8e0492}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!id@{id}}
\index{id@{id}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{id}{id}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+id}



Definition at line 323 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a6e6a5f2f7644a6cc273bfa25eca17df6}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a6e6a5f2f7644a6cc273bfa25eca17df6}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!N\+U\+L\+L\+\_\+\+I\+DX@{N\+U\+L\+L\+\_\+\+I\+DX}}
\index{N\+U\+L\+L\+\_\+\+I\+DX@{N\+U\+L\+L\+\_\+\+I\+DX}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{N\+U\+L\+L\+\_\+\+I\+DX}{NULL\_IDX}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+N\+U\+L\+L\+\_\+\+I\+DX}



Definition at line 325 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a04fa334c086cf9afa815a44f1948e625}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a04fa334c086cf9afa815a44f1948e625}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!observation@{observation}}
\index{observation@{observation}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{observation}{observation}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+observation}



Definition at line 964 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a4e938a91873bd6edde0ac7ed5299bc6a}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a4e938a91873bd6edde0ac7ed5299bc6a}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!opt@{opt}}
\index{opt@{opt}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+opt}



Definition at line 302 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a57acf9a56d383f7257fd7f4b0ce21537}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a57acf9a56d383f7257fd7f4b0ce21537}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!O\+P\+T\+I\+M\+\_\+\+O\+P\+TS@{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}}
\index{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS@{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}{OPTIM\_OPTS}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+O\+P\+T\+I\+M\+\_\+\+O\+P\+TS\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 132 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a2524bfb4b01626290e6fa26be52f2a80}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a2524bfb4b01626290e6fa26be52f2a80}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!optimizer@{optimizer}}
\index{optimizer@{optimizer}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{optimizer}{optimizer}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+optimizer}



Definition at line 369 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ad167df27f0b63077bf1d43e75c20301e}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ad167df27f0b63077bf1d43e75c20301e}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!P1\+\_\+\+T\+O\+K\+EN@{P1\+\_\+\+T\+O\+K\+EN}}
\index{P1\+\_\+\+T\+O\+K\+EN@{P1\+\_\+\+T\+O\+K\+EN}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{P1\+\_\+\+T\+O\+K\+EN}{P1\_TOKEN}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+P1\+\_\+\+T\+O\+K\+EN\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 138 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a002618d2202fb2dd61283f0a2b612a4c}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a002618d2202fb2dd61283f0a2b612a4c}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!P2\+\_\+\+T\+O\+K\+EN@{P2\+\_\+\+T\+O\+K\+EN}}
\index{P2\+\_\+\+T\+O\+K\+EN@{P2\+\_\+\+T\+O\+K\+EN}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{P2\+\_\+\+T\+O\+K\+EN}{P2\_TOKEN}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+P2\+\_\+\+T\+O\+K\+EN\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 139 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a3f1da649c485f406076be7bf84b2d4ee}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a3f1da649c485f406076be7bf84b2d4ee}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!proj\+\_\+rp@{proj\+\_\+rp}}
\index{proj\+\_\+rp@{proj\+\_\+rp}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{proj\+\_\+rp}{proj\_rp}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+proj\+\_\+rp}



Definition at line 465 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a2f9045fdfe9f956ee5023de84dd25a06}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a2f9045fdfe9f956ee5023de84dd25a06}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!random@{random}}
\index{random@{random}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{random}{random}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+random}



Definition at line 329 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ab768649f4b4a30eb9a75fedde5a9935f}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ab768649f4b4a30eb9a75fedde5a9935f}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!rank\+\_\+candidates@{rank\+\_\+candidates}}
\index{rank\+\_\+candidates@{rank\+\_\+candidates}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{rank\+\_\+candidates}{rank\_candidates}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+rank\+\_\+candidates}



Definition at line 338 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a91d101db75d3618e8240a44b258f3129}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a91d101db75d3618e8240a44b258f3129}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!replies@{replies}}
\index{replies@{replies}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{replies}{replies}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+replies}



Definition at line 295 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aea16ae8f9536959afd6e7434d418a719}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aea16ae8f9536959afd6e7434d418a719}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!scheduler@{scheduler}}
\index{scheduler@{scheduler}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{scheduler}{scheduler}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+scheduler}



Definition at line 387 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a37d6429a766547a68f72ffb6c27783db}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_a37d6429a766547a68f72ffb6c27783db}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!S\+T\+A\+R\+T\+\_\+\+I\+DX@{S\+T\+A\+R\+T\+\_\+\+I\+DX}}
\index{S\+T\+A\+R\+T\+\_\+\+I\+DX@{S\+T\+A\+R\+T\+\_\+\+I\+DX}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{S\+T\+A\+R\+T\+\_\+\+I\+DX}{START\_IDX}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+S\+T\+A\+R\+T\+\_\+\+I\+DX}



Definition at line 326 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ac0286e4dbf6dc71bda0c364851de5f22}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_ac0286e4dbf6dc71bda0c364851de5f22}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!truncate@{truncate}}
\index{truncate@{truncate}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{truncate}{truncate}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+truncate}



Definition at line 337 of file torch\+\_\+agent\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aa8efd385be7532abd27359b5dbbbbb24}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_1_1TorchAgent_aa8efd385be7532abd27359b5dbbbbb24}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}!use\+\_\+cuda@{use\+\_\+cuda}}
\index{use\+\_\+cuda@{use\+\_\+cuda}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::torch\+\_\+agent\+\_\+v1\+::\+Torch\+Agent}}
\subsubsection{\texorpdfstring{use\+\_\+cuda}{use\_cuda}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+torch\+\_\+agent\+\_\+v1.\+Torch\+Agent.\+use\+\_\+cuda}



Definition at line 310 of file torch\+\_\+agent\+\_\+v1.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/legacy\+\_\+agents/seq2seq/\hyperlink{torch__agent__v1_8py}{torch\+\_\+agent\+\_\+v1.\+py}\end{DoxyCompactItemize}
