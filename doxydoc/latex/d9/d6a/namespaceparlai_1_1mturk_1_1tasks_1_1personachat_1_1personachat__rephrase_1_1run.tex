\hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__rephrase_1_1run}{}\section{parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+rephrase.\+run Namespace Reference}
\label{namespaceparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__rephrase_1_1run}\index{parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+rephrase.\+run@{parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+rephrase.\+run}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__rephrase_1_1run_a91f09d955cf9e1502d8d9882fa7e1f69}{main} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__rephrase_1_1run_a91f09d955cf9e1502d8d9882fa7e1f69}\label{namespaceparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__rephrase_1_1run_a91f09d955cf9e1502d8d9882fa7e1f69}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+rephrase\+::run@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+rephrase\+::run}!main@{main}}
\index{main@{main}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+rephrase\+::run@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+rephrase\+::run}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+rephrase.\+run.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}This task consists of one agent, model or MTurk worker, talking to an MTurk worker
to negotiate a deal.
\end{DoxyVerb}
 

Definition at line 14 of file run.\+py.


\begin{DoxyCode}
14 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run_ad3ab2c71f8083c3112815c0b363d316b}{main}():
15     \textcolor{stringliteral}{"""}
16 \textcolor{stringliteral}{    This task consists of one agent, model or MTurk worker, talking to an MTurk worker}
17 \textcolor{stringliteral}{    to negotiate a deal.}
18 \textcolor{stringliteral}{    """}
19     argparser = ParlaiParser(\textcolor{keyword}{False}, \textcolor{keyword}{False})
20     argparser.add\_parlai\_data\_path()
21     argparser.add\_mturk\_args()
22     argparser.add\_argument(
23         \textcolor{stringliteral}{'-min\_t'}, \textcolor{stringliteral}{'--min\_turns'}, default=5, type=int, help=\textcolor{stringliteral}{'minimum number of turns'}
24     )
25     argparser.add\_argument(
26         \textcolor{stringliteral}{'-mt'}, \textcolor{stringliteral}{'--max\_turns'}, default=10, type=int, help=\textcolor{stringliteral}{'maximal number of chat turns'}
27     )
28     argparser.add\_argument(
29         \textcolor{stringliteral}{'-mx\_rsp\_time'},
30         \textcolor{stringliteral}{'--max\_resp\_time'},
31         default=150,
32         type=int,
33         help=\textcolor{stringliteral}{'time limit for entering a dialog message'},
34     )
35     argparser.add\_argument(
36         \textcolor{stringliteral}{'--ag\_shutdown\_time'},
37         default=120,
38         type=int,
39         help=\textcolor{stringliteral}{'time limit for entering a dialog message'},
40     )
41     argparser.add\_argument(
42         \textcolor{stringliteral}{'--persona-type'},
43         default=\textcolor{stringliteral}{'both'},
44         type=str,
45         choices=[\textcolor{stringliteral}{'both'}, \textcolor{stringliteral}{'self'}, \textcolor{stringliteral}{'other'}],
46         help=\textcolor{stringliteral}{'Which personas to load from personachat'},
47     )
48     opt = argparser.parse\_args()
49 
50     directory\_path = os.path.dirname(os.path.abspath(\_\_file\_\_))
51     opt[\textcolor{stringliteral}{'task'}] = os.path.basename(directory\_path)
52 
53     opt[\textcolor{stringliteral}{'extract\_personas\_path'}] = os.path.join(opt[\textcolor{stringliteral}{'datapath'}], opt[\textcolor{stringliteral}{'task'}])
54     opt.update(task\_config)
55 
56     mturk\_agent\_ids = [\textcolor{stringliteral}{'PERSON\_1'}]
57 
58     mturk\_manager = MTurkManager(opt=opt, mturk\_agent\_ids=mturk\_agent\_ids)
59 
60     mturk\_manager.setup\_server(task\_directory\_path=directory\_path)
61 
62     personas\_generator = PersonasGenerator(opt)
63     opt[\textcolor{stringliteral}{'personas\_generator'}] = personas\_generator
64 
65     \textcolor{keywordflow}{try}:
66         mturk\_manager.start\_new\_run()
67         mturk\_manager.create\_hits()
68 
69         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} opt[\textcolor{stringliteral}{'is\_sandbox'}]:
70             \textcolor{comment}{# ADD BLOCKED WORKERS HERE}
71             blocked\_worker\_list = []
72             \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} blocked\_worker\_list:
73                 mturk\_manager.block\_worker(
74                     w,
75                     \textcolor{stringliteral}{'We found that you have unexpected behaviors in our '}
76                     \textcolor{stringliteral}{'previous HITs. For more questions please email us.'},
77                 )
78 
79         \textcolor{keyword}{def }run\_onboard(worker):
80             \textcolor{keywordflow}{pass}
81 
82         mturk\_manager.set\_onboard\_function(onboard\_function=run\_onboard)
83         mturk\_manager.ready\_to\_accept\_workers()
84 
85         \textcolor{keyword}{def }check\_worker\_eligibility(worker):
86             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
87 
88         \textcolor{keyword}{def }assign\_worker\_roles(workers):
89             \textcolor{keywordflow}{for} index, worker \textcolor{keywordflow}{in} enumerate(workers):
90                 worker.id = mturk\_agent\_ids[index % len(mturk\_agent\_ids)]
91 
92         \textcolor{keyword}{def }run\_conversation(mturk\_manager, opt, workers):
93             worker = workers[0]
94             world = RephrasePersonaWorld(opt, worker)
95             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world.episode\_done():
96                 world.parley()
97             world.save\_data()
98             world.shutdown()
99             world.review\_work()
100 
101         mturk\_manager.start\_task(
102             eligibility\_function=check\_worker\_eligibility,
103             assign\_role\_function=assign\_worker\_roles,
104             task\_function=run\_conversation,
105         )
106 
107     \textcolor{keywordflow}{except} BaseException:
108         \textcolor{keywordflow}{raise}
109     \textcolor{keywordflow}{finally}:
110         mturk\_manager.expire\_all\_unassigned\_hits()
111         mturk\_manager.shutdown()
112 
113 
\end{DoxyCode}
