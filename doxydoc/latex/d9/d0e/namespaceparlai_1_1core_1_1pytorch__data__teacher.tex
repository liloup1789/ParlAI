\hypertarget{namespaceparlai_1_1core_1_1pytorch__data__teacher}{}\section{parlai.\+core.\+pytorch\+\_\+data\+\_\+teacher Namespace Reference}
\label{namespaceparlai_1_1core_1_1pytorch__data__teacher}\index{parlai.\+core.\+pytorch\+\_\+data\+\_\+teacher@{parlai.\+core.\+pytorch\+\_\+data\+\_\+teacher}}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classparlai_1_1core_1_1pytorch__data__teacher_1_1BatchSortCache}{Batch\+Sort\+Cache}
\item 
class \hyperlink{classparlai_1_1core_1_1pytorch__data__teacher_1_1DefaultTeacher}{Default\+Teacher}
\item 
class \hyperlink{classparlai_1_1core_1_1pytorch__data__teacher_1_1LoaderProcess}{Loader\+Process}
\item 
class \hyperlink{classparlai_1_1core_1_1pytorch__data__teacher_1_1ParlAIConcatDataset}{Parl\+A\+I\+Concat\+Dataset}
\item 
class \hyperlink{classparlai_1_1core_1_1pytorch__data__teacher_1_1ParlAIDataset}{Parl\+A\+I\+Dataset}
\item 
class \hyperlink{classparlai_1_1core_1_1pytorch__data__teacher_1_1PytorchDataTeacher}{Pytorch\+Data\+Teacher}
\item 
class \hyperlink{classparlai_1_1core_1_1pytorch__data__teacher_1_1StreamDataset}{Stream\+Dataset}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_afbd22acd239efcdb6afb94db83ee3493}{ep\+\_\+length} (val)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_acd56d9ac5d68831c1e91690f26eb2328}{get\+\_\+dataset\+\_\+classes} (opt)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_a7236aa20497f2a598df9b85909901184}{default\+\_\+collate} (batch)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_a0c6f08553514c14d037da194f9d112ae}{deserialize} (obj)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_a7b71207eb86027bc93809c1e4d57f641}{process} (ex\+\_\+or\+\_\+batch)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_abc38cc19f3e02fbe610e5b5cd2de0b2c}{T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+P\+ES}
\item 
\hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_a8a64b1f3378f7698020472b7e968cc8b}{S\+T\+R\+\_\+\+T\+O\+\_\+\+T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+PE}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1pytorch__data__teacher_a7236aa20497f2a598df9b85909901184}\label{namespaceparlai_1_1core_1_1pytorch__data__teacher_a7236aa20497f2a598df9b85909901184}} 
\index{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}!default\+\_\+collate@{default\+\_\+collate}}
\index{default\+\_\+collate@{default\+\_\+collate}!parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}}
\subsubsection{\texorpdfstring{default\+\_\+collate()}{default\_collate()}}
{\footnotesize\ttfamily def parlai.\+core.\+pytorch\+\_\+data\+\_\+teacher.\+default\+\_\+collate (\begin{DoxyParamCaption}\item[{}]{batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}Collate a batch.

Default collate function, used for ParlAIDataset and StreamDataset.
\end{DoxyVerb}
 

Definition at line 459 of file pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
459 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_a7236aa20497f2a598df9b85909901184}{default\_collate}(batch):
460     \textcolor{stringliteral}{"""}
461 \textcolor{stringliteral}{    Collate a batch.}
462 \textcolor{stringliteral}{}
463 \textcolor{stringliteral}{    Default collate function, used for ParlAIDataset and StreamDataset.}
464 \textcolor{stringliteral}{    """}
465     new\_batch = []
466     \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} batch:
467         idx = b[0]
468         \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(b[1]) \textcolor{keywordflow}{is} list:
469             ep = b[1][0]
470         \textcolor{keywordflow}{else}:
471             ep = b[1]
472         new\_batch.append((idx, ep))
473     \textcolor{keywordflow}{return} new\_batch
474 
475 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1pytorch__data__teacher_a0c6f08553514c14d037da194f9d112ae}\label{namespaceparlai_1_1core_1_1pytorch__data__teacher_a0c6f08553514c14d037da194f9d112ae}} 
\index{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}!deserialize@{deserialize}}
\index{deserialize@{deserialize}!parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}}
\subsubsection{\texorpdfstring{deserialize()}{deserialize()}}
{\footnotesize\ttfamily def parlai.\+core.\+pytorch\+\_\+data\+\_\+teacher.\+deserialize (\begin{DoxyParamCaption}\item[{}]{obj }\end{DoxyParamCaption})}

\begin{DoxyVerb}Deserializes lists into Tensors.
\end{DoxyVerb}
 

Definition at line 476 of file pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
476 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_a0c6f08553514c14d037da194f9d112ae}{deserialize}(obj):
477     \textcolor{stringliteral}{"""}
478 \textcolor{stringliteral}{    Deserializes lists into Tensors.}
479 \textcolor{stringliteral}{    """}
480     keys = list(obj.keys())
481     \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} keys:
482         \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(obj[key]) \textcolor{keywordflow}{is} dict \textcolor{keywordflow}{and} obj[key].get(\textcolor{stringliteral}{'deserialized\_tensor'}, \textcolor{keyword}{False}):
483             dtype = STR\_TO\_TORCH\_DTYPE[obj[key][\textcolor{stringliteral}{'type'}]]
484             val = obj[key][\textcolor{stringliteral}{'value'}]
485             del obj[key]
486             obj[key] = torch.as\_tensor(val, dtype=dtype)
487     \textcolor{keywordflow}{return} obj
488 
489 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1pytorch__data__teacher_afbd22acd239efcdb6afb94db83ee3493}\label{namespaceparlai_1_1core_1_1pytorch__data__teacher_afbd22acd239efcdb6afb94db83ee3493}} 
\index{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}!ep\+\_\+length@{ep\+\_\+length}}
\index{ep\+\_\+length@{ep\+\_\+length}!parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}}
\subsubsection{\texorpdfstring{ep\+\_\+length()}{ep\_length()}}
{\footnotesize\ttfamily def parlai.\+core.\+pytorch\+\_\+data\+\_\+teacher.\+ep\+\_\+length (\begin{DoxyParamCaption}\item[{}]{val }\end{DoxyParamCaption})}

\begin{DoxyVerb}Determine the length of an episode, given the specified value.
\end{DoxyVerb}
 

Definition at line 301 of file pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
301 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_afbd22acd239efcdb6afb94db83ee3493}{ep\_length}(val):
302     \textcolor{stringliteral}{"""}
303 \textcolor{stringliteral}{    Determine the length of an episode, given the specified value.}
304 \textcolor{stringliteral}{    """}
305     \textcolor{keywordflow}{if} isinstance(val, (int, bytes, bool)):
306         \textcolor{keywordflow}{return} 1
307     \textcolor{keywordflow}{if} isinstance(val, str):
308         \textcolor{keywordflow}{return} len(val.replace(\textcolor{stringliteral}{'\(\backslash\)n'}, \textcolor{stringliteral}{' '}).split(\textcolor{stringliteral}{' '}))
309     \textcolor{keywordflow}{if} isinstance(val, (collections.Mapping, collections.Sequence, torch.Tensor)):
310         \textcolor{keywordflow}{if} isinstance(val, collections.Mapping) \textcolor{keywordflow}{and} val.get(
311             \textcolor{stringliteral}{'deserialized\_tensor'}, \textcolor{keyword}{False}
312         ):
313             \textcolor{keywordflow}{return} len(val[\textcolor{stringliteral}{'value'}])
314         \textcolor{keywordflow}{return} len(val)
315 
316 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1pytorch__data__teacher_acd56d9ac5d68831c1e91690f26eb2328}\label{namespaceparlai_1_1core_1_1pytorch__data__teacher_acd56d9ac5d68831c1e91690f26eb2328}} 
\index{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}!get\+\_\+dataset\+\_\+classes@{get\+\_\+dataset\+\_\+classes}}
\index{get\+\_\+dataset\+\_\+classes@{get\+\_\+dataset\+\_\+classes}!parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}}
\subsubsection{\texorpdfstring{get\+\_\+dataset\+\_\+classes()}{get\_dataset\_classes()}}
{\footnotesize\ttfamily def parlai.\+core.\+pytorch\+\_\+data\+\_\+teacher.\+get\+\_\+dataset\+\_\+classes (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Get datasets from the options.

To use a custom dataset (as opposed to the StreamDataset or ParlAIDataset),
you can subclass the pytorch Dataset class and specify its location on the
command line.

For example, the VQA v1 task provides a custom dataset, which can
be specified on the command line as follows: ``-pytd vqa_v1:VQADataset``

Note that if the dataset is named ``DefaultDataset``, then you do
not need to specify its name following the colon; e.g., it
would just be: ``-pytd vqa_v1``
\end{DoxyVerb}
 

Definition at line 317 of file pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
317 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_acd56d9ac5d68831c1e91690f26eb2328}{get\_dataset\_classes}(opt):
318     \textcolor{stringliteral}{"""}
319 \textcolor{stringliteral}{    Get datasets from the options.}
320 \textcolor{stringliteral}{}
321 \textcolor{stringliteral}{    To use a custom dataset (as opposed to the StreamDataset or ParlAIDataset),}
322 \textcolor{stringliteral}{    you can subclass the pytorch Dataset class and specify its location on the}
323 \textcolor{stringliteral}{    command line.}
324 \textcolor{stringliteral}{}
325 \textcolor{stringliteral}{    For example, the VQA v1 task provides a custom dataset, which can}
326 \textcolor{stringliteral}{    be specified on the command line as follows: ``-pytd vqa\_v1:VQADataset``}
327 \textcolor{stringliteral}{}
328 \textcolor{stringliteral}{    Note that if the dataset is named ``DefaultDataset``, then you do}
329 \textcolor{stringliteral}{    not need to specify its name following the colon; e.g., it}
330 \textcolor{stringliteral}{    would just be: ``-pytd vqa\_v1``}
331 \textcolor{stringliteral}{    """}
332     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'stream'} \textcolor{keywordflow}{in} opt.get(\textcolor{stringliteral}{'datatype'}):
333         default\_dataset = StreamDataset
334     \textcolor{keywordflow}{else}:
335         default\_dataset = ParlAIDataset
336     dataset\_name = opt.get(\textcolor{stringliteral}{'pytorch\_teacher\_dataset'})
337     task\_name = opt.get(\textcolor{stringliteral}{'pytorch\_teacher\_task'})
338     datasets = []
339     \textcolor{keywordflow}{if} task\_name \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
340         datasets += [
341             (default\_dataset, default\_collate, task) \textcolor{keywordflow}{for} task \textcolor{keywordflow}{in} task\_name.split(\textcolor{stringliteral}{','})
342         ]
343     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} dataset\_name:
344         \textcolor{keywordflow}{return} datasets
345     sps = [d.strip() \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} dataset\_name.split(\textcolor{stringliteral}{','})]
346     \textcolor{keywordflow}{for} sp \textcolor{keywordflow}{in} sps:
347         full\_task\_name = sp
348         repo = \textcolor{stringliteral}{'parlai'}
349         \textcolor{keywordflow}{if} sp.startswith(\textcolor{stringliteral}{'internal:'}):
350             \textcolor{comment}{# To switch to local repo, useful for non-public projects}
351             \textcolor{comment}{# (make a directory called 'parlai\_internal' with your private agents)}
352             repo = \textcolor{stringliteral}{'parlai\_internal'}
353             sp = sp[9:]
354         sp = sp.split(\textcolor{stringliteral}{':'})
355         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'.'} \textcolor{keywordflow}{in} sp[0]:
356             module\_name = sp[0]
357         \textcolor{keywordflow}{else}:
358             dataset = sp[0].lower()
359             module\_name = \textcolor{stringliteral}{'\{\}.tasks.\{\}.agents'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(repo, dataset)
360         \textcolor{keywordflow}{if} len(sp) > 1:
361             sp[1] = sp[1][0].upper() + sp[1][1:]
362             dataset = sp[1]
363             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'.'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} sp[0] \textcolor{keywordflow}{and} \textcolor{stringliteral}{'Dataset'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} dataset:
364                 \textcolor{comment}{# Reformat from underscore to CamelCase and append "Dataset" to}
365                 \textcolor{comment}{# class name by default if a complete path is not given.}
366                 words = dataset.split(\textcolor{stringliteral}{'\_'})
367                 teacher\_name = \textcolor{stringliteral}{''}
368                 \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} words:
369                     teacher\_name += w[0].upper() + w[1:]
370                 dataset = teacher\_name + \textcolor{stringliteral}{'Dataset'}
371         \textcolor{keywordflow}{else}:
372             dataset = \textcolor{stringliteral}{'DefaultDataset'}
373         my\_module = importlib.import\_module(module\_name)
374         dataset\_class = getattr(my\_module, dataset)
375 
376         collate = default\_collate
377         \textcolor{keywordflow}{if} hasattr(dataset\_class, \textcolor{stringliteral}{'collate'}):
378             collate = dataset\_class.collate
379         \textcolor{keywordflow}{elif} opt.get(\textcolor{stringliteral}{'model'}, \textcolor{keyword}{False}):
380             agent\_class = \hyperlink{namespaceparlai_1_1core_1_1loader_a8e6a8f524cba24b80e9bd157c2e0ab8b}{load\_agent\_module}(opt.get(\textcolor{stringliteral}{'model'}))
381             \textcolor{keywordflow}{if} hasattr(agent\_class, \textcolor{stringliteral}{'collate'}):
382                 collate = agent\_class.collate
383         datasets.append((dataset\_class, collate, full\_task\_name))
384     \textcolor{keywordflow}{return} datasets
385 
386 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1pytorch__data__teacher_a7b71207eb86027bc93809c1e4d57f641}\label{namespaceparlai_1_1core_1_1pytorch__data__teacher_a7b71207eb86027bc93809c1e4d57f641}} 
\index{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}!process@{process}}
\index{process@{process}!parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}}
\subsubsection{\texorpdfstring{process()}{process()}}
{\footnotesize\ttfamily def parlai.\+core.\+pytorch\+\_\+data\+\_\+teacher.\+process (\begin{DoxyParamCaption}\item[{}]{ex\+\_\+or\+\_\+batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}Process examples/batches, i.e. deserialize if necessary.
\end{DoxyVerb}
 

Definition at line 490 of file pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
490 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_a7b71207eb86027bc93809c1e4d57f641}{process}(ex\_or\_batch):
491     \textcolor{stringliteral}{"""}
492 \textcolor{stringliteral}{    Process examples/batches, i.e. deserialize if necessary.}
493 \textcolor{stringliteral}{    """}
494     \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(ex\_or\_batch) \textcolor{keywordflow}{is} list:
495         \textcolor{keywordflow}{if} all([ep.get(\textcolor{stringliteral}{'preprocessed'}) \textcolor{keywordflow}{for} ep \textcolor{keywordflow}{in} ex\_or\_batch]):
496             ex\_or\_batch = [\hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_a0c6f08553514c14d037da194f9d112ae}{deserialize}(ep) \textcolor{keywordflow}{for} ep \textcolor{keywordflow}{in} ex\_or\_batch]
497     \textcolor{keywordflow}{else}:
498         \textcolor{keywordflow}{if} ex\_or\_batch.get(\textcolor{stringliteral}{'preprocessed'}):
499             ex\_or\_batch = \hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_a0c6f08553514c14d037da194f9d112ae}{deserialize}(ex\_or\_batch)
500     \textcolor{keywordflow}{return} ex\_or\_batch
501 
502 
503 \textcolor{stringliteral}{"""ParlAI Implementations of Pytorch Datasets"""}
504 
505 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1pytorch__data__teacher_a8a64b1f3378f7698020472b7e968cc8b}\label{namespaceparlai_1_1core_1_1pytorch__data__teacher_a8a64b1f3378f7698020472b7e968cc8b}} 
\index{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}!S\+T\+R\+\_\+\+T\+O\+\_\+\+T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+PE@{S\+T\+R\+\_\+\+T\+O\+\_\+\+T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+PE}}
\index{S\+T\+R\+\_\+\+T\+O\+\_\+\+T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+PE@{S\+T\+R\+\_\+\+T\+O\+\_\+\+T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+PE}!parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}}
\subsubsection{\texorpdfstring{S\+T\+R\+\_\+\+T\+O\+\_\+\+T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+PE}{STR\_TO\_TORCH\_DTYPE}}
{\footnotesize\ttfamily parlai.\+core.\+pytorch\+\_\+data\+\_\+teacher.\+S\+T\+R\+\_\+\+T\+O\+\_\+\+T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+PE}



Definition at line 456 of file pytorch\+\_\+data\+\_\+teacher.\+py.

\mbox{\Hypertarget{namespaceparlai_1_1core_1_1pytorch__data__teacher_abc38cc19f3e02fbe610e5b5cd2de0b2c}\label{namespaceparlai_1_1core_1_1pytorch__data__teacher_abc38cc19f3e02fbe610e5b5cd2de0b2c}} 
\index{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}!T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+P\+ES@{T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+P\+ES}}
\index{T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+P\+ES@{T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+P\+ES}!parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher@{parlai\+::core\+::pytorch\+\_\+data\+\_\+teacher}}
\subsubsection{\texorpdfstring{T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+P\+ES}{TORCH\_DTYPES}}
{\footnotesize\ttfamily parlai.\+core.\+pytorch\+\_\+data\+\_\+teacher.\+T\+O\+R\+C\+H\+\_\+\+D\+T\+Y\+P\+ES}



Definition at line 446 of file pytorch\+\_\+data\+\_\+teacher.\+py.

