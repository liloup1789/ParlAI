\hypertarget{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder}{}\section{parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder Class Reference}
\label{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder}\index{parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder@{parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder}}


Inheritance diagram for parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=235pt]{d0/df4/classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=235pt]{d0/d84/classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a16b286b0c62255fe349789ea576afdb0}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, num\+\_\+features, embeddingsize, hiddensize, padding\+\_\+idx=0, rnn\+\_\+class=\textquotesingle{}lstm\textquotesingle{}, numlayers=2, \hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a6affef1312d92ac7e5e87e7df12dedc1}{dropout}=0.\+1, bidirectional=False, shared\+\_\+lt=None, shared\+\_\+rnn=None, \hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a63109b3ee3136b7044f70b7d80e7ca42}{input\+\_\+dropout}=0, unknown\+\_\+idx=None, sparse=False)
\item 
def \hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a4ae3d043b7a381e0eb89eb5460217029}{forward} (self, xs)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a6affef1312d92ac7e5e87e7df12dedc1}{dropout}
\item 
\hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_afa4c686f37241bdaee7bd5a290aaed54}{layers}
\item 
\hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_ab5195ce2a874d7d793c5e68e77594deb}{dirs}
\item 
\hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a7543203d711195e9f56e8536d6955f98}{hsz}
\item 
\hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a63109b3ee3136b7044f70b7d80e7ca42}{input\+\_\+dropout}
\item 
\hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_aa881b82dfbaa8448c66bccf48493fd5d}{lt}
\item 
\hyperlink{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_aa64c67b1bfefa68a3e775a83001d308e}{rnn}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}RNN Encoder.
\end{DoxyVerb}
 

Definition at line 232 of file modules.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a16b286b0c62255fe349789ea576afdb0}\label{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a16b286b0c62255fe349789ea576afdb0}} 
\index{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{num\+\_\+features,  }\item[{}]{embeddingsize,  }\item[{}]{hiddensize,  }\item[{}]{padding\+\_\+idx = {\ttfamily 0},  }\item[{}]{rnn\+\_\+class = {\ttfamily \textquotesingle{}lstm\textquotesingle{}},  }\item[{}]{numlayers = {\ttfamily 2},  }\item[{}]{dropout = {\ttfamily 0.1},  }\item[{}]{bidirectional = {\ttfamily False},  }\item[{}]{shared\+\_\+lt = {\ttfamily None},  }\item[{}]{shared\+\_\+rnn = {\ttfamily None},  }\item[{}]{input\+\_\+dropout = {\ttfamily 0},  }\item[{}]{unknown\+\_\+idx = {\ttfamily None},  }\item[{}]{sparse = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Initialize recurrent encoder.
\end{DoxyVerb}
 

Definition at line 252 of file modules.\+py.


\begin{DoxyCode}
252     ):
253         \textcolor{stringliteral}{"""}
254 \textcolor{stringliteral}{        Initialize recurrent encoder.}
255 \textcolor{stringliteral}{        """}
256         super().\_\_init\_\_()
257 
258         self.dropout = nn.Dropout(p=dropout)
259         self.layers = numlayers
260         self.dirs = 2 \textcolor{keywordflow}{if} bidirectional \textcolor{keywordflow}{else} 1
261         self.hsz = hiddensize
262 
263         \textcolor{keywordflow}{if} input\_dropout > 0 \textcolor{keywordflow}{and} unknown\_idx \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
264             \textcolor{keywordflow}{raise} RuntimeError(\textcolor{stringliteral}{'input\_dropout > 0 but unknown\_idx not set'})
265         self.input\_dropout = UnknownDropout(unknown\_idx, input\_dropout)
266 
267         \textcolor{keywordflow}{if} shared\_lt \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
268             self.lt = nn.Embedding(
269                 num\_features, embeddingsize, padding\_idx=padding\_idx, sparse=sparse
270             )
271         \textcolor{keywordflow}{else}:
272             self.lt = shared\_lt
273 
274         \textcolor{keywordflow}{if} shared\_rnn \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
275             self.rnn = \hyperlink{namespaceseq2seq_1_1train_a46177da1cc74c4a2874e4a527d857f75}{rnn\_class}(
276                 embeddingsize,
277                 hiddensize,
278                 numlayers,
279                 dropout=dropout \textcolor{keywordflow}{if} numlayers > 1 \textcolor{keywordflow}{else} 0,
280                 batch\_first=\textcolor{keyword}{True},
281                 bidirectional=bidirectional,
282             )
283         \textcolor{keywordflow}{elif} bidirectional:
284             \textcolor{keywordflow}{raise} RuntimeError(\textcolor{stringliteral}{'Cannot share decoder with bidir encoder.'})
285         \textcolor{keywordflow}{else}:
286             self.rnn = shared\_rnn
287 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a4ae3d043b7a381e0eb89eb5460217029}\label{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a4ae3d043b7a381e0eb89eb5460217029}} 
\index{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}!forward@{forward}}
\index{forward@{forward}!parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{forward()}{forward()}}
{\footnotesize\ttfamily def parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder.\+forward (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{xs }\end{DoxyParamCaption})}

\begin{DoxyVerb}Encode sequence.

:param xs: (bsz x seqlen) LongTensor of input token indices

:returns: encoder outputs, hidden state, attention mask
    encoder outputs are the output state at each step of the encoding.
    the hidden state is the final hidden state of the encoder.
    the attention mask is a mask of which input values are nonzero.
\end{DoxyVerb}
 

Definition at line 288 of file modules.\+py.


\begin{DoxyCode}
288     \textcolor{keyword}{def }forward(self, xs):
289         \textcolor{stringliteral}{"""}
290 \textcolor{stringliteral}{        Encode sequence.}
291 \textcolor{stringliteral}{}
292 \textcolor{stringliteral}{        :param xs: (bsz x seqlen) LongTensor of input token indices}
293 \textcolor{stringliteral}{}
294 \textcolor{stringliteral}{        :returns: encoder outputs, hidden state, attention mask}
295 \textcolor{stringliteral}{            encoder outputs are the output state at each step of the encoding.}
296 \textcolor{stringliteral}{            the hidden state is the final hidden state of the encoder.}
297 \textcolor{stringliteral}{            the attention mask is a mask of which input values are nonzero.}
298 \textcolor{stringliteral}{        """}
299         bsz = len(xs)
300 
301         \textcolor{comment}{# embed input tokens}
302         xs = self.input\_dropout(xs)
303         xes = self.dropout(self.lt(xs))
304         attn\_mask = xs.ne(0)
305         \textcolor{keywordflow}{try}:
306             x\_lens = torch.sum(attn\_mask.int(), dim=1)
307             xes = pack\_padded\_sequence(xes, x\_lens, batch\_first=\textcolor{keyword}{True})
308             packed = \textcolor{keyword}{True}
309         \textcolor{keywordflow}{except} ValueError:
310             \textcolor{comment}{# packing failed, don't pack then}
311             packed = \textcolor{keyword}{False}
312 
313         encoder\_output, hidden = self.rnn(xes)
314         \textcolor{keywordflow}{if} packed:
315             \textcolor{comment}{# total\_length to make sure we give the proper length in the case}
316             \textcolor{comment}{# of multigpu settings.}
317             \textcolor{comment}{# https://pytorch.org/docs/stable/notes/faq.html#pack-rnn-unpack-with-data-parallelism}
318             encoder\_output, \_ = pad\_packed\_sequence(
319                 encoder\_output, batch\_first=\textcolor{keyword}{True}, total\_length=xs.size(1)
320             )
321 
322         \textcolor{keywordflow}{if} self.dirs > 1:
323             \textcolor{comment}{# project to decoder dimension by taking sum of forward and back}
324             \textcolor{keywordflow}{if} isinstance(self.rnn, nn.LSTM):
325                 hidden = (
326                     hidden[0].view(-1, self.dirs, bsz, self.hsz).sum(1),
327                     hidden[1].view(-1, self.dirs, bsz, self.hsz).sum(1),
328                 )
329             \textcolor{keywordflow}{else}:
330                 hidden = hidden.view(-1, self.dirs, bsz, self.hsz).sum(1)
331 
332         \textcolor{keywordflow}{return} encoder\_output, \_transpose\_hidden\_state(hidden), attn\_mask
333 
334 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_ab5195ce2a874d7d793c5e68e77594deb}\label{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_ab5195ce2a874d7d793c5e68e77594deb}} 
\index{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}!dirs@{dirs}}
\index{dirs@{dirs}!parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{dirs}{dirs}}
{\footnotesize\ttfamily parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder.\+dirs}



Definition at line 260 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a6affef1312d92ac7e5e87e7df12dedc1}\label{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a6affef1312d92ac7e5e87e7df12dedc1}} 
\index{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}!dropout@{dropout}}
\index{dropout@{dropout}!parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{dropout}{dropout}}
{\footnotesize\ttfamily parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder.\+dropout}



Definition at line 258 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a7543203d711195e9f56e8536d6955f98}\label{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a7543203d711195e9f56e8536d6955f98}} 
\index{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}!hsz@{hsz}}
\index{hsz@{hsz}!parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{hsz}{hsz}}
{\footnotesize\ttfamily parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder.\+hsz}



Definition at line 261 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a63109b3ee3136b7044f70b7d80e7ca42}\label{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_a63109b3ee3136b7044f70b7d80e7ca42}} 
\index{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}!input\+\_\+dropout@{input\+\_\+dropout}}
\index{input\+\_\+dropout@{input\+\_\+dropout}!parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{input\+\_\+dropout}{input\_dropout}}
{\footnotesize\ttfamily parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder.\+input\+\_\+dropout}



Definition at line 265 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_afa4c686f37241bdaee7bd5a290aaed54}\label{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_afa4c686f37241bdaee7bd5a290aaed54}} 
\index{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}!layers@{layers}}
\index{layers@{layers}!parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{layers}{layers}}
{\footnotesize\ttfamily parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder.\+layers}



Definition at line 259 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_aa881b82dfbaa8448c66bccf48493fd5d}\label{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_aa881b82dfbaa8448c66bccf48493fd5d}} 
\index{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}!lt@{lt}}
\index{lt@{lt}!parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{lt}{lt}}
{\footnotesize\ttfamily parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder.\+lt}



Definition at line 268 of file modules.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_aa64c67b1bfefa68a3e775a83001d308e}\label{classparlai_1_1agents_1_1seq2seq_1_1modules_1_1RNNEncoder_aa64c67b1bfefa68a3e775a83001d308e}} 
\index{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}!rnn@{rnn}}
\index{rnn@{rnn}!parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::seq2seq\+::modules\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{rnn}{rnn}}
{\footnotesize\ttfamily parlai.\+agents.\+seq2seq.\+modules.\+R\+N\+N\+Encoder.\+rnn}



Definition at line 275 of file modules.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/seq2seq/\hyperlink{parlai_2agents_2seq2seq_2modules_8py}{modules.\+py}\end{DoxyCompactItemize}
