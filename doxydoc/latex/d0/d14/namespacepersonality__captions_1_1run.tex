\hypertarget{namespacepersonality__captions_1_1run}{}\section{personality\+\_\+captions.\+run Namespace Reference}
\label{namespacepersonality__captions_1_1run}\index{personality\+\_\+captions.\+run@{personality\+\_\+captions.\+run}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespacepersonality__captions_1_1run_a6cc04d2f2bf859221adef60a6ea0857f}{main} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespacepersonality__captions_1_1run_a6cc04d2f2bf859221adef60a6ea0857f}\label{namespacepersonality__captions_1_1run_a6cc04d2f2bf859221adef60a6ea0857f}} 
\index{personality\+\_\+captions\+::run@{personality\+\_\+captions\+::run}!main@{main}}
\index{main@{main}!personality\+\_\+captions\+::run@{personality\+\_\+captions\+::run}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def personality\+\_\+captions.\+run.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}Personality-Captions Data Collection Task.

This is the task setup used when collecting the Personality-Captions dataset
(https://arxiv.org/abs/1810.10665).
\end{DoxyVerb}
 

Definition at line 20 of file run.\+py.


\begin{DoxyCode}
20 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run_ad3ab2c71f8083c3112815c0b363d316b}{main}():
21     \textcolor{stringliteral}{"""}
22 \textcolor{stringliteral}{    Personality-Captions Data Collection Task.}
23 \textcolor{stringliteral}{}
24 \textcolor{stringliteral}{    This is the task setup used when collecting the Personality-Captions dataset}
25 \textcolor{stringliteral}{    (https://arxiv.org/abs/1810.10665).}
26 \textcolor{stringliteral}{    """}
27     argparser = ParlaiParser(\textcolor{keyword}{False}, \textcolor{keyword}{False})
28     argparser.add\_parlai\_data\_path()
29     argparser.add\_mturk\_args()
30     PersonalityCaptionsTeacher.add\_cmdline\_args(argparser)
31     argparser.add\_argument(
32         \textcolor{stringliteral}{'-ni'},
33         \textcolor{stringliteral}{'--num\_images'},
34         type=int,
35         default=10,
36         help=\textcolor{stringliteral}{'number of images to show \(\backslash\)}
37 \textcolor{stringliteral}{                           to turker'},
38     )
39     argparser.add\_argument(
40         \textcolor{stringliteral}{'-mx\_rsp\_time'},
41         \textcolor{stringliteral}{'--max\_resp\_time'},
42         default=1800,
43         type=int,
44         help=\textcolor{stringliteral}{'time limit for entering a dialog message'},
45     )
46     argparser.add\_argument(
47         \textcolor{stringliteral}{'-mx\_onb\_time'},
48         \textcolor{stringliteral}{'--max\_onboard\_time'},
49         type=int,
50         default=300,
51         help=\textcolor{stringliteral}{'time limit for turker'} \textcolor{stringliteral}{'in onboarding'},
52     )
53     argparser.add\_argument(
54         \textcolor{stringliteral}{'--auto-approve-delay'},
55         type=int,
56         default=3600 * 24 * 5,
57         help=\textcolor{stringliteral}{'how long to wait for  \(\backslash\)}
58 \textcolor{stringliteral}{                           auto approval'},
59     )
60     argparser.add\_argument(
61         \textcolor{stringliteral}{'--multiple-personality'},
62         type=\textcolor{stringliteral}{'bool'},
63         default=\textcolor{keyword}{False},
64         help=\textcolor{stringliteral}{'for getting captions with '} \textcolor{stringliteral}{'multiple personalities for same image'},
65     )
66     argparser.add\_argument(
67         \textcolor{stringliteral}{'--task-type'},
68         type=str,
69         default=\textcolor{stringliteral}{'personality'},
70         choices=[\textcolor{stringliteral}{'personality'}, \textcolor{stringliteral}{'no\_personality'}, \textcolor{stringliteral}{'caption'}],
71         help=\textcolor{stringliteral}{'Task Type - specify `personality` for '}
72         \textcolor{stringliteral}{'original task, `no\_personality` for the same task '}
73         \textcolor{stringliteral}{'instructions but with no personality, and '}
74         \textcolor{stringliteral}{'`caption` for the task but asking for a normal '}
75         \textcolor{stringliteral}{'caption.'},
76     )
77 
78     opt = argparser.parse\_args()
79 
80     directory\_path = os.path.dirname(os.path.abspath(\_\_file\_\_))
81     opt[\textcolor{stringliteral}{'task'}] = os.path.basename(directory\_path)
82     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'data\_path'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt:
83         opt[\textcolor{stringliteral}{'data\_path'}] = os.getcwd() + \textcolor{stringliteral}{'/data/'} + opt[\textcolor{stringliteral}{'task'}]
84     opt.update(TASK\_TYPE\_TO\_CONFIG[opt[\textcolor{stringliteral}{'task\_type'}]])
85     build\_pc\_data(opt)
86     mturk\_agent\_ids = [COMMENTER]
87     mturk\_manager = MTurkManager(opt=opt, mturk\_agent\_ids=mturk\_agent\_ids, use\_db=\textcolor{keyword}{True})
88     personality\_generator = PersonalityGenerator(opt)
89     image\_generator = ImageGenerator(opt)
90     personality\_and\_image\_generator = PersonalityAndImageGenerator(opt)
91     mturk\_manager.setup\_server(task\_directory\_path=directory\_path)
92 
93     \textcolor{keywordflow}{try}:
94         mturk\_manager.start\_new\_run()
95 
96         \textcolor{keyword}{def }run\_onboard(worker):
97             worker.personality\_generator = personality\_generator
98             worker.image\_generator = image\_generator
99             worker.personality\_and\_image\_generator = personality\_and\_image\_generator
100             world = RoleOnboardWorld(opt, worker)
101             world.parley()
102             world.shutdown()
103 
104         mturk\_manager.set\_onboard\_function(onboard\_function=run\_onboard)
105         mturk\_manager.ready\_to\_accept\_workers()
106         mturk\_manager.create\_hits()
107 
108         \textcolor{keyword}{def }check\_worker\_eligibility(worker):
109             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
110 
111         \textcolor{keyword}{def }assign\_worker\_roles(workers):
112             \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} workers:
113                 w.id = mturk\_agent\_ids[0]
114 
115         \textcolor{keyword}{def }run\_conversation(mturk\_manager, opt, workers):
116             agents = workers[:]
117             conv\_idx = mturk\_manager.conversation\_index
118             world = MTurkPersonalityCaptionsWorld(
119                 opt, agents=agents, world\_tag=\textcolor{stringliteral}{'conversation t\_\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(conv\_idx)
120             )
121             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world.episode\_done():
122                 world.parley()
123             world.save\_data()
124 
125             world.shutdown()
126             world.review\_work()
127 
128         mturk\_manager.start\_task(
129             eligibility\_function=check\_worker\_eligibility,
130             assign\_role\_function=assign\_worker\_roles,
131             task\_function=run\_conversation,
132         )
133 
134     \textcolor{keywordflow}{except} BaseException:
135         \textcolor{keywordflow}{raise}
136     \textcolor{keywordflow}{finally}:
137         mturk\_manager.expire\_all\_unassigned\_hits()
138         mturk\_manager.shutdown()
139 
140 
\end{DoxyCode}
