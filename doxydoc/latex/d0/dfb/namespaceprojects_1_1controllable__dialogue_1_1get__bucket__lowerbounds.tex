\hypertarget{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds}{}\section{projects.\+controllable\+\_\+dialogue.\+get\+\_\+bucket\+\_\+lowerbounds Namespace Reference}
\label{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds}\index{projects.\+controllable\+\_\+dialogue.\+get\+\_\+bucket\+\_\+lowerbounds@{projects.\+controllable\+\_\+dialogue.\+get\+\_\+bucket\+\_\+lowerbounds}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds_aeba9a3a9932797d722c5ff9d0991a87e}{bucket\+\_\+data} (opt)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds_a872417720ce8a3ff988a11d934afbda8}{main} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds_aeba9a3a9932797d722c5ff9d0991a87e}\label{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds_aeba9a3a9932797d722c5ff9d0991a87e}} 
\index{projects\+::controllable\+\_\+dialogue\+::get\+\_\+bucket\+\_\+lowerbounds@{projects\+::controllable\+\_\+dialogue\+::get\+\_\+bucket\+\_\+lowerbounds}!bucket\+\_\+data@{bucket\+\_\+data}}
\index{bucket\+\_\+data@{bucket\+\_\+data}!projects\+::controllable\+\_\+dialogue\+::get\+\_\+bucket\+\_\+lowerbounds@{projects\+::controllable\+\_\+dialogue\+::get\+\_\+bucket\+\_\+lowerbounds}}
\subsubsection{\texorpdfstring{bucket\+\_\+data()}{bucket\_data()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+get\+\_\+bucket\+\_\+lowerbounds.\+bucket\+\_\+data (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}



Definition at line 21 of file get\+\_\+bucket\+\_\+lowerbounds.\+py.


\begin{DoxyCode}
21 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds_aeba9a3a9932797d722c5ff9d0991a87e}{bucket\_data}(opt):
22     \textcolor{comment}{# create repeat label agent and assign it to the specified task}
23     agent = RepeatLabelAgent(opt)
24     world = \hyperlink{namespaceparlai_1_1core_1_1worlds_a11923c10b545c7ecc1b08fe2242d9c2c}{create\_task}(opt, agent)
25 
26     \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'num\_examples'}] == -1:
27         num\_examples = world.num\_examples()
28     \textcolor{keywordflow}{else}:
29         num\_examples = opt[\textcolor{stringliteral}{'num\_examples'}]
30     log\_timer = TimeLogger()
31 
32     \textcolor{keyword}{assert} opt[\textcolor{stringliteral}{'control'}] != \textcolor{stringliteral}{''}
33     ctrl = opt[\textcolor{stringliteral}{'control'}]
34 
35     num\_buckets = opt[\textcolor{stringliteral}{'num\_buckets'}]
36 
37     ctrl\_vals = []  \textcolor{comment}{# list of floats}
38 
39     \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(num\_examples):
40         world.parley()
41         world.acts[0][\textcolor{stringliteral}{'labels'}] = world.acts[0].get(
42             \textcolor{stringliteral}{'labels'}, world.acts[0].pop(\textcolor{stringliteral}{'eval\_labels'}, \textcolor{keywordtype}{None})
43         )
44 
45         \textcolor{keywordflow}{if} ctrl \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} world.acts[0].keys():
46             \textcolor{keywordflow}{raise} Exception(
47                 \textcolor{stringliteral}{'Error: control %s isn\(\backslash\)'t in the data. available keys: %s'}
48                 % (ctrl, \textcolor{stringliteral}{', '}.join(world.acts[0].keys()))
49             )
50         ctrl\_val = world.acts[0][ctrl]
51         \textcolor{keywordflow}{if} ctrl\_val == \textcolor{stringliteral}{"None"}:
52             \textcolor{keyword}{assert} ctrl == \textcolor{stringliteral}{'lastuttsim'}
53             ctrl\_val = \textcolor{keywordtype}{None}
54         \textcolor{keywordflow}{else}:
55             ctrl\_val = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(ctrl\_val)
56         \textcolor{keywordflow}{if} ctrl == \textcolor{stringliteral}{'avg\_nidf'}:
57             \textcolor{keyword}{assert} ctrl\_val >= 0
58             \textcolor{keyword}{assert} ctrl\_val <= 1
59         \textcolor{keywordflow}{elif} ctrl == \textcolor{stringliteral}{'question'}:
60             \textcolor{keyword}{assert} ctrl\_val \textcolor{keywordflow}{in} [0, 1]
61         \textcolor{keywordflow}{elif} ctrl == \textcolor{stringliteral}{'lastuttsim'}:
62             \textcolor{keywordflow}{if} ctrl\_val \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
63                 \textcolor{keyword}{assert} ctrl\_val >= -1
64                 \textcolor{keyword}{assert} ctrl\_val <= 1
65         \textcolor{keywordflow}{else}:
66             \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{'Unexpected ctrl name: %s'} % ctrl)
67         ctrl\_vals.append(ctrl\_val)
68 
69         \textcolor{keywordflow}{if} log\_timer.time() > opt[\textcolor{stringliteral}{'log\_every\_n\_secs'}]:
70             text, \_log = log\_timer.log(world.total\_parleys, world.num\_examples())
71             print(text)
72 
73         \textcolor{keywordflow}{if} world.epoch\_done():
74             print(\textcolor{stringliteral}{'EPOCH DONE'})
75             \textcolor{keywordflow}{break}
76 
77     \textcolor{keywordflow}{if} ctrl == \textcolor{stringliteral}{'lastuttsim'}:
78         num\_nones = len([v \textcolor{keywordflow}{for} v \textcolor{keywordflow}{in} ctrl\_vals \textcolor{keywordflow}{if} v \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}])
79         ctrl\_vals = [v \textcolor{keywordflow}{for} v \textcolor{keywordflow}{in} ctrl\_vals \textcolor{keywordflow}{if} v \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}]
80         print(
81             \textcolor{stringliteral}{"Have %i Nones for lastuttsim; these have been removed "}
82             \textcolor{stringliteral}{"for bucket calculation"} % num\_nones
83         )
84 
85     print(
86         \textcolor{stringliteral}{'Collected %i control vals between %.6f and %.6f'}
87         % (len(ctrl\_vals), min(ctrl\_vals), max(ctrl\_vals))
88     )
89 
90     \textcolor{comment}{# Calculate bucket lower bounds}
91     print(\textcolor{stringliteral}{'Calculating lowerbounds for %i buckets...'} % num\_buckets)
92     ctrl\_vals = sorted(ctrl\_vals)
93     lb\_indices = [\hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(len(ctrl\_vals) * i / num\_buckets) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(num\_buckets)]
94     lbs = [ctrl\_vals[idx] \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} lb\_indices]
95     print(\textcolor{stringliteral}{'\(\backslash\)nBucket lowerbounds for control %s: '} % ctrl)
96     print(lbs)
97 
98     \textcolor{comment}{# Calculate the actual bucket sizes}
99     bucket\_sizes = Counter()
100     bucket\_ids = [\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a10bd268a01b2a8886d5af4358cd5e922}{sort\_into\_bucket}(ctrl\_val, lbs) \textcolor{keywordflow}{for} ctrl\_val \textcolor{keywordflow}{in} ctrl\_vals]
101     bucket\_sizes.update(bucket\_ids)
102     print(\textcolor{stringliteral}{'\(\backslash\)nBucket sizes: '})
103     \textcolor{keywordflow}{for} bucket\_id \textcolor{keywordflow}{in} sorted(bucket\_sizes.keys()):
104         print(\textcolor{stringliteral}{"%i: %i"} % (bucket\_id, bucket\_sizes[bucket\_id]))
105 
106 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds_a872417720ce8a3ff988a11d934afbda8}\label{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds_a872417720ce8a3ff988a11d934afbda8}} 
\index{projects\+::controllable\+\_\+dialogue\+::get\+\_\+bucket\+\_\+lowerbounds@{projects\+::controllable\+\_\+dialogue\+::get\+\_\+bucket\+\_\+lowerbounds}!main@{main}}
\index{main@{main}!projects\+::controllable\+\_\+dialogue\+::get\+\_\+bucket\+\_\+lowerbounds@{projects\+::controllable\+\_\+dialogue\+::get\+\_\+bucket\+\_\+lowerbounds}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+get\+\_\+bucket\+\_\+lowerbounds.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 107 of file get\+\_\+bucket\+\_\+lowerbounds.\+py.


\begin{DoxyCode}
107 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds_a872417720ce8a3ff988a11d934afbda8}{main}():
108     random.seed(42)
109     \textcolor{comment}{# Get command line arguments}
110     parser = ParlaiParser()
111     parser.add\_argument(
112         \textcolor{stringliteral}{'-n'},
113         \textcolor{stringliteral}{'--num-examples'},
114         default=-1,
115         type=int,
116         help=\textcolor{stringliteral}{'Total number of exs to convert, -1 to convert \(\backslash\)}
117 \textcolor{stringliteral}{                                all examples'},
118     )
119     parser.add\_argument(\textcolor{stringliteral}{'-ltim'}, \textcolor{stringliteral}{'--log-every-n-secs'}, type=float, default=2)
120     parser.add\_argument(
121         \textcolor{stringliteral}{'--control'},
122         type=str,
123         default=\textcolor{stringliteral}{''},
124         help=\textcolor{stringliteral}{'the control for which we want to calculate the buckets'},
125     )
126     parser.add\_argument(
127         \textcolor{stringliteral}{'--num-buckets'},
128         type=int,
129         default=10,
130         help=\textcolor{stringliteral}{'the number of buckets we want to calculate'},
131     )
132 
133     parser.set\_defaults(task=\textcolor{stringliteral}{"projects.controllable\_dialogue.tasks.agents"})
134     parser.set\_defaults(datatype=\textcolor{stringliteral}{"train:stream"})
135 
136     opt = parser.parse\_args()
137 
138     \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1get__bucket__lowerbounds_aeba9a3a9932797d722c5ff9d0991a87e}{bucket\_data}(opt)
139 
140 
\end{DoxyCode}
