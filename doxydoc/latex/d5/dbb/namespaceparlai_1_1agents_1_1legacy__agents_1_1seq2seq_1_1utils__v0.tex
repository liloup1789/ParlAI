\hypertarget{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0}{}\section{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+utils\+\_\+v0 Namespace Reference}
\label{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0}\index{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+utils\+\_\+v0@{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+utils\+\_\+v0}}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_1_1Beam}{Beam}
\item 
class \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_1_1PaddingUtils}{Padding\+Utils}
\item 
class \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_1_1SharedTable}{Shared\+Table}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_ac7cb3ffae208474d6e67f37ecfe07f64}{maintain\+\_\+dialog\+\_\+history} (history, observation, reply=\textquotesingle{}\textquotesingle{}, history\+Length=1, use\+Replies=\textquotesingle{}label\+\_\+else\+\_\+model\textquotesingle{}, dict=None, use\+Start\+End\+Indices=True, split\+Sentences=False)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}{round\+\_\+sigfigs} (x, sigfigs=4)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a96c8bd68b645f94b1257c37f8c5646f5}{is\+\_\+tensor} (v)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a5fbd3301b67f00d6d146fb01c7cd7626}{modelzoo\+\_\+path} (datapath, path)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a96c8bd68b645f94b1257c37f8c5646f5}\label{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a96c8bd68b645f94b1257c37f8c5646f5}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0}!is\+\_\+tensor@{is\+\_\+tensor}}
\index{is\+\_\+tensor@{is\+\_\+tensor}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0}}
\subsubsection{\texorpdfstring{is\+\_\+tensor()}{is\_tensor()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+utils\+\_\+v0.\+is\+\_\+tensor (\begin{DoxyParamCaption}\item[{}]{v }\end{DoxyParamCaption})}



Definition at line 748 of file utils\+\_\+v0.\+py.


\begin{DoxyCode}
748 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a96c8bd68b645f94b1257c37f8c5646f5}{is\_tensor}(v):
749     \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(v).\_\_module\_\_.startswith(\textcolor{stringliteral}{'torch'}):
750         \textcolor{keyword}{import} torch
751 
752         \textcolor{keywordflow}{return} torch.is\_tensor(v)
753     \textcolor{keywordflow}{return} \textcolor{keyword}{False}
754 
755 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_ac7cb3ffae208474d6e67f37ecfe07f64}\label{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_ac7cb3ffae208474d6e67f37ecfe07f64}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0}!maintain\+\_\+dialog\+\_\+history@{maintain\+\_\+dialog\+\_\+history}}
\index{maintain\+\_\+dialog\+\_\+history@{maintain\+\_\+dialog\+\_\+history}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0}}
\subsubsection{\texorpdfstring{maintain\+\_\+dialog\+\_\+history()}{maintain\_dialog\_history()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+utils\+\_\+v0.\+maintain\+\_\+dialog\+\_\+history (\begin{DoxyParamCaption}\item[{}]{history,  }\item[{}]{observation,  }\item[{}]{reply = {\ttfamily \textquotesingle{}\textquotesingle{}},  }\item[{}]{history\+Length = {\ttfamily 1},  }\item[{}]{use\+Replies = {\ttfamily \textquotesingle{}label\+\_\+else\+\_\+model\textquotesingle{}},  }\item[{}]{dict = {\ttfamily None},  }\item[{}]{use\+Start\+End\+Indices = {\ttfamily True},  }\item[{}]{split\+Sentences = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Keeps track of dialog history, up to a truncation length.

Either includes replies from the labels, model, or not all using param 'replies'.
\end{DoxyVerb}
 

Definition at line 338 of file utils\+\_\+v0.\+py.


\begin{DoxyCode}
338 ):
339     \textcolor{stringliteral}{"""}
340 \textcolor{stringliteral}{    Keeps track of dialog history, up to a truncation length.}
341 \textcolor{stringliteral}{}
342 \textcolor{stringliteral}{    Either includes replies from the labels, model, or not all using param 'replies'.}
343 \textcolor{stringliteral}{    """}
344 
345     \textcolor{keyword}{def }parse(txt, splitSentences):
346         \textcolor{keywordflow}{if} dict \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
347             \textcolor{keywordflow}{if} splitSentences:
348                 vec = [dict.txt2vec(t) \textcolor{keywordflow}{for} t \textcolor{keywordflow}{in} txt.split(\textcolor{stringliteral}{'\(\backslash\)n'})]
349             \textcolor{keywordflow}{else}:
350                 vec = dict.txt2vec(txt)
351             \textcolor{keywordflow}{return} vec
352         \textcolor{keywordflow}{else}:
353             \textcolor{keywordflow}{return} [txt]
354 
355     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'dialog'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} history:
356         history[\textcolor{stringliteral}{'dialog'}] = deque(maxlen=historyLength)
357         history[\textcolor{stringliteral}{'episode\_done'}] = \textcolor{keyword}{False}
358         history[\textcolor{stringliteral}{'labels'}] = []
359 
360     \textcolor{keywordflow}{if} history[\textcolor{stringliteral}{'episode\_done'}]:
361         history[\textcolor{stringliteral}{'dialog'}].clear()
362         history[\textcolor{stringliteral}{'labels'}] = []
363         useReplies = \textcolor{stringliteral}{'none'}
364         history[\textcolor{stringliteral}{'episode\_done'}] = \textcolor{keyword}{False}
365 
366     \textcolor{keywordflow}{if} useReplies != \textcolor{stringliteral}{'none'}:
367         \textcolor{keywordflow}{if} useReplies == \textcolor{stringliteral}{'model'} \textcolor{keywordflow}{or} (
368             useReplies == \textcolor{stringliteral}{'label\_else\_model'} \textcolor{keywordflow}{and} len(history[\textcolor{stringliteral}{'labels'}]) == 0
369         ):
370             \textcolor{keywordflow}{if} reply:
371                 \textcolor{keywordflow}{if} useStartEndIndices:
372                     reply = dict.start\_token + \textcolor{stringliteral}{' '} + reply
373                 history[\textcolor{stringliteral}{'dialog'}].extend(parse(reply, splitSentences))
374         \textcolor{keywordflow}{elif} len(history[\textcolor{stringliteral}{'labels'}]) > 0:
375             r = history[\textcolor{stringliteral}{'labels'}][0]
376             history[\textcolor{stringliteral}{'dialog'}].extend(parse(r, splitSentences))
377 
378     obs = observation
379     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'text'} \textcolor{keywordflow}{in} obs:
380         \textcolor{keywordflow}{if} useStartEndIndices:
381             obs[\textcolor{stringliteral}{'text'}] = dict.end\_token + \textcolor{stringliteral}{' '} + obs[\textcolor{stringliteral}{'text'}]
382         history[\textcolor{stringliteral}{'dialog'}].extend(parse(obs[\textcolor{stringliteral}{'text'}], splitSentences))
383 
384     history[\textcolor{stringliteral}{'episode\_done'}] = obs[\textcolor{stringliteral}{'episode\_done'}]
385 
386     labels = obs.get(\textcolor{stringliteral}{'labels'}, obs.get(\textcolor{stringliteral}{'eval\_labels'}, \textcolor{keywordtype}{None}))
387     \textcolor{keywordflow}{if} labels \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
388         \textcolor{keywordflow}{if} useStartEndIndices:
389             history[\textcolor{stringliteral}{'labels'}] = [dict.start\_token + \textcolor{stringliteral}{' '} + l \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} labels]
390         \textcolor{keywordflow}{else}:
391             history[\textcolor{stringliteral}{'labels'}] = labels
392 
393     \textcolor{keywordflow}{return} history[\textcolor{stringliteral}{'dialog'}]
394 
395 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a5fbd3301b67f00d6d146fb01c7cd7626}\label{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a5fbd3301b67f00d6d146fb01c7cd7626}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0}!modelzoo\+\_\+path@{modelzoo\+\_\+path}}
\index{modelzoo\+\_\+path@{modelzoo\+\_\+path}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0}}
\subsubsection{\texorpdfstring{modelzoo\+\_\+path()}{modelzoo\_path()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+utils\+\_\+v0.\+modelzoo\+\_\+path (\begin{DoxyParamCaption}\item[{}]{datapath,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}If path starts with 'models', then we remap it to the model zoo path within the data
directory (default is ParlAI/data/models).

We download models from the model zoo if they are not here yet.
\end{DoxyVerb}
 

Definition at line 756 of file utils\+\_\+v0.\+py.


\begin{DoxyCode}
756 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a5fbd3301b67f00d6d146fb01c7cd7626}{modelzoo\_path}(datapath, path):
757     \textcolor{stringliteral}{"""}
758 \textcolor{stringliteral}{    If path starts with 'models', then we remap it to the model zoo path within the data}
759 \textcolor{stringliteral}{    directory (default is ParlAI/data/models).}
760 \textcolor{stringliteral}{}
761 \textcolor{stringliteral}{    We download models from the model zoo if they are not here yet.}
762 \textcolor{stringliteral}{    """}
763     \textcolor{keywordflow}{if} path \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
764         \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
765     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} path.startswith(\textcolor{stringliteral}{'models:'}):
766         \textcolor{keywordflow}{return} path
767     \textcolor{keywordflow}{else}:
768         \textcolor{comment}{# Check if we need to download the model}
769         animal = path[7 : path.rfind(\textcolor{stringliteral}{'/'})].replace(\textcolor{stringliteral}{'/'}, \textcolor{stringliteral}{'.'})
770         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'.'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} animal:
771             animal += \textcolor{stringliteral}{'.build'}
772         module\_name = \textcolor{stringliteral}{'parlai.zoo.\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(animal)
773         \textcolor{keywordflow}{try}:
774             my\_module = importlib.import\_module(module\_name)
775             my\_module.download(datapath)
776         \textcolor{keywordflow}{except} (ImportError, AttributeError):
777             \textcolor{keywordflow}{pass}
778 
779         \textcolor{keywordflow}{return} os.path.join(datapath, \textcolor{stringliteral}{'models'}, path[7:])
780 \end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}\label{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0}!round\+\_\+sigfigs@{round\+\_\+sigfigs}}
\index{round\+\_\+sigfigs@{round\+\_\+sigfigs}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::utils\+\_\+v0}}
\subsubsection{\texorpdfstring{round\+\_\+sigfigs()}{round\_sigfigs()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+utils\+\_\+v0.\+round\+\_\+sigfigs (\begin{DoxyParamCaption}\item[{}]{x,  }\item[{}]{sigfigs = {\ttfamily 4} }\end{DoxyParamCaption})}



Definition at line 396 of file utils\+\_\+v0.\+py.


\begin{DoxyCode}
396 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}{round\_sigfigs}(x, sigfigs=4):
397     \textcolor{keywordflow}{try}:
398         \textcolor{keywordflow}{if} x == 0:
399             \textcolor{keywordflow}{return} 0
400         \textcolor{keywordflow}{return} round(x, -math.floor(math.log10(abs(x)) - sigfigs + 1))
401     \textcolor{keywordflow}{except} (RuntimeError, TypeError):
402         \textcolor{comment}{# handle 1D torch tensors}
403         \textcolor{comment}{# if anything else breaks here please file an issue on Github}
404         \textcolor{keywordflow}{if} hasattr(x, \textcolor{stringliteral}{'item'}):
405             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}{round\_sigfigs}(x.item(), sigfigs)
406         \textcolor{keywordflow}{else}:
407             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}{round\_sigfigs}(x[0], sigfigs)
408     \textcolor{keywordflow}{except} (ValueError, OverflowError) \textcolor{keyword}{as} ex:
409         \textcolor{keywordflow}{if} x \textcolor{keywordflow}{in} [\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'inf'}), \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'-inf'})] \textcolor{keywordflow}{or} x != x:  \textcolor{comment}{# inf or nan}
410             \textcolor{keywordflow}{return} x
411         \textcolor{keywordflow}{else}:
412             \textcolor{keywordflow}{raise} ex
413 
414 
\end{DoxyCode}
