\hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender}{}\section{parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender Class Reference}
\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender}\index{parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender@{parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender}}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_aaedf425b46271ec9c4b36f4b01914496}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, secret\+\_\+token)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a09b98552efb831c4066b1dd376de956d}{send\+\_\+sender\+\_\+action} (self, receiver\+\_\+id, action, persona\+\_\+id=None)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a69771368344f7fa86ab28bb0ad2a61e5}{send\+\_\+read} (self, receiver\+\_\+id)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_ade12174a453cd019fefc4aed2f811fd5}{typing\+\_\+on} (self, receiver\+\_\+id, persona\+\_\+id=None)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a7ed82af2bbe053084c457da301fb9759}{send\+\_\+fb\+\_\+payload} (self, receiver\+\_\+id, payload, quick\+\_\+replies=None, persona\+\_\+id=None)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_af4854bc64730dc49290816a6d3da2541}{send\+\_\+fb\+\_\+message} (self, receiver\+\_\+id, message, is\+\_\+response, quick\+\_\+replies=None, persona\+\_\+id=None)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_abd0bb6dbaec08355b16c4df8e9e72e2f}{create\+\_\+persona} (self, name, image\+\_\+url)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a511cc34a215c25dfeed69810523eb8e4}{delete\+\_\+persona} (self, persona\+\_\+id)
\item 
def \hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a7b12a4f091ba64baa59c0749f8531190}{upload\+\_\+fb\+\_\+attachment} (self, payload)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a748eb4858eed560aba381963050ad4b1}{auth\+\_\+args}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}MesageSender is a wrapper around the facebook messenger requests that simplifies the
process of sending content.
\end{DoxyVerb}
 

Definition at line 149 of file message\+\_\+sender.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_aaedf425b46271ec9c4b36f4b01914496}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_aaedf425b46271ec9c4b36f4b01914496}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{secret\+\_\+token }\end{DoxyParamCaption})}

\begin{DoxyVerb}server_url:           url at which the server is to be run
port:                 port for the socket to operate on
message_callback:     function to be called on incoming message objects
              format: message_callback(self, data)
\end{DoxyVerb}
 

Definition at line 155 of file message\+\_\+sender.\+py.


\begin{DoxyCode}
155     \textcolor{keyword}{def }\_\_init\_\_(self, secret\_token):
156         \textcolor{stringliteral}{"""}
157 \textcolor{stringliteral}{        server\_url:           url at which the server is to be run}
158 \textcolor{stringliteral}{        port:                 port for the socket to operate on}
159 \textcolor{stringliteral}{        message\_callback:     function to be called on incoming message objects}
160 \textcolor{stringliteral}{                              format: message\_callback(self, data)}
161 \textcolor{stringliteral}{        """}
162         self.auth\_args = \{\textcolor{stringliteral}{'access\_token'}: secret\_token\}
163 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_abd0bb6dbaec08355b16c4df8e9e72e2f}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_abd0bb6dbaec08355b16c4df8e9e72e2f}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}!create\+\_\+persona@{create\+\_\+persona}}
\index{create\+\_\+persona@{create\+\_\+persona}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}}
\subsubsection{\texorpdfstring{create\+\_\+persona()}{create\_persona()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender.\+create\+\_\+persona (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{name,  }\item[{}]{image\+\_\+url }\end{DoxyParamCaption})}

\begin{DoxyVerb}Creates a new persona and returns persona_id.
\end{DoxyVerb}
 

Definition at line 251 of file message\+\_\+sender.\+py.


\begin{DoxyCode}
251     \textcolor{keyword}{def }create\_persona(self, name, image\_url):
252         \textcolor{stringliteral}{"""}
253 \textcolor{stringliteral}{        Creates a new persona and returns persona\_id.}
254 \textcolor{stringliteral}{        """}
255         api\_address = \textcolor{stringliteral}{'https://graph.facebook.com/me/personas'}
256         message = \{\textcolor{stringliteral}{'name'}: name, \textcolor{stringliteral}{"profile\_picture\_url"}: image\_url\}
257         response = requests.post(api\_address, params=self.auth\_args, json=message)
258         result = response.json()
259         shared\_utils.print\_and\_log(
260             logging.INFO, \textcolor{stringliteral}{'"Facebook response from create persona: \{\}"'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(result)
261         )
262         \textcolor{keywordflow}{return} result
263 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a511cc34a215c25dfeed69810523eb8e4}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a511cc34a215c25dfeed69810523eb8e4}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}!delete\+\_\+persona@{delete\+\_\+persona}}
\index{delete\+\_\+persona@{delete\+\_\+persona}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}}
\subsubsection{\texorpdfstring{delete\+\_\+persona()}{delete\_persona()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender.\+delete\+\_\+persona (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{persona\+\_\+id }\end{DoxyParamCaption})}

\begin{DoxyVerb}Deletes the persona.
\end{DoxyVerb}
 

Definition at line 264 of file message\+\_\+sender.\+py.


\begin{DoxyCode}
264     \textcolor{keyword}{def }delete\_persona(self, persona\_id):
265         \textcolor{stringliteral}{"""}
266 \textcolor{stringliteral}{        Deletes the persona.}
267 \textcolor{stringliteral}{        """}
268         api\_address = \textcolor{stringliteral}{'https://graph.facebook.com/'} + persona\_id
269         response = requests.delete(api\_address, params=self.auth\_args)
270         result = response.json()
271         shared\_utils.print\_and\_log(
272             logging.INFO, \textcolor{stringliteral}{'"Facebook response from delete persona: \{\}"'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(result)
273         )
274         \textcolor{keywordflow}{return} result
275 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_af4854bc64730dc49290816a6d3da2541}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_af4854bc64730dc49290816a6d3da2541}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}!send\+\_\+fb\+\_\+message@{send\+\_\+fb\+\_\+message}}
\index{send\+\_\+fb\+\_\+message@{send\+\_\+fb\+\_\+message}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}}
\subsubsection{\texorpdfstring{send\+\_\+fb\+\_\+message()}{send\_fb\_message()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender.\+send\+\_\+fb\+\_\+message (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{receiver\+\_\+id,  }\item[{}]{message,  }\item[{}]{is\+\_\+response,  }\item[{}]{quick\+\_\+replies = {\ttfamily None},  }\item[{}]{persona\+\_\+id = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Sends a message directly to messenger.
\end{DoxyVerb}
 

Definition at line 217 of file message\+\_\+sender.\+py.


\begin{DoxyCode}
217     ):
218         \textcolor{stringliteral}{"""}
219 \textcolor{stringliteral}{        Sends a message directly to messenger.}
220 \textcolor{stringliteral}{        """}
221         api\_address = \textcolor{stringliteral}{'https://graph.facebook.com/v2.6/me/messages'}
222         \textcolor{keywordflow}{if} quick\_replies \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
223             quick\_replies = [\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_a895e006007913ad0fde9c2c9bf9ec5a5}{create\_reply\_option}(x, x) \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} quick\_replies]
224         ms = \hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_a4c32dfd7947a473a730b81e9356e3513}{create\_text\_message}(message, quick\_replies)
225         results = []
226         \textcolor{keywordflow}{for} m \textcolor{keywordflow}{in} ms:
227             \textcolor{keywordflow}{if} m[\textcolor{stringliteral}{'text'}] == \textcolor{stringliteral}{''}:
228                 \textcolor{keywordflow}{continue}  \textcolor{comment}{# Skip blank messages}
229             payload = \{
230                 \textcolor{stringliteral}{"messaging\_type"}: \textcolor{stringliteral}{'RESPONSE'} \textcolor{keywordflow}{if} is\_response \textcolor{keywordflow}{else} \textcolor{stringliteral}{'UPDATE'},
231                 \textcolor{stringliteral}{"recipient"}: \{\textcolor{stringliteral}{"id"}: receiver\_id\},
232                 \textcolor{stringliteral}{"message"}: m,
233             \}
234             \textcolor{keywordflow}{if} persona\_id \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
235                 payload[\textcolor{stringliteral}{'persona\_id'}] = persona\_id
236             response = requests.post(api\_address, params=self.auth\_args, json=payload)
237             result = response.json()
238             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'error'} \textcolor{keywordflow}{in} result:
239                 \textcolor{keywordflow}{if} result[\textcolor{stringliteral}{'error'}][\textcolor{stringliteral}{'code'}] == 1200:
240                     \textcolor{comment}{# temporary error please retry}
241                     response = requests.post(
242                         api\_address, params=self.auth\_args, json=payload
243                     )
244                     result = response.json()
245             shared\_utils.print\_and\_log(
246                 logging.INFO, \textcolor{stringliteral}{'"Facebook response from message send: \{\}"'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(result)
247             )
248             results.append(result)
249         \textcolor{keywordflow}{return} results
250 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a7ed82af2bbe053084c457da301fb9759}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a7ed82af2bbe053084c457da301fb9759}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}!send\+\_\+fb\+\_\+payload@{send\+\_\+fb\+\_\+payload}}
\index{send\+\_\+fb\+\_\+payload@{send\+\_\+fb\+\_\+payload}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}}
\subsubsection{\texorpdfstring{send\+\_\+fb\+\_\+payload()}{send\_fb\_payload()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender.\+send\+\_\+fb\+\_\+payload (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{receiver\+\_\+id,  }\item[{}]{payload,  }\item[{}]{quick\+\_\+replies = {\ttfamily None},  }\item[{}]{persona\+\_\+id = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Sends a payload to messenger, processes it if we can.
\end{DoxyVerb}
 

Definition at line 179 of file message\+\_\+sender.\+py.


\begin{DoxyCode}
179     ):
180         \textcolor{stringliteral}{"""}
181 \textcolor{stringliteral}{        Sends a payload to messenger, processes it if we can.}
182 \textcolor{stringliteral}{        """}
183         api\_address = \textcolor{stringliteral}{'https://graph.facebook.com/v2.6/me/messages'}
184         \textcolor{keywordflow}{if} payload[\textcolor{stringliteral}{'type'}] == \textcolor{stringliteral}{'list'}:
185             data = \hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_aad605cb9ba870a032f7b09775bebabb1}{create\_compact\_list\_message}(payload[\textcolor{stringliteral}{'data'}])
186         \textcolor{keywordflow}{elif} payload[\textcolor{stringliteral}{'type'}] \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'image'}, \textcolor{stringliteral}{'video'}, \textcolor{stringliteral}{'file'}, \textcolor{stringliteral}{'audio'}]:
187             data = \hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_a8303c44a600b84c0d42770128be13e9a}{create\_attachment}(payload)
188         \textcolor{keywordflow}{else}:
189             data = payload[\textcolor{stringliteral}{'data'}]
190 
191         message = \{
192             \textcolor{stringliteral}{"messaging\_type"}: \textcolor{stringliteral}{'RESPONSE'},
193             \textcolor{stringliteral}{"recipient"}: \{\textcolor{stringliteral}{"id"}: receiver\_id\},
194             \textcolor{stringliteral}{"message"}: \{\textcolor{stringliteral}{"attachment"}: data\},
195         \}
196         \textcolor{keywordflow}{if} quick\_replies \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
197             quick\_replies = [\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_a895e006007913ad0fde9c2c9bf9ec5a5}{create\_reply\_option}(x, x) \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} quick\_replies]
198             message[\textcolor{stringliteral}{'message'}][\textcolor{stringliteral}{'quick\_replies'}] = quick\_replies
199         \textcolor{keywordflow}{if} persona\_id \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
200             payload[\textcolor{stringliteral}{'persona\_id'}] = persona\_id
201         response = requests.post(api\_address, params=self.auth\_args, json=message)
202         result = response.json()
203         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'error'} \textcolor{keywordflow}{in} result:
204             \textcolor{keywordflow}{if} result[\textcolor{stringliteral}{'error'}][\textcolor{stringliteral}{'code'}] == 1200:
205                 \textcolor{comment}{# temporary error please retry}
206                 response = requests.post(
207                     api\_address, params=self.auth\_args, json=message
208                 )
209                 result = response.json()
210         shared\_utils.print\_and\_log(
211             logging.INFO, \textcolor{stringliteral}{'"Facebook response from message send: \{\}"'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(result)
212         )
213         \textcolor{keywordflow}{return} result
214 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a69771368344f7fa86ab28bb0ad2a61e5}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a69771368344f7fa86ab28bb0ad2a61e5}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}!send\+\_\+read@{send\+\_\+read}}
\index{send\+\_\+read@{send\+\_\+read}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}}
\subsubsection{\texorpdfstring{send\+\_\+read()}{send\_read()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender.\+send\+\_\+read (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{receiver\+\_\+id }\end{DoxyParamCaption})}



Definition at line 171 of file message\+\_\+sender.\+py.


\begin{DoxyCode}
171     \textcolor{keyword}{def }send\_read(self, receiver\_id):
172         self.send\_sender\_action(receiver\_id, \textcolor{stringliteral}{"mark\_seen"})
173 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a09b98552efb831c4066b1dd376de956d}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a09b98552efb831c4066b1dd376de956d}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}!send\+\_\+sender\+\_\+action@{send\+\_\+sender\+\_\+action}}
\index{send\+\_\+sender\+\_\+action@{send\+\_\+sender\+\_\+action}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}}
\subsubsection{\texorpdfstring{send\+\_\+sender\+\_\+action()}{send\_sender\_action()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender.\+send\+\_\+sender\+\_\+action (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{receiver\+\_\+id,  }\item[{}]{action,  }\item[{}]{persona\+\_\+id = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 164 of file message\+\_\+sender.\+py.


\begin{DoxyCode}
164     \textcolor{keyword}{def }send\_sender\_action(self, receiver\_id, action, persona\_id=None):
165         api\_address = \textcolor{stringliteral}{'https://graph.facebook.com/v2.6/me/messages'}
166         message = \{\textcolor{stringliteral}{'recipient'}: \{\textcolor{stringliteral}{'id'}: receiver\_id\}, \textcolor{stringliteral}{"sender\_action"}: action\}
167         \textcolor{keywordflow}{if} persona\_id \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
168             message[\textcolor{stringliteral}{'persona\_id'}] = persona\_id
169         requests.post(api\_address, params=self.auth\_args, json=message)
170 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_ade12174a453cd019fefc4aed2f811fd5}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_ade12174a453cd019fefc4aed2f811fd5}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}!typing\+\_\+on@{typing\+\_\+on}}
\index{typing\+\_\+on@{typing\+\_\+on}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}}
\subsubsection{\texorpdfstring{typing\+\_\+on()}{typing\_on()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender.\+typing\+\_\+on (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{receiver\+\_\+id,  }\item[{}]{persona\+\_\+id = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 174 of file message\+\_\+sender.\+py.


\begin{DoxyCode}
174     \textcolor{keyword}{def }typing\_on(self, receiver\_id, persona\_id=None):
175         self.send\_sender\_action(receiver\_id, \textcolor{stringliteral}{"typing\_on"}, persona\_id)
176 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a7b12a4f091ba64baa59c0749f8531190}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a7b12a4f091ba64baa59c0749f8531190}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}!upload\+\_\+fb\+\_\+attachment@{upload\+\_\+fb\+\_\+attachment}}
\index{upload\+\_\+fb\+\_\+attachment@{upload\+\_\+fb\+\_\+attachment}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}}
\subsubsection{\texorpdfstring{upload\+\_\+fb\+\_\+attachment()}{upload\_fb\_attachment()}}
{\footnotesize\ttfamily def parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender.\+upload\+\_\+fb\+\_\+attachment (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{payload }\end{DoxyParamCaption})}

\begin{DoxyVerb}Uploads an attachment using the Attachment Upload API and returns an attachment
ID.
\end{DoxyVerb}
 

Definition at line 276 of file message\+\_\+sender.\+py.


\begin{DoxyCode}
276     \textcolor{keyword}{def }upload\_fb\_attachment(self, payload):
277         \textcolor{stringliteral}{"""}
278 \textcolor{stringliteral}{        Uploads an attachment using the Attachment Upload API and returns an attachment}
279 \textcolor{stringliteral}{        ID.}
280 \textcolor{stringliteral}{        """}
281         api\_address = \textcolor{stringliteral}{'https://graph.facebook.com/v2.6/me/message\_attachments'}
282         \textcolor{keyword}{assert} payload[\textcolor{stringliteral}{'type'}] \textcolor{keywordflow}{in} [
283             \textcolor{stringliteral}{'image'},
284             \textcolor{stringliteral}{'video'},
285             \textcolor{stringliteral}{'file'},
286             \textcolor{stringliteral}{'audio'},
287         ], \textcolor{stringliteral}{'unsupported attachment type'}
288         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'url'} \textcolor{keywordflow}{in} payload:
289             message = \{
290                 \textcolor{stringliteral}{"message"}: \{
291                     \textcolor{stringliteral}{"attachment"}: \{
292                         \textcolor{stringliteral}{"type"}: payload[\textcolor{stringliteral}{'type'}],
293                         \textcolor{stringliteral}{"payload"}: \{\textcolor{stringliteral}{"is\_reusable"}: \textcolor{stringliteral}{"true"}, \textcolor{stringliteral}{"url"}: payload[\textcolor{stringliteral}{'url'}]\},
294                     \}
295                 \}
296             \}
297             response = requests.post(api\_address, params=self.auth\_args, json=message)
298         \textcolor{keywordflow}{elif} \textcolor{stringliteral}{'filename'} \textcolor{keywordflow}{in} payload:
299             message = \{
300                 \textcolor{stringliteral}{"attachment"}: \{
301                     \textcolor{stringliteral}{"type"}: payload[\textcolor{stringliteral}{'type'}],
302                     \textcolor{stringliteral}{"payload"}: \{\textcolor{stringliteral}{"is\_reusable"}: \textcolor{stringliteral}{"true"}\},
303                 \}
304             \}
305             with open(payload[\textcolor{stringliteral}{'filename'}], \textcolor{stringliteral}{'rb'}) \textcolor{keyword}{as} f:
306                 filedata = \{
307                     \textcolor{stringliteral}{"filedata"}: (
308                         payload[\textcolor{stringliteral}{'filename'}],
309                         f,
310                         payload[\textcolor{stringliteral}{'type'}] + \textcolor{stringliteral}{'/'} + payload[\textcolor{stringliteral}{'format'}],
311                     )
312                 \}
313                 response = requests.post(
314                     api\_address,
315                     params=self.auth\_args,
316                     data=\{\textcolor{stringliteral}{"message"}: json.dumps(message)\},
317                     files=filedata,
318                 )
319         result = response.json()
320         shared\_utils.print\_and\_log(
321             logging.INFO,
322             \textcolor{stringliteral}{'"Facebook response from attachment upload: \{\}"'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(result),
323         )
324         \textcolor{keywordflow}{return} result
325 \end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a748eb4858eed560aba381963050ad4b1}\label{classparlai_1_1chat__service_1_1services_1_1messenger_1_1message__sender_1_1MessageSender_a748eb4858eed560aba381963050ad4b1}} 
\index{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}!auth\+\_\+args@{auth\+\_\+args}}
\index{auth\+\_\+args@{auth\+\_\+args}!parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender@{parlai\+::chat\+\_\+service\+::services\+::messenger\+::message\+\_\+sender\+::\+Message\+Sender}}
\subsubsection{\texorpdfstring{auth\+\_\+args}{auth\_args}}
{\footnotesize\ttfamily parlai.\+chat\+\_\+service.\+services.\+messenger.\+message\+\_\+sender.\+Message\+Sender.\+auth\+\_\+args}



Definition at line 162 of file message\+\_\+sender.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/chat\+\_\+service/services/messenger/\hyperlink{message__sender_8py}{message\+\_\+sender.\+py}\end{DoxyCompactItemize}
