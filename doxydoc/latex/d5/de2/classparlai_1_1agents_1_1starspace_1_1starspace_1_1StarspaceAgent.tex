\hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent}{}\section{parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent Class Reference}
\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent}\index{parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent@{parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent}}


Inheritance diagram for parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=247pt]{de/d25/classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=247pt]{d7/da3/classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a6bdc1142c021946ee6cb409d4f9dc3c9}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_aae476e9cdd8b9672ae6c28ef9400f09e}{opt}, shared=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a4d5057250faeae3f3812603469daa282}{reset} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a4a03374eadb6aa60dcd01173f0f5aa6b}{share} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ab75a17fe54cbc5ba074ca2df457235d4}{override\+\_\+opt} (self, new\+\_\+opt)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ab08bd065e56f11ebe2ad30d3894c46c7}{parse} (self, text)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ad38444615578df64d2e341b2ce37a012}{t2v} (self, text)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a070074c4396b7ea6edc56e190e0c011f}{v2t} (self, vec)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a788b504ead65ec6af074717226cc07bb}{observe} (self, \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a0ec7b24305a7ca5f0fd5a11cd6aa1fdc}{observation})
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a763de34b8d6464cbaa1ba17bf83f7df0}{same} (self, y1, y2)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a9591d5f485debcf4611e24be38900b5e}{get\+\_\+negs} (self, xs, ys)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_abf3eb0a95a46ba21d819ef09465390c3}{dict\+\_\+neighbors} (self, word, use\+R\+HS=False)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a69d9fa941c82271637287a44fde88cb3}{compute\+\_\+metrics} (self, loss, scores)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a6511fc8a4d2687cd99a981b4e3b6a589}{input\+\_\+dropout} (self, xs, ys, negs)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a16753fa083c07bcdb8164116d8288b39}{predict} (self, xs, ys=None, \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a1986fb638717b81936ada2bf418b259f}{cands}=None, cands\+\_\+txt=None, obs=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a87253cca09c8b22848ff0bea7195e32d}{vectorize} (self, observations)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ace15d00770ddf83193ddee499c7c87a1}{add\+\_\+to\+\_\+ys\+\_\+cache} (self, ys)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a426f2fb245c6a0a409365c4662aec2d2}{batch\+\_\+act} (self, observations)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_aff87fb1b28e798a9ca28a0dc3fbb2f22}{act} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a4016a83cf0ed9ed97c8b94d9eacbcae3}{shutdown} (self)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a55b3dab4e31cee40441105efb66004ac}{save} (self, path=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a57f2fcd5e04246f3d8edf57ccdb99eab}{load} (self, path)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a04d4db961ea8e3ed0ca1cb4cc7a7eca5}{dictionary\+\_\+class} ()
\item 
def \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ace1f02a93ef83c9623ab599f9be26d66}{add\+\_\+cmdline\+\_\+args} (argparser)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a78a530a11ff03bce1e41831e560163bc}{id}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_aee34a5667cc7acbeaacc5b9563487087}{N\+U\+L\+L\+\_\+\+I\+DX}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a1986fb638717b81936ada2bf418b259f}{cands}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a050c7f6c495b0bccc9c29caa5c83d0ae}{ys\+\_\+cache}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a6f300619fe9d0814ed612db691ec9dab}{ys\+\_\+cache\+\_\+sz}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a9c521ca705e241271b6bb34bd5b22bea}{truncate}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a652778d6927eaf8633dc1d8cbeab9409}{history}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a668af7bc10cad919c8deff9b4f82e6d9}{debug\+Mode}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a650dfa9753ea9d80f8a81823d9fdc50a}{dict}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a1bf1dacfd9d58385bd7da5bcd574cb0f}{model}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a384ddfe5e4ad6c08243e6b8b1136ecbc}{criterion}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a787ee6df16019fb6b9f78c7137070056}{fixed\+Cands}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a152e023a9ed4b162ab66e5d2e97f5f4e}{fixedX}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a13eba6e6eb10b366d145863b538571b7}{fixed\+Cands\+\_\+txt}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a0ec7b24305a7ca5f0fd5a11cd6aa1fdc}{observation}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ad6565ef570b709afb46bf9a9b4bc59c3}{episode\+\_\+done}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_afacbbd91785631f9b23fd0fbd9b4cc21}{optimizer}
\item 
\hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_aae476e9cdd8b9672ae6c28ef9400f09e}{opt}
\end{DoxyCompactItemize}
\subsection*{Static Public Attributes}
\begin{DoxyCompactItemize}
\item 
dictionary \hyperlink{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ab9c156709a8072a6cddf7216396f610a}{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Simple implementation of the starspace algorithm: https://arxiv.org/abs/1709.03856.
\end{DoxyVerb}
 

Definition at line 28 of file starspace.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a6bdc1142c021946ee6cb409d4f9dc3c9}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a6bdc1142c021946ee6cb409d4f9dc3c9}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Set up model if shared params not set, otherwise no work to do.
\end{DoxyVerb}
 

Definition at line 179 of file starspace.\+py.


\begin{DoxyCode}
179     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
180         \textcolor{stringliteral}{"""}
181 \textcolor{stringliteral}{        Set up model if shared params not set, otherwise no work to do.}
182 \textcolor{stringliteral}{        """}
183         super().\_\_init\_\_(opt, shared)
184         opt = self.opt
185         self.reset\_metrics()
186         self.id = \textcolor{stringliteral}{'Starspace'}
187         self.NULL\_IDX = 0
188         self.cands = torch.LongTensor(1, 1, 1)
189         self.ys\_cache = []
190         self.ys\_cache\_sz = opt[\textcolor{stringliteral}{'cache\_size'}]
191         self.truncate = opt[\textcolor{stringliteral}{'truncate'}] \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'truncate'}] > 0 \textcolor{keywordflow}{else} \textcolor{keywordtype}{None}
192         self.history = \{\}
193         self.debugMode = \textcolor{keyword}{False}
194         \textcolor{keywordflow}{if} shared:
195             torch.set\_num\_threads(1)
196             \textcolor{comment}{# set up shared properties}
197             self.dict = shared[\textcolor{stringliteral}{'dict'}]
198             self.model = shared[\textcolor{stringliteral}{'model'}]
199         \textcolor{keywordflow}{else}:
200             print(\textcolor{stringliteral}{"[ creating StarspaceAgent ]"})
201             \textcolor{comment}{# this is not a shared instance of this class, so do full init}
202             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'model\_file'}) \textcolor{keywordflow}{and} (
203                 os.path.isfile(opt.get(\textcolor{stringliteral}{'model\_file'}) + \textcolor{stringliteral}{'.dict'})
204                 \textcolor{keywordflow}{or} (opt[\textcolor{stringliteral}{'dict\_file'}] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None})
205             ):
206                 \textcolor{comment}{# set default dict-file if not set}
207                 opt[\textcolor{stringliteral}{'dict\_file'}] = opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'.dict'}
208             \textcolor{comment}{# load dictionary and basic tokens & vectors}
209             self.dict = DictionaryAgent(opt)
210 
211             self.model = Starspace(opt, len(self.dict), self.dict)
212             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'model\_file'}) \textcolor{keywordflow}{and} os.path.isfile(opt[\textcolor{stringliteral}{'model\_file'}]):
213                 self.load(opt[\textcolor{stringliteral}{'model\_file'}])
214             \textcolor{keywordflow}{else}:
215                 self.\_init\_embeddings()
216             self.model.share\_memory()
217 
218         \textcolor{comment}{# set up modules}
219         self.criterion = torch.nn.CosineEmbeddingLoss(
220             margin=opt[\textcolor{stringliteral}{'margin'}], size\_average=\textcolor{keyword}{False}
221         )
222         self.reset()
223         self.fixedCands = \textcolor{keyword}{False}
224         self.fixedX = \textcolor{keywordtype}{None}
225         \textcolor{keywordflow}{if} self.opt.get(\textcolor{stringliteral}{'fixed\_candidates\_file'}):
226             self.fixedCands\_txt = \hyperlink{namespaceparlai_1_1utils_1_1misc_ad935ab0a9d49b897c5e3efdbe1c46c4d}{load\_cands}(self.opt.get(\textcolor{stringliteral}{'fixed\_candidates\_file'}))
227             fcs = []
228             \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} self.fixedCands\_txt:
229                 fcs.append(torch.LongTensor(self.parse(c)).unsqueeze(0))
230             self.fixedCands = fcs
231             print(\textcolor{stringliteral}{"[loaded candidates]"})
232 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_aff87fb1b28e798a9ca28a0dc3fbb2f22}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_aff87fb1b28e798a9ca28a0dc3fbb2f22}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!act@{act}}
\index{act@{act}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{act()}{act()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+act (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 572 of file starspace.\+py.


\begin{DoxyCode}
572     \textcolor{keyword}{def }act(self):
573         \textcolor{comment}{# call batch\_act with this batch of one}
574         \textcolor{keywordflow}{return} self.batch\_act([self.observation])[0]
575 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ace1f02a93ef83c9623ab599f9be26d66}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ace1f02a93ef83c9623ab599f9be26d66}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}}
\index{add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+cmdline\+\_\+args()}{add\_cmdline\_args()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+add\+\_\+cmdline\+\_\+args (\begin{DoxyParamCaption}\item[{}]{argparser }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\begin{DoxyVerb}Add command-line arguments specifically for this agent.
\end{DoxyVerb}
 

Definition at line 50 of file starspace.\+py.


\begin{DoxyCode}
50     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(argparser):
51         \textcolor{stringliteral}{"""}
52 \textcolor{stringliteral}{        Add command-line arguments specifically for this agent.}
53 \textcolor{stringliteral}{        """}
54         agent = argparser.add\_argument\_group(\textcolor{stringliteral}{'StarSpace Arguments'})
55         agent.add\_argument(
56             \textcolor{stringliteral}{'-emb'},
57             \textcolor{stringliteral}{'--embedding-type'},
58             default=\textcolor{stringliteral}{'random'},
59             choices=[
60                 \textcolor{stringliteral}{'random'},
61                 \textcolor{stringliteral}{'glove'},
62                 \textcolor{stringliteral}{'glove-fixed'},
63                 \textcolor{stringliteral}{'glove-twitter-fixed'},
64                 \textcolor{stringliteral}{'fasttext'},
65                 \textcolor{stringliteral}{'fasttext-fixed'},
66                 \textcolor{stringliteral}{'fasttext\_cc'},
67                 \textcolor{stringliteral}{'fasttext\_cc-fixed'},
68             ],
69             help=\textcolor{stringliteral}{'Choose between different strategies for initializing word '}
70             \textcolor{stringliteral}{'embeddings. Default is random, but can also preinitialize '}
71             \textcolor{stringliteral}{'from Glove or Fasttext. Preinitialized embeddings can also '}
72             \textcolor{stringliteral}{'be fixed so they are not updated during training.'},
73         )
74         agent.add\_argument(
75             \textcolor{stringliteral}{'-esz'},
76             \textcolor{stringliteral}{'--embeddingsize'},
77             type=int,
78             default=128,
79             help=\textcolor{stringliteral}{'size of the token embeddings'},
80         )
81         agent.add\_argument(
82             \textcolor{stringliteral}{'-enorm'},
83             \textcolor{stringliteral}{'--embeddingnorm'},
84             type=float,
85             default=10,
86             help=\textcolor{stringliteral}{'max norm of word embeddings'},
87         )
88         agent.add\_argument(
89             \textcolor{stringliteral}{'-shareEmb'},
90             \textcolor{stringliteral}{'--share-embeddings'},
91             type=\textcolor{stringliteral}{'bool'},
92             default=\textcolor{keyword}{True},
93             help=\textcolor{stringliteral}{'whether LHS and RHS share embeddings'},
94         )
95         agent.add\_argument(
96             \textcolor{stringliteral}{'--lins'},
97             default=0,
98             type=int,
99             help=\textcolor{stringliteral}{'If set to 1, add a linear layer between lhs and rhs.'},
100         )
101         agent.add\_argument(
102             \textcolor{stringliteral}{'-lr'}, \textcolor{stringliteral}{'--learningrate'}, type=float, default=0.1, help=\textcolor{stringliteral}{'learning rate'}
103         )
104         agent.add\_argument(
105             \textcolor{stringliteral}{'-margin'}, \textcolor{stringliteral}{'--margin'}, type=float, default=0.1, help=\textcolor{stringliteral}{'margin'}
106         )
107         agent.add\_argument(
108             \textcolor{stringliteral}{'--input\_dropout'},
109             type=float,
110             default=0,
111             help=\textcolor{stringliteral}{'fraction of input/output features to dropout during training'},
112         )
113         agent.add\_argument(
114             \textcolor{stringliteral}{'-opt'},
115             \textcolor{stringliteral}{'--optimizer'},
116             default=\textcolor{stringliteral}{'sgd'},
117             choices=StarspaceAgent.OPTIM\_OPTS.keys(),
118             help=\textcolor{stringliteral}{'Choose between pytorch optimizers. '}
119             \textcolor{stringliteral}{'Any member of torch.optim is valid and will '}
120             \textcolor{stringliteral}{'be used with default params except learning '}
121             \textcolor{stringliteral}{'rate (as specified by -lr).'},
122         )
123         agent.add\_argument(
124             \textcolor{stringliteral}{'-tr'},
125             \textcolor{stringliteral}{'--truncate'},
126             type=int,
127             default=-1,
128             help=\textcolor{stringliteral}{'truncate input & output lengths to speed up '}
129             \textcolor{stringliteral}{'training (may reduce accuracy). This fixes all '}
130             \textcolor{stringliteral}{'input and output to have a maximum length.'},
131         )
132         agent.add\_argument(
133             \textcolor{stringliteral}{'-k'},
134             \textcolor{stringliteral}{'--neg-samples'},
135             type=int,
136             default=10,
137             help=\textcolor{stringliteral}{'number k of negative samples per example'},
138         )
139         agent.add\_argument(
140             \textcolor{stringliteral}{'--parrot-neg'}, type=int, default=0, help=\textcolor{stringliteral}{'include query as a negative'}
141         )
142         agent.add\_argument(
143             \textcolor{stringliteral}{'--tfidf'},
144             type=\textcolor{stringliteral}{'bool'},
145             default=\textcolor{keyword}{False},
146             help=\textcolor{stringliteral}{'Use frequency based normalization for embeddings.'},
147         )
148         agent.add\_argument(
149             \textcolor{stringliteral}{'-cs'},
150             \textcolor{stringliteral}{'--cache-size'},
151             type=int,
152             default=1000,
153             help=\textcolor{stringliteral}{'size of negative sample cache to draw from'},
154         )
155         agent.add\_argument(
156             \textcolor{stringliteral}{'-hist'},
157             \textcolor{stringliteral}{'--history-length'},
158             default=10000,
159             type=int,
160             help=\textcolor{stringliteral}{'Number of past tokens to remember. '},
161         )
162         agent.add\_argument(
163             \textcolor{stringliteral}{'-histr'},
164             \textcolor{stringliteral}{'--history-replies'},
165             default=\textcolor{stringliteral}{'label\_else\_model'},
166             type=str,
167             choices=[\textcolor{stringliteral}{'none'}, \textcolor{stringliteral}{'model'}, \textcolor{stringliteral}{'label'}, \textcolor{stringliteral}{'label\_else\_model'}],
168             help=\textcolor{stringliteral}{'Keep replies in the history, or not.'},
169         )
170         agent.add\_argument(
171             \textcolor{stringliteral}{'-fixedCands'},
172             \textcolor{stringliteral}{'--fixed-candidates-file'},
173             default=\textcolor{keywordtype}{None},
174             type=str,
175             help=\textcolor{stringliteral}{'File of cands to use for prediction'},
176         )
177         StarspaceAgent.dictionary\_class().\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(argparser)
178 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ace15d00770ddf83193ddee499c7c87a1}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ace15d00770ddf83193ddee499c7c87a1}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!add\+\_\+to\+\_\+ys\+\_\+cache@{add\+\_\+to\+\_\+ys\+\_\+cache}}
\index{add\+\_\+to\+\_\+ys\+\_\+cache@{add\+\_\+to\+\_\+ys\+\_\+cache}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+to\+\_\+ys\+\_\+cache()}{add\_to\_ys\_cache()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+add\+\_\+to\+\_\+ys\+\_\+cache (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{ys }\end{DoxyParamCaption})}



Definition at line 549 of file starspace.\+py.


\begin{DoxyCode}
549     \textcolor{keyword}{def }add\_to\_ys\_cache(self, ys):
550         \textcolor{keywordflow}{if} ys \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} len(ys) == 0:
551             \textcolor{keywordflow}{return}
552         \textcolor{keywordflow}{if} len(self.ys\_cache) < self.ys\_cache\_sz:
553             self.ys\_cache.append(copy.deepcopy(ys))
554         \textcolor{keywordflow}{else}:
555             ind = random.randint(0, self.ys\_cache\_sz - 1)
556             self.ys\_cache[ind] = copy.deepcopy(ys)
557 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a426f2fb245c6a0a409365c4662aec2d2}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a426f2fb245c6a0a409365c4662aec2d2}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!batch\+\_\+act@{batch\+\_\+act}}
\index{batch\+\_\+act@{batch\+\_\+act}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{batch\+\_\+act()}{batch\_act()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+batch\+\_\+act (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observations }\end{DoxyParamCaption})}



Definition at line 558 of file starspace.\+py.


\begin{DoxyCode}
558     \textcolor{keyword}{def }batch\_act(self, observations):
559         batchsize = len(observations)
560         \textcolor{comment}{# initialize a table of replies with this agent's id}
561         \textcolor{comment}{# convert the observations into batches of inputs and targets}
562         \textcolor{comment}{# valid\_inds tells us the indices of all valid examples}
563         \textcolor{comment}{# e.g. for input [\{\}, \{'text': 'hello'\}, \{\}, \{\}], valid\_inds is [1]}
564         \textcolor{comment}{# since the other three elements had no 'text' field}
565         xs, ys, cands, cands\_txt = self.vectorize(observations)
566         batch\_reply = self.predict(xs, ys, cands, cands\_txt, observations)
567         \textcolor{keywordflow}{while} len(batch\_reply) < batchsize:
568             batch\_reply.append(\{\textcolor{stringliteral}{'id'}: self.getID()\})
569         self.add\_to\_ys\_cache(ys)
570         \textcolor{keywordflow}{return} batch\_reply
571 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a69d9fa941c82271637287a44fde88cb3}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a69d9fa941c82271637287a44fde88cb3}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!compute\+\_\+metrics@{compute\+\_\+metrics}}
\index{compute\+\_\+metrics@{compute\+\_\+metrics}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{compute\+\_\+metrics()}{compute\_metrics()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+compute\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{loss,  }\item[{}]{scores }\end{DoxyParamCaption})}



Definition at line 386 of file starspace.\+py.


\begin{DoxyCode}
386     \textcolor{keyword}{def }compute\_metrics(self, loss, scores):
387         metrics = \{\}
388         pos = scores[0]
389         cnt = 0
390         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, len(scores)):
391             \textcolor{keywordflow}{if} scores[i] >= pos:
392                 cnt += 1
393         metrics[\textcolor{stringliteral}{'mean\_rank'}] = cnt
394         metrics[\textcolor{stringliteral}{'loss'}] = loss
395         \textcolor{keywordflow}{return} metrics
396 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_abf3eb0a95a46ba21d819ef09465390c3}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_abf3eb0a95a46ba21d819ef09465390c3}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!dict\+\_\+neighbors@{dict\+\_\+neighbors}}
\index{dict\+\_\+neighbors@{dict\+\_\+neighbors}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{dict\+\_\+neighbors()}{dict\_neighbors()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+dict\+\_\+neighbors (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{word,  }\item[{}]{use\+R\+HS = {\ttfamily False} }\end{DoxyParamCaption})}



Definition at line 367 of file starspace.\+py.


\begin{DoxyCode}
367     \textcolor{keyword}{def }dict\_neighbors(self, word, useRHS=False):
368         input = self.t2v(word)
369         W = self.model.encoder.lt.weight
370         q = W[input.data[0][0]]
371         \textcolor{keywordflow}{if} useRHS:
372             W = self.model.encoder2.lt.weight
373         score = torch.Tensor(W.size(0))
374         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(W.size(0)):
375             score[i] = torch.nn.functional.cosine\_similarity(q, W[i], dim=0).item()
376         val, ind = score.sort(descending=\textcolor{keyword}{True})
377         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(20):
378             print(
379                 \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(ind[i])
380                 + \textcolor{stringliteral}{" ["}
381                 + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(val[i])
382                 + \textcolor{stringliteral}{"]: "}
383                 + self.v2t(torch.Tensor([ind[i]]))
384             )
385 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a04d4db961ea8e3ed0ca1cb4cc7a7eca5}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a04d4db961ea8e3ed0ca1cb4cc7a7eca5}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!dictionary\+\_\+class@{dictionary\+\_\+class}}
\index{dictionary\+\_\+class@{dictionary\+\_\+class}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{dictionary\+\_\+class()}{dictionary\_class()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+dictionary\+\_\+class (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 46 of file starspace.\+py.


\begin{DoxyCode}
46     \textcolor{keyword}{def }dictionary\_class():
47         \textcolor{keywordflow}{return} DictionaryAgent
48 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a9591d5f485debcf4611e24be38900b5e}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a9591d5f485debcf4611e24be38900b5e}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!get\+\_\+negs@{get\+\_\+negs}}
\index{get\+\_\+negs@{get\+\_\+negs}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{get\+\_\+negs()}{get\_negs()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+get\+\_\+negs (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{xs,  }\item[{}]{ys }\end{DoxyParamCaption})}



Definition at line 347 of file starspace.\+py.


\begin{DoxyCode}
347     \textcolor{keyword}{def }get\_negs(self, xs, ys):
348         negs = []
349         cache\_sz = len(self.ys\_cache) - 1
350         \textcolor{keywordflow}{if} cache\_sz < 1:
351             \textcolor{keywordflow}{return} negs
352         k = self.opt[\textcolor{stringliteral}{'neg\_samples'}]
353         \textcolor{keywordflow}{for} \_i \textcolor{keywordflow}{in} range(1, k * 3):
354             index = random.randint(0, cache\_sz)
355             neg = self.ys\_cache[index]
356             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.same(ys, neg):
357                 negs.append(neg)
358                 \textcolor{keywordflow}{if} len(negs) >= k:
359                     \textcolor{keywordflow}{break}
360         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'parrot\_neg'}] > 0:
361             utt = self.history[\textcolor{stringliteral}{'last\_utterance'}]
362             \textcolor{keywordflow}{if} len(utt) > 2:
363                 query = torch.LongTensor(utt).unsqueeze(0)
364                 negs.append(query)
365         \textcolor{keywordflow}{return} negs
366 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a6511fc8a4d2687cd99a981b4e3b6a589}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a6511fc8a4d2687cd99a981b4e3b6a589}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!input\+\_\+dropout@{input\+\_\+dropout}}
\index{input\+\_\+dropout@{input\+\_\+dropout}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{input\+\_\+dropout()}{input\_dropout()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+input\+\_\+dropout (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{xs,  }\item[{}]{ys,  }\item[{}]{negs }\end{DoxyParamCaption})}



Definition at line 397 of file starspace.\+py.


\begin{DoxyCode}
397     \textcolor{keyword}{def }input\_dropout(self, xs, ys, negs):
398         \textcolor{keyword}{def }\hyperlink{namespaceseq2seq_1_1train_ad1c2b0c39f2fadec077284e46fd39c1f}{dropout}(x, rate):
399             xd = []
400             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} x[0]:
401                 \textcolor{keywordflow}{if} random.uniform(0, 1) > rate:
402                     xd.append(i)
403             \textcolor{keywordflow}{if} len(xd) == 0:
404                 \textcolor{comment}{# pick one random thing to put in xd}
405                 xd.append(x[0][random.randint(0, x.size(1) - 1)])
406             \textcolor{keywordflow}{return} torch.LongTensor(xd).unsqueeze(0)
407 
408         rate = self.opt.get(\textcolor{stringliteral}{'input\_dropout'})
409         xs2 = \hyperlink{namespaceseq2seq_1_1train_ad1c2b0c39f2fadec077284e46fd39c1f}{dropout}(xs, rate)
410         ys2 = \hyperlink{namespaceseq2seq_1_1train_ad1c2b0c39f2fadec077284e46fd39c1f}{dropout}(ys, rate)
411         negs2 = []
412         \textcolor{keywordflow}{for} n \textcolor{keywordflow}{in} negs:
413             negs2.append(\hyperlink{namespaceseq2seq_1_1train_ad1c2b0c39f2fadec077284e46fd39c1f}{dropout}(n, rate))
414         \textcolor{keywordflow}{return} xs2, ys2, negs2
415 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a57f2fcd5e04246f3d8edf57ccdb99eab}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a57f2fcd5e04246f3d8edf57ccdb99eab}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!load@{load}}
\index{load@{load}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{load()}{load()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+load (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return opt and model states.
\end{DoxyVerb}
 

Definition at line 595 of file starspace.\+py.


\begin{DoxyCode}
595     \textcolor{keyword}{def }load(self, path):
596         \textcolor{stringliteral}{"""}
597 \textcolor{stringliteral}{        Return opt and model states.}
598 \textcolor{stringliteral}{        """}
599         print(\textcolor{stringliteral}{'Loading existing model params from '} + path)
600         data = torch.load(path, map\_location=\textcolor{keyword}{lambda} cpu, \_: cpu)
601         self.model.load\_state\_dict(data[\textcolor{stringliteral}{'model'}])
602         self.reset()
603         self.optimizer.load\_state\_dict(data[\textcolor{stringliteral}{'optimizer'}])
604         self.opt = self.override\_opt(data[\textcolor{stringliteral}{'opt'}])
605 \end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a788b504ead65ec6af074717226cc07bb}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a788b504ead65ec6af074717226cc07bb}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!observe@{observe}}
\index{observe@{observe}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{observe()}{observe()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+observe (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observation }\end{DoxyParamCaption})}



Definition at line 325 of file starspace.\+py.


\begin{DoxyCode}
325     \textcolor{keyword}{def }observe(self, observation):
326         self.episode\_done = observation[\textcolor{stringliteral}{'episode\_done'}]
327         \textcolor{comment}{# shallow copy observation (deep copy can be expensive)}
328         obs = observation.copy()
329         obs[\textcolor{stringliteral}{'text2vec'}] = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_ac7cb3ffae208474d6e67f37ecfe07f64}{maintain\_dialog\_history}(
330             self.history,
331             obs,
332             historyLength=self.opt[\textcolor{stringliteral}{'history\_length'}],
333             useReplies=self.opt[\textcolor{stringliteral}{'history\_replies'}],
334             dict=self.dict,
335             useStartEndIndices=\textcolor{keyword}{False},
336         )
337         self.observation = obs
338         \textcolor{keywordflow}{return} obs
339 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ab75a17fe54cbc5ba074ca2df457235d4}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ab75a17fe54cbc5ba074ca2df457235d4}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!override\+\_\+opt@{override\+\_\+opt}}
\index{override\+\_\+opt@{override\+\_\+opt}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{override\+\_\+opt()}{override\_opt()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+override\+\_\+opt (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{new\+\_\+opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Set overridable opts from loaded opt file.

Print out each added key and each overriden key. Only override args specific to
the model.
\end{DoxyVerb}
 

Definition at line 280 of file starspace.\+py.


\begin{DoxyCode}
280     \textcolor{keyword}{def }override\_opt(self, new\_opt):
281         \textcolor{stringliteral}{"""}
282 \textcolor{stringliteral}{        Set overridable opts from loaded opt file.}
283 \textcolor{stringliteral}{}
284 \textcolor{stringliteral}{        Print out each added key and each overriden key. Only override args specific to}
285 \textcolor{stringliteral}{        the model.}
286 \textcolor{stringliteral}{        """}
287         model\_args = \{\textcolor{stringliteral}{'embeddingsize'}, \textcolor{stringliteral}{'optimizer'}\}
288         \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} new\_opt.items():
289             \textcolor{keywordflow}{if} k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} model\_args:
290                 \textcolor{comment}{# skip non-model args}
291                 \textcolor{keywordflow}{continue}
292             \textcolor{keywordflow}{if} k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.opt:
293                 print(\textcolor{stringliteral}{'Adding new option [ \{k\}: \{v\} ]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(k=k, v=v))
294             \textcolor{keywordflow}{elif} self.opt[k] != v:
295                 print(
296                     \textcolor{stringliteral}{'Overriding option [ \{k\}: \{old\} => \{v\}]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
297                         k=k, old=self.opt[k], v=v
298                     )
299                 )
300             self.opt[k] = v
301         \textcolor{keywordflow}{return} self.opt
302 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ab08bd065e56f11ebe2ad30d3894c46c7}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ab08bd065e56f11ebe2ad30d3894c46c7}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!parse@{parse}}
\index{parse@{parse}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{parse()}{parse()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+parse (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{text }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert string to token indices.
\end{DoxyVerb}
 

Definition at line 303 of file starspace.\+py.


\begin{DoxyCode}
303     \textcolor{keyword}{def }parse(self, text):
304         \textcolor{stringliteral}{"""}
305 \textcolor{stringliteral}{        Convert string to token indices.}
306 \textcolor{stringliteral}{        """}
307         vec = self.dict.txt2vec(text)
308         \textcolor{keywordflow}{if} vec == []:
309             vec = [self.dict[self.dict.null\_token]]
310         \textcolor{keywordflow}{return} vec
311 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a16753fa083c07bcdb8164116d8288b39}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a16753fa083c07bcdb8164116d8288b39}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!predict@{predict}}
\index{predict@{predict}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{predict()}{predict()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+predict (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{xs,  }\item[{}]{ys = {\ttfamily None},  }\item[{}]{cands = {\ttfamily None},  }\item[{}]{cands\+\_\+txt = {\ttfamily None},  }\item[{}]{obs = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Produce a prediction from our model.

Update the model using the targets if available, otherwise rank candidates as
well if they are available and param is set.
\end{DoxyVerb}
 

Definition at line 416 of file starspace.\+py.


\begin{DoxyCode}
416     \textcolor{keyword}{def }predict(self, xs, ys=None, cands=None, cands\_txt=None, obs=None):
417         \textcolor{stringliteral}{"""}
418 \textcolor{stringliteral}{        Produce a prediction from our model.}
419 \textcolor{stringliteral}{}
420 \textcolor{stringliteral}{        Update the model using the targets if available, otherwise rank candidates as}
421 \textcolor{stringliteral}{        well if they are available and param is set.}
422 \textcolor{stringliteral}{        """}
423         is\_training = ys \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
424         \textcolor{keywordflow}{if} is\_training:
425             negs = self.get\_negs(xs, ys)
426             \textcolor{keywordflow}{if} is\_training \textcolor{keywordflow}{and} len(negs) > 0:
427                 self.model.\hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a36a5f4f6f9df0611a6818610518d2cf0}{train}()
428                 self.optimizer.zero\_grad()
429                 \textcolor{keywordflow}{if} self.opt.get(\textcolor{stringliteral}{'input\_dropout'}, 0) > 0:
430                     xs, ys, negs = self.input\_dropout(xs, ys, negs)
431                 xe, ye = self.model(xs, ys, negs)
432                 \textcolor{keywordflow}{if} self.debugMode:
433                     \textcolor{comment}{# print example}
434                     print(\textcolor{stringliteral}{"inp: "} + self.v2t(xs.squeeze()))
435                     print(\textcolor{stringliteral}{"pos: "} + self.v2t(ys.squeeze()))
436                     \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} negs:
437                         print(\textcolor{stringliteral}{"neg: "} + self.v2t(c.squeeze()))
438                     print(\textcolor{stringliteral}{"---"})
439                 y = -torch.ones(xe.size(0))
440                 y[0] = 1
441                 loss = self.criterion(xe, ye, y)
442                 loss.backward()
443                 self.optimizer.step()
444                 pred = nn.CosineSimilarity().forward(xe, ye)
445                 metrics = self.compute\_metrics(loss.item(), pred.data.squeeze())
446                 \textcolor{keywordflow}{return} [\{\textcolor{stringliteral}{'metrics'}: metrics\}]
447         \textcolor{keywordflow}{else}:
448             self.model.eval()
449             \textcolor{keywordflow}{if} cands \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} cands[0] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
450                 \textcolor{comment}{# cannot predict without candidates.}
451                 \textcolor{keywordflow}{if} self.fixedCands:
452                     cands = [self.fixedCands]
453                     cands\_txt = [self.fixedCands\_txt]
454                 \textcolor{keywordflow}{else}:
455                     \textcolor{keywordflow}{return} [\{\textcolor{stringliteral}{'text'}: \textcolor{stringliteral}{'I dunno.'}\}]
456                 \textcolor{comment}{# test set prediction uses fixed candidates}
457                 \textcolor{keywordflow}{if} self.fixedX \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
458                     xe, ye = self.model(xs, ys, self.fixedCands)
459                     self.fixedX = ye
460                 \textcolor{keywordflow}{else}:
461                     \textcolor{comment}{# fixed candidate embed vectors are cached, dont't recompute}
462                     blah = torch.LongTensor([1])
463                     xe, ye = self.model(xs, ys, [blah])
464                     ye = self.fixedX
465             \textcolor{keywordflow}{else}:
466                 \textcolor{comment}{# test set prediction uses candidates}
467                 xe, ye = self.model(xs, ys, cands[0])
468             pred = nn.CosineSimilarity().forward(xe, ye)
469             \textcolor{comment}{# This is somewhat costly which we could avoid if we do not evalute ranking.}
470             \textcolor{comment}{# i.e. by only doing: val,ind = pred.max(0)}
471             val, ind = pred.sort(descending=\textcolor{keyword}{True})
472             \textcolor{comment}{# predict the highest scoring candidate, and return it.}
473             ypred = cands\_txt[0][ind.data[0]]
474             tc = []
475             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(min(100, ind.size(0))):
476                 tc.append(cands\_txt[0][ind.data[i]])
477             ret = [\{\textcolor{stringliteral}{'text'}: ypred, \textcolor{stringliteral}{'text\_candidates'}: tc\}]
478             \textcolor{keywordflow}{return} ret
479         \textcolor{keywordflow}{return} [\{\textcolor{stringliteral}{'id'}: self.getID()\}]
480 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a4d5057250faeae3f3812603469daa282}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a4d5057250faeae3f3812603469daa282}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!reset@{reset}}
\index{reset@{reset}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+reset (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Reset observation and episode_done.
\end{DoxyVerb}
 

Definition at line 259 of file starspace.\+py.


\begin{DoxyCode}
259     \textcolor{keyword}{def }reset(self):
260         \textcolor{stringliteral}{"""}
261 \textcolor{stringliteral}{        Reset observation and episode\_done.}
262 \textcolor{stringliteral}{        """}
263         self.observation = \textcolor{keywordtype}{None}
264         self.episode\_done = \textcolor{keyword}{True}
265         \textcolor{comment}{# set up optimizer}
266         lr = self.opt[\textcolor{stringliteral}{'learningrate'}]
267         optim\_class = StarspaceAgent.OPTIM\_OPTS[self.opt[\textcolor{stringliteral}{'optimizer'}]]
268         kwargs = \{\textcolor{stringliteral}{'lr'}: lr\}
269         self.optimizer = optim\_class(self.model.parameters(), **kwargs)
270 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a763de34b8d6464cbaa1ba17bf83f7df0}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a763de34b8d6464cbaa1ba17bf83f7df0}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!same@{same}}
\index{same@{same}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{same()}{same()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+same (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{y1,  }\item[{}]{y2 }\end{DoxyParamCaption})}



Definition at line 340 of file starspace.\+py.


\begin{DoxyCode}
340     \textcolor{keyword}{def }same(self, y1, y2):
341         \textcolor{keywordflow}{if} len(y1.squeeze(0)) != len(y2.squeeze(0)):
342             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
343         \textcolor{keywordflow}{if} abs((y1.squeeze(0) - y2.squeeze(0)).sum().data.sum()) > 0.00001:
344             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
345         \textcolor{keywordflow}{return} \textcolor{keyword}{True}
346 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a55b3dab4e31cee40441105efb66004ac}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a55b3dab4e31cee40441105efb66004ac}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!save@{save}}
\index{save@{save}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+save (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Save model parameters if model_file is set.
\end{DoxyVerb}
 

Definition at line 580 of file starspace.\+py.


\begin{DoxyCode}
580     \textcolor{keyword}{def }save(self, path=None):
581         \textcolor{stringliteral}{"""}
582 \textcolor{stringliteral}{        Save model parameters if model\_file is set.}
583 \textcolor{stringliteral}{        """}
584         path = self.opt.get(\textcolor{stringliteral}{'model\_file'}, \textcolor{keywordtype}{None}) \textcolor{keywordflow}{if} path \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{else} path
585         \textcolor{keywordflow}{if} path \textcolor{keywordflow}{and} hasattr(self, \textcolor{stringliteral}{'model'}):
586             data = \{\}
587             data[\textcolor{stringliteral}{'model'}] = self.model.state\_dict()
588             data[\textcolor{stringliteral}{'optimizer'}] = self.optimizer.state\_dict()
589             data[\textcolor{stringliteral}{'opt'}] = self.opt
590             with open(path, \textcolor{stringliteral}{'wb'}) \textcolor{keyword}{as} handle:
591                 torch.save(data, handle)
592             with open(path + \textcolor{stringliteral}{'.opt'}, \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} handle:
593                 json.dump(self.opt, handle)
594 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a4a03374eadb6aa60dcd01173f0f5aa6b}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a4a03374eadb6aa60dcd01173f0f5aa6b}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!share@{share}}
\index{share@{share}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{share()}{share()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+share (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Share internal states between parent and child instances.
\end{DoxyVerb}
 

Definition at line 271 of file starspace.\+py.


\begin{DoxyCode}
271     \textcolor{keyword}{def }share(self):
272         \textcolor{stringliteral}{"""}
273 \textcolor{stringliteral}{        Share internal states between parent and child instances.}
274 \textcolor{stringliteral}{        """}
275         shared = super().share()
276         shared[\textcolor{stringliteral}{'dict'}] = self.dict
277         shared[\textcolor{stringliteral}{'model'}] = self.model
278         \textcolor{keywordflow}{return} shared
279 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a4016a83cf0ed9ed97c8b94d9eacbcae3}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a4016a83cf0ed9ed97c8b94d9eacbcae3}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!shutdown@{shutdown}}
\index{shutdown@{shutdown}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{shutdown()}{shutdown()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+shutdown (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 576 of file starspace.\+py.


\begin{DoxyCode}
576     \textcolor{keyword}{def }shutdown(self):
577         \textcolor{comment}{# """Save the state of the model when shutdown."""}
578         super().shutdown()
579 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ad38444615578df64d2e341b2ce37a012}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ad38444615578df64d2e341b2ce37a012}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!t2v@{t2v}}
\index{t2v@{t2v}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{t2v()}{t2v()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+t2v (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{text }\end{DoxyParamCaption})}



Definition at line 312 of file starspace.\+py.


\begin{DoxyCode}
312     \textcolor{keyword}{def }t2v(self, text):
313         p = self.dict.txt2vec(text)
314         \textcolor{keywordflow}{return} torch.LongTensor(p).unsqueeze(1)
315 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a070074c4396b7ea6edc56e190e0c011f}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a070074c4396b7ea6edc56e190e0c011f}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!v2t@{v2t}}
\index{v2t@{v2t}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{v2t()}{v2t()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+v2t (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{vec }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert token indices to string of tokens.
\end{DoxyVerb}
 

Definition at line 316 of file starspace.\+py.


\begin{DoxyCode}
316     \textcolor{keyword}{def }v2t(self, vec):
317         \textcolor{stringliteral}{"""}
318 \textcolor{stringliteral}{        Convert token indices to string of tokens.}
319 \textcolor{stringliteral}{        """}
320         new\_vec = []
321         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} vec:
322             new\_vec.append(i)
323         \textcolor{keywordflow}{return} self.dict.vec2txt(new\_vec)
324 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a87253cca09c8b22848ff0bea7195e32d}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a87253cca09c8b22848ff0bea7195e32d}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!vectorize@{vectorize}}
\index{vectorize@{vectorize}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{vectorize()}{vectorize()}}
{\footnotesize\ttfamily def parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+vectorize (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observations }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert a list of observations into input & target tensors.
\end{DoxyVerb}
 

Definition at line 481 of file starspace.\+py.


\begin{DoxyCode}
481     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1utils_a5c76cc39e3014c7bcf9199d566dbdc0f}{vectorize}(self, observations):
482         \textcolor{stringliteral}{"""}
483 \textcolor{stringliteral}{        Convert a list of observations into input & target tensors.}
484 \textcolor{stringliteral}{        """}
485 
486         \textcolor{keyword}{def }valid(obs):
487             \textcolor{comment}{# check if this is an example our model should actually process}
488             \textcolor{keywordflow}{return} \textcolor{stringliteral}{'text2vec'} \textcolor{keywordflow}{in} obs \textcolor{keywordflow}{and} len(obs[\textcolor{stringliteral}{'text2vec'}]) > 0
489 
490         \textcolor{keywordflow}{try}:
491             \textcolor{comment}{# valid examples and their indices}
492             valid\_inds, exs = zip(
493                 *[(i, ex) \textcolor{keywordflow}{for} i, ex \textcolor{keywordflow}{in} enumerate(observations) \textcolor{keywordflow}{if} valid(ex)]
494             )
495         \textcolor{keywordflow}{except} ValueError:
496             \textcolor{comment}{# zero examples to process in this batch, so zip failed to unpack}
497             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}
498 
499         \textcolor{comment}{# `x` text is already tokenized and truncated}
500         \textcolor{comment}{# sort by length so we can use pack\_padded}
501         parsed\_x = [ex[\textcolor{stringliteral}{'text2vec'}] \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
502         x\_lens = [len(x) \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} parsed\_x]
503         ind\_sorted = sorted(range(len(x\_lens)), key=\textcolor{keyword}{lambda} k: -x\_lens[k])
504 
505         exs = [exs[k] \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} ind\_sorted]
506         valid\_inds = [valid\_inds[k] \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} ind\_sorted]
507         parsed\_x = [parsed\_x[k] \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} ind\_sorted]
508 
509         labels\_avail = any([\textcolor{stringliteral}{'labels'} \textcolor{keywordflow}{in} ex \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs])
510 
511         max\_x\_len = max([len(x) \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} parsed\_x])
512         \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} parsed\_x:
513             x += [self.NULL\_IDX] * (max\_x\_len - len(x))
514         xs = torch.LongTensor(parsed\_x)
515 
516         \textcolor{comment}{# set up the target tensors}
517         ys = \textcolor{keywordtype}{None}
518         labels = \textcolor{keywordtype}{None}
519         \textcolor{keywordflow}{if} labels\_avail:
520             \textcolor{comment}{# randomly select one of the labels to update on, if multiple}
521             labels = [random.choice(ex.get(\textcolor{stringliteral}{'labels'}, [\textcolor{stringliteral}{''}])) \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
522             \textcolor{comment}{# parse each label and append END}
523             parsed\_y = [deque(maxlen=self.truncate) \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} labels]
524             \textcolor{keywordflow}{for} dq, y \textcolor{keywordflow}{in} zip(parsed\_y, labels):
525                 dq.extendleft(reversed(self.parse(y)))
526             max\_y\_len = max(len(y) \textcolor{keywordflow}{for} y \textcolor{keywordflow}{in} parsed\_y)
527             \textcolor{keywordflow}{for} y \textcolor{keywordflow}{in} parsed\_y:
528                 y += [self.NULL\_IDX] * (max\_y\_len - len(y))
529             ys = torch.LongTensor(parsed\_y)
530 
531         cands = []
532         cands\_txt = []
533         \textcolor{keywordflow}{if} ys \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
534             \textcolor{comment}{# only build candidates in eval mode.}
535             \textcolor{keywordflow}{for} o \textcolor{keywordflow}{in} observations:
536                 \textcolor{keywordflow}{if} o.get(\textcolor{stringliteral}{'label\_candidates'}, \textcolor{keyword}{False}):
537                     cs = []
538                     ct = []
539                     \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} o[\textcolor{stringliteral}{'label\_candidates'}]:
540                         cs.append(torch.LongTensor(self.parse(c)).unsqueeze(0))
541                         ct.append(c)
542                     cands.append(cs)
543                     cands\_txt.append(ct)
544                 \textcolor{keywordflow}{else}:
545                     cands.append(\textcolor{keywordtype}{None})
546                     cands\_txt.append(\textcolor{keywordtype}{None})
547         \textcolor{keywordflow}{return} xs, ys, cands, cands\_txt
548 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a1986fb638717b81936ada2bf418b259f}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a1986fb638717b81936ada2bf418b259f}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!cands@{cands}}
\index{cands@{cands}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{cands}{cands}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+cands}



Definition at line 188 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a384ddfe5e4ad6c08243e6b8b1136ecbc}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a384ddfe5e4ad6c08243e6b8b1136ecbc}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!criterion@{criterion}}
\index{criterion@{criterion}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{criterion}{criterion}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+criterion}



Definition at line 219 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a668af7bc10cad919c8deff9b4f82e6d9}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a668af7bc10cad919c8deff9b4f82e6d9}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!debug\+Mode@{debug\+Mode}}
\index{debug\+Mode@{debug\+Mode}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{debug\+Mode}{debugMode}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+debug\+Mode}



Definition at line 193 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a650dfa9753ea9d80f8a81823d9fdc50a}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a650dfa9753ea9d80f8a81823d9fdc50a}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!dict@{dict}}
\index{dict@{dict}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{dict}{dict}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+dict}



Definition at line 197 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ad6565ef570b709afb46bf9a9b4bc59c3}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ad6565ef570b709afb46bf9a9b4bc59c3}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!episode\+\_\+done@{episode\+\_\+done}}
\index{episode\+\_\+done@{episode\+\_\+done}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{episode\+\_\+done}{episode\_done}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+episode\+\_\+done}



Definition at line 264 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a787ee6df16019fb6b9f78c7137070056}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a787ee6df16019fb6b9f78c7137070056}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!fixed\+Cands@{fixed\+Cands}}
\index{fixed\+Cands@{fixed\+Cands}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{fixed\+Cands}{fixedCands}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+fixed\+Cands}



Definition at line 223 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a13eba6e6eb10b366d145863b538571b7}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a13eba6e6eb10b366d145863b538571b7}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!fixed\+Cands\+\_\+txt@{fixed\+Cands\+\_\+txt}}
\index{fixed\+Cands\+\_\+txt@{fixed\+Cands\+\_\+txt}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{fixed\+Cands\+\_\+txt}{fixedCands\_txt}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+fixed\+Cands\+\_\+txt}



Definition at line 226 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a152e023a9ed4b162ab66e5d2e97f5f4e}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a152e023a9ed4b162ab66e5d2e97f5f4e}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!fixedX@{fixedX}}
\index{fixedX@{fixedX}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{fixedX}{fixedX}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+fixedX}



Definition at line 224 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a652778d6927eaf8633dc1d8cbeab9409}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a652778d6927eaf8633dc1d8cbeab9409}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!history@{history}}
\index{history@{history}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{history}{history}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+history}



Definition at line 192 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a78a530a11ff03bce1e41831e560163bc}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a78a530a11ff03bce1e41831e560163bc}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!id@{id}}
\index{id@{id}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{id}{id}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+id}



Definition at line 186 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a1bf1dacfd9d58385bd7da5bcd574cb0f}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a1bf1dacfd9d58385bd7da5bcd574cb0f}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!model@{model}}
\index{model@{model}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{model}{model}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+model}



Definition at line 198 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_aee34a5667cc7acbeaacc5b9563487087}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_aee34a5667cc7acbeaacc5b9563487087}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!N\+U\+L\+L\+\_\+\+I\+DX@{N\+U\+L\+L\+\_\+\+I\+DX}}
\index{N\+U\+L\+L\+\_\+\+I\+DX@{N\+U\+L\+L\+\_\+\+I\+DX}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{N\+U\+L\+L\+\_\+\+I\+DX}{NULL\_IDX}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+N\+U\+L\+L\+\_\+\+I\+DX}



Definition at line 187 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a0ec7b24305a7ca5f0fd5a11cd6aa1fdc}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a0ec7b24305a7ca5f0fd5a11cd6aa1fdc}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!observation@{observation}}
\index{observation@{observation}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{observation}{observation}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+observation}



Definition at line 263 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_aae476e9cdd8b9672ae6c28ef9400f09e}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_aae476e9cdd8b9672ae6c28ef9400f09e}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!opt@{opt}}
\index{opt@{opt}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+opt}



Definition at line 604 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ab9c156709a8072a6cddf7216396f610a}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_ab9c156709a8072a6cddf7216396f610a}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!O\+P\+T\+I\+M\+\_\+\+O\+P\+TS@{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}}
\index{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS@{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}{OPTIM\_OPTS}}
{\footnotesize\ttfamily dictionary parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+O\+P\+T\+I\+M\+\_\+\+O\+P\+TS\hspace{0.3cm}{\ttfamily [static]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}
=  \{
        \textcolor{stringliteral}{'adadelta'}: optim.Adadelta,
        \textcolor{stringliteral}{'adagrad'}: optim.Adagrad,
        \textcolor{stringliteral}{'adam'}: optim.Adam,
        \textcolor{stringliteral}{'adamax'}: optim.Adamax,
        \textcolor{stringliteral}{'asgd'}: optim.ASGD,
        \textcolor{stringliteral}{'lbfgs'}: optim.LBFGS,
        \textcolor{stringliteral}{'rmsprop'}: optim.RMSprop,
        \textcolor{stringliteral}{'rprop'}: optim.Rprop,
        \textcolor{stringliteral}{'sgd'}: optim.SGD,
    \}
\end{DoxyCode}


Definition at line 33 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_afacbbd91785631f9b23fd0fbd9b4cc21}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_afacbbd91785631f9b23fd0fbd9b4cc21}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!optimizer@{optimizer}}
\index{optimizer@{optimizer}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{optimizer}{optimizer}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+optimizer}



Definition at line 269 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a9c521ca705e241271b6bb34bd5b22bea}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a9c521ca705e241271b6bb34bd5b22bea}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!truncate@{truncate}}
\index{truncate@{truncate}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{truncate}{truncate}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+truncate}



Definition at line 191 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a050c7f6c495b0bccc9c29caa5c83d0ae}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a050c7f6c495b0bccc9c29caa5c83d0ae}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!ys\+\_\+cache@{ys\+\_\+cache}}
\index{ys\+\_\+cache@{ys\+\_\+cache}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{ys\+\_\+cache}{ys\_cache}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+ys\+\_\+cache}



Definition at line 189 of file starspace.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a6f300619fe9d0814ed612db691ec9dab}\label{classparlai_1_1agents_1_1starspace_1_1starspace_1_1StarspaceAgent_a6f300619fe9d0814ed612db691ec9dab}} 
\index{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}!ys\+\_\+cache\+\_\+sz@{ys\+\_\+cache\+\_\+sz}}
\index{ys\+\_\+cache\+\_\+sz@{ys\+\_\+cache\+\_\+sz}!parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent@{parlai\+::agents\+::starspace\+::starspace\+::\+Starspace\+Agent}}
\subsubsection{\texorpdfstring{ys\+\_\+cache\+\_\+sz}{ys\_cache\_sz}}
{\footnotesize\ttfamily parlai.\+agents.\+starspace.\+starspace.\+Starspace\+Agent.\+ys\+\_\+cache\+\_\+sz}



Definition at line 190 of file starspace.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/starspace/\hyperlink{starspace_8py}{starspace.\+py}\end{DoxyCompactItemize}
