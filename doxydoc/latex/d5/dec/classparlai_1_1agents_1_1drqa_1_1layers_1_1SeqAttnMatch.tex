\hypertarget{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch}{}\section{parlai.\+agents.\+drqa.\+layers.\+Seq\+Attn\+Match Class Reference}
\label{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch}\index{parlai.\+agents.\+drqa.\+layers.\+Seq\+Attn\+Match@{parlai.\+agents.\+drqa.\+layers.\+Seq\+Attn\+Match}}


Inheritance diagram for parlai.\+agents.\+drqa.\+layers.\+Seq\+Attn\+Match\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=206pt]{d8/d18/classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+drqa.\+layers.\+Seq\+Attn\+Match\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=206pt]{d5/d05/classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch_abd3be7cddadf751a880aab03c55b0a6c}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, input\+\_\+size, identity=False)
\item 
def \hyperlink{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch_ade14c6394d52f566a64da6573e8c913b}{forward} (self, x, y, y\+\_\+mask)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch_a6332862a9596fe3e4cb3c323b818a42f}{linear}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Given sequences X and Y, match sequence Y to each element in X.

* o_i = sum(alpha_j * y_j) for i in X
* alpha_j = softmax(y_j * x_i)
\end{DoxyVerb}
 

Definition at line 149 of file layers.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch_abd3be7cddadf751a880aab03c55b0a6c}\label{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch_abd3be7cddadf751a880aab03c55b0a6c}} 
\index{parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match@{parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match@{parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+drqa.\+layers.\+Seq\+Attn\+Match.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{input\+\_\+size,  }\item[{}]{identity = {\ttfamily False} }\end{DoxyParamCaption})}



Definition at line 157 of file layers.\+py.


\begin{DoxyCode}
157     \textcolor{keyword}{def }\_\_init\_\_(self, input\_size, identity=False):
158         super(SeqAttnMatch, self).\_\_init\_\_()
159         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} identity:
160             self.linear = nn.Linear(input\_size, input\_size)
161         \textcolor{keywordflow}{else}:
162             self.linear = \textcolor{keywordtype}{None}
163 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch_ade14c6394d52f566a64da6573e8c913b}\label{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch_ade14c6394d52f566a64da6573e8c913b}} 
\index{parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match@{parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match}!forward@{forward}}
\index{forward@{forward}!parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match@{parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match}}
\subsubsection{\texorpdfstring{forward()}{forward()}}
{\footnotesize\ttfamily def parlai.\+agents.\+drqa.\+layers.\+Seq\+Attn\+Match.\+forward (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{x,  }\item[{}]{y,  }\item[{}]{y\+\_\+mask }\end{DoxyParamCaption})}

\begin{DoxyVerb}Input shapes:

    x = batch * len1 * h
    y = batch * len2 * h
    y_mask = batch * len2
Output shapes:
    matched_seq = batch * len1 * h
\end{DoxyVerb}
 

Definition at line 164 of file layers.\+py.


\begin{DoxyCode}
164     \textcolor{keyword}{def }forward(self, x, y, y\_mask):
165         \textcolor{stringliteral}{"""}
166 \textcolor{stringliteral}{        Input shapes:}
167 \textcolor{stringliteral}{}
168 \textcolor{stringliteral}{            x = batch * len1 * h}
169 \textcolor{stringliteral}{            y = batch * len2 * h}
170 \textcolor{stringliteral}{            y\_mask = batch * len2}
171 \textcolor{stringliteral}{        Output shapes:}
172 \textcolor{stringliteral}{            matched\_seq = batch * len1 * h}
173 \textcolor{stringliteral}{        """}
174         \textcolor{comment}{# Project vectors}
175         \textcolor{keywordflow}{if} self.linear:
176             x\_proj = self.linear(x.view(-1, x.size(2))).view(x.size())
177             x\_proj = F.relu(x\_proj)
178             y\_proj = self.linear(y.view(-1, y.size(2))).view(y.size())
179             y\_proj = F.relu(y\_proj)
180         \textcolor{keywordflow}{else}:
181             x\_proj = x
182             y\_proj = y
183 
184         \textcolor{comment}{# Compute scores}
185         scores = x\_proj.bmm(y\_proj.transpose(2, 1))
186 
187         \textcolor{comment}{# Mask padding}
188         y\_mask = y\_mask.unsqueeze(1).expand(scores.size())
189         scores.data.masked\_fill\_(y\_mask.data, -\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(\textcolor{stringliteral}{'inf'}))
190 
191         \textcolor{comment}{# Normalize with softmax}
192         alpha\_flat = F.softmax(scores.view(-1, y.size(1)))
193         alpha = alpha\_flat.view(-1, x.size(1), y.size(1))
194 
195         \textcolor{comment}{# Take weighted average}
196         matched\_seq = alpha.bmm(y)
197         \textcolor{keywordflow}{return} matched\_seq
198 
199 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch_a6332862a9596fe3e4cb3c323b818a42f}\label{classparlai_1_1agents_1_1drqa_1_1layers_1_1SeqAttnMatch_a6332862a9596fe3e4cb3c323b818a42f}} 
\index{parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match@{parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match}!linear@{linear}}
\index{linear@{linear}!parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match@{parlai\+::agents\+::drqa\+::layers\+::\+Seq\+Attn\+Match}}
\subsubsection{\texorpdfstring{linear}{linear}}
{\footnotesize\ttfamily parlai.\+agents.\+drqa.\+layers.\+Seq\+Attn\+Match.\+linear}



Definition at line 160 of file layers.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/drqa/\hyperlink{layers_8py}{layers.\+py}\end{DoxyCompactItemize}
