\hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils}{}\section{parlai.\+agents.\+tfidf\+\_\+retriever.\+utils Namespace Reference}
\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils}\index{parlai.\+agents.\+tfidf\+\_\+retriever.\+utils@{parlai.\+agents.\+tfidf\+\_\+retriever.\+utils}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ad884f6e5806325937ff74a63bc7eea82}{save\+\_\+sparse\+\_\+csr} (filename, matrix, metadata=None)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a6d1c2b31f2a5d432d7cb677f436e17c0}{save\+\_\+sparse\+\_\+tensor} (filename, matrix, metadata=None)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ac866d85f1378528cb12c8d13b959d279}{load\+\_\+sparse\+\_\+csr} (filename)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a28faf0af977db4915cf5253d69d37c0d}{load\+\_\+sparse\+\_\+tensor} (filename)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a6df58709964913e04733db89d6e187db}{hash} (token, num\+\_\+buckets)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ace97d2139f74e163a7ba81fcfb505f1c}{normalize} (text)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a57608b2b9a61223e39e3cb51f5c9f812}{filter\+\_\+word} (text)
\item 
def \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a791c829884544e127e480a52d233d521}{filter\+\_\+ngram} (gram, mode=\textquotesingle{}any\textquotesingle{})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
dictionary \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_afd1296771f9d4fe64b901825a37b1438}{S\+T\+O\+P\+W\+O\+R\+DS}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a791c829884544e127e480a52d233d521}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a791c829884544e127e480a52d233d521}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}!filter\+\_\+ngram@{filter\+\_\+ngram}}
\index{filter\+\_\+ngram@{filter\+\_\+ngram}!parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}}
\subsubsection{\texorpdfstring{filter\+\_\+ngram()}{filter\_ngram()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+utils.\+filter\+\_\+ngram (\begin{DoxyParamCaption}\item[{}]{gram,  }\item[{}]{mode = {\ttfamily \textquotesingle{}any\textquotesingle{}} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Decide whether to keep or discard an n-gram.

Args:
    gram: list of tokens (length N)
    mode: Option to throw out ngram if
      'any': any single token passes filter_word
      'all': all tokens pass filter_word
      'ends': book-ended by filterable tokens
\end{DoxyVerb}
 

Definition at line 269 of file utils.\+py.


\begin{DoxyCode}
269 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a791c829884544e127e480a52d233d521}{filter\_ngram}(gram, mode='any'):
270     \textcolor{stringliteral}{"""}
271 \textcolor{stringliteral}{    Decide whether to keep or discard an n-gram.}
272 \textcolor{stringliteral}{}
273 \textcolor{stringliteral}{    Args:}
274 \textcolor{stringliteral}{        gram: list of tokens (length N)}
275 \textcolor{stringliteral}{        mode: Option to throw out ngram if}
276 \textcolor{stringliteral}{          'any': any single token passes filter\_word}
277 \textcolor{stringliteral}{          'all': all tokens pass filter\_word}
278 \textcolor{stringliteral}{          'ends': book-ended by filterable tokens}
279 \textcolor{stringliteral}{    """}
280     filtered = [\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a57608b2b9a61223e39e3cb51f5c9f812}{filter\_word}(w) \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} gram]
281     \textcolor{keywordflow}{if} mode == \textcolor{stringliteral}{'any'}:
282         \textcolor{keywordflow}{return} any(filtered)
283     \textcolor{keywordflow}{elif} mode == \textcolor{stringliteral}{'all'}:
284         \textcolor{keywordflow}{return} all(filtered)
285     \textcolor{keywordflow}{elif} mode == \textcolor{stringliteral}{'ends'}:
286         \textcolor{keywordflow}{return} filtered[0] \textcolor{keywordflow}{or} filtered[-1]
287     \textcolor{keywordflow}{else}:
288         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{'Invalid mode: %s'} % mode)
289 \end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a57608b2b9a61223e39e3cb51f5c9f812}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a57608b2b9a61223e39e3cb51f5c9f812}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}!filter\+\_\+word@{filter\+\_\+word}}
\index{filter\+\_\+word@{filter\+\_\+word}!parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}}
\subsubsection{\texorpdfstring{filter\+\_\+word()}{filter\_word()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+utils.\+filter\+\_\+word (\begin{DoxyParamCaption}\item[{}]{text }\end{DoxyParamCaption})}

\begin{DoxyVerb}Take out english stopwords, punctuation, and compound endings.
\end{DoxyVerb}
 

Definition at line 257 of file utils.\+py.


\begin{DoxyCode}
257 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a57608b2b9a61223e39e3cb51f5c9f812}{filter\_word}(text):
258     \textcolor{stringliteral}{"""}
259 \textcolor{stringliteral}{    Take out english stopwords, punctuation, and compound endings.}
260 \textcolor{stringliteral}{    """}
261     text = \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ace97d2139f74e163a7ba81fcfb505f1c}{normalize}(text)
262     \textcolor{keywordflow}{if} regex.match(\textcolor{stringliteral}{r'^\(\backslash\)p\{P\}+$'}, text):
263         \textcolor{keywordflow}{return} \textcolor{keyword}{True}
264     \textcolor{keywordflow}{if} text.lower() \textcolor{keywordflow}{in} STOPWORDS:
265         \textcolor{keywordflow}{return} \textcolor{keyword}{True}
266     \textcolor{keywordflow}{return} \textcolor{keyword}{False}
267 
268 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a6df58709964913e04733db89d6e187db}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a6df58709964913e04733db89d6e187db}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}!hash@{hash}}
\index{hash@{hash}!parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}}
\subsubsection{\texorpdfstring{hash()}{hash()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+utils.\+hash (\begin{DoxyParamCaption}\item[{}]{token,  }\item[{}]{num\+\_\+buckets }\end{DoxyParamCaption})}

\begin{DoxyVerb}Unsigned 32 bit murmurhash for feature hashing.
\end{DoxyVerb}
 

Definition at line 70 of file utils.\+py.


\begin{DoxyCode}
70 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a6df58709964913e04733db89d6e187db}{hash}(token, num\_buckets):
71     \textcolor{stringliteral}{"""}
72 \textcolor{stringliteral}{    Unsigned 32 bit murmurhash for feature hashing.}
73 \textcolor{stringliteral}{    """}
74     \textcolor{keywordflow}{return} murmurhash3\_32(token, positive=\textcolor{keyword}{True}) % num\_buckets
75 
76 
77 \textcolor{comment}{# ------------------------------------------------------------------------------}
78 \textcolor{comment}{# Text cleaning.}
79 \textcolor{comment}{# ------------------------------------------------------------------------------}
80 
81 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ac866d85f1378528cb12c8d13b959d279}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ac866d85f1378528cb12c8d13b959d279}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}!load\+\_\+sparse\+\_\+csr@{load\+\_\+sparse\+\_\+csr}}
\index{load\+\_\+sparse\+\_\+csr@{load\+\_\+sparse\+\_\+csr}!parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}}
\subsubsection{\texorpdfstring{load\+\_\+sparse\+\_\+csr()}{load\_sparse\_csr()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+utils.\+load\+\_\+sparse\+\_\+csr (\begin{DoxyParamCaption}\item[{}]{filename }\end{DoxyParamCaption})}



Definition at line 49 of file utils.\+py.


\begin{DoxyCode}
49 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ac866d85f1378528cb12c8d13b959d279}{load\_sparse\_csr}(filename):
50     loader = np.load(filename + \textcolor{stringliteral}{'.npz'}, allow\_pickle=\textcolor{keyword}{True})
51     matrix = sp.csr\_matrix(
52         (loader[\textcolor{stringliteral}{'data'}], loader[\textcolor{stringliteral}{'indices'}], loader[\textcolor{stringliteral}{'indptr'}]), shape=loader[\textcolor{stringliteral}{'shape'}]
53     )
54     \textcolor{keywordflow}{return} matrix, loader[\textcolor{stringliteral}{'metadata'}].item(0) \textcolor{keywordflow}{if} \textcolor{stringliteral}{'metadata'} \textcolor{keywordflow}{in} loader \textcolor{keywordflow}{else} \textcolor{keywordtype}{None}
55 
56 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a28faf0af977db4915cf5253d69d37c0d}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a28faf0af977db4915cf5253d69d37c0d}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}!load\+\_\+sparse\+\_\+tensor@{load\+\_\+sparse\+\_\+tensor}}
\index{load\+\_\+sparse\+\_\+tensor@{load\+\_\+sparse\+\_\+tensor}!parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}}
\subsubsection{\texorpdfstring{load\+\_\+sparse\+\_\+tensor()}{load\_sparse\_tensor()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+utils.\+load\+\_\+sparse\+\_\+tensor (\begin{DoxyParamCaption}\item[{}]{filename }\end{DoxyParamCaption})}



Definition at line 57 of file utils.\+py.


\begin{DoxyCode}
57 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a28faf0af977db4915cf5253d69d37c0d}{load\_sparse\_tensor}(filename):
58     loader = torch.load(filename)
59     matrix = torch.sparse.FloatTensor(
60         loader[\textcolor{stringliteral}{'indices'}], loader[\textcolor{stringliteral}{'values'}], loader[\textcolor{stringliteral}{'size'}]
61     )
62     \textcolor{keywordflow}{return} matrix, loader[\textcolor{stringliteral}{'metadata'}] \textcolor{keywordflow}{if} \textcolor{stringliteral}{'metadata'} \textcolor{keywordflow}{in} loader \textcolor{keywordflow}{else} \textcolor{keywordtype}{None}
63 
64 
65 \textcolor{comment}{# ------------------------------------------------------------------------------}
66 \textcolor{comment}{# Token hashing.}
67 \textcolor{comment}{# ------------------------------------------------------------------------------}
68 
69 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ace97d2139f74e163a7ba81fcfb505f1c}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ace97d2139f74e163a7ba81fcfb505f1c}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}!normalize@{normalize}}
\index{normalize@{normalize}!parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}}
\subsubsection{\texorpdfstring{normalize()}{normalize()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+utils.\+normalize (\begin{DoxyParamCaption}\item[{}]{text }\end{DoxyParamCaption})}

\begin{DoxyVerb}Resolve different type of unicode encodings.
\end{DoxyVerb}
 

Definition at line 248 of file utils.\+py.


\begin{DoxyCode}
248 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ace97d2139f74e163a7ba81fcfb505f1c}{normalize}(text):
249     \textcolor{stringliteral}{"""}
250 \textcolor{stringliteral}{    Resolve different type of unicode encodings.}
251 \textcolor{stringliteral}{    """}
252     \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(text) != str:
253         \textcolor{keywordflow}{return} text
254     \textcolor{keywordflow}{return} unicodedata.normalize(\textcolor{stringliteral}{'NFD'}, text)
255 
256 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ad884f6e5806325937ff74a63bc7eea82}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ad884f6e5806325937ff74a63bc7eea82}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}!save\+\_\+sparse\+\_\+csr@{save\+\_\+sparse\+\_\+csr}}
\index{save\+\_\+sparse\+\_\+csr@{save\+\_\+sparse\+\_\+csr}!parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}}
\subsubsection{\texorpdfstring{save\+\_\+sparse\+\_\+csr()}{save\_sparse\_csr()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+utils.\+save\+\_\+sparse\+\_\+csr (\begin{DoxyParamCaption}\item[{}]{filename,  }\item[{}]{matrix,  }\item[{}]{metadata = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 28 of file utils.\+py.


\begin{DoxyCode}
28 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_ad884f6e5806325937ff74a63bc7eea82}{save\_sparse\_csr}(filename, matrix, metadata=None):
29     data = \{
30         \textcolor{stringliteral}{'data'}: matrix.data,
31         \textcolor{stringliteral}{'indices'}: matrix.indices,
32         \textcolor{stringliteral}{'indptr'}: matrix.indptr,
33         \textcolor{stringliteral}{'shape'}: matrix.shape,
34         \textcolor{stringliteral}{'metadata'}: metadata,
35     \}
36     np.savez(filename, **data)
37 
38 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a6d1c2b31f2a5d432d7cb677f436e17c0}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a6d1c2b31f2a5d432d7cb677f436e17c0}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}!save\+\_\+sparse\+\_\+tensor@{save\+\_\+sparse\+\_\+tensor}}
\index{save\+\_\+sparse\+\_\+tensor@{save\+\_\+sparse\+\_\+tensor}!parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}}
\subsubsection{\texorpdfstring{save\+\_\+sparse\+\_\+tensor()}{save\_sparse\_tensor()}}
{\footnotesize\ttfamily def parlai.\+agents.\+tfidf\+\_\+retriever.\+utils.\+save\+\_\+sparse\+\_\+tensor (\begin{DoxyParamCaption}\item[{}]{filename,  }\item[{}]{matrix,  }\item[{}]{metadata = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 39 of file utils.\+py.


\begin{DoxyCode}
39 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_a6d1c2b31f2a5d432d7cb677f436e17c0}{save\_sparse\_tensor}(filename, matrix, metadata=None):
40     data = \{
41         \textcolor{stringliteral}{'indices'}: matrix.\_indices(),
42         \textcolor{stringliteral}{'values'}: matrix.\_values(),
43         \textcolor{stringliteral}{'size'}: matrix.size(),
44         \textcolor{stringliteral}{'metadata'}: metadata,
45     \}
46     torch.save(data, filename)
47 
48 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_afd1296771f9d4fe64b901825a37b1438}\label{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1utils_afd1296771f9d4fe64b901825a37b1438}} 
\index{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}!S\+T\+O\+P\+W\+O\+R\+DS@{S\+T\+O\+P\+W\+O\+R\+DS}}
\index{S\+T\+O\+P\+W\+O\+R\+DS@{S\+T\+O\+P\+W\+O\+R\+DS}!parlai\+::agents\+::tfidf\+\_\+retriever\+::utils@{parlai\+::agents\+::tfidf\+\_\+retriever\+::utils}}
\subsubsection{\texorpdfstring{S\+T\+O\+P\+W\+O\+R\+DS}{STOPWORDS}}
{\footnotesize\ttfamily dictionary parlai.\+agents.\+tfidf\+\_\+retriever.\+utils.\+S\+T\+O\+P\+W\+O\+R\+DS}



Definition at line 82 of file utils.\+py.

