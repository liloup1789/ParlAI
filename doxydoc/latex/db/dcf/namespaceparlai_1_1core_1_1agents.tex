\hypertarget{namespaceparlai_1_1core_1_1agents}{}\section{parlai.\+core.\+agents Namespace Reference}
\label{namespaceparlai_1_1core_1_1agents}\index{parlai.\+core.\+agents@{parlai.\+core.\+agents}}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classparlai_1_1core_1_1agents_1_1Agent}{Agent}
\item 
class \hyperlink{classparlai_1_1core_1_1agents_1_1MultiTaskTeacher}{Multi\+Task\+Teacher}
\item 
class \hyperlink{classparlai_1_1core_1_1agents_1_1Teacher}{Teacher}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1core_1_1agents_a7a5f5076b35ce376d8b46bfb362bfc53}{name\+\_\+to\+\_\+agent\+\_\+class} (name)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1agents_a7eb0ec391b94a2adc51acdf8d2a35a68}{compare\+\_\+init\+\_\+model\+\_\+opts} (opt, curr\+\_\+opt)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1agents_a213df46dd21144eb4c056bb58c294c5d}{load\+\_\+agent\+\_\+module} (opt)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1agents_a14a9d134d76ffd0509e50703d0f2c949}{get\+\_\+agent\+\_\+module} (dir\+\_\+name)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1agents_ad0d54074d4bcc148bb415ab5515a53b5}{create\+\_\+agent} (opt, require\+Model\+Exists=False)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1agents_aa5af5dd1d2f9da491b60348d479b849f}{create\+\_\+agent\+\_\+from\+\_\+shared} (shared\+\_\+agent)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1agents_a5600530545f5e60a79e2d657b5af1d8c}{create\+\_\+agents\+\_\+from\+\_\+shared} (shared)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1agents_a530b987b67a802a8e9c5fa3c24ae942f}{get\+\_\+task\+\_\+module} (taskname)
\item 
def \hyperlink{namespaceparlai_1_1core_1_1agents_ab4473fa54af02b5ab385b41b51dacd10}{create\+\_\+task\+\_\+agent\+\_\+from\+\_\+taskname} (opt)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1agents_a7eb0ec391b94a2adc51acdf8d2a35a68}\label{namespaceparlai_1_1core_1_1agents_a7eb0ec391b94a2adc51acdf8d2a35a68}} 
\index{parlai\+::core\+::agents@{parlai\+::core\+::agents}!compare\+\_\+init\+\_\+model\+\_\+opts@{compare\+\_\+init\+\_\+model\+\_\+opts}}
\index{compare\+\_\+init\+\_\+model\+\_\+opts@{compare\+\_\+init\+\_\+model\+\_\+opts}!parlai\+::core\+::agents@{parlai\+::core\+::agents}}
\subsubsection{\texorpdfstring{compare\+\_\+init\+\_\+model\+\_\+opts()}{compare\_init\_model\_opts()}}
{\footnotesize\ttfamily def parlai.\+core.\+agents.\+compare\+\_\+init\+\_\+model\+\_\+opts (\begin{DoxyParamCaption}\item[{}]{opt,  }\item[{}]{curr\+\_\+opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Print loud warning when `init_model` opts differ from previous configuration.
\end{DoxyVerb}
 

Definition at line 452 of file agents.\+py.


\begin{DoxyCode}
452 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1agents_a7eb0ec391b94a2adc51acdf8d2a35a68}{compare\_init\_model\_opts}(opt, curr\_opt):
453     \textcolor{stringliteral}{"""}
454 \textcolor{stringliteral}{    Print loud warning when `init\_model` opts differ from previous configuration.}
455 \textcolor{stringliteral}{    """}
456     \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'init\_model'}) \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
457         \textcolor{keywordflow}{return}
458     opt[\textcolor{stringliteral}{'init\_model'}] = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a5fbd3301b67f00d6d146fb01c7cd7626}{modelzoo\_path}(opt[\textcolor{stringliteral}{'datapath'}], opt[\textcolor{stringliteral}{'init\_model'}])
459     optfile = opt[\textcolor{stringliteral}{'init\_model'}] + \textcolor{stringliteral}{'.opt'}
460     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.isfile(optfile):
461         \textcolor{keywordflow}{return}
462     init\_model\_opt = \hyperlink{namespaceparlai_1_1utils_1_1misc_a7c97ef3250327bc549ac652a481be0cf}{load\_opt\_file}(optfile)
463 
464     extra\_opts = \{\}
465     different\_opts = \{\}
466     exempt\_opts = [
467         \textcolor{stringliteral}{'model\_file'},
468         \textcolor{stringliteral}{'dict\_file'},
469         \textcolor{stringliteral}{'override'},
470         \textcolor{stringliteral}{'starttime'},
471         \textcolor{stringliteral}{'init\_model'},
472         \textcolor{stringliteral}{'batchindex'},
473     ]
474 
475     \textcolor{comment}{# search through init model opts}
476     \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} init\_model\_opt.items():
477         \textcolor{keywordflow}{if} (
478             k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} exempt\_opts
479             \textcolor{keywordflow}{and} k \textcolor{keywordflow}{in} init\_model\_opt
480             \textcolor{keywordflow}{and} init\_model\_opt[k] != curr\_opt.get(k)
481         ):
482             \textcolor{keywordflow}{if} isinstance(v, list):
483                 \textcolor{keywordflow}{if} init\_model\_opt[k] != list(curr\_opt[k]):
484                     different\_opts[k] = \textcolor{stringliteral}{','}.join([\hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(x) \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} v])
485             \textcolor{keywordflow}{else}:
486                 different\_opts[k] = v
487 
488     \textcolor{comment}{# search through opts to load}
489     \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} curr\_opt.items():
490         \textcolor{keywordflow}{if} k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} exempt\_opts \textcolor{keywordflow}{and} k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} init\_model\_opt:
491             \textcolor{keywordflow}{if} isinstance(v, list):
492                 extra\_opts[k] = \textcolor{stringliteral}{','}.join([\hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(x) \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} v])
493             \textcolor{keywordflow}{else}:
494                 extra\_opts[k] = v
495 
496     \textcolor{comment}{# print warnings}
497     extra\_strs = [\textcolor{stringliteral}{'\{\}: \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(k, v) \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} extra\_opts.items()]
498     \textcolor{keywordflow}{if} extra\_strs:
499         print(\textcolor{stringliteral}{'\(\backslash\)n'} + \textcolor{stringliteral}{'*'} * 75)
500         print(
501             \textcolor{stringliteral}{'[ WARNING ] : your model is being loaded with opts that do not '}
502             \textcolor{stringliteral}{'exist in the model you are initializing the weights with: '}
503             \textcolor{stringliteral}{'\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(\textcolor{stringliteral}{','}.join(extra\_strs))
504         )
505 
506     different\_strs = [
507         \textcolor{stringliteral}{'--\{\} \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(k, v).replace(\textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{'-'}) \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} different\_opts.items()
508     ]
509     \textcolor{keywordflow}{if} different\_strs:
510         print(\textcolor{stringliteral}{'\(\backslash\)n'} + \textcolor{stringliteral}{'*'} * 75)
511         print(
512             \textcolor{stringliteral}{'[ WARNING ] : your model is being loaded with opts that differ '}
513             \textcolor{stringliteral}{'from the model you are initializing the weights with. Add the '}
514             \textcolor{stringliteral}{'following args to your run command to change this: \(\backslash\)n'}
515             \textcolor{stringliteral}{'\(\backslash\)n\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(\textcolor{stringliteral}{' '}.join(different\_strs))
516         )
517         print(\textcolor{stringliteral}{'*'} * 75)
518 
519 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1agents_ad0d54074d4bcc148bb415ab5515a53b5}\label{namespaceparlai_1_1core_1_1agents_ad0d54074d4bcc148bb415ab5515a53b5}} 
\index{parlai\+::core\+::agents@{parlai\+::core\+::agents}!create\+\_\+agent@{create\+\_\+agent}}
\index{create\+\_\+agent@{create\+\_\+agent}!parlai\+::core\+::agents@{parlai\+::core\+::agents}}
\subsubsection{\texorpdfstring{create\+\_\+agent()}{create\_agent()}}
{\footnotesize\ttfamily def parlai.\+core.\+agents.\+create\+\_\+agent (\begin{DoxyParamCaption}\item[{}]{opt,  }\item[{}]{require\+Model\+Exists = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create an agent from the options ``model``, ``model_params`` and ``model_file``.

The input is either of the form
``parlai.agents.ir_baseline.agents:IrBaselineAgent`` (i.e. the path
followed by the class name) or else just ``ir_baseline`` which
assumes the path above, and a class name suffixed with 'Agent'.

If ``model-file`` is available in the options this function can also
attempt to load the model from that location instead. This avoids having to
specify all the other options necessary to set up the model including its
name as they are all loaded from the options file if it exists (the file
opt['model_file'] + '.opt' must exist and contain a pickled or json dict
containing the model's options).
\end{DoxyVerb}
 

Definition at line 696 of file agents.\+py.


\begin{DoxyCode}
696 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1agents_ad0d54074d4bcc148bb415ab5515a53b5}{create\_agent}(opt, requireModelExists=False):
697     \textcolor{stringliteral}{"""}
698 \textcolor{stringliteral}{    Create an agent from the options ``model``, ``model\_params`` and ``model\_file``.}
699 \textcolor{stringliteral}{}
700 \textcolor{stringliteral}{    The input is either of the form}
701 \textcolor{stringliteral}{    ``parlai.agents.ir\_baseline.agents:IrBaselineAgent`` (i.e. the path}
702 \textcolor{stringliteral}{    followed by the class name) or else just ``ir\_baseline`` which}
703 \textcolor{stringliteral}{    assumes the path above, and a class name suffixed with 'Agent'.}
704 \textcolor{stringliteral}{}
705 \textcolor{stringliteral}{    If ``model-file`` is available in the options this function can also}
706 \textcolor{stringliteral}{    attempt to load the model from that location instead. This avoids having to}
707 \textcolor{stringliteral}{    specify all the other options necessary to set up the model including its}
708 \textcolor{stringliteral}{    name as they are all loaded from the options file if it exists (the file}
709 \textcolor{stringliteral}{    opt['model\_file'] + '.opt' must exist and contain a pickled or json dict}
710 \textcolor{stringliteral}{    containing the model's options).}
711 \textcolor{stringliteral}{    """}
712     \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'datapath'}, \textcolor{keywordtype}{None}) \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
713         \textcolor{comment}{# add datapath, it is missing}
714         \textcolor{keyword}{from} \hyperlink{namespaceparlai_1_1core_1_1params}{parlai.core.params} \textcolor{keyword}{import} ParlaiParser, get\_model\_name
715 
716         parser = ParlaiParser(add\_parlai\_args=\textcolor{keyword}{False})
717         parser.add\_parlai\_data\_path()
718         \textcolor{comment}{# add model args if they are missing}
719         model = \hyperlink{namespaceparlai_1_1core_1_1params_a6d160324f6af84562334fd0698141074}{get\_model\_name}(opt)
720         \textcolor{keywordflow}{if} model \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
721             parser.add\_model\_subargs(model)
722         opt\_parser = parser.parse\_args(\textcolor{stringliteral}{""}, print\_args=\textcolor{keyword}{False})
723         \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} opt\_parser.items():
724             \textcolor{keywordflow}{if} k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt:
725                 opt[k] = v
726 
727     \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'model\_file'}):
728         opt[\textcolor{stringliteral}{'model\_file'}] = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a5fbd3301b67f00d6d146fb01c7cd7626}{modelzoo\_path}(opt.get(\textcolor{stringliteral}{'datapath'}), opt[\textcolor{stringliteral}{'model\_file'}])
729         \textcolor{keywordflow}{if} requireModelExists \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} os.path.isfile(opt[\textcolor{stringliteral}{'model\_file'}]):
730             \textcolor{keywordflow}{raise} RuntimeError(
731                 \textcolor{stringliteral}{'WARNING: Model file does not exist, check to make '}
732                 \textcolor{stringliteral}{'sure it is correct: \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(opt[\textcolor{stringliteral}{'model\_file'}])
733             )
734         \textcolor{comment}{# Attempt to load the model from the model file first (this way we do}
735         \textcolor{comment}{# not even have to specify the model name as a parameter)}
736         model = \hyperlink{namespaceparlai_1_1core_1_1agents_a213df46dd21144eb4c056bb58c294c5d}{load\_agent\_module}(opt)
737         \textcolor{keywordflow}{if} model \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
738             \textcolor{keywordflow}{return} model
739         \textcolor{keywordflow}{else}:
740             print(\textcolor{stringliteral}{"[ no model with opt yet at: "} + opt.get(\textcolor{stringliteral}{'model\_file'}) + \textcolor{stringliteral}{"(.opt) ]"})
741 
742     \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'model'}):
743         model\_class = \hyperlink{namespaceparlai_1_1core_1_1agents_a14a9d134d76ffd0509e50703d0f2c949}{get\_agent\_module}(opt[\textcolor{stringliteral}{'model'}])
744         \textcolor{comment}{# if we want to load weights from --init-model, compare opts with}
745         \textcolor{comment}{# loaded ones}
746         \hyperlink{namespaceparlai_1_1core_1_1agents_a7eb0ec391b94a2adc51acdf8d2a35a68}{compare\_init\_model\_opts}(opt, opt)
747         model = model\_class(opt)
748         \textcolor{keywordflow}{if} requireModelExists \textcolor{keywordflow}{and} hasattr(model, \textcolor{stringliteral}{'load'}) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} opt.get(\textcolor{stringliteral}{'model\_file'}):
749             \textcolor{comment}{# double check that we didn't forget to set model\_file on loadable model}
750             print(\textcolor{stringliteral}{'WARNING: model\_file unset but model has a `load` function.'})
751         \textcolor{keywordflow}{return} model
752     \textcolor{keywordflow}{else}:
753         \textcolor{keywordflow}{raise} RuntimeError(\textcolor{stringliteral}{'Need to set `model` argument to use create\_agent.'})
754 
755 
756 \textcolor{comment}{# Helper functions to create agent/agents given shared parameters}
757 \textcolor{comment}{# returned from agent.share(). Useful for parallelism, sharing params, etc.}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1agents_aa5af5dd1d2f9da491b60348d479b849f}\label{namespaceparlai_1_1core_1_1agents_aa5af5dd1d2f9da491b60348d479b849f}} 
\index{parlai\+::core\+::agents@{parlai\+::core\+::agents}!create\+\_\+agent\+\_\+from\+\_\+shared@{create\+\_\+agent\+\_\+from\+\_\+shared}}
\index{create\+\_\+agent\+\_\+from\+\_\+shared@{create\+\_\+agent\+\_\+from\+\_\+shared}!parlai\+::core\+::agents@{parlai\+::core\+::agents}}
\subsubsection{\texorpdfstring{create\+\_\+agent\+\_\+from\+\_\+shared()}{create\_agent\_from\_shared()}}
{\footnotesize\ttfamily def parlai.\+core.\+agents.\+create\+\_\+agent\+\_\+from\+\_\+shared (\begin{DoxyParamCaption}\item[{}]{shared\+\_\+agent }\end{DoxyParamCaption})}

\begin{DoxyVerb}Instantiate an agent from the default `shared` params.

:param shared_agent:
    should include an `opt` dictionary and agent `class`, along with
    whatever other parameters the agent needs to instantiate.
\end{DoxyVerb}
 

Definition at line 758 of file agents.\+py.


\begin{DoxyCode}
758 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1agents_aa5af5dd1d2f9da491b60348d479b849f}{create\_agent\_from\_shared}(shared\_agent):
759     \textcolor{stringliteral}{"""}
760 \textcolor{stringliteral}{    Instantiate an agent from the default `shared` params.}
761 \textcolor{stringliteral}{}
762 \textcolor{stringliteral}{    :param shared\_agent:}
763 \textcolor{stringliteral}{        should include an `opt` dictionary and agent `class`, along with}
764 \textcolor{stringliteral}{        whatever other parameters the agent needs to instantiate.}
765 \textcolor{stringliteral}{    """}
766     opt = copy.deepcopy(shared\_agent[\textcolor{stringliteral}{'opt'}])
767     a = shared\_agent[\textcolor{stringliteral}{'class'}](opt, shared\_agent)
768     \textcolor{keywordflow}{return} a
769 
770 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1agents_a5600530545f5e60a79e2d657b5af1d8c}\label{namespaceparlai_1_1core_1_1agents_a5600530545f5e60a79e2d657b5af1d8c}} 
\index{parlai\+::core\+::agents@{parlai\+::core\+::agents}!create\+\_\+agents\+\_\+from\+\_\+shared@{create\+\_\+agents\+\_\+from\+\_\+shared}}
\index{create\+\_\+agents\+\_\+from\+\_\+shared@{create\+\_\+agents\+\_\+from\+\_\+shared}!parlai\+::core\+::agents@{parlai\+::core\+::agents}}
\subsubsection{\texorpdfstring{create\+\_\+agents\+\_\+from\+\_\+shared()}{create\_agents\_from\_shared()}}
{\footnotesize\ttfamily def parlai.\+core.\+agents.\+create\+\_\+agents\+\_\+from\+\_\+shared (\begin{DoxyParamCaption}\item[{}]{shared }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create agents based on shared data.

:param shared: `list` of `dict` objects created by calling e.g.
    [a.share() for a in agents].

Returns a list of instantiated agents.
\end{DoxyVerb}
 

Definition at line 771 of file agents.\+py.


\begin{DoxyCode}
771 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1agents_a5600530545f5e60a79e2d657b5af1d8c}{create\_agents\_from\_shared}(shared):
772     \textcolor{stringliteral}{"""}
773 \textcolor{stringliteral}{    Create agents based on shared data.}
774 \textcolor{stringliteral}{}
775 \textcolor{stringliteral}{    :param shared: `list` of `dict` objects created by calling e.g.}
776 \textcolor{stringliteral}{        [a.share() for a in agents].}
777 \textcolor{stringliteral}{}
778 \textcolor{stringliteral}{    Returns a list of instantiated agents.}
779 \textcolor{stringliteral}{    """}
780     shared\_agents = []
781     \textcolor{keywordflow}{for} shared\_agent \textcolor{keywordflow}{in} shared:
782         agent = \hyperlink{namespaceparlai_1_1core_1_1agents_aa5af5dd1d2f9da491b60348d479b849f}{create\_agent\_from\_shared}(shared\_agent)
783         shared\_agents.append(agent)
784     \textcolor{keywordflow}{return} shared\_agents
785 
786 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1agents_ab4473fa54af02b5ab385b41b51dacd10}\label{namespaceparlai_1_1core_1_1agents_ab4473fa54af02b5ab385b41b51dacd10}} 
\index{parlai\+::core\+::agents@{parlai\+::core\+::agents}!create\+\_\+task\+\_\+agent\+\_\+from\+\_\+taskname@{create\+\_\+task\+\_\+agent\+\_\+from\+\_\+taskname}}
\index{create\+\_\+task\+\_\+agent\+\_\+from\+\_\+taskname@{create\+\_\+task\+\_\+agent\+\_\+from\+\_\+taskname}!parlai\+::core\+::agents@{parlai\+::core\+::agents}}
\subsubsection{\texorpdfstring{create\+\_\+task\+\_\+agent\+\_\+from\+\_\+taskname()}{create\_task\_agent\_from\_taskname()}}
{\footnotesize\ttfamily def parlai.\+core.\+agents.\+create\+\_\+task\+\_\+agent\+\_\+from\+\_\+taskname (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create task agent(s) assuming the input ``task_dir:teacher_class``.

e.g. def_string is a shorthand path like ``babi:Task1k:1`` or ``#babi`` or a
complete path like ``parlai.tasks.babi.agents:Task1kTeacher:1``, which essentially
performs ``from parlai.tasks.babi import Task1kTeacher`` with the parameter ``1`` in
``opt['task']`` to be used by the class ``Task1kTeacher``.
\end{DoxyVerb}
 

Definition at line 859 of file agents.\+py.


\begin{DoxyCode}
859 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1agents_ab4473fa54af02b5ab385b41b51dacd10}{create\_task\_agent\_from\_taskname}(opt):
860     \textcolor{stringliteral}{"""}
861 \textcolor{stringliteral}{    Create task agent(s) assuming the input ``task\_dir:teacher\_class``.}
862 \textcolor{stringliteral}{}
863 \textcolor{stringliteral}{    e.g. def\_string is a shorthand path like ``babi:Task1k:1`` or ``#babi`` or a}
864 \textcolor{stringliteral}{    complete path like ``parlai.tasks.babi.agents:Task1kTeacher:1``, which essentially}
865 \textcolor{stringliteral}{    performs ``from parlai.tasks.babi import Task1kTeacher`` with the parameter ``1`` in}
866 \textcolor{stringliteral}{    ``opt['task']`` to be used by the class ``Task1kTeacher``.}
867 \textcolor{stringliteral}{    """}
868     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} (
869         opt.get(\textcolor{stringliteral}{'task'})
870         \textcolor{keywordflow}{or} opt.get(\textcolor{stringliteral}{'pytorch\_teacher\_task'})
871         \textcolor{keywordflow}{or} opt.get(\textcolor{stringliteral}{'pytorch\_teacher\_dataset'})
872     ):
873         \textcolor{keywordflow}{raise} RuntimeError(
874             \textcolor{stringliteral}{'No task specified. Please select a task with '} + \textcolor{stringliteral}{'--task \{task\_name\}.'}
875         )
876     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} opt.get(\textcolor{stringliteral}{'task'}):
877         opt[\textcolor{stringliteral}{'task'}] = \textcolor{stringliteral}{'pytorch\_teacher'}
878     \textcolor{keywordflow}{if} \textcolor{stringliteral}{','} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'task'}]:
879         \textcolor{comment}{# Single task}
880         teacher\_class = \hyperlink{namespaceparlai_1_1core_1_1agents_a530b987b67a802a8e9c5fa3c24ae942f}{get\_task\_module}(opt[\textcolor{stringliteral}{'task'}])
881         \_add\_task\_flags\_to\_agent\_opt(teacher\_class, opt, opt[\textcolor{stringliteral}{'task'}])
882         task\_agents = teacher\_class(opt)
883         \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(task\_agents) != list:
884             task\_agents = [task\_agents]
885         \textcolor{keywordflow}{return} task\_agents
886     \textcolor{keywordflow}{else}:
887         \textcolor{comment}{# Multitask teacher/agent}
888         task\_agents = MultiTaskTeacher(opt)
889         \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(task\_agents) != list:
890             task\_agents = [task\_agents]
891         \textcolor{keywordflow}{return} task\_agents
892 \end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1agents_a14a9d134d76ffd0509e50703d0f2c949}\label{namespaceparlai_1_1core_1_1agents_a14a9d134d76ffd0509e50703d0f2c949}} 
\index{parlai\+::core\+::agents@{parlai\+::core\+::agents}!get\+\_\+agent\+\_\+module@{get\+\_\+agent\+\_\+module}}
\index{get\+\_\+agent\+\_\+module@{get\+\_\+agent\+\_\+module}!parlai\+::core\+::agents@{parlai\+::core\+::agents}}
\subsubsection{\texorpdfstring{get\+\_\+agent\+\_\+module()}{get\_agent\_module()}}
{\footnotesize\ttfamily def parlai.\+core.\+agents.\+get\+\_\+agent\+\_\+module (\begin{DoxyParamCaption}\item[{}]{dir\+\_\+name }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return the module for an agent specified by ``--model``.

Can be formatted in several different ways:

* full: `-m parlai.agents.seq2seq.seq2seq:Seq2seqAgent`
* shorthand: -m seq2seq, which will check both paths
  ``parlai.agents.seq2seq.seq2seq:Seq2seqAgent`` and
  ``parlai.agents.seq2seq.agents:Seq2seqAgent``
* half-shorthand: ``-m seq2seq/variant``, which will check the path
  `parlai.agents.seq2seq.variant:VariantAgent`
* legacy models: ``-m legacy:seq2seq:0``, which will look for the deprecated
  model at ``parlai.agents.legacy_agents.seq2seq.seq2seq_v0:Seq2seqAgent``

The base path to search when using shorthand formats can be changed from
"parlai" to "parlai_internal" by prepending "internal:" to the path, e.g.
"internal:seq2seq".

To use legacy agent versions, you can prepend "legacy:" to model arguments,
e.g. "legacy:seq2seq:0" will translate to ``legacy_agents/seq2seq/seq2seq_v0``.

To use agents in projects, you can prepend "projects:" and the name of the
project folder to model arguments, e.g. "projects:personachat:kvmemnn"
will translate to ``projects/personachat/kvmemnn``.

:param dir_name: path to model class in one of the above formats.
\end{DoxyVerb}
 

Definition at line 606 of file agents.\+py.


\begin{DoxyCode}
606 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1agents_a14a9d134d76ffd0509e50703d0f2c949}{get\_agent\_module}(dir\_name):
607     \textcolor{stringliteral}{"""}
608 \textcolor{stringliteral}{    Return the module for an agent specified by ``--model``.}
609 \textcolor{stringliteral}{}
610 \textcolor{stringliteral}{    Can be formatted in several different ways:}
611 \textcolor{stringliteral}{}
612 \textcolor{stringliteral}{    * full: `-m parlai.agents.seq2seq.seq2seq:Seq2seqAgent`}
613 \textcolor{stringliteral}{    * shorthand: -m seq2seq, which will check both paths}
614 \textcolor{stringliteral}{      ``parlai.agents.seq2seq.seq2seq:Seq2seqAgent`` and}
615 \textcolor{stringliteral}{      ``parlai.agents.seq2seq.agents:Seq2seqAgent``}
616 \textcolor{stringliteral}{    * half-shorthand: ``-m seq2seq/variant``, which will check the path}
617 \textcolor{stringliteral}{      `parlai.agents.seq2seq.variant:VariantAgent`}
618 \textcolor{stringliteral}{    * legacy models: ``-m legacy:seq2seq:0``, which will look for the deprecated}
619 \textcolor{stringliteral}{      model at ``parlai.agents.legacy\_agents.seq2seq.seq2seq\_v0:Seq2seqAgent``}
620 \textcolor{stringliteral}{}
621 \textcolor{stringliteral}{    The base path to search when using shorthand formats can be changed from}
622 \textcolor{stringliteral}{    "parlai" to "parlai\_internal" by prepending "internal:" to the path, e.g.}
623 \textcolor{stringliteral}{    "internal:seq2seq".}
624 \textcolor{stringliteral}{}
625 \textcolor{stringliteral}{    To use legacy agent versions, you can prepend "legacy:" to model arguments,}
626 \textcolor{stringliteral}{    e.g. "legacy:seq2seq:0" will translate to ``legacy\_agents/seq2seq/seq2seq\_v0``.}
627 \textcolor{stringliteral}{}
628 \textcolor{stringliteral}{    To use agents in projects, you can prepend "projects:" and the name of the}
629 \textcolor{stringliteral}{    project folder to model arguments, e.g. "projects:personachat:kvmemnn"}
630 \textcolor{stringliteral}{    will translate to ``projects/personachat/kvmemnn``.}
631 \textcolor{stringliteral}{}
632 \textcolor{stringliteral}{    :param dir\_name: path to model class in one of the above formats.}
633 \textcolor{stringliteral}{    """}
634     repo = \textcolor{stringliteral}{'parlai'}
635     \textcolor{keywordflow}{if} dir\_name.startswith(\textcolor{stringliteral}{'internal:'}):
636         \textcolor{comment}{# To switch to local repo, useful for non-public projects}
637         \textcolor{comment}{# (make a directory called 'parlai\_internal' with your private agents)}
638         \textcolor{comment}{# this will follow the same paths but look in parlai\_internal instead}
639         repo = \textcolor{stringliteral}{'parlai\_internal'}
640         dir\_name = dir\_name[9:]
641 
642     \textcolor{keywordflow}{if} dir\_name.startswith(\textcolor{stringliteral}{'legacy:'}):
643         \textcolor{comment}{# e.g. -m legacy:seq2seq:0}
644         \textcolor{comment}{# will check legacy\_agents.seq2seq.seq2seq\_v0:Seq2seqAgent}
645         s = dir\_name.split(\textcolor{stringliteral}{':'})
646         \textcolor{keywordflow}{if} len(s) != 3:
647             \textcolor{keywordflow}{raise} RuntimeError(
648                 \textcolor{stringliteral}{'legacy paths should follow pattern '}
649                 \textcolor{stringliteral}{'legacy:model:version; you used \{\}'}
650                 \textcolor{stringliteral}{''}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(dir\_name)
651             )
652         model\_name = s[1]  \textcolor{comment}{# seq2seq}
653         module\_name = \textcolor{stringliteral}{'parlai.agents.legacy\_agents.\{m\}.\{m\}\_v\{v\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
654             m=model\_name, v=s[2]
655         )
656         class\_name = \hyperlink{namespaceparlai_1_1core_1_1agents_a7a5f5076b35ce376d8b46bfb362bfc53}{name\_to\_agent\_class}(model\_name)
657     \textcolor{keywordflow}{elif} dir\_name.startswith(\textcolor{stringliteral}{'projects:'}):
658         \textcolor{comment}{# e.g. -m projects:personachat:kvmemnn}
659         s = dir\_name.split(\textcolor{stringliteral}{':'})
660         \textcolor{keywordflow}{if} len(s) != 3:
661             \textcolor{keywordflow}{raise} RuntimeError(
662                 \textcolor{stringliteral}{'projects paths should follow pattern '}
663                 \textcolor{stringliteral}{'projects:folder:model; you used \{\}'}
664                 \textcolor{stringliteral}{''}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(dir\_name)
665             )
666         folder\_name = s[1]
667         model\_name = s[2]
668         module\_name = \textcolor{stringliteral}{'projects.\{p\}.\{m\}.\{m\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(m=model\_name, p=folder\_name)
669         class\_name = \hyperlink{namespaceparlai_1_1core_1_1agents_a7a5f5076b35ce376d8b46bfb362bfc53}{name\_to\_agent\_class}(model\_name)
670     \textcolor{keywordflow}{elif} \textcolor{stringliteral}{':'} \textcolor{keywordflow}{in} dir\_name:
671         \textcolor{comment}{# e.g. -m "parlai.agents.seq2seq.seq2seq:Seq2seqAgent"}
672         s = dir\_name.split(\textcolor{stringliteral}{':'})
673         module\_name = s[0]
674         class\_name = s[1]
675     \textcolor{keywordflow}{elif} \textcolor{stringliteral}{'/'} \textcolor{keywordflow}{in} dir\_name:
676         \textcolor{comment}{# e.g. -m my\_agent/special\_variant}
677         \textcolor{comment}{# will check parlai.agents.my\_agent.special\_variant:SpecialVariantAgent}
678         sp = dir\_name.split(\textcolor{stringliteral}{'/'})
679         module\_name = \textcolor{stringliteral}{"%s.agents.%s.%s"} % (repo, sp[0], sp[1])
680         class\_name = \hyperlink{namespaceparlai_1_1core_1_1agents_a7a5f5076b35ce376d8b46bfb362bfc53}{name\_to\_agent\_class}(sp[1])
681     \textcolor{keywordflow}{else}:
682         \textcolor{comment}{# e.g. -m seq2seq}
683         \textcolor{comment}{# will check parlai.agents.seq2seq.agents for Seq2seqAgent first}
684         \textcolor{comment}{# then check parlai.agents.seq2seq.seq2seq for Seq2seqAgent second}
685         class\_name = \hyperlink{namespaceparlai_1_1core_1_1agents_a7a5f5076b35ce376d8b46bfb362bfc53}{name\_to\_agent\_class}(dir\_name)
686         \textcolor{keywordflow}{try}:
687             module\_name = \textcolor{stringliteral}{"%s.agents.%s.agents"} % (repo, dir\_name)
688             importlib.import\_module(module\_name)  \textcolor{comment}{# check if it's there}
689         \textcolor{keywordflow}{except} ImportError:
690             module\_name = \textcolor{stringliteral}{"%s.agents.%s.%s"} % (repo, dir\_name, dir\_name)
691     my\_module = importlib.import\_module(module\_name)
692     model\_class = getattr(my\_module, class\_name)
693     \textcolor{keywordflow}{return} model\_class
694 
695 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1agents_a530b987b67a802a8e9c5fa3c24ae942f}\label{namespaceparlai_1_1core_1_1agents_a530b987b67a802a8e9c5fa3c24ae942f}} 
\index{parlai\+::core\+::agents@{parlai\+::core\+::agents}!get\+\_\+task\+\_\+module@{get\+\_\+task\+\_\+module}}
\index{get\+\_\+task\+\_\+module@{get\+\_\+task\+\_\+module}!parlai\+::core\+::agents@{parlai\+::core\+::agents}}
\subsubsection{\texorpdfstring{get\+\_\+task\+\_\+module()}{get\_task\_module()}}
{\footnotesize\ttfamily def parlai.\+core.\+agents.\+get\+\_\+task\+\_\+module (\begin{DoxyParamCaption}\item[{}]{taskname }\end{DoxyParamCaption})}

\begin{DoxyVerb}Get the module of the task agent specified by `--task`.

Can be formatted in several different ways:

* full: ``-t parlai.tasks.babi.agents:DefaultTeacher``
* shorthand: ``-t babi``, which will check
    ``parlai.tasks.babi.agents:DefaultTeacher``
* shorthand specific: ``-t babi:task10k``, which will check
    ``parlai.tasks.babi.agents:Task10kTeacher``

The base path to search when using shorthand formats can be changed from
"parlai" to "parlai_internal" by prepending "internal:" to the path, e.g.
"internal:babi".

Options can be sent to the teacher by adding an additional colon,
for example ``-t babi:task10k:1`` directs the babi Task10kTeacher to use
task number 1.

:param taskname: path to task class in one of the above formats.
\end{DoxyVerb}
 

Definition at line 787 of file agents.\+py.


\begin{DoxyCode}
787 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1agents_a530b987b67a802a8e9c5fa3c24ae942f}{get\_task\_module}(taskname):
788     \textcolor{stringliteral}{"""}
789 \textcolor{stringliteral}{    Get the module of the task agent specified by `--task`.}
790 \textcolor{stringliteral}{}
791 \textcolor{stringliteral}{    Can be formatted in several different ways:}
792 \textcolor{stringliteral}{}
793 \textcolor{stringliteral}{    * full: ``-t parlai.tasks.babi.agents:DefaultTeacher``}
794 \textcolor{stringliteral}{    * shorthand: ``-t babi``, which will check}
795 \textcolor{stringliteral}{        ``parlai.tasks.babi.agents:DefaultTeacher``}
796 \textcolor{stringliteral}{    * shorthand specific: ``-t babi:task10k``, which will check}
797 \textcolor{stringliteral}{        ``parlai.tasks.babi.agents:Task10kTeacher``}
798 \textcolor{stringliteral}{}
799 \textcolor{stringliteral}{    The base path to search when using shorthand formats can be changed from}
800 \textcolor{stringliteral}{    "parlai" to "parlai\_internal" by prepending "internal:" to the path, e.g.}
801 \textcolor{stringliteral}{    "internal:babi".}
802 \textcolor{stringliteral}{}
803 \textcolor{stringliteral}{    Options can be sent to the teacher by adding an additional colon,}
804 \textcolor{stringliteral}{    for example ``-t babi:task10k:1`` directs the babi Task10kTeacher to use}
805 \textcolor{stringliteral}{    task number 1.}
806 \textcolor{stringliteral}{}
807 \textcolor{stringliteral}{    :param taskname: path to task class in one of the above formats.}
808 \textcolor{stringliteral}{    """}
809     sp = taskname.strip()
810     repo = \textcolor{stringliteral}{'parlai'}
811     \textcolor{keywordflow}{if} sp.startswith(\textcolor{stringliteral}{'internal:'}):
812         \textcolor{comment}{# To switch to local repo, useful for non-public projects}
813         \textcolor{comment}{# (make a directory called 'parlai\_internal' with your private agents)}
814         repo = \textcolor{stringliteral}{'parlai\_internal'}
815         sp = sp[9:]
816     sp = sp.split(\textcolor{stringliteral}{':'})
817     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'.'} \textcolor{keywordflow}{in} sp[0]:
818         module\_name = sp[0]
819     \textcolor{keywordflow}{elif} sp[0] == \textcolor{stringliteral}{'pytorch\_teacher'}:
820         module\_name = \textcolor{stringliteral}{'parlai.core.pytorch\_data\_teacher'}
821     \textcolor{keywordflow}{else}:
822         task = sp[0].lower()
823         module\_name = \textcolor{stringliteral}{"%s.tasks.%s.agents"} % (repo, task)
824     \textcolor{keywordflow}{if} len(sp) > 1 \textcolor{keywordflow}{and} \textcolor{stringliteral}{'='} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} sp[1]:
825         sp[1] = sp[1][0].upper() + sp[1][1:]
826         teacher = sp[1]
827         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'.'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} sp[0] \textcolor{keywordflow}{and} \textcolor{stringliteral}{'Teacher'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} teacher:
828             \textcolor{comment}{# Reformat from underscore to CamelCase and append "Teacher" to}
829             \textcolor{comment}{# class name by default if a complete path is not given.}
830             words = teacher.split(\textcolor{stringliteral}{'\_'})
831             teacher\_name = \textcolor{stringliteral}{''}
832             \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} words:
833                 teacher\_name += w[0].upper() + w[1:]
834             teacher = teacher\_name + \textcolor{stringliteral}{"Teacher"}
835     \textcolor{keywordflow}{else}:
836         teacher = \textcolor{stringliteral}{"DefaultTeacher"}
837     my\_module = importlib.import\_module(module\_name)
838     teacher\_class = getattr(my\_module, teacher)
839     \textcolor{keywordflow}{return} teacher\_class
840 
841 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1agents_a213df46dd21144eb4c056bb58c294c5d}\label{namespaceparlai_1_1core_1_1agents_a213df46dd21144eb4c056bb58c294c5d}} 
\index{parlai\+::core\+::agents@{parlai\+::core\+::agents}!load\+\_\+agent\+\_\+module@{load\+\_\+agent\+\_\+module}}
\index{load\+\_\+agent\+\_\+module@{load\+\_\+agent\+\_\+module}!parlai\+::core\+::agents@{parlai\+::core\+::agents}}
\subsubsection{\texorpdfstring{load\+\_\+agent\+\_\+module()}{load\_agent\_module()}}
{\footnotesize\ttfamily def parlai.\+core.\+agents.\+load\+\_\+agent\+\_\+module (\begin{DoxyParamCaption}\item[{}]{opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Load agent options and module from file if opt file exists.

Checks to see if file exists opt['model_file'] + ".opt"; if so, load up the
options from the file and use that to create an agent, loading the model
type from that file and overriding any options specified in that file when
instantiating the agent.

If that file does not exist, return None.
\end{DoxyVerb}
 

Definition at line 520 of file agents.\+py.


\begin{DoxyCode}
520 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1agents_a213df46dd21144eb4c056bb58c294c5d}{load\_agent\_module}(opt):
521     \textcolor{stringliteral}{"""}
522 \textcolor{stringliteral}{    Load agent options and module from file if opt file exists.}
523 \textcolor{stringliteral}{}
524 \textcolor{stringliteral}{    Checks to see if file exists opt['model\_file'] + ".opt"; if so, load up the}
525 \textcolor{stringliteral}{    options from the file and use that to create an agent, loading the model}
526 \textcolor{stringliteral}{    type from that file and overriding any options specified in that file when}
527 \textcolor{stringliteral}{    instantiating the agent.}
528 \textcolor{stringliteral}{}
529 \textcolor{stringliteral}{    If that file does not exist, return None.}
530 \textcolor{stringliteral}{    """}
531     model\_file = opt[\textcolor{stringliteral}{'model\_file'}]
532     optfile = model\_file + \textcolor{stringliteral}{'.opt'}
533     \textcolor{keywordflow}{if} os.path.isfile(optfile):
534         new\_opt = \hyperlink{namespaceparlai_1_1utils_1_1misc_a7c97ef3250327bc549ac652a481be0cf}{load\_opt\_file}(optfile)
535         \textcolor{comment}{# TODO we need a better way to say these options are never copied...}
536         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'datapath'} \textcolor{keywordflow}{in} new\_opt:
537             \textcolor{comment}{# never use the datapath from an opt dump}
538             del new\_opt[\textcolor{stringliteral}{'datapath'}]
539         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'batchindex'} \textcolor{keywordflow}{in} new\_opt:
540             \textcolor{comment}{# This saved variable can cause trouble if we switch to BS=1 at test time}
541             del new\_opt[\textcolor{stringliteral}{'batchindex'}]
542         \textcolor{comment}{# only override opts specified in 'override' dict}
543         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'override'}):
544             \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} opt[\textcolor{stringliteral}{'override'}].items():
545                 \textcolor{keywordflow}{if} \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(v) != \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(new\_opt.get(k, \textcolor{keywordtype}{None})):
546                     print(
547                         \textcolor{stringliteral}{"[ warning: overriding opt['\{\}'] to \{\} ("}
548                         \textcolor{stringliteral}{"previously: \{\} )]"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(k, v, new\_opt.get(k, \textcolor{keywordtype}{None}))
549                     )
550                 new\_opt[k] = v
551 
552         model\_class = \hyperlink{namespaceparlai_1_1core_1_1agents_a14a9d134d76ffd0509e50703d0f2c949}{get\_agent\_module}(new\_opt[\textcolor{stringliteral}{'model'}])
553 
554         \textcolor{comment}{# check for model version}
555         \textcolor{keywordflow}{if} hasattr(model\_class, \textcolor{stringliteral}{'model\_version'}):
556             curr\_version = new\_opt.get(\textcolor{stringliteral}{'model\_version'}, 0)
557             \textcolor{keywordflow}{if} curr\_version != model\_class.model\_version():
558                 model = new\_opt[\textcolor{stringliteral}{'model'}]
559                 m = (
560                     \textcolor{stringliteral}{'It looks like you are trying to load an older version of'}
561                     \textcolor{stringliteral}{' the selected model. Change your model argument to use '}
562                     \textcolor{stringliteral}{'the old version from parlai/agents/legacy\_agents: for '}
563                     \textcolor{stringliteral}{'example: `-m legacy:\{m\}:\{v\}` or '}
564                     \textcolor{stringliteral}{'`--model parlai.agents.legacy\_agents.\{m\}.\{m\}\_v\{v\}:\{c\}`'}
565                 )
566                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'.'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} model:
567                     \textcolor{comment}{# give specific error message if it's easy}
568                     \textcolor{keywordflow}{raise} RuntimeError(
569                         m.format(m=model, v=curr\_version, c=model\_class.\_\_name\_\_)
570                     )
571                 \textcolor{keywordflow}{else}:
572                     \textcolor{comment}{# otherwise generic one}
573                     \textcolor{keywordflow}{raise} RuntimeError(
574                         m.format(m=\textcolor{stringliteral}{'modelname'}, v=curr\_version, c=\textcolor{stringliteral}{'ModelAgent'})
575                     )
576 
577         \textcolor{keywordflow}{if} hasattr(model\_class, \textcolor{stringliteral}{'upgrade\_opt'}):
578             new\_opt = model\_class.upgrade\_opt(new\_opt)
579 
580         \textcolor{comment}{# add model arguments to new\_opt if they aren't in new\_opt already}
581         \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} opt.items():
582             \textcolor{keywordflow}{if} k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} new\_opt:
583                 new\_opt[k] = v
584         new\_opt[\textcolor{stringliteral}{'model\_file'}] = model\_file
585         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} new\_opt.get(\textcolor{stringliteral}{'dict\_file'}):
586             new\_opt[\textcolor{stringliteral}{'dict\_file'}] = model\_file + \textcolor{stringliteral}{'.dict'}
587         \textcolor{keywordflow}{elif} new\_opt.get(\textcolor{stringliteral}{'dict\_file'}) \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} os.path.isfile(new\_opt[\textcolor{stringliteral}{'dict\_file'}]):
588             old\_dict\_file = new\_opt[\textcolor{stringliteral}{'dict\_file'}]
589             new\_opt[\textcolor{stringliteral}{'dict\_file'}] = model\_file + \textcolor{stringliteral}{'.dict'}
590         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.isfile(new\_opt[\textcolor{stringliteral}{'dict\_file'}]):
591             \hyperlink{namespaceparlai_1_1utils_1_1misc_acf146e70ea7f6867969a7c2b545d4b4b}{warn\_once}(
592                 \textcolor{stringliteral}{'WARNING: Neither the specified dict file (\{\}) nor the '}
593                 \textcolor{stringliteral}{'`model\_file`.dict file (\{\}) exists, check to make sure either '}
594                 \textcolor{stringliteral}{'is correct. This may manifest as a shape mismatch later '}
595                 \textcolor{stringliteral}{'on.'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(old\_dict\_file, new\_opt[\textcolor{stringliteral}{'dict\_file'}])
596             )
597 
598         \textcolor{comment}{# if we want to load weights from --init-model, compare opts with}
599         \textcolor{comment}{# loaded ones}
600         \hyperlink{namespaceparlai_1_1core_1_1agents_a7eb0ec391b94a2adc51acdf8d2a35a68}{compare\_init\_model\_opts}(opt, new\_opt)
601         \textcolor{keywordflow}{return} model\_class(new\_opt)
602     \textcolor{keywordflow}{else}:
603         \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
604 
605 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceparlai_1_1core_1_1agents_a7a5f5076b35ce376d8b46bfb362bfc53}\label{namespaceparlai_1_1core_1_1agents_a7a5f5076b35ce376d8b46bfb362bfc53}} 
\index{parlai\+::core\+::agents@{parlai\+::core\+::agents}!name\+\_\+to\+\_\+agent\+\_\+class@{name\+\_\+to\+\_\+agent\+\_\+class}}
\index{name\+\_\+to\+\_\+agent\+\_\+class@{name\+\_\+to\+\_\+agent\+\_\+class}!parlai\+::core\+::agents@{parlai\+::core\+::agents}}
\subsubsection{\texorpdfstring{name\+\_\+to\+\_\+agent\+\_\+class()}{name\_to\_agent\_class()}}
{\footnotesize\ttfamily def parlai.\+core.\+agents.\+name\+\_\+to\+\_\+agent\+\_\+class (\begin{DoxyParamCaption}\item[{}]{name }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert agent name to class.

This adds "Agent" to the end of the name and uppercases the first letter
and the first letter appearing after each underscore (underscores are
removed).

:param name: name of agent, e.g. local_human

Returns class of agent, e.g. LocalHumanAgent.
\end{DoxyVerb}
 

Definition at line 432 of file agents.\+py.


\begin{DoxyCode}
432 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1core_1_1agents_a7a5f5076b35ce376d8b46bfb362bfc53}{name\_to\_agent\_class}(name):
433     \textcolor{stringliteral}{"""}
434 \textcolor{stringliteral}{    Convert agent name to class.}
435 \textcolor{stringliteral}{}
436 \textcolor{stringliteral}{    This adds "Agent" to the end of the name and uppercases the first letter}
437 \textcolor{stringliteral}{    and the first letter appearing after each underscore (underscores are}
438 \textcolor{stringliteral}{    removed).}
439 \textcolor{stringliteral}{}
440 \textcolor{stringliteral}{    :param name: name of agent, e.g. local\_human}
441 \textcolor{stringliteral}{}
442 \textcolor{stringliteral}{    Returns class of agent, e.g. LocalHumanAgent.}
443 \textcolor{stringliteral}{    """}
444     words = name.split(\textcolor{stringliteral}{'\_'})
445     class\_name = \textcolor{stringliteral}{''}
446     \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} words:
447         class\_name += w[0].upper() + w[1:]
448     class\_name += \textcolor{stringliteral}{'Agent'}
449     \textcolor{keywordflow}{return} class\_name
450 
451 
\end{DoxyCode}
