\hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent}{}\section{parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent Class Reference}
\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent}\index{parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent@{parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent}}


Inheritance diagram for parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=273pt]{da/dee/classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=318pt]{db/d0b/classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a96d864d610277625195f71a615c0f585}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1core_1_1torch__agent_1_1TorchAgent_a785bb920cf8c8afc3e9bf6a8b77e335a}{opt}, shared=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a49ef7547db36c1570b8c10d0c8bee42e}{train\+\_\+step} (self, batch)
\item 
def \hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a6d189366af4a1264770d59e4b114967a}{eval\+\_\+step} (self, batch)
\item 
def \hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a5e8419dfd48e5a9b0a999058a9537831}{save} (self, path=None)
\item 
def \hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a3900966ef98a770cf6e871bb7de67907}{load} (self, path)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a763f87c99544b29a0f8fae2c6019e2f8}{add\+\_\+cmdline\+\_\+args} (parser)
\item 
def \hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a4fd71b73fc926491aedc3da5921f62ca}{dictionary\+\_\+class} ()
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a09440365a6c5a85c438f1a2bda393fff}{path\+\_\+biencoder}
\item 
\hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a5042e527dfb849630b553b3d06388764}{path\+\_\+crossencoder}
\item 
\hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_ac4f692882d020eb3fced04859bd6f3ff}{top\+\_\+n\+\_\+bi}
\item 
\hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a3ab75f0b7e32e139b933b13b588917c4}{N\+U\+L\+L\+\_\+\+I\+DX}
\item 
\hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a4cde2fe30b33c41771c0747ceed6ad56}{S\+T\+A\+R\+T\+\_\+\+I\+DX}
\item 
\hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_aa82e3a58e40ee874568e3ecd7bf1ec8f}{E\+N\+D\+\_\+\+I\+DX}
\item 
\hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a314d86777e26f7f1ab9a7b96bbaf1398}{biencoder}
\item 
\hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_adcc57077c1fa3c461fecca24720f73bf}{crossencoder\+\_\+batchsize}
\item 
\hyperlink{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a7ad0e098a0dd8278caa7ed77e147bfb1}{crossencoder}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
\begin{DoxyVerb}A Bi Encoder followed by a Cross Encoder.

Although it's trainable by itself, I'd recommend training the crossencoder and the
biencoder separately which can be done in parallel or sequentially and thus
requiring less memory on the GPU.
\end{DoxyVerb}
 

Definition at line 14 of file both\+\_\+encoder\+\_\+ranker.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a96d864d610277625195f71a615c0f585}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a96d864d610277625195f71a615c0f585}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 53 of file both\+\_\+encoder\+\_\+ranker.\+py.


\begin{DoxyCode}
53     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
54         opt[\textcolor{stringliteral}{'lr\_scheduler'}] = \textcolor{stringliteral}{'none'}
55         self.path\_biencoder = opt.get(\textcolor{stringliteral}{'biencoder\_model\_file'}, \textcolor{keywordtype}{None})
56         \textcolor{keywordflow}{if} self.path\_biencoder \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
57             self.path\_biencoder = opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'\_bi'}
58         self.path\_crossencoder = opt.get(\textcolor{stringliteral}{'crossencoder\_model\_file'}, \textcolor{keywordtype}{None})
59         \textcolor{keywordflow}{if} self.path\_crossencoder \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
60             self.path\_crossencoder = opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'\_cross'}
61         self.top\_n\_bi = opt[\textcolor{stringliteral}{'biencoder\_top\_n'}]
62 
63         super().\_\_init\_\_(opt, shared)
64         self.NULL\_IDX = self.dict.pad\_idx
65         self.START\_IDX = self.dict.start\_idx
66         self.END\_IDX = self.dict.end\_idx
67         \textcolor{keywordflow}{if} shared \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
68             opt\_biencoder = dict(opt)
69             opt\_biencoder[\textcolor{stringliteral}{'model\_file'}] = self.path\_biencoder
70             self.biencoder = BiEncoderRankerAgent(opt\_biencoder)
71             opt\_crossencoder = dict(opt)
72             opt\_crossencoder[\textcolor{stringliteral}{'model\_file'}] = self.path\_crossencoder
73             opt\_crossencoder[\textcolor{stringliteral}{'batchsize'}] = opt[\textcolor{stringliteral}{'batchsize'}]
74             opt\_crossencoder[\textcolor{stringliteral}{'eval\_candidates'}] = \textcolor{stringliteral}{'inline'}
75             \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'crossencoder\_batchsize'}] != -1:
76                 opt\_crossencoder[\textcolor{stringliteral}{'batchsize'}] = opt[\textcolor{stringliteral}{'crossencoder\_batchsize'}]
77             self.crossencoder\_batchsize = opt\_crossencoder[\textcolor{stringliteral}{'batchsize'}]
78             self.crossencoder = CrossEncoderRankerAgent(opt\_crossencoder)
79 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a763f87c99544b29a0f8fae2c6019e2f8}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a763f87c99544b29a0f8fae2c6019e2f8}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}}
\index{add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+cmdline\+\_\+args()}{add\_cmdline\_args()}}
{\footnotesize\ttfamily def parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+add\+\_\+cmdline\+\_\+args (\begin{DoxyParamCaption}\item[{}]{parser }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 24 of file both\+\_\+encoder\+\_\+ranker.\+py.


\begin{DoxyCode}
24     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(parser):
25         \hyperlink{namespaceparlai_1_1agents_1_1bert__ranker_1_1helpers_ac2e926c3aba3a62be09e2c37dffcaee2}{add\_common\_args}(parser)
26         parser = parser.add\_argument\_group(\textcolor{stringliteral}{'Bert Ranker Arguments'})
27         parser.add\_argument(
28             \textcolor{stringliteral}{'--biencoder-model-file'},
29             type=str,
30             default=\textcolor{keywordtype}{None},
31             help=\textcolor{stringliteral}{'path to biencoder model. Default to model-file\_bi'},
32         )
33         parser.add\_argument(
34             \textcolor{stringliteral}{'--biencoder-top-n'},
35             type=int,
36             default=10,
37             help=\textcolor{stringliteral}{'default number of elements to keep from the biencoder response'},
38         )
39         parser.add\_argument(
40             \textcolor{stringliteral}{'--crossencoder-model-file'},
41             type=str,
42             default=\textcolor{keywordtype}{None},
43             help=\textcolor{stringliteral}{'path to crossencoder model. Default to model-file\_cross'},
44         )
45         parser.add\_argument(
46             \textcolor{stringliteral}{'--crossencoder-batchsize'},
47             type=int,
48             default=-1,
49             help=\textcolor{stringliteral}{'crossencoder will be fed those many elements at train or eval time.'},
50         )
51         parser.set\_defaults(encode\_candidate\_vecs=\textcolor{keyword}{True})
52 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a4fd71b73fc926491aedc3da5921f62ca}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a4fd71b73fc926491aedc3da5921f62ca}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!dictionary\+\_\+class@{dictionary\+\_\+class}}
\index{dictionary\+\_\+class@{dictionary\+\_\+class}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{dictionary\+\_\+class()}{dictionary\_class()}}
{\footnotesize\ttfamily def parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+dictionary\+\_\+class (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 81 of file both\+\_\+encoder\+\_\+ranker.\+py.


\begin{DoxyCode}
81     \textcolor{keyword}{def }dictionary\_class():
82         \textcolor{keywordflow}{return} BertDictionaryAgent
83 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a6d189366af4a1264770d59e4b114967a}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a6d189366af4a1264770d59e4b114967a}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!eval\+\_\+step@{eval\+\_\+step}}
\index{eval\+\_\+step@{eval\+\_\+step}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{eval\+\_\+step()}{eval\_step()}}
{\footnotesize\ttfamily def parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+eval\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}We pass the batch first in the biencoder, then filter with crossencoder.
\end{DoxyVerb}
 

Definition at line 100 of file both\+\_\+encoder\+\_\+ranker.\+py.


\begin{DoxyCode}
100     \textcolor{keyword}{def }eval\_step(self, batch):
101         \textcolor{stringliteral}{"""}
102 \textcolor{stringliteral}{        We pass the batch first in the biencoder, then filter with crossencoder.}
103 \textcolor{stringliteral}{        """}
104         output\_biencoder = self.biencoder.eval\_step(batch)
105         \textcolor{keywordflow}{if} output\_biencoder \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
106             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
107         new\_candidate\_vecs = [
108             self.biencoder.vectorize\_fixed\_candidates(cands[0 : self.top\_n\_bi])
109             \textcolor{keywordflow}{for} cands \textcolor{keywordflow}{in} output\_biencoder.text\_candidates
110         ]
111         new\_candidates = [
112             [c \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} cands[0 : self.top\_n\_bi]]
113             \textcolor{keywordflow}{for} cands \textcolor{keywordflow}{in} output\_biencoder.text\_candidates
114             \textcolor{keywordflow}{if} cands \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
115         ]
116         copy\_batch = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a74cfde390a2b9861179ac0fcd59da28c}{Batch}(
117             text\_vec=batch.text\_vec,
118             candidate\_vecs=new\_candidate\_vecs,
119             candidates=new\_candidates,
120         )
121         \textcolor{keywordflow}{return} self.crossencoder.eval\_step(copy\_batch)
122 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a3900966ef98a770cf6e871bb7de67907}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a3900966ef98a770cf6e871bb7de67907}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!load@{load}}
\index{load@{load}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{load()}{load()}}
{\footnotesize\ttfamily def parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+load (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}



Definition at line 127 of file both\+\_\+encoder\+\_\+ranker.\+py.


\begin{DoxyCode}
127     \textcolor{keyword}{def }load(self, path):
128         self.biencoder.load(self.path\_biencoder)
129         self.crossencoder.load(self.path\_crossencoder)
130 \end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a5e8419dfd48e5a9b0a999058a9537831}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a5e8419dfd48e5a9b0a999058a9537831}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!save@{save}}
\index{save@{save}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily def parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+save (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 123 of file both\+\_\+encoder\+\_\+ranker.\+py.


\begin{DoxyCode}
123     \textcolor{keyword}{def }save(self, path=None):
124         self.biencoder.save(self.path\_biencoder)
125         self.crossencoder.save(self.path\_crossencoder)
126 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a49ef7547db36c1570b8c10d0c8bee42e}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a49ef7547db36c1570b8c10d0c8bee42e}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!train\+\_\+step@{train\+\_\+step}}
\index{train\+\_\+step@{train\+\_\+step}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{train\+\_\+step()}{train\_step()}}
{\footnotesize\ttfamily def parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+train\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}



Definition at line 84 of file both\+\_\+encoder\+\_\+ranker.\+py.


\begin{DoxyCode}
84     \textcolor{keyword}{def }train\_step(self, batch):
85         self.biencoder.train\_step(batch)
86         \textcolor{comment}{# the crossencoder requires batches that are smaller.}
87         \textcolor{comment}{# split the batch into smaller pieces}
88         outc = []
89         step = self.crossencoder\_batchsize
90         \textcolor{keywordflow}{for} start \textcolor{keywordflow}{in} range(0, len(batch.text\_vec), step):
91             mbatch = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a74cfde390a2b9861179ac0fcd59da28c}{Batch}(
92                 text\_vec=batch.text\_vec[start : start + step],
93                 label\_vec=batch.label\_vec[start : start + step],
94                 candidate\_vecs=batch.candidate\_vecs[start : start + step],
95                 candidates=batch.candidates[start : start + step],
96             )
97             outc.append(self.crossencoder.train\_step(mbatch))
98         \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(text=[text \textcolor{keywordflow}{for} out \textcolor{keywordflow}{in} outc \textcolor{keywordflow}{for} text \textcolor{keywordflow}{in} out.text])
99 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a314d86777e26f7f1ab9a7b96bbaf1398}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a314d86777e26f7f1ab9a7b96bbaf1398}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!biencoder@{biencoder}}
\index{biencoder@{biencoder}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{biencoder}{biencoder}}
{\footnotesize\ttfamily parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+biencoder}



Definition at line 70 of file both\+\_\+encoder\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a7ad0e098a0dd8278caa7ed77e147bfb1}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a7ad0e098a0dd8278caa7ed77e147bfb1}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!crossencoder@{crossencoder}}
\index{crossencoder@{crossencoder}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{crossencoder}{crossencoder}}
{\footnotesize\ttfamily parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+crossencoder}



Definition at line 78 of file both\+\_\+encoder\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_adcc57077c1fa3c461fecca24720f73bf}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_adcc57077c1fa3c461fecca24720f73bf}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!crossencoder\+\_\+batchsize@{crossencoder\+\_\+batchsize}}
\index{crossencoder\+\_\+batchsize@{crossencoder\+\_\+batchsize}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{crossencoder\+\_\+batchsize}{crossencoder\_batchsize}}
{\footnotesize\ttfamily parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+crossencoder\+\_\+batchsize}



Definition at line 77 of file both\+\_\+encoder\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_aa82e3a58e40ee874568e3ecd7bf1ec8f}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_aa82e3a58e40ee874568e3ecd7bf1ec8f}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!E\+N\+D\+\_\+\+I\+DX@{E\+N\+D\+\_\+\+I\+DX}}
\index{E\+N\+D\+\_\+\+I\+DX@{E\+N\+D\+\_\+\+I\+DX}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{E\+N\+D\+\_\+\+I\+DX}{END\_IDX}}
{\footnotesize\ttfamily parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+E\+N\+D\+\_\+\+I\+DX}



Definition at line 66 of file both\+\_\+encoder\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a3ab75f0b7e32e139b933b13b588917c4}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a3ab75f0b7e32e139b933b13b588917c4}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!N\+U\+L\+L\+\_\+\+I\+DX@{N\+U\+L\+L\+\_\+\+I\+DX}}
\index{N\+U\+L\+L\+\_\+\+I\+DX@{N\+U\+L\+L\+\_\+\+I\+DX}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{N\+U\+L\+L\+\_\+\+I\+DX}{NULL\_IDX}}
{\footnotesize\ttfamily parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+N\+U\+L\+L\+\_\+\+I\+DX}



Definition at line 64 of file both\+\_\+encoder\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a09440365a6c5a85c438f1a2bda393fff}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a09440365a6c5a85c438f1a2bda393fff}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!path\+\_\+biencoder@{path\+\_\+biencoder}}
\index{path\+\_\+biencoder@{path\+\_\+biencoder}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{path\+\_\+biencoder}{path\_biencoder}}
{\footnotesize\ttfamily parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+path\+\_\+biencoder}



Definition at line 55 of file both\+\_\+encoder\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a5042e527dfb849630b553b3d06388764}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a5042e527dfb849630b553b3d06388764}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!path\+\_\+crossencoder@{path\+\_\+crossencoder}}
\index{path\+\_\+crossencoder@{path\+\_\+crossencoder}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{path\+\_\+crossencoder}{path\_crossencoder}}
{\footnotesize\ttfamily parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+path\+\_\+crossencoder}



Definition at line 58 of file both\+\_\+encoder\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a4cde2fe30b33c41771c0747ceed6ad56}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_a4cde2fe30b33c41771c0747ceed6ad56}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!S\+T\+A\+R\+T\+\_\+\+I\+DX@{S\+T\+A\+R\+T\+\_\+\+I\+DX}}
\index{S\+T\+A\+R\+T\+\_\+\+I\+DX@{S\+T\+A\+R\+T\+\_\+\+I\+DX}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{S\+T\+A\+R\+T\+\_\+\+I\+DX}{START\_IDX}}
{\footnotesize\ttfamily parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+S\+T\+A\+R\+T\+\_\+\+I\+DX}



Definition at line 65 of file both\+\_\+encoder\+\_\+ranker.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_ac4f692882d020eb3fced04859bd6f3ff}\label{classparlai_1_1agents_1_1bert__ranker_1_1both__encoder__ranker_1_1BothEncoderRankerAgent_ac4f692882d020eb3fced04859bd6f3ff}} 
\index{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}!top\+\_\+n\+\_\+bi@{top\+\_\+n\+\_\+bi}}
\index{top\+\_\+n\+\_\+bi@{top\+\_\+n\+\_\+bi}!parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent@{parlai\+::agents\+::bert\+\_\+ranker\+::both\+\_\+encoder\+\_\+ranker\+::\+Both\+Encoder\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{top\+\_\+n\+\_\+bi}{top\_n\_bi}}
{\footnotesize\ttfamily parlai.\+agents.\+bert\+\_\+ranker.\+both\+\_\+encoder\+\_\+ranker.\+Both\+Encoder\+Ranker\+Agent.\+top\+\_\+n\+\_\+bi}



Definition at line 61 of file both\+\_\+encoder\+\_\+ranker.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/bert\+\_\+ranker/\hyperlink{both__encoder__ranker_8py}{both\+\_\+encoder\+\_\+ranker.\+py}\end{DoxyCompactItemize}
