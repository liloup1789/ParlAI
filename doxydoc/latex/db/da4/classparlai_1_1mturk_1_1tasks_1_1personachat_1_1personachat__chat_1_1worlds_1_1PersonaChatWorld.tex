\hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld}{}\section{parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World Class Reference}
\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld}\index{parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World@{parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World}}


Inheritance diagram for parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=287pt]{d7/d57/classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=287pt]{df/d6d/classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a2c2cc9c085e1c562ce88a845bc6811d1}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1core_1_1worlds_1_1World_a3640d92718acd3e6942a28c1ab3678bd}{opt}, \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a9b7cb2eee599053a23d83201036d57a1}{agents}=None, shared=None, \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad08f076173e395eea81ba3de824e166c}{range\+\_\+turn}=(4, 7), \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a6f496f8f3c030b9e273f1d583a41f240}{max\+\_\+turn}=10, \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_aca25d3660a3dac91fa40ec7a18b214f5}{max\+\_\+resp\+\_\+time}=120, \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a254ecf0c1c1d37f2f2027f4206abc321}{world\+\_\+tag}=\textquotesingle{}N\+O\+NE\textquotesingle{}, \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad93464fe08cb5ec2007ef03f6d65e0f4}{agent\+\_\+timeout\+\_\+shutdown}=120)
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_af1504dbfbf076f8e3dad5f8ac823f761}{parley} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a86d1d4e599a470ec7f031c60b2fb0e61}{shutdown} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a9497024a85da74e69e5b6a1568b5ff18}{episode\+\_\+done} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_accac4ee2dc51850f0af8fa43055023e7}{get\+\_\+instruction} (self, agent\+\_\+id=None, tag=\textquotesingle{}first\textquotesingle{})
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad0266a390c3789b1351a19b8bcad2696}{save\+\_\+data} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a5edf0526e8aad41c00289548253d51e9}{is\+\_\+exact\+\_\+match} (self, act, ag, tolerance=0)
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a7f6c59f2e1f897e1e480b43fc67680df}{is\+\_\+msg\+\_\+tooshortlong} (self, act, ag, th\+\_\+min=5, th\+\_\+max=17)
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a3882e622e065f27421c5b2105558471a}{reset\+\_\+random} (self)
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a2d3f943d1fd0d1bff5af9fdcae160439}{check\+\_\+timeout} (self, act)
\item 
def \hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a17e4312c4028bb75b1b1bc7f83557509}{review\+\_\+work} (self)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a9b7cb2eee599053a23d83201036d57a1}{agents}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a51467e3bd1a647ebccb408b416c14392}{turn\+\_\+idx}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad08f076173e395eea81ba3de824e166c}{range\+\_\+turn}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a6f496f8f3c030b9e273f1d583a41f240}{max\+\_\+turn}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a5d7ec7e979796d96f4ba08a5e060e74d}{n\+\_\+turn}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a8371a48d12812df08bfd082ece010595}{dialog}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a023ac4d00b220768cef0157b1e859d37}{task\+\_\+type}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a1cc3d9e7a13bd3c7dd8987681d628f54}{chat\+\_\+done}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a254ecf0c1c1d37f2f2027f4206abc321}{world\+\_\+tag}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_aca25d3660a3dac91fa40ec7a18b214f5}{max\+\_\+resp\+\_\+time}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad93464fe08cb5ec2007ef03f6d65e0f4}{agent\+\_\+timeout\+\_\+shutdown}
\item 
\hyperlink{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a956a563f5690d02a40ad90028b773c24}{personas}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 126 of file worlds.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a2c2cc9c085e1c562ce88a845bc6811d1}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a2c2cc9c085e1c562ce88a845bc6811d1}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{agents = {\ttfamily None},  }\item[{}]{shared = {\ttfamily None},  }\item[{}]{range\+\_\+turn = {\ttfamily (4,~7)},  }\item[{}]{max\+\_\+turn = {\ttfamily 10},  }\item[{}]{max\+\_\+resp\+\_\+time = {\ttfamily 120},  }\item[{}]{world\+\_\+tag = {\ttfamily \textquotesingle{}NONE\textquotesingle{}},  }\item[{}]{agent\+\_\+timeout\+\_\+shutdown = {\ttfamily 120} }\end{DoxyParamCaption})}



Definition at line 137 of file worlds.\+py.


\begin{DoxyCode}
137     ):
138         self.agents = agents
139         self.turn\_idx = 0
140         self.range\_turn = range\_turn
141         self.max\_turn = max\_turn
142         self.n\_turn = np.random.randint(self.range\_turn[0], self.range\_turn[1]) + 1
143         self.dialog = []
144         self.task\_type = \textcolor{stringliteral}{'sandbox'} \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'is\_sandbox'}] \textcolor{keywordflow}{else} \textcolor{stringliteral}{'live'}
145         self.chat\_done = \textcolor{keyword}{False}
146         self.world\_tag = world\_tag
147 
148         \textcolor{comment}{# below are timeout protocols}
149         self.max\_resp\_time = max\_resp\_time  \textcolor{comment}{# in secs}
150         self.agent\_timeout\_shutdown = agent\_timeout\_shutdown
151         super().\_\_init\_\_(opt, agents, shared)
152 
153         \textcolor{comment}{# get personas}
154         self.personas = [
155             (ag.persona\_data \textcolor{keywordflow}{if} hasattr(ag, \textcolor{stringliteral}{'persona\_data'}) \textcolor{keywordflow}{else} \textcolor{keywordtype}{None})
156             \textcolor{keywordflow}{for} ag \textcolor{keywordflow}{in} self.agents
157         ]
158 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a2d3f943d1fd0d1bff5af9fdcae160439}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a2d3f943d1fd0d1bff5af9fdcae160439}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!check\+\_\+timeout@{check\+\_\+timeout}}
\index{check\+\_\+timeout@{check\+\_\+timeout}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{check\+\_\+timeout()}{check\_timeout()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+check\+\_\+timeout (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{act }\end{DoxyParamCaption})}



Definition at line 411 of file worlds.\+py.


\begin{DoxyCode}
411     \textcolor{keyword}{def }check\_timeout(self, act):
412         \textcolor{keywordflow}{if} act[\textcolor{stringliteral}{'text'}] == \textcolor{stringliteral}{'[TIMEOUT]'} \textcolor{keywordflow}{and} act[\textcolor{stringliteral}{'episode\_done'}]:
413             control\_msg = \{\textcolor{stringliteral}{'episode\_done'}: \textcolor{keyword}{True}\}
414             control\_msg[\textcolor{stringliteral}{'id'}] = \textcolor{stringliteral}{'SYSTEM'}
415             control\_msg[\textcolor{stringliteral}{'text'}] = self.get\_instruction(
416                 agent\_id=act[\textcolor{stringliteral}{'id'}], tag=\textcolor{stringliteral}{'timeout'}
417             )
418             \textcolor{keywordflow}{for} ag \textcolor{keywordflow}{in} self.agents:
419                 \textcolor{keywordflow}{if} ag.id != act[\textcolor{stringliteral}{'id'}]:
420                     ag.observe(\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(control\_msg))
421             self.chat\_done = \textcolor{keyword}{True}
422             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
423         \textcolor{keywordflow}{else}:
424             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
425 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a9497024a85da74e69e5b6a1568b5ff18}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a9497024a85da74e69e5b6a1568b5ff18}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!episode\+\_\+done@{episode\+\_\+done}}
\index{episode\+\_\+done@{episode\+\_\+done}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{episode\+\_\+done()}{episode\_done()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+episode\+\_\+done (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 253 of file worlds.\+py.


\begin{DoxyCode}
253     \textcolor{keyword}{def }episode\_done(self):
254         \textcolor{keywordflow}{return} self.chat\_done
255 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_accac4ee2dc51850f0af8fa43055023e7}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_accac4ee2dc51850f0af8fa43055023e7}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!get\+\_\+instruction@{get\+\_\+instruction}}
\index{get\+\_\+instruction@{get\+\_\+instruction}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{get\+\_\+instruction()}{get\_instruction()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+get\+\_\+instruction (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{agent\+\_\+id = {\ttfamily None},  }\item[{}]{tag = {\ttfamily \textquotesingle{}first\textquotesingle{}} }\end{DoxyParamCaption})}



Definition at line 256 of file worlds.\+py.


\begin{DoxyCode}
256     \textcolor{keyword}{def }get\_instruction(self, agent\_id=None, tag='first'):
257         \textcolor{keywordflow}{if} tag == \textcolor{stringliteral}{'start'}:
258             \textcolor{keywordflow}{return} (
259                 \textcolor{stringliteral}{'\(\backslash\)nSuccessfully matched. Now let\(\backslash\)'s get to know each other'}
260                 \textcolor{stringliteral}{'through the chat! \(\backslash\)nYou need to finish at least <b>'}
261                 + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(self.n\_turn)
262                 + \textcolor{stringliteral}{' chat turns</b>, after that you can click the "Done" button '}
263                 \textcolor{stringliteral}{'to end the chat. \(\backslash\)n'}
264                 \textcolor{stringliteral}{'<b>You can track your character description on the left.</b> '}
265                 \textcolor{stringliteral}{'\(\backslash\)n <span style="color:blue"><b>Please try to speak to the '}
266                 \textcolor{stringliteral}{'other person as if you are the character assigned.</b></span>'}
267                 \textcolor{stringliteral}{'\(\backslash\)n <span style="color:blue"><b>Do not trivially copy the '}
268                 \textcolor{stringliteral}{'character descriptions into the message.</b></span>'}
269             )
270 
271         \textcolor{keywordflow}{if} tag == \textcolor{stringliteral}{'chat\_not\_done'}:
272             \textcolor{keywordflow}{return} (
273                 \textcolor{stringliteral}{'Sorry, we need at least <b>'}
274                 + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(self.n\_turn + 1 - self.turn\_idx)
275                 + \textcolor{stringliteral}{' more turn(s)</b> to finish. '}
276                 \textcolor{stringliteral}{'Please send a new message:'}
277             )
278 
279         \textcolor{keywordflow}{if} tag == \textcolor{stringliteral}{'timeout'}:
280             \textcolor{keywordflow}{return} (
281                 \textcolor{stringliteral}{'<b>\{\}</b> is timeout. Please click the "Done with this HIT" '}
282                 \textcolor{stringliteral}{'button below to exit this HIT. No rejections.'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(agent\_id)
283             )
284 
285         \textcolor{keywordflow}{if} tag == \textcolor{stringliteral}{'exceed\_min\_turns'}:
286             \textcolor{keywordflow}{return} (
287                 \textcolor{stringliteral}{'\(\backslash\)n \{\} chat turns finished! \(\backslash\)n Keep chatting or you can click '}
288                 \textcolor{stringliteral}{'the "Done" button to end the chat if it\(\backslash\)'s your turn.'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
289                     self.n\_turn
290                 )
291             )
292 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a5edf0526e8aad41c00289548253d51e9}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a5edf0526e8aad41c00289548253d51e9}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!is\+\_\+exact\+\_\+match@{is\+\_\+exact\+\_\+match}}
\index{is\+\_\+exact\+\_\+match@{is\+\_\+exact\+\_\+match}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{is\+\_\+exact\+\_\+match()}{is\_exact\_match()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+is\+\_\+exact\+\_\+match (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{act,  }\item[{}]{ag,  }\item[{}]{tolerance = {\ttfamily 0} }\end{DoxyParamCaption})}



Definition at line 349 of file worlds.\+py.


\begin{DoxyCode}
349     \textcolor{keyword}{def }is\_exact\_match(self, act, ag, tolerance=0):
350         \textcolor{keywordflow}{if} act[\textcolor{stringliteral}{'episode\_done'}]:
351             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
352 
353         control\_msg = \{\textcolor{stringliteral}{'episode\_done'}: \textcolor{keyword}{False}\}
354         control\_msg[\textcolor{stringliteral}{'id'}] = \textcolor{stringliteral}{'SYSTEM'}
355 
356         text = act[\textcolor{stringliteral}{'text'}]
357         \textcolor{keywordflow}{if} text \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} [\textcolor{stringliteral}{''}, \textcolor{stringliteral}{' '}, \textcolor{stringliteral}{'  '}, \textcolor{stringliteral}{'   '}]:
358             n\_word\_match = 0
359             \textcolor{keywordflow}{for} per \textcolor{keywordflow}{in} ag.persona\_data:
360                 per\_parse = per.split(\textcolor{stringliteral}{' '})
361                 regular\_words = [\textcolor{stringliteral}{''}, \textcolor{stringliteral}{' '}, \textcolor{stringliteral}{'I'}, \textcolor{stringliteral}{'I\(\backslash\)'m'}, \textcolor{stringliteral}{'My'}, \textcolor{stringliteral}{'i'}]
362                 \textcolor{keywordflow}{for} r\_w \textcolor{keywordflow}{in} regular\_words:
363                     \textcolor{keywordflow}{if} r\_w \textcolor{keywordflow}{in} per\_parse:
364                         per\_parse.remove(r\_w)
365                 per\_subseq = [
366                     \textcolor{stringliteral}{' '}.join(per\_parse[i : i + len(per\_parse) - tolerance])
367                     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(tolerance + 1)
368                 ]
369                 \textcolor{keywordflow}{for} pp \textcolor{keywordflow}{in} per\_subseq:
370                     \textcolor{keywordflow}{if} pp \textcolor{keywordflow}{in} [\textcolor{stringliteral}{''}, \textcolor{stringliteral}{' '}, \textcolor{stringliteral}{'  '}, \textcolor{stringliteral}{'   '}]:
371                         per\_subseq.remove(pp)
372                 n\_word\_match += sum([(paa \textcolor{keywordflow}{in} text) \textcolor{keywordflow}{for} paa \textcolor{keywordflow}{in} per\_subseq])
373             \textcolor{keywordflow}{if} n\_word\_match > 0:
374                 control\_msg[\textcolor{stringliteral}{'text'}] = (
375                     \textcolor{stringliteral}{'We found that you <b><span style="color:red">trivially '}
376                     \textcolor{stringliteral}{'copied character descriptions</span></b>. Please '}
377                     \textcolor{stringliteral}{'rephrase your message again.'}
378                 )
379                 ag.observe(\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(control\_msg))
380                 \textcolor{keywordflow}{return} \textcolor{keyword}{True}
381             \textcolor{keywordflow}{else}:
382                 \textcolor{keywordflow}{return} \textcolor{keyword}{False}
383 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a7f6c59f2e1f897e1e480b43fc67680df}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a7f6c59f2e1f897e1e480b43fc67680df}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!is\+\_\+msg\+\_\+tooshortlong@{is\+\_\+msg\+\_\+tooshortlong}}
\index{is\+\_\+msg\+\_\+tooshortlong@{is\+\_\+msg\+\_\+tooshortlong}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{is\+\_\+msg\+\_\+tooshortlong()}{is\_msg\_tooshortlong()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+is\+\_\+msg\+\_\+tooshortlong (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{act,  }\item[{}]{ag,  }\item[{}]{th\+\_\+min = {\ttfamily 5},  }\item[{}]{th\+\_\+max = {\ttfamily 17} }\end{DoxyParamCaption})}



Definition at line 384 of file worlds.\+py.


\begin{DoxyCode}
384     \textcolor{keyword}{def }is\_msg\_tooshortlong(self, act, ag, th\_min=5, th\_max=17):
385         \textcolor{keywordflow}{if} act[\textcolor{stringliteral}{'episode\_done'}]:
386             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
387 
388         control\_msg = \{\textcolor{stringliteral}{'episode\_done'}: \textcolor{keyword}{False}\}
389         control\_msg[\textcolor{stringliteral}{'id'}] = \textcolor{stringliteral}{'SYSTEM'}
390 
391         msg\_len = len(act[\textcolor{stringliteral}{'text'}].split(\textcolor{stringliteral}{' '}))
392         \textcolor{keywordflow}{if} msg\_len < th\_min:
393             control\_msg[\textcolor{stringliteral}{'text'}] = (
394                 \textcolor{stringliteral}{'Your message is too short, please make it more than '}
395                 \textcolor{stringliteral}{'<b><span style="color:red">5 words</span></b>.'}
396             )
397             ag.observe(\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(control\_msg))
398             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
399         \textcolor{keywordflow}{if} msg\_len > th\_max:
400             control\_msg[\textcolor{stringliteral}{'text'}] = (
401                 \textcolor{stringliteral}{'Your message is too long, please make it less than '}
402                 \textcolor{stringliteral}{'<b><span style="color:red">15 words</span></b>.'}
403             )
404             ag.observe(\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(control\_msg))
405             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
406         \textcolor{keywordflow}{return} \textcolor{keyword}{False}
407 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_af1504dbfbf076f8e3dad5f8ac823f761}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_af1504dbfbf076f8e3dad5f8ac823f761}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!parley@{parley}}
\index{parley@{parley}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{parley()}{parley()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+parley (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 159 of file worlds.\+py.


\begin{DoxyCode}
159     \textcolor{keyword}{def }parley(self):
160         self.turn\_idx += 1
161 
162         control\_msg = \{\textcolor{stringliteral}{'episode\_done'}: \textcolor{keyword}{False}\}
163         control\_msg[\textcolor{stringliteral}{'id'}] = \textcolor{stringliteral}{'SYSTEM'}
164 
165         print(self.world\_tag + \textcolor{stringliteral}{' is at turn \{\}...'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(self.turn\_idx))
166 
167         \textcolor{stringliteral}{"""If at first turn, we need to give each agent their persona"""}
168         \textcolor{keywordflow}{if} self.turn\_idx == 1:
169             \textcolor{keywordflow}{for} idx, agent \textcolor{keywordflow}{in} enumerate(self.agents):
170                 persona\_text = \textcolor{stringliteral}{''}
171                 \textcolor{keywordflow}{for} s \textcolor{keywordflow}{in} self.personas[idx]:
172                     persona\_text += (
173                         \textcolor{stringliteral}{'<b><span style="color:blue">'}
174                         \textcolor{stringliteral}{'\{\}\(\backslash\)n</span></b>'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(s.strip())
175                     )
176                 control\_msg[\textcolor{stringliteral}{'persona\_text'}] = persona\_text
177                 control\_msg[\textcolor{stringliteral}{'text'}] = self.get\_instruction(
178                     tag=\textcolor{stringliteral}{'start'}, agent\_id=agent.id
179                 )
180                 agent.observe(\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(control\_msg))
181                 \textcolor{keywordflow}{if} idx == 0:
182                     time.sleep(3)
183 
184         \textcolor{stringliteral}{"""If we get to the min turns, inform turker that they can end if they}
185 \textcolor{stringliteral}{           want}
186 \textcolor{stringliteral}{        """}
187         \textcolor{keywordflow}{if} self.turn\_idx == self.n\_turn + 1:
188             \textcolor{keywordflow}{for} idx, agent \textcolor{keywordflow}{in} enumerate(self.agents):
189                 control\_msg[\textcolor{stringliteral}{'text'}] = self.get\_instruction(idx, tag=\textcolor{stringliteral}{'exceed\_min\_turns'})
190                 control\_msg[\textcolor{stringliteral}{'exceed\_min\_turns'}] = \textcolor{keyword}{True}
191                 agent.observe(\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(control\_msg))
192 
193         \textcolor{stringliteral}{"""Otherwise, we proceed accordingly"""}
194         acts = [\textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}]
195         \textcolor{keywordflow}{for} idx, agent \textcolor{keywordflow}{in} enumerate(self.agents):
196             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.chat\_done:
197                 acts[idx] = agent.act(timeout=self.max\_resp\_time)
198             \textcolor{keywordflow}{if} self.check\_timeout(acts[idx]):
199                 \textcolor{keywordflow}{return}
200 
201             \textcolor{keywordflow}{if} self.turn\_idx > 1:
202                 \textcolor{comment}{# only check if message is too short on first message}
203                 \textcolor{keywordflow}{while} self.is\_msg\_tooshortlong(acts[idx], agent) \textcolor{keywordflow}{or} self.is\_exact\_match(
204                     acts[idx], agent
205                 ):
206                     acts[idx] = agent.act()
207             \textcolor{keywordflow}{else}:
208                 \textcolor{keywordflow}{while} self.is\_exact\_match(acts[idx], agent):
209                     acts[idx] = agent.act()
210 
211             \textcolor{keywordflow}{if} acts[idx][\textcolor{stringliteral}{'episode\_done'}]:
212                 self.chat\_done = \textcolor{keyword}{True}
213                 \textcolor{keywordflow}{for} ag \textcolor{keywordflow}{in} self.agents:
214                     \textcolor{comment}{# if agent disconnected}
215                     \textcolor{keywordflow}{if} ag != agent \textcolor{keywordflow}{and} ag.some\_agent\_disconnected:
216                         control\_msg[\textcolor{stringliteral}{'text'}] = (
217                             \textcolor{stringliteral}{'The other worker unexpectedly diconnected. '}
218                             \textcolor{stringliteral}{'Please click "Done with this HIT" button below to '}
219                             \textcolor{stringliteral}{'finish this HIT.'}
220                         )
221                         control\_msg[\textcolor{stringliteral}{'episode\_done'}] = \textcolor{keyword}{True}
222                         ag.observe(\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(control\_msg))
223                         \textcolor{keywordflow}{return}
224                 \textcolor{comment}{# agent ends chat after exceeding minimum number of turns}
225                 \textcolor{keywordflow}{if} self.turn\_idx > self.n\_turn:
226                     \textcolor{keywordflow}{for} ag \textcolor{keywordflow}{in} self.agents:
227                         ag.observe(\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(acts[idx]))
228                         control\_msg[\textcolor{stringliteral}{'text'}] = (
229                             \textcolor{stringliteral}{'One of you ended the chat. Thanks for your time! '}
230                             \textcolor{stringliteral}{'Please click "Done with this HIT" button below '}
231                             \textcolor{stringliteral}{'to finish this HIT.'}
232                         )
233                         control\_msg[\textcolor{stringliteral}{'episode\_done'}] = \textcolor{keyword}{True}
234                         ag.observe(\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(control\_msg))
235                 \textcolor{keywordflow}{return}
236 
237             \textcolor{keywordflow}{else}:
238                 self.dialog.append((idx, acts[idx][\textcolor{stringliteral}{'text'}]))
239                 \textcolor{keywordflow}{for} other\_agent \textcolor{keywordflow}{in} self.agents:
240                     \textcolor{keywordflow}{if} other\_agent != agent:
241                         other\_agent.observe(\hyperlink{namespaceparlai_1_1core_1_1worlds_afc3fad603b7bce41dbdc9cdc04a9c794}{validate}(acts[idx]))
242 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a3882e622e065f27421c5b2105558471a}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a3882e622e065f27421c5b2105558471a}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!reset\+\_\+random@{reset\+\_\+random}}
\index{reset\+\_\+random@{reset\+\_\+random}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{reset\+\_\+random()}{reset\_random()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+reset\+\_\+random (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 408 of file worlds.\+py.


\begin{DoxyCode}
408     \textcolor{keyword}{def }reset\_random(self):
409         self.n\_turn = np.random.randint(self.range\_turn[0], self.range\_turn[1]) + 1
410 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a17e4312c4028bb75b1b1bc7f83557509}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a17e4312c4028bb75b1b1bc7f83557509}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!review\+\_\+work@{review\+\_\+work}}
\index{review\+\_\+work@{review\+\_\+work}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{review\+\_\+work()}{review\_work()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+review\+\_\+work (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 426 of file worlds.\+py.


\begin{DoxyCode}
426     \textcolor{keyword}{def }review\_work(self):
427         \textcolor{keyword}{global} review\_agent
428 
429         \textcolor{keyword}{def }review\_agent(ag):
430             \textcolor{keywordflow}{if} hasattr(ag, \textcolor{stringliteral}{'not\_approve'}):
431                 \textcolor{keywordflow}{pass}
432             \textcolor{keywordflow}{else}:
433                 ag.approve\_work()
434 
435         Parallel(n\_jobs=len(self.agents), backend=\textcolor{stringliteral}{'threading'})(
436             delayed(review\_agent)(agent) \textcolor{keywordflow}{for} agent \textcolor{keywordflow}{in} self.agents
437         )
438 \end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad0266a390c3789b1351a19b8bcad2696}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad0266a390c3789b1351a19b8bcad2696}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!save\+\_\+data@{save\+\_\+data}}
\index{save\+\_\+data@{save\+\_\+data}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{save\+\_\+data()}{save\_data()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+save\+\_\+data (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 293 of file worlds.\+py.


\begin{DoxyCode}
293     \textcolor{keyword}{def }save\_data(self):
294         \textcolor{comment}{# save persona\_idx\_stack}
295         convo\_finished = \textcolor{keyword}{True}
296         bad\_workers = []
297         \textcolor{keywordflow}{for} ag \textcolor{keywordflow}{in} self.agents:
298             \textcolor{keywordflow}{if} (
299                 ag.hit\_is\_abandoned
300                 \textcolor{keywordflow}{or} ag.hit\_is\_returned
301                 \textcolor{keywordflow}{or} ag.disconnected
302                 \textcolor{keywordflow}{or} ag.hit\_is\_expired
303             ):
304                 bad\_workers.append(ag.worker\_id)
305                 convo\_finished = \textcolor{keyword}{False}
306         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} convo\_finished \textcolor{keywordflow}{or} self.dialog == []:
307             \textcolor{keywordflow}{for} ag \textcolor{keywordflow}{in} self.agents:
308                 ag.not\_approve = \textcolor{keyword}{True}
309                 ag.persona\_generator.push\_persona(ag.persona\_idx)
310                 print(
311                     \textcolor{stringliteral}{"\(\backslash\)n******* Push persona \{\} back to stack. *******\(\backslash\)n"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
312                         ag.persona\_idx
313                     )
314                 )
315 
316         data\_path = self.opt[\textcolor{stringliteral}{'extract\_personas\_path'}]
317         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(data\_path):
318             os.makedirs(data\_path)
319         \textcolor{keywordflow}{if} convo\_finished:
320             filename = os.path.join(
321                 data\_path,
322                 \textcolor{stringliteral}{'\{\}\_\{\}\_\{\}.pkl'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
323                     time.strftime(\textcolor{stringliteral}{"%Y%m%d-%H%M%S"}),
324                     np.random.randint(0, 1000),
325                     self.task\_type,
326                 ),
327             )
328         \textcolor{keywordflow}{else}:
329             filename = os.path.join(
330                 data\_path,
331                 \textcolor{stringliteral}{'\{\}\_\{\}\_\{\}\_incomplete.pkl'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
332                     time.strftime(\textcolor{stringliteral}{"%Y%m%d-%H%M%S"}),
333                     np.random.randint(0, 1000),
334                     self.task\_type,
335                 ),
336             )
337         print(self.world\_tag + \textcolor{stringliteral}{': Data successfully saved at \{\}.'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(filename))
338         pickle.dump(
339             \{
340                 \textcolor{stringliteral}{'personas'}: self.personas,
341                 \textcolor{stringliteral}{'dialog'}: self.dialog,
342                 \textcolor{stringliteral}{'workers'}: [ag.worker\_id \textcolor{keywordflow}{for} ag \textcolor{keywordflow}{in} self.agents],
343                 \textcolor{stringliteral}{'bad\_workers'}: bad\_workers,
344                 \textcolor{stringliteral}{'n\_turn'}: self.n\_turn,
345             \},
346             open(filename, \textcolor{stringliteral}{'wb'}),
347         )
348 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a86d1d4e599a470ec7f031c60b2fb0e61}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a86d1d4e599a470ec7f031c60b2fb0e61}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!shutdown@{shutdown}}
\index{shutdown@{shutdown}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{shutdown()}{shutdown()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+shutdown (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 243 of file worlds.\+py.


\begin{DoxyCode}
243     \textcolor{keyword}{def }shutdown(self):
244         \textcolor{keyword}{global} shutdown\_agent
245 
246         \textcolor{keyword}{def }shutdown\_agent(mturk\_agent):
247             mturk\_agent.shutdown()
248 
249         Parallel(n\_jobs=len(self.agents), backend=\textcolor{stringliteral}{'threading'})(
250             delayed(shutdown\_agent)(agent) \textcolor{keywordflow}{for} agent \textcolor{keywordflow}{in} self.agents
251         )
252 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad93464fe08cb5ec2007ef03f6d65e0f4}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad93464fe08cb5ec2007ef03f6d65e0f4}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!agent\+\_\+timeout\+\_\+shutdown@{agent\+\_\+timeout\+\_\+shutdown}}
\index{agent\+\_\+timeout\+\_\+shutdown@{agent\+\_\+timeout\+\_\+shutdown}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{agent\+\_\+timeout\+\_\+shutdown}{agent\_timeout\_shutdown}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+agent\+\_\+timeout\+\_\+shutdown}



Definition at line 150 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a9b7cb2eee599053a23d83201036d57a1}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a9b7cb2eee599053a23d83201036d57a1}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!agents@{agents}}
\index{agents@{agents}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{agents}{agents}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+agents}



Definition at line 138 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a1cc3d9e7a13bd3c7dd8987681d628f54}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a1cc3d9e7a13bd3c7dd8987681d628f54}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!chat\+\_\+done@{chat\+\_\+done}}
\index{chat\+\_\+done@{chat\+\_\+done}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{chat\+\_\+done}{chat\_done}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+chat\+\_\+done}



Definition at line 145 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a8371a48d12812df08bfd082ece010595}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a8371a48d12812df08bfd082ece010595}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!dialog@{dialog}}
\index{dialog@{dialog}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{dialog}{dialog}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+dialog}



Definition at line 143 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_aca25d3660a3dac91fa40ec7a18b214f5}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_aca25d3660a3dac91fa40ec7a18b214f5}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!max\+\_\+resp\+\_\+time@{max\+\_\+resp\+\_\+time}}
\index{max\+\_\+resp\+\_\+time@{max\+\_\+resp\+\_\+time}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{max\+\_\+resp\+\_\+time}{max\_resp\_time}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+max\+\_\+resp\+\_\+time}



Definition at line 149 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a6f496f8f3c030b9e273f1d583a41f240}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a6f496f8f3c030b9e273f1d583a41f240}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!max\+\_\+turn@{max\+\_\+turn}}
\index{max\+\_\+turn@{max\+\_\+turn}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{max\+\_\+turn}{max\_turn}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+max\+\_\+turn}



Definition at line 141 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a5d7ec7e979796d96f4ba08a5e060e74d}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a5d7ec7e979796d96f4ba08a5e060e74d}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!n\+\_\+turn@{n\+\_\+turn}}
\index{n\+\_\+turn@{n\+\_\+turn}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{n\+\_\+turn}{n\_turn}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+n\+\_\+turn}



Definition at line 142 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a956a563f5690d02a40ad90028b773c24}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a956a563f5690d02a40ad90028b773c24}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!personas@{personas}}
\index{personas@{personas}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{personas}{personas}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+personas}



Definition at line 154 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad08f076173e395eea81ba3de824e166c}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_ad08f076173e395eea81ba3de824e166c}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!range\+\_\+turn@{range\+\_\+turn}}
\index{range\+\_\+turn@{range\+\_\+turn}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{range\+\_\+turn}{range\_turn}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+range\+\_\+turn}



Definition at line 140 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a023ac4d00b220768cef0157b1e859d37}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a023ac4d00b220768cef0157b1e859d37}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!task\+\_\+type@{task\+\_\+type}}
\index{task\+\_\+type@{task\+\_\+type}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{task\+\_\+type}{task\_type}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+task\+\_\+type}



Definition at line 144 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a51467e3bd1a647ebccb408b416c14392}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a51467e3bd1a647ebccb408b416c14392}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!turn\+\_\+idx@{turn\+\_\+idx}}
\index{turn\+\_\+idx@{turn\+\_\+idx}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{turn\+\_\+idx}{turn\_idx}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+turn\+\_\+idx}



Definition at line 139 of file worlds.\+py.

\mbox{\Hypertarget{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a254ecf0c1c1d37f2f2027f4206abc321}\label{classparlai_1_1mturk_1_1tasks_1_1personachat_1_1personachat__chat_1_1worlds_1_1PersonaChatWorld_a254ecf0c1c1d37f2f2027f4206abc321}} 
\index{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}!world\+\_\+tag@{world\+\_\+tag}}
\index{world\+\_\+tag@{world\+\_\+tag}!parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World@{parlai\+::mturk\+::tasks\+::personachat\+::personachat\+\_\+chat\+::worlds\+::\+Persona\+Chat\+World}}
\subsubsection{\texorpdfstring{world\+\_\+tag}{world\_tag}}
{\footnotesize\ttfamily parlai.\+mturk.\+tasks.\+personachat.\+personachat\+\_\+chat.\+worlds.\+Persona\+Chat\+World.\+world\+\_\+tag}



Definition at line 146 of file worlds.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/mturk/tasks/personachat/personachat\+\_\+chat/\hyperlink{parlai_2mturk_2tasks_2personachat_2personachat__chat_2worlds_8py}{worlds.\+py}\end{DoxyCompactItemize}
