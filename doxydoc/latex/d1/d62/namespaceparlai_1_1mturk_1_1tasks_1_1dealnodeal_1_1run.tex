\hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1dealnodeal_1_1run}{}\section{parlai.\+mturk.\+tasks.\+dealnodeal.\+run Namespace Reference}
\label{namespaceparlai_1_1mturk_1_1tasks_1_1dealnodeal_1_1run}\index{parlai.\+mturk.\+tasks.\+dealnodeal.\+run@{parlai.\+mturk.\+tasks.\+dealnodeal.\+run}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1dealnodeal_1_1run_aafb6d1c8bf3b37bc874ee8d8dcbecce8}{main} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1mturk_1_1tasks_1_1dealnodeal_1_1run_aafb6d1c8bf3b37bc874ee8d8dcbecce8}\label{namespaceparlai_1_1mturk_1_1tasks_1_1dealnodeal_1_1run_aafb6d1c8bf3b37bc874ee8d8dcbecce8}} 
\index{parlai\+::mturk\+::tasks\+::dealnodeal\+::run@{parlai\+::mturk\+::tasks\+::dealnodeal\+::run}!main@{main}}
\index{main@{main}!parlai\+::mturk\+::tasks\+::dealnodeal\+::run@{parlai\+::mturk\+::tasks\+::dealnodeal\+::run}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def parlai.\+mturk.\+tasks.\+dealnodeal.\+run.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}This task consists of one agent, model or MTurk worker, talking to an MTurk worker
to negotiate a deal.
\end{DoxyVerb}
 

Definition at line 14 of file run.\+py.


\begin{DoxyCode}
14 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run_ad3ab2c71f8083c3112815c0b363d316b}{main}():
15     \textcolor{stringliteral}{"""}
16 \textcolor{stringliteral}{    This task consists of one agent, model or MTurk worker, talking to an MTurk worker}
17 \textcolor{stringliteral}{    to negotiate a deal.}
18 \textcolor{stringliteral}{    """}
19     argparser = ParlaiParser(\textcolor{keyword}{False}, \textcolor{keyword}{False})
20     argparser.add\_parlai\_data\_path()
21     argparser.add\_mturk\_args()
22     argparser.add\_argument(
23         \textcolor{stringliteral}{'--two\_mturk\_agents'},
24         dest=\textcolor{stringliteral}{'two\_mturk\_agents'},
25         action=\textcolor{stringliteral}{'store\_true'},
26         help=\textcolor{stringliteral}{'data collection mode '} \textcolor{stringliteral}{'with converations between two MTurk agents'},
27     )
28 
29     opt = argparser.parse\_args()
30     opt[\textcolor{stringliteral}{'task'}] = \textcolor{stringliteral}{'dealnodeal'}
31     opt[\textcolor{stringliteral}{'datatype'}] = \textcolor{stringliteral}{'valid'}
32     opt.update(task\_config)
33 
34     local\_agent\_1\_id = \textcolor{stringliteral}{'local\_1'}
35     mturk\_agent\_ids = [\textcolor{stringliteral}{'mturk\_agent\_1'}]
36     \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'two\_mturk\_agents'}]:
37         mturk\_agent\_ids.append(\textcolor{stringliteral}{'mturk\_agent\_2'})
38 
39     mturk\_manager = MTurkManager(opt=opt, mturk\_agent\_ids=mturk\_agent\_ids)
40 
41     mturk\_manager.setup\_server()
42 
43     \textcolor{keywordflow}{try}:
44         mturk\_manager.start\_new\_run()
45         mturk\_manager.create\_hits()
46 
47         mturk\_manager.set\_onboard\_function(onboard\_function=\textcolor{keywordtype}{None})
48         mturk\_manager.ready\_to\_accept\_workers()
49 
50         \textcolor{keyword}{def }check\_worker\_eligibility(worker):
51             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
52 
53         \textcolor{keyword}{def }assign\_worker\_roles(workers):
54             \textcolor{keywordflow}{for} index, worker \textcolor{keywordflow}{in} enumerate(workers):
55                 worker.id = mturk\_agent\_ids[index % len(mturk\_agent\_ids)]
56 
57         \textcolor{keyword}{def }run\_conversation(mturk\_manager, opt, workers):
58             agents = workers[:]
59 
60             \textcolor{comment}{# Create a local agent}
61             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} opt[\textcolor{stringliteral}{'two\_mturk\_agents'}]:
62                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'model'} \textcolor{keywordflow}{in} opt:
63                     local\_agent = \hyperlink{namespaceparlai_1_1core_1_1agents_ad0d54074d4bcc148bb415ab5515a53b5}{create\_agent}(opt)
64                 \textcolor{keywordflow}{else}:
65                     local\_agent = LocalHumanAgent(opt=\textcolor{keywordtype}{None})
66 
67                 local\_agent.id = local\_agent\_1\_id
68                 agents.append(local\_agent)
69 
70             opt[\textcolor{stringliteral}{"batchindex"}] = mturk\_manager.started\_conversations
71 
72             world = MTurkDealNoDealDialogWorld(opt=opt, agents=agents)
73 
74             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world.episode\_done():
75                 world.parley()
76 
77             world.shutdown()
78 
79         mturk\_manager.start\_task(
80             eligibility\_function=check\_worker\_eligibility,
81             assign\_role\_function=assign\_worker\_roles,
82             task\_function=run\_conversation,
83         )
84 
85     \textcolor{keywordflow}{except} BaseException:
86         \textcolor{keywordflow}{raise}
87     \textcolor{keywordflow}{finally}:
88         mturk\_manager.expire\_all\_unassigned\_hits()
89         mturk\_manager.shutdown()
90 
91 
\end{DoxyCode}
