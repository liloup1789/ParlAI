\hypertarget{namespaceparlai_1_1scripts_1_1distributed__train}{}\section{parlai.\+scripts.\+distributed\+\_\+train Namespace Reference}
\label{namespaceparlai_1_1scripts_1_1distributed__train}\index{parlai.\+scripts.\+distributed\+\_\+train@{parlai.\+scripts.\+distributed\+\_\+train}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceparlai_1_1scripts_1_1distributed__train_a8fb5ab65a3210ae3a91ec244aeaf49f7}{main} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceparlai_1_1scripts_1_1distributed__train_a8fb5ab65a3210ae3a91ec244aeaf49f7}\label{namespaceparlai_1_1scripts_1_1distributed__train_a8fb5ab65a3210ae3a91ec244aeaf49f7}} 
\index{parlai\+::scripts\+::distributed\+\_\+train@{parlai\+::scripts\+::distributed\+\_\+train}!main@{main}}
\index{main@{main}!parlai\+::scripts\+::distributed\+\_\+train@{parlai\+::scripts\+::distributed\+\_\+train}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def parlai.\+scripts.\+distributed\+\_\+train.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 42 of file distributed\+\_\+train.\+py.


\begin{DoxyCode}
42 \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1scripts_1_1distributed__train_a8fb5ab65a3210ae3a91ec244aeaf49f7}{main}():
43     \textcolor{comment}{# double check we're using SLURM}
44     node\_list = os.environ.get(\textcolor{stringliteral}{'SLURM\_JOB\_NODELIST'})
45     \textcolor{keywordflow}{if} node\_list \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
46         \textcolor{keywordflow}{raise} RuntimeError(
47             \textcolor{stringliteral}{'Does not appear to be in a SLURM environment. '}
48             \textcolor{stringliteral}{'You should not call this script directly; see launch\_distributed.py'}
49         )
50 
51     parser = single\_train.setup\_args()
52     parser.add\_distributed\_training\_args()
53     parser.add\_argument(\textcolor{stringliteral}{'--port'}, type=int, default=61337, help=\textcolor{stringliteral}{'TCP port number'})
54     opt = parser.parse\_args(print\_args=(os.environ[\textcolor{stringliteral}{'SLURM\_PROCID'}] == \textcolor{stringliteral}{'0'}))
55 
56     \textcolor{comment}{# We can determine the init method automatically for Slurm.}
57     \textcolor{keywordflow}{try}:
58         \textcolor{comment}{# Figure out the main host, and which rank we are.}
59         hostnames = subprocess.check\_output(
60             [\textcolor{stringliteral}{'scontrol'}, \textcolor{stringliteral}{'show'}, \textcolor{stringliteral}{'hostnames'}, node\_list]
61         )
62         main\_host = hostnames.split()[0].decode(\textcolor{stringliteral}{'utf-8'})
63         distributed\_rank = \hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(os.environ[\textcolor{stringliteral}{'SLURM\_PROCID'}])
64         device\_id = \hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(os.environ[\textcolor{stringliteral}{'SLURM\_LOCALID'}])
65         port = opt[\textcolor{stringliteral}{'port'}]
66         print(
67             \textcolor{stringliteral}{'Initializing host \{\} as rank \{\}, main is \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
68                 socket.gethostname(), distributed\_rank, main\_host
69             )
70         )
71         \textcolor{comment}{# Begin distributed training}
72         \hyperlink{namespaceparlai_1_1scripts_1_1multiprocessing__train_aa979267c9eb44bbdfcd25a6d69a58cc4}{multiprocess\_train}(distributed\_rank, opt, port, 0, device\_id, main\_host)
73     \textcolor{keywordflow}{except} subprocess.CalledProcessError \textcolor{keyword}{as} e:
74         \textcolor{comment}{# scontrol failed}
75         \textcolor{keywordflow}{raise} e
76     \textcolor{keywordflow}{except} FileNotFoundError:
77         \textcolor{comment}{# Slurm is not installed}
78         \textcolor{keywordflow}{raise} RuntimeError(\textcolor{stringliteral}{'SLURM does not appear to be installed.'})
79 
80 
\end{DoxyCode}
