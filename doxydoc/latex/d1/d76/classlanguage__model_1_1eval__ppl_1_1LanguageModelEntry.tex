\hypertarget{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry}{}\section{language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry Class Reference}
\label{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry}\index{language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry@{language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry}}


Inheritance diagram for language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=247pt]{d4/d27/classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=247pt]{d6/d57/classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a295c7e2f6cb59aca07f985d82e4f34c5}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1agents_1_1language__model_1_1language__model_1_1LanguageModelAgent_af8d8114af65bf817afe01545033d51e6}{opt}, shared=None)
\item 
def \hyperlink{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a3a4b8adc4c891d9de5626b7c15e088a8}{share} (self)
\item 
def \hyperlink{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a16e77aba535b4451ea5071723e271336}{next\+\_\+word\+\_\+probability} (self, partial\+\_\+out)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a56bd1620561edf44373182bf5324d1bd}{probs}
\item 
\hyperlink{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_af1143417ff0e3910c4fabc386e17ff94}{last\+\_\+text}
\item 
\hyperlink{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a57e88deff0cee954bca24b4ff34c7729}{reset\+\_\+next}
\item 
\hyperlink{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a7c97d0414fa78165b9d85cc4399ac87d}{hidden}
\item 
\hyperlink{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a3beb0703ab3b39e2c38956978435fd17}{seen}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 15 of file eval\+\_\+ppl.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a295c7e2f6cb59aca07f985d82e4f34c5}\label{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a295c7e2f6cb59aca07f985d82e4f34c5}} 
\index{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 16 of file eval\+\_\+ppl.\+py.


\begin{DoxyCode}
16     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
17         super().\_\_init\_\_(opt, shared)
18         \textcolor{keywordflow}{if} shared:
19             self.probs = shared[\textcolor{stringliteral}{'probs'}]
20         \textcolor{keywordflow}{else}:
21             \textcolor{comment}{# default minimum probability mass for all tokens}
22             self.probs = \{k: 1e-7 \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} \hyperlink{namespacebuild__dict}{build\_dict}().keys()\}
23 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a16e77aba535b4451ea5071723e271336}\label{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a16e77aba535b4451ea5071723e271336}} 
\index{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}!next\+\_\+word\+\_\+probability@{next\+\_\+word\+\_\+probability}}
\index{next\+\_\+word\+\_\+probability@{next\+\_\+word\+\_\+probability}!language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}}
\subsubsection{\texorpdfstring{next\+\_\+word\+\_\+probability()}{next\_word\_probability()}}
{\footnotesize\ttfamily def language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry.\+next\+\_\+word\+\_\+probability (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{partial\+\_\+out }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return probability distribution over next words given an partial
true output. This is used to calculate the per-word perplexity.
Arguments:
partial_out -- previous "true" words
Returns a dict, where each key is a word and each value is a probability
score for that word. Unset keys assume a probability of zero.
e.g.
{'text': 'Run test program.'}, ['hello'] => {'world': 1.0}
\end{DoxyVerb}
 

Definition at line 29 of file eval\+\_\+ppl.\+py.


\begin{DoxyCode}
29     \textcolor{keyword}{def }next\_word\_probability(self, partial\_out):
30         \textcolor{stringliteral}{"""Return probability distribution over next words given an partial}
31 \textcolor{stringliteral}{        true output. This is used to calculate the per-word perplexity.}
32 \textcolor{stringliteral}{        Arguments:}
33 \textcolor{stringliteral}{        partial\_out -- previous "true" words}
34 \textcolor{stringliteral}{        Returns a dict, where each key is a word and each value is a probability}
35 \textcolor{stringliteral}{        score for that word. Unset keys assume a probability of zero.}
36 \textcolor{stringliteral}{        e.g.}
37 \textcolor{stringliteral}{        \{'text': 'Run test program.'\}, ['hello'] => \{'world': 1.0\}}
38 \textcolor{stringliteral}{        """}
39         obs = self.observation
40         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} hasattr(self, \textcolor{stringliteral}{'last\_text'}):
41             self.last\_text = \textcolor{keywordtype}{None}
42             self.reset\_next = \textcolor{keyword}{False}
43         \textcolor{keywordflow}{if} obs[\textcolor{stringliteral}{'text'}] != self.last\_text:
44             \textcolor{keywordflow}{if} self.reset\_next:
45                 \textcolor{comment}{# reset hidden state for new episodes}
46                 self.hidden = self.model.init\_hidden(1)
47                 self.reset\_next = \textcolor{keyword}{False}
48             self.seen = \textcolor{keyword}{False}
49             self.last\_text = obs.get(\textcolor{stringliteral}{'text'})
50 
51         self.model.eval()
52 
53         \textcolor{keywordflow}{if} obs[\textcolor{stringliteral}{'episode\_done'}] \textcolor{keywordflow}{is} \textcolor{keyword}{True}:
54             self.reset\_next = \textcolor{keyword}{True}
55         \textcolor{keywordflow}{else}:
56             self.reset\_next = \textcolor{keyword}{False}
57 
58         \textcolor{keywordflow}{if} len(partial\_out) == 0:
59             \textcolor{comment}{# first observe 'PERSON2' token}
60             obs[\textcolor{stringliteral}{'eval\_labels'}] = (\textcolor{stringliteral}{'PERSON2'},)
61         \textcolor{keywordflow}{else}:
62             \textcolor{comment}{# feed in words one at a time}
63             obs[\textcolor{stringliteral}{'eval\_labels'}] = (partial\_out[-1],)
64 
65         data\_list, targets\_list, labels, valid\_inds, y\_lens = self.vectorize(
66             [obs], self.opt[\textcolor{stringliteral}{'seq\_len'}], \textcolor{keyword}{False}
67         )
68         data = data\_list[0]
69         targets = targets\_list[0]
70 
71         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.seen:
72             output, hidden = self.model(data.transpose(0, 1), self.hidden)
73             self.hidden = self.repackage\_hidden(hidden)
74             \textcolor{comment}{# feed in end tokens}
75             output, hidden = self.model(Variable(self.ends[:1].view(1, 1)), self.hidden)
76             \textcolor{comment}{# feed in person2 tokens}
77             output, hidden = self.model(
78                 targets.select(1, 0).view(1, 1), self.hidden, no\_pack=\textcolor{keyword}{True}
79             )
80             self.hidden = self.repackage\_hidden(hidden)
81             output\_flat = output.view(-1, len(self.dict))
82             self.seen = \textcolor{keyword}{True}
83         \textcolor{keywordflow}{else}:
84             output, hidden = self.model(
85                 targets.select(1, 0).view(1, 1), self.hidden, no\_pack=\textcolor{keyword}{True}
86             )
87             self.hidden = self.repackage\_hidden(hidden)
88             output\_flat = output.view(-1, len(self.dict))
89 
90         \textcolor{comment}{# get probabilites for all words}
91         probs = F.softmax(output\_flat, dim=1).squeeze().cpu()
92         probs = probs.tolist()
93         dist = self.probs
94         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(probs)):
95             dist[self.dict[i]] = probs[i]
96 
97         \textcolor{keywordflow}{return} dist
98 
99 
\end{DoxyCode}
\mbox{\Hypertarget{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a3a4b8adc4c891d9de5626b7c15e088a8}\label{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a3a4b8adc4c891d9de5626b7c15e088a8}} 
\index{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}!share@{share}}
\index{share@{share}!language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}}
\subsubsection{\texorpdfstring{share()}{share()}}
{\footnotesize\ttfamily def language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry.\+share (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 24 of file eval\+\_\+ppl.\+py.


\begin{DoxyCode}
24     \textcolor{keyword}{def }share(self):
25         shared = super().share()
26         shared[\textcolor{stringliteral}{'probs'}] = self.probs.copy()
27         \textcolor{keywordflow}{return} shared
28 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a7c97d0414fa78165b9d85cc4399ac87d}\label{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a7c97d0414fa78165b9d85cc4399ac87d}} 
\index{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}!hidden@{hidden}}
\index{hidden@{hidden}!language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}}
\subsubsection{\texorpdfstring{hidden}{hidden}}
{\footnotesize\ttfamily language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry.\+hidden}



Definition at line 46 of file eval\+\_\+ppl.\+py.

\mbox{\Hypertarget{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_af1143417ff0e3910c4fabc386e17ff94}\label{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_af1143417ff0e3910c4fabc386e17ff94}} 
\index{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}!last\+\_\+text@{last\+\_\+text}}
\index{last\+\_\+text@{last\+\_\+text}!language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}}
\subsubsection{\texorpdfstring{last\+\_\+text}{last\_text}}
{\footnotesize\ttfamily language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry.\+last\+\_\+text}



Definition at line 41 of file eval\+\_\+ppl.\+py.

\mbox{\Hypertarget{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a56bd1620561edf44373182bf5324d1bd}\label{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a56bd1620561edf44373182bf5324d1bd}} 
\index{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}!probs@{probs}}
\index{probs@{probs}!language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}}
\subsubsection{\texorpdfstring{probs}{probs}}
{\footnotesize\ttfamily language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry.\+probs}



Definition at line 19 of file eval\+\_\+ppl.\+py.

\mbox{\Hypertarget{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a57e88deff0cee954bca24b4ff34c7729}\label{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a57e88deff0cee954bca24b4ff34c7729}} 
\index{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}!reset\+\_\+next@{reset\+\_\+next}}
\index{reset\+\_\+next@{reset\+\_\+next}!language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}}
\subsubsection{\texorpdfstring{reset\+\_\+next}{reset\_next}}
{\footnotesize\ttfamily language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry.\+reset\+\_\+next}



Definition at line 42 of file eval\+\_\+ppl.\+py.

\mbox{\Hypertarget{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a3beb0703ab3b39e2c38956978435fd17}\label{classlanguage__model_1_1eval__ppl_1_1LanguageModelEntry_a3beb0703ab3b39e2c38956978435fd17}} 
\index{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}!seen@{seen}}
\index{seen@{seen}!language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry@{language\+\_\+model\+::eval\+\_\+ppl\+::\+Language\+Model\+Entry}}
\subsubsection{\texorpdfstring{seen}{seen}}
{\footnotesize\ttfamily language\+\_\+model.\+eval\+\_\+ppl.\+Language\+Model\+Entry.\+seen}



Definition at line 48 of file eval\+\_\+ppl.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
projects/convai2/baselines/language\+\_\+model/\hyperlink{projects_2convai2_2baselines_2language__model_2eval__ppl_8py}{eval\+\_\+ppl.\+py}\end{DoxyCompactItemize}
