\hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent}{}\section{parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent Class Reference}
\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent}\index{parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent@{parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent}}


Inheritance diagram for parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/df3/classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=318pt]{dd/d66/classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a8b16043428bbb29ee4a3ed28c2bbb472}{add\+\_\+cmdline\+\_\+args} (cls, argparser)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_acde404a79bf3678bb52d3e6c3ee5244a}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1core_1_1torch__agent_1_1TorchAgent_a785bb920cf8c8afc3e9bf6a8b77e335a}{opt}, shared=None)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a16d004a75c5fee42cd13db4abe157b98}{build\+\_\+criterion} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9b90f2718c85b6373ead4cd207cfd3d8}{set\+\_\+interactive\+\_\+mode} (self, mode, shared=False)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a936cebe646816609dd1d4f56b9490d45}{get\+\_\+task\+\_\+candidates\+\_\+path} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a65d5726a4e2098212298bc2cdf13e70f}{score\+\_\+candidates} (self, batch, cand\+\_\+vecs, cand\+\_\+encs=None)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a3a80c3eb68b019859da2a83706c3844d}{is\+\_\+valid} (self, obs)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a05ddf921f386f21116ec0ef50796987a}{train\+\_\+step} (self, batch)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a65bca7841123e4c3df1e09f8c4eb397f}{eval\+\_\+step} (self, batch)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a628050d71339298baafbaf678f94207d}{block\+\_\+repeats} (self, cand\+\_\+preds)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9ba5899b6497645bb6d406ecc2441da7}{share} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ab526b2171567fd980451a795bb639cda}{reset\+\_\+metrics} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a6314748dfa9aaf6e26145af686d5787d}{report} (self)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a41c604613a97e566bfcc31667d0dfc6a}{set\+\_\+vocab\+\_\+candidates} (self, shared)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9039757596f98b45b6676b16589883a3}{set\+\_\+fixed\+\_\+candidates} (self, shared)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a353991d201d8889c453bf72c15ec78a9}{load\+\_\+candidates} (self, path, cand\+\_\+type=\textquotesingle{}vectors\textquotesingle{})
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a1c8e4925f558783a51a28ccb577c42c7}{encode\+\_\+candidates} (self, padded\+\_\+cands)
\item 
def \hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_af2e2d618f056bb68089c7252fa07d07b}{vectorize\+\_\+fixed\+\_\+candidates} (self, cands\+\_\+batch, add\+\_\+start=False, add\+\_\+end=False)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a687a40a7925676c15b42a6cee06f5d72}{criterion}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a675eab99eca0761267b0d55910487233}{model}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a1205be489b10e7870d865844c05d7fec}{rank\+\_\+top\+\_\+k}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ac28b6cc47b43ed9b4f0c6786828d2649}{optimizer}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_af54615af2f53a06df8fb046492f1ec38}{candidates}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9a166529b77c8b77ca4c419534a95379}{encode\+\_\+candidate\+\_\+vecs}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_aaa94e12e115e0fc09ba34dd9d4839fba}{eval\+\_\+candidates}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ae239c259e74080fe0fe9a501b8e0fc12}{ignore\+\_\+bad\+\_\+candidates}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_abde0ae40e8dc959f9bad3039b3a267e4}{fixed\+\_\+candidates\+\_\+path}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a7a6bfdf4db906b9f4ed7e75e51d580f9}{fixed\+\_\+candidate\+\_\+encs}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a627d68f27f1e2683935674b632c7c3e1}{vocab\+\_\+candidates}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a7ea32d15ace58e3cf91712fdc6056bbc}{vocab\+\_\+candidate\+\_\+vecs}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_afefae7f9bc31b66c2e488528d4277e58}{vocab\+\_\+candidate\+\_\+encs}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a6ae8c88595193b7a921843c1ad3b25f8}{fixed\+\_\+candidates}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ae74ff1d80d1954b1ec44fe89b46b9f32}{fixed\+\_\+candidate\+\_\+vecs}
\item 
\hyperlink{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_af72d685e19afda09adc7f52a6346ab34}{num\+\_\+fixed\+\_\+candidates}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
\begin{DoxyVerb}Abstract TorchRankerAgent class; only meant to be extended.

TorchRankerAgents aim to provide convenient functionality for building ranking
models. This includes:

- Training/evaluating on candidates from a variety of sources.
- Computing hits@1, hits@5, mean reciprical rank (MRR), and other metrics.
- Caching representations for fast runtime when deploying models to production.
\end{DoxyVerb}
 

Definition at line 26 of file torch\+\_\+ranker\+\_\+agent.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_acde404a79bf3678bb52d3e6c3ee5244a}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_acde404a79bf3678bb52d3e6c3ee5244a}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 151 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
151     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
152         \textcolor{comment}{# Must call \_get\_init\_model() first so that paths are updated if necessary}
153         \textcolor{comment}{# (e.g., a .dict file)}
154         init\_model, is\_finetune = self.\_get\_init\_model(opt, shared)
155         opt[\textcolor{stringliteral}{'rank\_candidates'}] = \textcolor{keyword}{True}
156         super().\_\_init\_\_(opt, shared)
157 
158         \textcolor{keywordflow}{if} shared:
159             states = \textcolor{keywordtype}{None}
160         \textcolor{keywordflow}{else}:
161             \textcolor{comment}{# Note: we cannot change the type of metrics ahead of time, so you}
162             \textcolor{comment}{# should correctly initialize to floats or ints here}
163             self.metrics[\textcolor{stringliteral}{'loss'}] = 0.0
164             self.metrics[\textcolor{stringliteral}{'examples'}] = 0
165             self.metrics[\textcolor{stringliteral}{'rank'}] = 0.0
166             self.metrics[\textcolor{stringliteral}{'mrr'}] = 0.0
167             self.metrics[\textcolor{stringliteral}{'train\_accuracy'}] = 0.0
168 
169             self.criterion = self.build\_criterion()
170             self.model = self.build\_model()
171             \textcolor{keywordflow}{if} self.model \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} self.criterion \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
172                 \textcolor{keywordflow}{raise} AttributeError(
173                     \textcolor{stringliteral}{'build\_model() and build\_criterion() need to return the model or criterion'}
174                 )
175             \textcolor{keywordflow}{if} self.use\_cuda:
176                 self.model.cuda()
177                 self.criterion.cuda()
178 
179             print(\textcolor{stringliteral}{"Total parameters: \{\}"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(self.\_total\_parameters()))
180             print(\textcolor{stringliteral}{"Trainable parameters:  \{\}"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(self.\_trainable\_parameters()))
181 
182             \textcolor{keywordflow}{if} self.fp16:
183                 self.model = self.model.half()
184             \textcolor{keywordflow}{if} init\_model:
185                 print(\textcolor{stringliteral}{'Loading existing model parameters from '} + init\_model)
186                 states = self.load(init\_model)
187             \textcolor{keywordflow}{else}:
188                 states = \{\}
189 
190         self.rank\_top\_k = opt.get(\textcolor{stringliteral}{'rank\_top\_k'}, -1)
191 
192         \textcolor{comment}{# Vectorize and save fixed/vocab candidates once upfront if applicable}
193         self.set\_fixed\_candidates(shared)
194         self.set\_vocab\_candidates(shared)
195 
196         \textcolor{keywordflow}{if} shared:
197             \textcolor{comment}{# We don't use get here because hasattr is used on optimizer later.}
198             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'optimizer'} \textcolor{keywordflow}{in} shared:
199                 self.optimizer = shared[\textcolor{stringliteral}{'optimizer'}]
200         \textcolor{keywordflow}{else}:
201             optim\_params = [p \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} self.model.parameters() \textcolor{keywordflow}{if} p.requires\_grad]
202             self.init\_optim(
203                 optim\_params, states.get(\textcolor{stringliteral}{'optimizer'}), states.get(\textcolor{stringliteral}{'optimizer\_type'})
204             )
205             self.build\_lr\_scheduler(states, hard\_reset=is\_finetune)
206 
207         \textcolor{keywordflow}{if} shared \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{and} \hyperlink{namespaceparlai_1_1utils_1_1distributed_a023acb5e3b66e1f27e21247c35661279}{is\_distributed}():
208             self.model = torch.nn.parallel.DistributedDataParallel(
209                 self.model, device\_ids=[self.opt[\textcolor{stringliteral}{'gpu'}]], broadcast\_buffers=\textcolor{keyword}{False}
210             )
211 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a8b16043428bbb29ee4a3ed28c2bbb472}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a8b16043428bbb29ee4a3ed28c2bbb472}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}}
\index{add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+cmdline\+\_\+args()}{add\_cmdline\_args()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+add\+\_\+cmdline\+\_\+args (\begin{DoxyParamCaption}\item[{}]{cls,  }\item[{}]{argparser }\end{DoxyParamCaption})}

\begin{DoxyVerb}Add CLI args.
\end{DoxyVerb}
 

Definition at line 39 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
39     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(cls, argparser):
40         \textcolor{stringliteral}{"""}
41 \textcolor{stringliteral}{        Add CLI args.}
42 \textcolor{stringliteral}{        """}
43         super(TorchRankerAgent, cls).\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(argparser)
44         agent = argparser.add\_argument\_group(\textcolor{stringliteral}{'TorchRankerAgent'})
45         agent.add\_argument(
46             \textcolor{stringliteral}{'-cands'},
47             \textcolor{stringliteral}{'--candidates'},
48             type=str,
49             default=\textcolor{stringliteral}{'inline'},
50             choices=[\textcolor{stringliteral}{'batch'}, \textcolor{stringliteral}{'inline'}, \textcolor{stringliteral}{'fixed'}, \textcolor{stringliteral}{'batch-all-cands'}],
51             help=\textcolor{stringliteral}{'The source of candidates during training '}
52             \textcolor{stringliteral}{'(see TorchRankerAgent.\_build\_candidates() for details).'},
53         )
54         agent.add\_argument(
55             \textcolor{stringliteral}{'-ecands'},
56             \textcolor{stringliteral}{'--eval-candidates'},
57             type=str,
58             default=\textcolor{stringliteral}{'inline'},
59             choices=[\textcolor{stringliteral}{'batch'}, \textcolor{stringliteral}{'inline'}, \textcolor{stringliteral}{'fixed'}, \textcolor{stringliteral}{'vocab'}, \textcolor{stringliteral}{'batch-all-cands'}],
60             help=\textcolor{stringliteral}{'The source of candidates during evaluation (defaults to the same'}
61             \textcolor{stringliteral}{'value as --candidates if no flag is given)'},
62         )
63         agent.add\_argument(
64             \textcolor{stringliteral}{'--repeat-blocking-heuristic'},
65             type=\textcolor{stringliteral}{'bool'},
66             default=\textcolor{keyword}{True},
67             help=\textcolor{stringliteral}{'Block repeating previous utterances. '}
68             \textcolor{stringliteral}{'Helpful for many models that score repeats highly, so switched '}
69             \textcolor{stringliteral}{'on by default.'},
70         )
71         agent.add\_argument(
72             \textcolor{stringliteral}{'-fcp'},
73             \textcolor{stringliteral}{'--fixed-candidates-path'},
74             type=str,
75             help=\textcolor{stringliteral}{'A text file of fixed candidates to use for all examples, one '}
76             \textcolor{stringliteral}{'candidate per line'},
77         )
78         agent.add\_argument(
79             \textcolor{stringliteral}{'--fixed-candidate-vecs'},
80             type=str,
81             default=\textcolor{stringliteral}{'reuse'},
82             help=\textcolor{stringliteral}{'One of "reuse", "replace", or a path to a file with vectors '}
83             \textcolor{stringliteral}{'corresponding to the candidates at --fixed-candidates-path. '}
84             \textcolor{stringliteral}{'The default path is a /path/to/model-file.<cands\_name>, where '}
85             \textcolor{stringliteral}{'<cands\_name> is the name of the file (not the full path) passed by '}
86             \textcolor{stringliteral}{'the flag --fixed-candidates-path. By default, this file is created '}
87             \textcolor{stringliteral}{'once and reused. To replace it, use the "replace" option.'},
88         )
89         agent.add\_argument(
90             \textcolor{stringliteral}{'--encode-candidate-vecs'},
91             type=\textcolor{stringliteral}{'bool'},
92             default=\textcolor{keyword}{True},
93             help=\textcolor{stringliteral}{'Cache and save the encoding of the candidate vecs. This '}
94             \textcolor{stringliteral}{'might be used when interacting with the model in real time '}
95             \textcolor{stringliteral}{'or evaluating on fixed candidate set when the encoding of '}
96             \textcolor{stringliteral}{'the candidates is independent of the input.'},
97         )
98         agent.add\_argument(
99             \textcolor{stringliteral}{'--encode-candidate-vecs-batchsize'},
100             type=int,
101             default=256,
102             hidden=\textcolor{keyword}{True},
103             help=\textcolor{stringliteral}{'Batchsize when encoding candidate vecs'},
104         )
105         agent.add\_argument(
106             \textcolor{stringliteral}{'--init-model'},
107             type=str,
108             default=\textcolor{keywordtype}{None},
109             help=\textcolor{stringliteral}{'Initialize model with weights from this file.'},
110         )
111         agent.add\_argument(
112             \textcolor{stringliteral}{'--train-predict'},
113             type=\textcolor{stringliteral}{'bool'},
114             default=\textcolor{keyword}{False},
115             help=\textcolor{stringliteral}{'Get predictions and calculate mean rank during the train '}
116             \textcolor{stringliteral}{'step. Turning this on may slow down training.'},
117         )
118         agent.add\_argument(
119             \textcolor{stringliteral}{'--cap-num-predictions'},
120             type=int,
121             default=100,
122             help=\textcolor{stringliteral}{'Limit to the number of predictions in output.text\_candidates'},
123         )
124         agent.add\_argument(
125             \textcolor{stringliteral}{'--ignore-bad-candidates'},
126             type=\textcolor{stringliteral}{'bool'},
127             default=\textcolor{keyword}{False},
128             help=\textcolor{stringliteral}{'Ignore examples for which the label is not present in the '}
129             \textcolor{stringliteral}{'label candidates. Default behavior results in RuntimeError. '},
130         )
131         agent.add\_argument(
132             \textcolor{stringliteral}{'--rank-top-k'},
133             type=int,
134             default=-1,
135             help=\textcolor{stringliteral}{'Ranking returns the top k results of k > 0, otherwise sorts every '}
136             \textcolor{stringliteral}{'single candidate according to the ranking.'},
137         )
138         agent.add\_argument(
139             \textcolor{stringliteral}{'--inference'},
140             choices=\{\textcolor{stringliteral}{'max'}, \textcolor{stringliteral}{'topk'}\},
141             default=\textcolor{stringliteral}{'max'},
142             help=\textcolor{stringliteral}{'Final response output algorithm'},
143         )
144         agent.add\_argument(
145             \textcolor{stringliteral}{'--topk'},
146             type=int,
147             default=5,
148             help=\textcolor{stringliteral}{'K used in Top K sampling inference, when selected'},
149         )
150 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a628050d71339298baafbaf678f94207d}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a628050d71339298baafbaf678f94207d}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!block\+\_\+repeats@{block\+\_\+repeats}}
\index{block\+\_\+repeats@{block\+\_\+repeats}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{block\+\_\+repeats()}{block\_repeats()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+block\+\_\+repeats (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{cand\+\_\+preds }\end{DoxyParamCaption})}

\begin{DoxyVerb}Heuristic to block a model repeating a line from the history.
\end{DoxyVerb}
 

Definition at line 494 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
494     \textcolor{keyword}{def }block\_repeats(self, cand\_preds):
495         \textcolor{stringliteral}{"""}
496 \textcolor{stringliteral}{        Heuristic to block a model repeating a line from the history.}
497 \textcolor{stringliteral}{        """}
498         history\_strings = []
499         \textcolor{keywordflow}{for} h \textcolor{keywordflow}{in} self.history.history\_raw\_strings:
500             \textcolor{comment}{# Heuristic: Block any given line in the history, splitting by '\(\backslash\)n'.}
501             history\_strings.extend(h.split(\textcolor{stringliteral}{'\(\backslash\)n'}))
502 
503         new\_preds = []
504         \textcolor{keywordflow}{for} cp \textcolor{keywordflow}{in} cand\_preds:
505             np = []
506             \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} cp:
507                 \textcolor{keywordflow}{if} c \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} history\_strings:
508                     np.append(c)
509             new\_preds.append(np)
510         \textcolor{keywordflow}{return} new\_preds
511 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a16d004a75c5fee42cd13db4abe157b98}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a16d004a75c5fee42cd13db4abe157b98}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!build\+\_\+criterion@{build\+\_\+criterion}}
\index{build\+\_\+criterion@{build\+\_\+criterion}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{build\+\_\+criterion()}{build\_criterion()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+build\+\_\+criterion (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Construct and return the loss function.

By default torch.nn.CrossEntropyLoss.
\end{DoxyVerb}
 

Definition at line 212 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
212     \textcolor{keyword}{def }build\_criterion(self):
213         \textcolor{stringliteral}{"""}
214 \textcolor{stringliteral}{        Construct and return the loss function.}
215 \textcolor{stringliteral}{}
216 \textcolor{stringliteral}{        By default torch.nn.CrossEntropyLoss.}
217 \textcolor{stringliteral}{        """}
218         \textcolor{keywordflow}{return} torch.nn.CrossEntropyLoss(reduction=\textcolor{stringliteral}{'sum'})
219 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a1c8e4925f558783a51a28ccb577c42c7}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a1c8e4925f558783a51a28ccb577c42c7}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!encode\+\_\+candidates@{encode\+\_\+candidates}}
\index{encode\+\_\+candidates@{encode\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{encode\+\_\+candidates()}{encode\_candidates()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+encode\+\_\+candidates (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{padded\+\_\+cands }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert the given candidates to vectors.

This is an abstract method that must be implemented by the user.

:param padded_cands:
    The padded candidates.
\end{DoxyVerb}
 

Definition at line 957 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
957     \textcolor{keyword}{def }encode\_candidates(self, padded\_cands):
958         \textcolor{stringliteral}{"""}
959 \textcolor{stringliteral}{        Convert the given candidates to vectors.}
960 \textcolor{stringliteral}{}
961 \textcolor{stringliteral}{        This is an abstract method that must be implemented by the user.}
962 \textcolor{stringliteral}{}
963 \textcolor{stringliteral}{        :param padded\_cands:}
964 \textcolor{stringliteral}{            The padded candidates.}
965 \textcolor{stringliteral}{        """}
966         \textcolor{keywordflow}{raise} NotImplementedError(
967             \textcolor{stringliteral}{'Abstract method: user must implement encode\_candidates(). '}
968             \textcolor{stringliteral}{'If your agent encodes candidates independently '}
969             \textcolor{stringliteral}{'from context, you can get performance gains with fixed cands by '}
970             \textcolor{stringliteral}{'implementing this function and running with the flag '}
971             \textcolor{stringliteral}{'--encode-candidate-vecs True.'}
972         )
973 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a65bca7841123e4c3df1e09f8c4eb397f}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a65bca7841123e4c3df1e09f8c4eb397f}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!eval\+\_\+step@{eval\+\_\+step}}
\index{eval\+\_\+step@{eval\+\_\+step}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{eval\+\_\+step()}{eval\_step()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+eval\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}Evaluate a single batch of examples.
\end{DoxyVerb}
 

Definition at line 414 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
414     \textcolor{keyword}{def }eval\_step(self, batch):
415         \textcolor{stringliteral}{"""}
416 \textcolor{stringliteral}{        Evaluate a single batch of examples.}
417 \textcolor{stringliteral}{        """}
418         \textcolor{keywordflow}{if} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{and} batch.image \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
419             \textcolor{keywordflow}{return}
420         batchsize = (
421             batch.text\_vec.size(0)
422             \textcolor{keywordflow}{if} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
423             \textcolor{keywordflow}{else} batch.image.size(0)
424         )
425         self.model.eval()
426 
427         cands, cand\_vecs, label\_inds = self.\_build\_candidates(
428             batch, source=self.eval\_candidates, mode=\textcolor{stringliteral}{'eval'}
429         )
430 
431         cand\_encs = \textcolor{keywordtype}{None}
432         \textcolor{keywordflow}{if} self.encode\_candidate\_vecs \textcolor{keywordflow}{and} self.eval\_candidates \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'fixed'}, \textcolor{stringliteral}{'vocab'}]:
433             \textcolor{comment}{# if we cached candidate encodings for a fixed list of candidates,}
434             \textcolor{comment}{# pass those into the score\_candidates function}
435             \textcolor{keywordflow}{if} self.fixed\_candidate\_encs \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
436                 self.fixed\_candidate\_encs = self.\_make\_candidate\_encs(
437                     cand\_vecs
438                 ).detach()
439             \textcolor{keywordflow}{if} self.eval\_candidates == \textcolor{stringliteral}{'fixed'}:
440                 cand\_encs = self.fixed\_candidate\_encs
441             \textcolor{keywordflow}{elif} self.eval\_candidates == \textcolor{stringliteral}{'vocab'}:
442                 cand\_encs = self.vocab\_candidate\_encs
443 
444         scores = self.score\_candidates(batch, cand\_vecs, cand\_encs=cand\_encs)
445         \textcolor{keywordflow}{if} self.rank\_top\_k > 0:
446             \_, ranks = scores.topk(
447                 min(self.rank\_top\_k, scores.size(1)), 1, largest=\textcolor{keyword}{True}
448             )
449         \textcolor{keywordflow}{else}:
450             \_, ranks = scores.sort(1, descending=\textcolor{keyword}{True})
451 
452         \textcolor{comment}{# Update metrics}
453         \textcolor{keywordflow}{if} label\_inds \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
454             loss = self.criterion(scores, label\_inds)
455             self.metrics[\textcolor{stringliteral}{'loss'}] += loss.item()
456             self.metrics[\textcolor{stringliteral}{'examples'}] += batchsize
457             \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} range(batchsize):
458                 rank = (ranks[b] == label\_inds[b]).nonzero()
459                 rank = rank.item() \textcolor{keywordflow}{if} len(rank) == 1 \textcolor{keywordflow}{else} scores.size(1)
460                 self.metrics[\textcolor{stringliteral}{'rank'}] += 1 + rank
461                 self.metrics[\textcolor{stringliteral}{'mrr'}] += 1.0 / (1 + rank)
462 
463         ranks = ranks.cpu()
464         max\_preds = self.opt[\textcolor{stringliteral}{'cap\_num\_predictions'}]
465         cand\_preds = []
466         \textcolor{keywordflow}{for} i, ordering \textcolor{keywordflow}{in} enumerate(ranks):
467             \textcolor{keywordflow}{if} cand\_vecs.dim() == 2:
468                 cand\_list = cands
469             \textcolor{keywordflow}{elif} cand\_vecs.dim() == 3:
470                 cand\_list = cands[i]
471             \textcolor{comment}{# using a generator instead of a list comprehension allows}
472             \textcolor{comment}{# to cap the number of elements.}
473             cand\_preds\_generator = (
474                 cand\_list[rank] \textcolor{keywordflow}{for} rank \textcolor{keywordflow}{in} ordering \textcolor{keywordflow}{if} rank < len(cand\_list)
475             )
476             cand\_preds.append(list(islice(cand\_preds\_generator, max\_preds)))
477 
478         \textcolor{keywordflow}{if} (
479             self.opt.get(\textcolor{stringliteral}{'repeat\_blocking\_heuristic'}, \textcolor{keyword}{True})
480             \textcolor{keywordflow}{and} self.eval\_candidates == \textcolor{stringliteral}{'fixed'}
481         ):
482             cand\_preds = self.block\_repeats(cand\_preds)
483 
484         \textcolor{keywordflow}{if} self.opt.get(\textcolor{stringliteral}{'inference'}, \textcolor{stringliteral}{'max'}) == \textcolor{stringliteral}{'max'}:
485             preds = [cand\_preds[i][0] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(batchsize)]
486         \textcolor{keywordflow}{else}:
487             \textcolor{comment}{# Top-k inference.}
488             preds = []
489             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(batchsize):
490                 preds.append(random.choice(cand\_preds[i][0 : self.opt[\textcolor{stringliteral}{'topk'}]]))
491 
492         \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}(preds, cand\_preds)
493 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a936cebe646816609dd1d4f56b9490d45}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a936cebe646816609dd1d4f56b9490d45}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!get\+\_\+task\+\_\+candidates\+\_\+path@{get\+\_\+task\+\_\+candidates\+\_\+path}}
\index{get\+\_\+task\+\_\+candidates\+\_\+path@{get\+\_\+task\+\_\+candidates\+\_\+path}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{get\+\_\+task\+\_\+candidates\+\_\+path()}{get\_task\_candidates\_path()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+get\+\_\+task\+\_\+candidates\+\_\+path (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 240 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
240     \textcolor{keyword}{def }get\_task\_candidates\_path(self):
241         path = self.opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'.cands-'} + self.opt[\textcolor{stringliteral}{'task'}] + \textcolor{stringliteral}{'.cands'}
242         \textcolor{keywordflow}{if} os.path.isfile(path) \textcolor{keywordflow}{and} self.opt[\textcolor{stringliteral}{'fixed\_candidate\_vecs'}] == \textcolor{stringliteral}{'reuse'}:
243             \textcolor{keywordflow}{return} path
244         print(\textcolor{stringliteral}{"[ *** building candidates file as they do not exist: "} + path + \textcolor{stringliteral}{' *** ]'})
245         \textcolor{keyword}{from} \hyperlink{namespaceparlai_1_1scripts_1_1build__candidates}{parlai.scripts.build\_candidates} \textcolor{keyword}{import} build\_cands
246         \textcolor{keyword}{from} copy \textcolor{keyword}{import} deepcopy
247 
248         opt = deepcopy(self.opt)
249         opt[\textcolor{stringliteral}{'outfile'}] = path
250         opt[\textcolor{stringliteral}{'datatype'}] = \textcolor{stringliteral}{'train:evalmode'}
251         opt[\textcolor{stringliteral}{'interactive\_task'}] = \textcolor{keyword}{False}
252         opt[\textcolor{stringliteral}{'batchsize'}] = 1
253         \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1memnn_1_1memnn__v0_ab07fdb540c02e8e2a1cc7e8cf662a8b8}{build\_cands}(opt)
254         \textcolor{keywordflow}{return} path
255 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a3a80c3eb68b019859da2a83706c3844d}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a3a80c3eb68b019859da2a83706c3844d}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!is\+\_\+valid@{is\+\_\+valid}}
\index{is\+\_\+valid@{is\+\_\+valid}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{is\+\_\+valid()}{is\_valid()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+is\+\_\+valid (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{obs }\end{DoxyParamCaption})}

\begin{DoxyVerb}Override from TorchAgent.

Check to see if label candidates contain the label.
\end{DoxyVerb}
 

Definition at line 336 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
336     \textcolor{keyword}{def }is\_valid(self, obs):
337         \textcolor{stringliteral}{"""}
338 \textcolor{stringliteral}{        Override from TorchAgent.}
339 \textcolor{stringliteral}{}
340 \textcolor{stringliteral}{        Check to see if label candidates contain the label.}
341 \textcolor{stringliteral}{        """}
342         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.ignore\_bad\_candidates:
343             \textcolor{keywordflow}{return} super().is\_valid(obs)
344 
345         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} super().is\_valid(obs):
346             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
347 
348         \textcolor{comment}{# skip examples for which the set of label candidates do not}
349         \textcolor{comment}{# contain the label}
350         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'labels\_vec'} \textcolor{keywordflow}{in} obs \textcolor{keywordflow}{and} \textcolor{stringliteral}{'label\_candidates\_vecs'} \textcolor{keywordflow}{in} obs:
351             cand\_vecs = obs[\textcolor{stringliteral}{'label\_candidates\_vecs'}]
352             label\_vec = obs[\textcolor{stringliteral}{'labels\_vec'}]
353             matches = [x \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} cand\_vecs \textcolor{keywordflow}{if} torch.equal(x, label\_vec)]
354             \textcolor{keywordflow}{if} len(matches) == 0:
355                 \hyperlink{namespaceparlai_1_1utils_1_1misc_acf146e70ea7f6867969a7c2b545d4b4b}{warn\_once}(
356                     \textcolor{stringliteral}{'At least one example has a set of label candidates that '}
357                     \textcolor{stringliteral}{'does not contain the label.'}
358                 )
359                 \textcolor{keywordflow}{return} \textcolor{keyword}{False}
360 
361         \textcolor{keywordflow}{return} \textcolor{keyword}{True}
362 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a353991d201d8889c453bf72c15ec78a9}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a353991d201d8889c453bf72c15ec78a9}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!load\+\_\+candidates@{load\+\_\+candidates}}
\index{load\+\_\+candidates@{load\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{load\+\_\+candidates()}{load\_candidates()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+load\+\_\+candidates (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path,  }\item[{}]{cand\+\_\+type = {\ttfamily \textquotesingle{}vectors\textquotesingle{}} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Load fixed candidates from a path.
\end{DoxyVerb}
 

Definition at line 926 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
926     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1tasks_1_1coco__caption_1_1agents_aa190162d0e36e1c93fc224b8a049f0cf}{load\_candidates}(self, path, cand\_type='vectors'):
927         \textcolor{stringliteral}{"""}
928 \textcolor{stringliteral}{        Load fixed candidates from a path.}
929 \textcolor{stringliteral}{        """}
930         print(\textcolor{stringliteral}{"[ Loading fixed candidate set \{\} from \{\} ]"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(cand\_type, path))
931         \textcolor{keywordflow}{return} torch.load(path, map\_location=\textcolor{keyword}{lambda} cpu, \_: cpu)
932 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a6314748dfa9aaf6e26145af686d5787d}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a6314748dfa9aaf6e26145af686d5787d}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!report@{report}}
\index{report@{report}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{report()}{report()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+report (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Report loss and mean_rank from model's perspective.
\end{DoxyVerb}
 

Definition at line 771 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
771     \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1convai2_1_1eval__f1_a01a47b9c08dad189837a51f085defc45}{report}(self):
772         \textcolor{stringliteral}{"""}
773 \textcolor{stringliteral}{        Report loss and mean\_rank from model's perspective.}
774 \textcolor{stringliteral}{        """}
775         base = super().\hyperlink{namespaceprojects_1_1convai2_1_1eval__f1_a01a47b9c08dad189837a51f085defc45}{report}()
776         m = \{\}
777         examples = self.metrics[\textcolor{stringliteral}{'examples'}]
778         \textcolor{keywordflow}{if} examples > 0:
779             m[\textcolor{stringliteral}{'examples'}] = examples
780             m[\textcolor{stringliteral}{'loss'}] = self.metrics[\textcolor{stringliteral}{'loss'}]
781             m[\textcolor{stringliteral}{'mean\_loss'}] = self.metrics[\textcolor{stringliteral}{'loss'}] / examples
782             batch\_train = self.candidates == \textcolor{stringliteral}{'batch'} \textcolor{keywordflow}{and} self.is\_training
783             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.is\_training \textcolor{keywordflow}{or} self.opt.get(\textcolor{stringliteral}{'train\_predict'}) \textcolor{keywordflow}{or} batch\_train:
784                 m[\textcolor{stringliteral}{'mean\_rank'}] = self.metrics[\textcolor{stringliteral}{'rank'}] / examples
785                 m[\textcolor{stringliteral}{'mrr'}] = self.metrics[\textcolor{stringliteral}{'mrr'}] / examples
786             \textcolor{keywordflow}{if} batch\_train:
787                 m[\textcolor{stringliteral}{'train\_accuracy'}] = self.metrics[\textcolor{stringliteral}{'train\_accuracy'}] / examples
788         \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} m.items():
789             \textcolor{comment}{# clean up: rounds to sigfigs and converts tensors to floats}
790             base[k] = \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}{round\_sigfigs}(v, 4)
791         \textcolor{keywordflow}{return} base
792 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ab526b2171567fd980451a795bb639cda}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ab526b2171567fd980451a795bb639cda}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!reset\+\_\+metrics@{reset\+\_\+metrics}}
\index{reset\+\_\+metrics@{reset\+\_\+metrics}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{reset\+\_\+metrics()}{reset\_metrics()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+reset\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Reset metrics.
\end{DoxyVerb}
 

Definition at line 758 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
758     \textcolor{keyword}{def }reset\_metrics(self):
759         \textcolor{stringliteral}{"""}
760 \textcolor{stringliteral}{        Reset metrics.}
761 \textcolor{stringliteral}{        """}
762         super().reset\_metrics()
763         \textcolor{comment}{# Note: we cannot change the type of metrics ahead of time, so you}
764         \textcolor{comment}{# should correctly initialize to floats or ints here}
765         self.metrics[\textcolor{stringliteral}{'examples'}] = 0
766         self.metrics[\textcolor{stringliteral}{'loss'}] = 0.0
767         self.metrics[\textcolor{stringliteral}{'rank'}] = 0.0
768         self.metrics[\textcolor{stringliteral}{'mrr'}] = 0.0
769         self.metrics[\textcolor{stringliteral}{'train\_accuracy'}] = 0.0
770 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a65d5726a4e2098212298bc2cdf13e70f}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a65d5726a4e2098212298bc2cdf13e70f}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!score\+\_\+candidates@{score\+\_\+candidates}}
\index{score\+\_\+candidates@{score\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{score\+\_\+candidates()}{score\_candidates()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+score\+\_\+candidates (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch,  }\item[{}]{cand\+\_\+vecs,  }\item[{}]{cand\+\_\+encs = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Given a batch and candidate set, return scores (for ranking).

:param Batch batch:
    a Batch object (defined in torch_agent.py)
:param LongTensor cand_vecs:
    padded and tokenized candidates
:param FloatTensor cand_encs:
    encoded candidates, if these are passed into the function (in cases
    where we cache the candidate encodings), you do not need to call
    self.model on cand_vecs
\end{DoxyVerb}
 

Definition at line 257 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
257     \textcolor{keyword}{def }score\_candidates(self, batch, cand\_vecs, cand\_encs=None):
258         \textcolor{stringliteral}{"""}
259 \textcolor{stringliteral}{        Given a batch and candidate set, return scores (for ranking).}
260 \textcolor{stringliteral}{}
261 \textcolor{stringliteral}{        :param Batch batch:}
262 \textcolor{stringliteral}{            a Batch object (defined in torch\_agent.py)}
263 \textcolor{stringliteral}{        :param LongTensor cand\_vecs:}
264 \textcolor{stringliteral}{            padded and tokenized candidates}
265 \textcolor{stringliteral}{        :param FloatTensor cand\_encs:}
266 \textcolor{stringliteral}{            encoded candidates, if these are passed into the function (in cases}
267 \textcolor{stringliteral}{            where we cache the candidate encodings), you do not need to call}
268 \textcolor{stringliteral}{            self.model on cand\_vecs}
269 \textcolor{stringliteral}{        """}
270         \textcolor{keywordflow}{pass}
271 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9039757596f98b45b6676b16589883a3}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9039757596f98b45b6676b16589883a3}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!set\+\_\+fixed\+\_\+candidates@{set\+\_\+fixed\+\_\+candidates}}
\index{set\+\_\+fixed\+\_\+candidates@{set\+\_\+fixed\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{set\+\_\+fixed\+\_\+candidates()}{set\_fixed\_candidates()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+set\+\_\+fixed\+\_\+candidates (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{shared }\end{DoxyParamCaption})}

\begin{DoxyVerb}Load a set of fixed candidates and their vectors (or vectorize them here).

self.fixed_candidates will contain a [num_cands] list of strings
self.fixed_candidate_vecs will contain a [num_cands, seq_len] LongTensor

See the note on the --fixed-candidate-vecs flag for an explanation of the
'reuse', 'replace', or path options.

Note: TorchRankerAgent by default converts candidates to vectors by vectorizing
in the common sense (i.e., replacing each token with its index in the
dictionary). If a child model wants to additionally perform encoding, it can
overwrite the vectorize_fixed_candidates() method to produce encoded vectors
instead of just vectorized ones.
\end{DoxyVerb}
 

Definition at line 838 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
838     \textcolor{keyword}{def }set\_fixed\_candidates(self, shared):
839         \textcolor{stringliteral}{"""}
840 \textcolor{stringliteral}{        Load a set of fixed candidates and their vectors (or vectorize them here).}
841 \textcolor{stringliteral}{}
842 \textcolor{stringliteral}{        self.fixed\_candidates will contain a [num\_cands] list of strings}
843 \textcolor{stringliteral}{        self.fixed\_candidate\_vecs will contain a [num\_cands, seq\_len] LongTensor}
844 \textcolor{stringliteral}{}
845 \textcolor{stringliteral}{        See the note on the --fixed-candidate-vecs flag for an explanation of the}
846 \textcolor{stringliteral}{        'reuse', 'replace', or path options.}
847 \textcolor{stringliteral}{}
848 \textcolor{stringliteral}{        Note: TorchRankerAgent by default converts candidates to vectors by vectorizing}
849 \textcolor{stringliteral}{        in the common sense (i.e., replacing each token with its index in the}
850 \textcolor{stringliteral}{        dictionary). If a child model wants to additionally perform encoding, it can}
851 \textcolor{stringliteral}{        overwrite the vectorize\_fixed\_candidates() method to produce encoded vectors}
852 \textcolor{stringliteral}{        instead of just vectorized ones.}
853 \textcolor{stringliteral}{        """}
854         \textcolor{keywordflow}{if} shared:
855             self.fixed\_candidates = shared[\textcolor{stringliteral}{'fixed\_candidates'}]
856             self.fixed\_candidate\_vecs = shared[\textcolor{stringliteral}{'fixed\_candidate\_vecs'}]
857             self.fixed\_candidate\_encs = shared[\textcolor{stringliteral}{'fixed\_candidate\_encs'}]
858             self.num\_fixed\_candidates = shared[\textcolor{stringliteral}{'num\_fixed\_candidates'}]
859         \textcolor{keywordflow}{else}:
860             self.num\_fixed\_candidates = 0
861             opt = self.opt
862             cand\_path = self.fixed\_candidates\_path
863             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'fixed'} \textcolor{keywordflow}{in} (self.candidates, self.eval\_candidates):
864                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} cand\_path:
865                     \textcolor{comment}{# Attempt to get a standard candidate set for the given task}
866                     path = self.get\_task\_candidates\_path()
867                     \textcolor{keywordflow}{if} path:
868                         print(\textcolor{stringliteral}{"[setting fixed\_candidates path to: "} + path + \textcolor{stringliteral}{" ]"})
869                         self.fixed\_candidates\_path = path
870                         cand\_path = self.fixed\_candidates\_path
871                 \textcolor{comment}{# Load candidates}
872                 print(\textcolor{stringliteral}{"[ Loading fixed candidate set from \{\} ]"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(cand\_path))
873                 with open(cand\_path, \textcolor{stringliteral}{'r', encoding='}utf-8') as f:
874                     cands = [line.strip() \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} f.readlines()]
875                 \textcolor{comment}{# Load or create candidate vectors}
876                 \textcolor{keywordflow}{if} os.path.isfile(self.opt[\textcolor{stringliteral}{'fixed\_candidate\_vecs'}]):
877                     vecs\_path = opt[\textcolor{stringliteral}{'fixed\_candidate\_vecs'}]
878                     vecs = self.load\_candidates(vecs\_path)
879                 \textcolor{keywordflow}{else}:
880                     setting = self.opt[\textcolor{stringliteral}{'fixed\_candidate\_vecs'}]
881                     model\_dir, model\_file = os.path.split(self.opt[\textcolor{stringliteral}{'model\_file'}])
882                     model\_name = os.path.splitext(model\_file)[0]
883                     cands\_name = os.path.splitext(os.path.basename(cand\_path))[0]
884                     vecs\_path = os.path.join(
885                         model\_dir, \textcolor{stringliteral}{'.'}.join([model\_name, cands\_name, \textcolor{stringliteral}{'vecs'}])
886                     )
887                     \textcolor{keywordflow}{if} setting == \textcolor{stringliteral}{'reuse'} \textcolor{keywordflow}{and} os.path.isfile(vecs\_path):
888                         vecs = self.load\_candidates(vecs\_path)
889                     \textcolor{keywordflow}{else}:  \textcolor{comment}{# setting == 'replace' OR generating for the first time}
890                         vecs = self.\_make\_candidate\_vecs(cands)
891                         self.\_save\_candidates(vecs, vecs\_path)
892 
893                 self.fixed\_candidates = cands
894                 self.num\_fixed\_candidates = len(self.fixed\_candidates)
895                 self.fixed\_candidate\_vecs = vecs
896                 \textcolor{keywordflow}{if} self.use\_cuda:
897                     self.fixed\_candidate\_vecs = self.fixed\_candidate\_vecs.cuda()
898 
899                 \textcolor{keywordflow}{if} self.encode\_candidate\_vecs:
900                     \textcolor{comment}{# candidate encodings are fixed so set them up now}
901                     enc\_path = os.path.join(
902                         model\_dir, \textcolor{stringliteral}{'.'}.join([model\_name, cands\_name, \textcolor{stringliteral}{'encs'}])
903                     )
904                     \textcolor{keywordflow}{if} setting == \textcolor{stringliteral}{'reuse'} \textcolor{keywordflow}{and} os.path.isfile(enc\_path):
905                         encs = self.load\_candidates(enc\_path, cand\_type=\textcolor{stringliteral}{'encodings'})
906                     \textcolor{keywordflow}{else}:
907                         encs = self.\_make\_candidate\_encs(self.fixed\_candidate\_vecs)
908                         self.\_save\_candidates(
909                             encs, path=enc\_path, cand\_type=\textcolor{stringliteral}{'encodings'}
910                         )
911                     self.fixed\_candidate\_encs = encs
912                     \textcolor{keywordflow}{if} self.use\_cuda:
913                         self.fixed\_candidate\_encs = self.fixed\_candidate\_encs.cuda()
914                     \textcolor{keywordflow}{if} self.fp16:
915                         self.fixed\_candidate\_encs = self.fixed\_candidate\_encs.half()
916                     \textcolor{keywordflow}{else}:
917                         self.fixed\_candidate\_encs = self.fixed\_candidate\_encs.
      \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}()
918                 \textcolor{keywordflow}{else}:
919                     self.fixed\_candidate\_encs = \textcolor{keywordtype}{None}
920 
921             \textcolor{keywordflow}{else}:
922                 self.fixed\_candidates = \textcolor{keywordtype}{None}
923                 self.fixed\_candidate\_vecs = \textcolor{keywordtype}{None}
924                 self.fixed\_candidate\_encs = \textcolor{keywordtype}{None}
925 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9b90f2718c85b6373ead4cd207cfd3d8}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9b90f2718c85b6373ead4cd207cfd3d8}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!set\+\_\+interactive\+\_\+mode@{set\+\_\+interactive\+\_\+mode}}
\index{set\+\_\+interactive\+\_\+mode@{set\+\_\+interactive\+\_\+mode}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{set\+\_\+interactive\+\_\+mode()}{set\_interactive\_mode()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+set\+\_\+interactive\+\_\+mode (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{mode,  }\item[{}]{shared = {\ttfamily False} }\end{DoxyParamCaption})}



Definition at line 220 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
220     \textcolor{keyword}{def }set\_interactive\_mode(self, mode, shared=False):
221         super().set\_interactive\_mode(mode, shared)
222         self.candidates = self.opt[\textcolor{stringliteral}{'candidates'}]
223         self.encode\_candidate\_vecs = self.opt[\textcolor{stringliteral}{'encode\_candidate\_vecs'}]
224         \textcolor{keywordflow}{if} mode:
225             self.eval\_candidates = \textcolor{stringliteral}{'fixed'}
226             self.ignore\_bad\_candidates = \textcolor{keyword}{True}
227             self.fixed\_candidates\_path = self.opt[\textcolor{stringliteral}{'fixed\_candidates\_path'}]
228             \textcolor{keywordflow}{if} self.fixed\_candidates\_path \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} self.fixed\_candidates\_path == \textcolor{stringliteral}{''}:
229                 \textcolor{comment}{# Attempt to get a standard candidate set for the given task}
230                 path = self.get\_task\_candidates\_path()
231                 \textcolor{keywordflow}{if} path:
232                     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} shared:
233                         print(\textcolor{stringliteral}{"[setting fixed\_candidates path to: "} + path + \textcolor{stringliteral}{" ]"})
234                     self.fixed\_candidates\_path = path
235         \textcolor{keywordflow}{else}:
236             self.eval\_candidates = self.opt[\textcolor{stringliteral}{'eval\_candidates'}]
237             self.ignore\_bad\_candidates = self.opt.get(\textcolor{stringliteral}{'ignore\_bad\_candidates'}, \textcolor{keyword}{False})
238             self.fixed\_candidates\_path = self.opt[\textcolor{stringliteral}{'fixed\_candidates\_path'}]
239 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a41c604613a97e566bfcc31667d0dfc6a}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a41c604613a97e566bfcc31667d0dfc6a}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!set\+\_\+vocab\+\_\+candidates@{set\+\_\+vocab\+\_\+candidates}}
\index{set\+\_\+vocab\+\_\+candidates@{set\+\_\+vocab\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{set\+\_\+vocab\+\_\+candidates()}{set\_vocab\_candidates()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+set\+\_\+vocab\+\_\+candidates (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{shared }\end{DoxyParamCaption})}

\begin{DoxyVerb}Load the tokens from the vocab as candidates.

self.vocab_candidates will contain a [num_cands] list of strings
self.vocab_candidate_vecs will contain a [num_cands, 1] LongTensor
\end{DoxyVerb}
 

Definition at line 793 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
793     \textcolor{keyword}{def }set\_vocab\_candidates(self, shared):
794         \textcolor{stringliteral}{"""}
795 \textcolor{stringliteral}{        Load the tokens from the vocab as candidates.}
796 \textcolor{stringliteral}{}
797 \textcolor{stringliteral}{        self.vocab\_candidates will contain a [num\_cands] list of strings}
798 \textcolor{stringliteral}{        self.vocab\_candidate\_vecs will contain a [num\_cands, 1] LongTensor}
799 \textcolor{stringliteral}{        """}
800         \textcolor{keywordflow}{if} shared:
801             self.vocab\_candidates = shared[\textcolor{stringliteral}{'vocab\_candidates'}]
802             self.vocab\_candidate\_vecs = shared[\textcolor{stringliteral}{'vocab\_candidate\_vecs'}]
803             self.vocab\_candidate\_encs = shared[\textcolor{stringliteral}{'vocab\_candidate\_encs'}]
804         \textcolor{keywordflow}{else}:
805             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'vocab'} \textcolor{keywordflow}{in} (self.opt[\textcolor{stringliteral}{'candidates'}], self.opt[\textcolor{stringliteral}{'eval\_candidates'}]):
806                 cands = []
807                 vecs = []
808                 \textcolor{keywordflow}{for} ind \textcolor{keywordflow}{in} range(1, len(self.dict)):
809                     cands.append(self.dict.ind2tok[ind])
810                     vecs.append(ind)
811                 self.vocab\_candidates = cands
812                 self.vocab\_candidate\_vecs = torch.LongTensor(vecs).unsqueeze(1)
813                 print(
814                     \textcolor{stringliteral}{"[ Loaded fixed candidate set (n = \{\}) from vocabulary ]"}
815                     \textcolor{stringliteral}{""}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(len(self.vocab\_candidates))
816                 )
817                 \textcolor{keywordflow}{if} self.use\_cuda:
818                     self.vocab\_candidate\_vecs = self.vocab\_candidate\_vecs.cuda()
819 
820                 \textcolor{keywordflow}{if} self.encode\_candidate\_vecs:
821                     \textcolor{comment}{# encode vocab candidate vecs}
822                     self.vocab\_candidate\_encs = self.\_make\_candidate\_encs(
823                         self.vocab\_candidate\_vecs
824                     )
825                     \textcolor{keywordflow}{if} self.use\_cuda:
826                         self.vocab\_candidate\_encs = self.vocab\_candidate\_encs.cuda()
827                     \textcolor{keywordflow}{if} self.fp16:
828                         self.vocab\_candidate\_encs = self.vocab\_candidate\_encs.half()
829                     \textcolor{keywordflow}{else}:
830                         self.vocab\_candidate\_encs = self.vocab\_candidate\_encs.
      \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}()
831                 \textcolor{keywordflow}{else}:
832                     self.vocab\_candidate\_encs = \textcolor{keywordtype}{None}
833             \textcolor{keywordflow}{else}:
834                 self.vocab\_candidates = \textcolor{keywordtype}{None}
835                 self.vocab\_candidate\_vecs = \textcolor{keywordtype}{None}
836                 self.vocab\_candidate\_encs = \textcolor{keywordtype}{None}
837 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9ba5899b6497645bb6d406ecc2441da7}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9ba5899b6497645bb6d406ecc2441da7}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!share@{share}}
\index{share@{share}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{share()}{share()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+share (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Share model parameters.
\end{DoxyVerb}
 

Definition at line 743 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
743     \textcolor{keyword}{def }share(self):
744         \textcolor{stringliteral}{"""}
745 \textcolor{stringliteral}{        Share model parameters.}
746 \textcolor{stringliteral}{        """}
747         shared = super().share()
748         shared[\textcolor{stringliteral}{'fixed\_candidates'}] = self.fixed\_candidates
749         shared[\textcolor{stringliteral}{'fixed\_candidate\_vecs'}] = self.fixed\_candidate\_vecs
750         shared[\textcolor{stringliteral}{'fixed\_candidate\_encs'}] = self.fixed\_candidate\_encs
751         shared[\textcolor{stringliteral}{'num\_fixed\_candidates'}] = self.num\_fixed\_candidates
752         shared[\textcolor{stringliteral}{'vocab\_candidates'}] = self.vocab\_candidates
753         shared[\textcolor{stringliteral}{'vocab\_candidate\_vecs'}] = self.vocab\_candidate\_vecs
754         shared[\textcolor{stringliteral}{'vocab\_candidate\_encs'}] = self.vocab\_candidate\_encs
755         shared[\textcolor{stringliteral}{'optimizer'}] = self.optimizer
756         \textcolor{keywordflow}{return} shared
757 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a05ddf921f386f21116ec0ef50796987a}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a05ddf921f386f21116ec0ef50796987a}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!train\+\_\+step@{train\+\_\+step}}
\index{train\+\_\+step@{train\+\_\+step}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{train\+\_\+step()}{train\_step()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+train\+\_\+step (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{batch }\end{DoxyParamCaption})}

\begin{DoxyVerb}Train on a single batch of examples.
\end{DoxyVerb}
 

Definition at line 363 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
363     \textcolor{keyword}{def }train\_step(self, batch):
364         \textcolor{stringliteral}{"""}
365 \textcolor{stringliteral}{        Train on a single batch of examples.}
366 \textcolor{stringliteral}{        """}
367         self.\_maybe\_invalidate\_fixed\_encs\_cache()
368         \textcolor{keywordflow}{if} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{and} batch.image \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
369             \textcolor{keywordflow}{return}
370         batchsize = (
371             batch.text\_vec.size(0)
372             \textcolor{keywordflow}{if} batch.text\_vec \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
373             \textcolor{keywordflow}{else} batch.image.size(0)
374         )
375         self.model.\hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a36a5f4f6f9df0611a6818610518d2cf0}{train}()
376         self.zero\_grad()
377 
378         cands, cand\_vecs, label\_inds = self.\_build\_candidates(
379             batch, source=self.candidates, mode=\textcolor{stringliteral}{'train'}
380         )
381         \textcolor{keywordflow}{try}:
382             scores = self.score\_candidates(batch, cand\_vecs)
383             loss = self.criterion(scores, label\_inds)
384             self.backward(loss)
385             self.update\_params()
386         \textcolor{keywordflow}{except} RuntimeError \textcolor{keyword}{as} e:
387             \textcolor{comment}{# catch out of memory exceptions during fwd/bck (skip batch)}
388             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'out of memory'} \textcolor{keywordflow}{in} \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(e):
389                 print(
390                     \textcolor{stringliteral}{'| WARNING: ran out of memory, skipping batch. '}
391                     \textcolor{stringliteral}{'if this happens frequently, decrease batchsize or '}
392                     \textcolor{stringliteral}{'truncate the inputs to the model.'}
393                 )
394                 \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}()
395             \textcolor{keywordflow}{else}:
396                 \textcolor{keywordflow}{raise} e
397 
398         \textcolor{comment}{# Update loss}
399         self.metrics[\textcolor{stringliteral}{'loss'}] += loss.item()
400         self.metrics[\textcolor{stringliteral}{'examples'}] += batchsize
401 
402         \textcolor{comment}{# Get train predictions}
403         \textcolor{keywordflow}{if} self.candidates == \textcolor{stringliteral}{'batch'}:
404             self.\_get\_batch\_train\_metrics(scores)
405             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}()
406         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.opt.get(\textcolor{stringliteral}{'train\_predict'}, \textcolor{keyword}{False}):
407             \hyperlink{namespaceparlai_1_1utils_1_1misc_acf146e70ea7f6867969a7c2b545d4b4b}{warn\_once}(
408                 \textcolor{stringliteral}{"Some training metrics are omitted for speed. Set the flag "}
409                 \textcolor{stringliteral}{"`--train-predict` to calculate train metrics."}
410             )
411             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1torch__agent__v1_a2689006ea97d09413fb242f984bd8016}{Output}()
412         \textcolor{keywordflow}{return} self.\_get\_train\_preds(scores, label\_inds, cands, cand\_vecs)
413 
\end{DoxyCode}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_af2e2d618f056bb68089c7252fa07d07b}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_af2e2d618f056bb68089c7252fa07d07b}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!vectorize\+\_\+fixed\+\_\+candidates@{vectorize\+\_\+fixed\+\_\+candidates}}
\index{vectorize\+\_\+fixed\+\_\+candidates@{vectorize\+\_\+fixed\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{vectorize\+\_\+fixed\+\_\+candidates()}{vectorize\_fixed\_candidates()}}
{\footnotesize\ttfamily def parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+vectorize\+\_\+fixed\+\_\+candidates (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{cands\+\_\+batch,  }\item[{}]{add\+\_\+start = {\ttfamily False},  }\item[{}]{add\+\_\+end = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert a batch of candidates from text to vectors.

:param cands_batch:
    a [batchsize] list of candidates (strings)
:returns:
    a [num_cands] list of candidate vectors

By default, candidates are simply vectorized (tokens replaced by token ids).
A child class may choose to overwrite this method to perform vectorization as
well as encoding if so desired.
\end{DoxyVerb}
 

Definition at line 995 of file torch\+\_\+ranker\+\_\+agent.\+py.


\begin{DoxyCode}
995     \textcolor{keyword}{def }vectorize\_fixed\_candidates(self, cands\_batch, add\_start=False, add\_end=False):
996         \textcolor{stringliteral}{"""}
997 \textcolor{stringliteral}{        Convert a batch of candidates from text to vectors.}
998 \textcolor{stringliteral}{}
999 \textcolor{stringliteral}{        :param cands\_batch:}
1000 \textcolor{stringliteral}{            a [batchsize] list of candidates (strings)}
1001 \textcolor{stringliteral}{        :returns:}
1002 \textcolor{stringliteral}{            a [num\_cands] list of candidate vectors}
1003 \textcolor{stringliteral}{}
1004 \textcolor{stringliteral}{        By default, candidates are simply vectorized (tokens replaced by token ids).}
1005 \textcolor{stringliteral}{        A child class may choose to overwrite this method to perform vectorization as}
1006 \textcolor{stringliteral}{        well as encoding if so desired.}
1007 \textcolor{stringliteral}{        """}
1008         \textcolor{keywordflow}{return} [
1009             self.\_vectorize\_text(
1010                 cand,
1011                 truncate=self.label\_truncate,
1012                 truncate\_left=\textcolor{keyword}{False},
1013                 add\_start=add\_start,
1014                 add\_end=add\_end,
1015             )
1016             \textcolor{keywordflow}{for} cand \textcolor{keywordflow}{in} cands\_batch
1017         ]
1018 \end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_af54615af2f53a06df8fb046492f1ec38}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_af54615af2f53a06df8fb046492f1ec38}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!candidates@{candidates}}
\index{candidates@{candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{candidates}{candidates}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+candidates}



Definition at line 222 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a687a40a7925676c15b42a6cee06f5d72}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a687a40a7925676c15b42a6cee06f5d72}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!criterion@{criterion}}
\index{criterion@{criterion}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{criterion}{criterion}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+criterion}



Definition at line 169 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9a166529b77c8b77ca4c419534a95379}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a9a166529b77c8b77ca4c419534a95379}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!encode\+\_\+candidate\+\_\+vecs@{encode\+\_\+candidate\+\_\+vecs}}
\index{encode\+\_\+candidate\+\_\+vecs@{encode\+\_\+candidate\+\_\+vecs}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{encode\+\_\+candidate\+\_\+vecs}{encode\_candidate\_vecs}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+encode\+\_\+candidate\+\_\+vecs}



Definition at line 223 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_aaa94e12e115e0fc09ba34dd9d4839fba}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_aaa94e12e115e0fc09ba34dd9d4839fba}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!eval\+\_\+candidates@{eval\+\_\+candidates}}
\index{eval\+\_\+candidates@{eval\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{eval\+\_\+candidates}{eval\_candidates}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+eval\+\_\+candidates}



Definition at line 225 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a7a6bfdf4db906b9f4ed7e75e51d580f9}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a7a6bfdf4db906b9f4ed7e75e51d580f9}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!fixed\+\_\+candidate\+\_\+encs@{fixed\+\_\+candidate\+\_\+encs}}
\index{fixed\+\_\+candidate\+\_\+encs@{fixed\+\_\+candidate\+\_\+encs}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{fixed\+\_\+candidate\+\_\+encs}{fixed\_candidate\_encs}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+fixed\+\_\+candidate\+\_\+encs}



Definition at line 274 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ae74ff1d80d1954b1ec44fe89b46b9f32}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ae74ff1d80d1954b1ec44fe89b46b9f32}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!fixed\+\_\+candidate\+\_\+vecs@{fixed\+\_\+candidate\+\_\+vecs}}
\index{fixed\+\_\+candidate\+\_\+vecs@{fixed\+\_\+candidate\+\_\+vecs}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{fixed\+\_\+candidate\+\_\+vecs}{fixed\_candidate\_vecs}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+fixed\+\_\+candidate\+\_\+vecs}



Definition at line 856 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a6ae8c88595193b7a921843c1ad3b25f8}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a6ae8c88595193b7a921843c1ad3b25f8}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!fixed\+\_\+candidates@{fixed\+\_\+candidates}}
\index{fixed\+\_\+candidates@{fixed\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{fixed\+\_\+candidates}{fixed\_candidates}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+fixed\+\_\+candidates}



Definition at line 855 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_abde0ae40e8dc959f9bad3039b3a267e4}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_abde0ae40e8dc959f9bad3039b3a267e4}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!fixed\+\_\+candidates\+\_\+path@{fixed\+\_\+candidates\+\_\+path}}
\index{fixed\+\_\+candidates\+\_\+path@{fixed\+\_\+candidates\+\_\+path}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{fixed\+\_\+candidates\+\_\+path}{fixed\_candidates\_path}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+fixed\+\_\+candidates\+\_\+path}



Definition at line 227 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ae239c259e74080fe0fe9a501b8e0fc12}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ae239c259e74080fe0fe9a501b8e0fc12}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!ignore\+\_\+bad\+\_\+candidates@{ignore\+\_\+bad\+\_\+candidates}}
\index{ignore\+\_\+bad\+\_\+candidates@{ignore\+\_\+bad\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{ignore\+\_\+bad\+\_\+candidates}{ignore\_bad\_candidates}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+ignore\+\_\+bad\+\_\+candidates}



Definition at line 226 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a675eab99eca0761267b0d55910487233}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a675eab99eca0761267b0d55910487233}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!model@{model}}
\index{model@{model}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{model}{model}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+model}



Definition at line 170 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_af72d685e19afda09adc7f52a6346ab34}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_af72d685e19afda09adc7f52a6346ab34}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!num\+\_\+fixed\+\_\+candidates@{num\+\_\+fixed\+\_\+candidates}}
\index{num\+\_\+fixed\+\_\+candidates@{num\+\_\+fixed\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{num\+\_\+fixed\+\_\+candidates}{num\_fixed\_candidates}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+num\+\_\+fixed\+\_\+candidates}



Definition at line 858 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ac28b6cc47b43ed9b4f0c6786828d2649}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_ac28b6cc47b43ed9b4f0c6786828d2649}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!optimizer@{optimizer}}
\index{optimizer@{optimizer}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{optimizer}{optimizer}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+optimizer}



Definition at line 199 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a1205be489b10e7870d865844c05d7fec}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a1205be489b10e7870d865844c05d7fec}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!rank\+\_\+top\+\_\+k@{rank\+\_\+top\+\_\+k}}
\index{rank\+\_\+top\+\_\+k@{rank\+\_\+top\+\_\+k}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{rank\+\_\+top\+\_\+k}{rank\_top\_k}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+rank\+\_\+top\+\_\+k}



Definition at line 190 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_afefae7f9bc31b66c2e488528d4277e58}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_afefae7f9bc31b66c2e488528d4277e58}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!vocab\+\_\+candidate\+\_\+encs@{vocab\+\_\+candidate\+\_\+encs}}
\index{vocab\+\_\+candidate\+\_\+encs@{vocab\+\_\+candidate\+\_\+encs}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{vocab\+\_\+candidate\+\_\+encs}{vocab\_candidate\_encs}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+vocab\+\_\+candidate\+\_\+encs}



Definition at line 803 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a7ea32d15ace58e3cf91712fdc6056bbc}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a7ea32d15ace58e3cf91712fdc6056bbc}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!vocab\+\_\+candidate\+\_\+vecs@{vocab\+\_\+candidate\+\_\+vecs}}
\index{vocab\+\_\+candidate\+\_\+vecs@{vocab\+\_\+candidate\+\_\+vecs}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{vocab\+\_\+candidate\+\_\+vecs}{vocab\_candidate\_vecs}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+vocab\+\_\+candidate\+\_\+vecs}



Definition at line 802 of file torch\+\_\+ranker\+\_\+agent.\+py.

\mbox{\Hypertarget{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a627d68f27f1e2683935674b632c7c3e1}\label{classparlai_1_1core_1_1torch__ranker__agent_1_1TorchRankerAgent_a627d68f27f1e2683935674b632c7c3e1}} 
\index{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}!vocab\+\_\+candidates@{vocab\+\_\+candidates}}
\index{vocab\+\_\+candidates@{vocab\+\_\+candidates}!parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent@{parlai\+::core\+::torch\+\_\+ranker\+\_\+agent\+::\+Torch\+Ranker\+Agent}}
\subsubsection{\texorpdfstring{vocab\+\_\+candidates}{vocab\_candidates}}
{\footnotesize\ttfamily parlai.\+core.\+torch\+\_\+ranker\+\_\+agent.\+Torch\+Ranker\+Agent.\+vocab\+\_\+candidates}



Definition at line 801 of file torch\+\_\+ranker\+\_\+agent.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/core/\hyperlink{torch__ranker__agent_8py}{torch\+\_\+ranker\+\_\+agent.\+py}\end{DoxyCompactItemize}
