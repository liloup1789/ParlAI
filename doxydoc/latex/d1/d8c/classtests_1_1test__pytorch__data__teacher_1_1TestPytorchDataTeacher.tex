\hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher}{}\section{tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher Class Reference}
\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher}\index{tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher@{tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher}}


Inheritance diagram for tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=235pt]{d6/d61/classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=235pt]{d8/d25/classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_aaecd01e211d3e5b0c87f58da6c9b3def}{test\+\_\+shuffle} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_ad9d9065300215a4afeb0589192b5ba05}{test\+\_\+pyt\+\_\+preprocess} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a2c83da3833b551a1e15e6cec4a8589eb}{test\+\_\+valid\+\_\+pyt\+\_\+batchsort} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a1c96927436b550513d6656564ec0c5fe}{test\+\_\+pyt\+\_\+batchsort\+\_\+field} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a4321d4b1619bf66a94146e811d869185}{test\+\_\+pyt\+\_\+train} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a3d14342d0d8a931821b223111e383d8e}{test\+\_\+pyt\+\_\+train\+\_\+stream} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a1ccb0839b1de7c220c5b53e73d4f9ae1}{test\+\_\+pyt\+\_\+train\+\_\+stream\+\_\+ordered} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a3ba46374c7e9068827af1b90f35c832e}{test\+\_\+pyt\+\_\+preprocess\+\_\+train} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a17540e666ded187d76960e3ef3f43d7b}{test\+\_\+pyt\+\_\+batchsort\+\_\+train} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a5db5cdee08adaaf60c646c7c884f1068}{test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+stream} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_acf2428b3226bc0cf95d4dbb80877e6d0}{test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+preprocess} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a3ff18909bd05956b4fa7970bc3c96afb}{test\+\_\+pytd\+\_\+teacher} (self)
\item 
def \hyperlink{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a7337dfde736431a6c52de772c5230617}{test\+\_\+pyt\+\_\+multitask} (self)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Various tests for PytorchDataTeacher.
\end{DoxyVerb}
\begin{DoxyVerb}Unit Tests\end{DoxyVerb}
 

Definition at line 62 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.



\subsection{Member Function Documentation}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a1c96927436b550513d6656564ec0c5fe}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a1c96927436b550513d6656564ec0c5fe}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pyt\+\_\+batchsort\+\_\+field@{test\+\_\+pyt\+\_\+batchsort\+\_\+field}}
\index{test\+\_\+pyt\+\_\+batchsort\+\_\+field@{test\+\_\+pyt\+\_\+batchsort\+\_\+field}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pyt\+\_\+batchsort\+\_\+field()}{test\_pyt\_batchsort\_field()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pyt\+\_\+batchsort\+\_\+field (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Test that the batchsort actually works for Pytorch Data Teacher.

That is, for every batch except the last one, check that the length of each
example (determined by batchsort_field) is within `batch-length-range`
\end{DoxyVerb}
 

Definition at line 226 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
226     \textcolor{keyword}{def }test\_pyt\_batchsort\_field(self):
227         \textcolor{stringliteral}{"""}
228 \textcolor{stringliteral}{        Test that the batchsort actually works for Pytorch Data Teacher.}
229 \textcolor{stringliteral}{}
230 \textcolor{stringliteral}{        That is, for every batch except the last one, check that the length of each}
231 \textcolor{stringliteral}{        example (determined by batchsort\_field) is within `batch-length-range`}
232 \textcolor{stringliteral}{        """}
233         \textcolor{comment}{# First, check that batchsort itself works}
234         defaults = unit\_test\_parser\_defaults.copy()
235         defaults[\textcolor{stringliteral}{'datatype'}] = \textcolor{stringliteral}{'train:stream:ordered'}
236         defaults[\textcolor{stringliteral}{'pytorch\_teacher\_batch\_sort'}] = \textcolor{keyword}{True}
237         defaults[\textcolor{stringliteral}{'pytorch\_teacher\_task'}] = \textcolor{stringliteral}{'babi:task1k:1'}
238         defaults[\textcolor{stringliteral}{'batchsize'}] = 50
239         max\_range = defaults[\textcolor{stringliteral}{'batch\_length\_range'}]
240 
241         \textcolor{keyword}{def }verify\_batch\_lengths(defaults):
242             with testing\_utils.capture\_output() \textcolor{keyword}{as} \_, testing\_utils.tempdir() \textcolor{keyword}{as} tmpdir:
243                 \textcolor{comment}{# Get processed act from agent}
244                 parser = train\_setup\_args()
245                 defaults[\textcolor{stringliteral}{'model\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model'})
246                 defaults[\textcolor{stringliteral}{'dict\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model.dict'})
247                 parser.set\_defaults(**defaults)
248                 opt = parser.parse\_args()
249                 \hyperlink{namespacebuild__dict}{build\_dict}(opt)
250                 agent = \hyperlink{namespaceparlai_1_1core_1_1agents_a00d77a7e26fb89e8bd900f7b2a02982a}{create\_agent}(opt)
251                 world\_data = \hyperlink{namespaceparlai_1_1core_1_1worlds_a79969c7ba76d4b3c500f5bb776444dc6}{create\_task}(opt, agent)
252                 batch\_sort\_acts = []
253                 \textcolor{comment}{# first epoch}
254                 \textcolor{keywordflow}{while} len(batch\_sort\_acts) < 900 / 50:
255                     world\_data.parley()
256                     batch\_sort\_acts.append(world\_data.acts[0])
257                 teacher = world\_data.world.get\_agents()[0]
258                 teacher.reset\_data()
259                 \textcolor{comment}{# second epoch}
260                 \textcolor{keywordflow}{while} len(batch\_sort\_acts) < 1800 / 50:
261                     world\_data.parley()
262                     batch\_sort\_acts.append(world\_data.acts[0])
263                 world\_data.shutdown()
264             field = defaults[\textcolor{stringliteral}{'batch\_sort\_field'}]
265             lengths = [
266                 [\hyperlink{namespaceparlai_1_1core_1_1pytorch__data__teacher_afbd22acd239efcdb6afb94db83ee3493}{ep\_length}(b[field]) \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} bb \textcolor{keywordflow}{if} field \textcolor{keywordflow}{in} b]
267                 \textcolor{keywordflow}{for} bb \textcolor{keywordflow}{in} batch\_sort\_acts[:-2]
268             ]  \textcolor{comment}{# exclude last batch}
269             \textcolor{comment}{# verify batch lengths}
270             \textcolor{keywordflow}{for} batch\_lens \textcolor{keywordflow}{in} lengths:
271                 self.assertLessEqual(
272                     max(batch\_lens) - min(batch\_lens),
273                     max\_range,
274                     \textcolor{stringliteral}{'PytorchDataTeacher batching does not give '}
275                     \textcolor{stringliteral}{'batches with similar sized examples, when '}
276                     \textcolor{stringliteral}{'sorting by `\{\}` field.'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(defaults[\textcolor{stringliteral}{'batch\_sort\_field'}]),
277                 )
278 
279         defaults[\textcolor{stringliteral}{'batch\_sort\_field'}] = \textcolor{stringliteral}{'text'}
280         verify\_batch\_lengths(defaults)
281         defaults[\textcolor{stringliteral}{'batch\_sort\_field'}] = \textcolor{stringliteral}{'text\_vec'}
282         defaults[\textcolor{stringliteral}{'pytorch\_preprocess'}] = \textcolor{keyword}{True}
283         verify\_batch\_lengths(defaults)
284 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a17540e666ded187d76960e3ef3f43d7b}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a17540e666ded187d76960e3ef3f43d7b}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pyt\+\_\+batchsort\+\_\+train@{test\+\_\+pyt\+\_\+batchsort\+\_\+train}}
\index{test\+\_\+pyt\+\_\+batchsort\+\_\+train@{test\+\_\+pyt\+\_\+batchsort\+\_\+train}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pyt\+\_\+batchsort\+\_\+train()}{test\_pyt\_batchsort\_train()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pyt\+\_\+batchsort\+\_\+train (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 361 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
361     \textcolor{keyword}{def }test\_pyt\_batchsort\_train(self):
362         self.\_pyt\_batchsort\_train(\textcolor{stringliteral}{'train'}, \textcolor{keyword}{False})
363 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_acf2428b3226bc0cf95d4dbb80877e6d0}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_acf2428b3226bc0cf95d4dbb80877e6d0}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+preprocess@{test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+preprocess}}
\index{test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+preprocess@{test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+preprocess}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+preprocess()}{test\_pyt\_batchsort\_train\_preprocess()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+preprocess (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 369 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
369     \textcolor{keyword}{def }test\_pyt\_batchsort\_train\_preprocess(self):
370         self.\_pyt\_batchsort\_train(\textcolor{stringliteral}{'train'}, \textcolor{keyword}{True})
371 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a5db5cdee08adaaf60c646c7c884f1068}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a5db5cdee08adaaf60c646c7c884f1068}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+stream@{test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+stream}}
\index{test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+stream@{test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+stream}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+stream()}{test\_pyt\_batchsort\_train\_stream()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pyt\+\_\+batchsort\+\_\+train\+\_\+stream (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 365 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
365     \textcolor{keyword}{def }test\_pyt\_batchsort\_train\_stream(self):
366         self.\_pyt\_batchsort\_train(\textcolor{stringliteral}{'train:stream'}, \textcolor{keyword}{False})
367 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a7337dfde736431a6c52de772c5230617}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a7337dfde736431a6c52de772c5230617}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pyt\+\_\+multitask@{test\+\_\+pyt\+\_\+multitask}}
\index{test\+\_\+pyt\+\_\+multitask@{test\+\_\+pyt\+\_\+multitask}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pyt\+\_\+multitask()}{test\_pyt\_multitask()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pyt\+\_\+multitask (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Unit test for ensuring that PytorchDataTeacher correctly handles multitasking.

This test will iterate through the following scenarios:
    1. 2 `pytorch_teacher_task`s
    2. 1 `pytorch_teacher_task`, 1 regular ParlAI task
    3. 1 `pytorch_teacher_task`, 1 `pytorch_teacher_dataset`
    4. 1 `pytorch_teacher_dataset`, 1 regular ParlAI task
    5. 2 `pytorch_teacher_dataset`s
\end{DoxyVerb}
 

Definition at line 412 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
412     \textcolor{keyword}{def }test\_pyt\_multitask(self):
413         \textcolor{stringliteral}{"""}
414 \textcolor{stringliteral}{        Unit test for ensuring that PytorchDataTeacher correctly handles multitasking.}
415 \textcolor{stringliteral}{}
416 \textcolor{stringliteral}{        This test will iterate through the following scenarios:}
417 \textcolor{stringliteral}{            1. 2 `pytorch\_teacher\_task`s}
418 \textcolor{stringliteral}{            2. 1 `pytorch\_teacher\_task`, 1 regular ParlAI task}
419 \textcolor{stringliteral}{            3. 1 `pytorch\_teacher\_task`, 1 `pytorch\_teacher\_dataset`}
420 \textcolor{stringliteral}{            4. 1 `pytorch\_teacher\_dataset`, 1 regular ParlAI task}
421 \textcolor{stringliteral}{            5. 2 `pytorch\_teacher\_dataset`s}
422 \textcolor{stringliteral}{        """}
423 
424         \textcolor{keyword}{def }run\_display\_test(defaults, ep\_and\_ex\_counts):
425             with testing\_utils.capture\_output() \textcolor{keyword}{as} f:
426                 parser = display\_setup\_args()
427                 parser.set\_defaults(**defaults)
428                 opt = parser.parse\_args()
429                 \hyperlink{namespacedisplay__data}{display\_data}(opt)
430             str\_output = f.getvalue()
431             self.assertTrue(
432                 \textcolor{stringliteral}{'[ loaded \{\} episodes with a total of \{\} examples ]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
433                     ep\_and\_ex\_counts[0], ep\_and\_ex\_counts[1]
434                 )
435                 \textcolor{keywordflow}{in} str\_output,
436                 \textcolor{stringliteral}{'PytorchDataTeacher multitasking failed with '}
437                 \textcolor{stringliteral}{'following args: \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(opt),
438             )
439 
440         \textcolor{comment}{# task; num eps; num exs}
441         task1 = \textcolor{stringliteral}{'babi:task1k:1'}  \textcolor{comment}{# 180, 900}
442         task2 = \textcolor{stringliteral}{'babi:task1k:2'}  \textcolor{comment}{# 180, 900}
443         dataset1 = \textcolor{stringliteral}{'integration\_tests'}  \textcolor{comment}{# 500, 500}
444         dataset2 = \textcolor{stringliteral}{'integration\_tests:NoCandidateTeacherDataset'}  \textcolor{comment}{# 500, 500}
445 
446         \textcolor{comment}{# Expected example and episode counts}
447         eps\_and\_exs\_counts = [
448             (1800, 1800),
449             (1080, 1800),
450             (1400, 1400),
451             (680, 1400),
452             (1000, 1000),
453         ]
454         defaults = integration\_test\_parser\_defaults.copy()
455 
456         \textcolor{comment}{# 1.}
457         defaults[\textcolor{stringliteral}{'pytorch\_teacher\_task'}] = \textcolor{stringliteral}{'\{\},\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(task1, task2)
458         run\_display\_test(defaults, eps\_and\_exs\_counts[0])
459 
460         \textcolor{comment}{# 2.}
461         defaults[\textcolor{stringliteral}{'pytorch\_teacher\_task'}] = task1
462         defaults[\textcolor{stringliteral}{'task'}] = task2
463         run\_display\_test(defaults, eps\_and\_exs\_counts[1])
464 
465         \textcolor{comment}{# 3.}
466         del defaults[\textcolor{stringliteral}{'task'}]
467         defaults[\textcolor{stringliteral}{'pytorch\_teacher\_dataset'}] = dataset1
468         run\_display\_test(defaults, eps\_and\_exs\_counts[2])
469 
470         \textcolor{comment}{# 4.}
471         del defaults[\textcolor{stringliteral}{'pytorch\_teacher\_task'}]
472         defaults[\textcolor{stringliteral}{'task'}] = task1
473         run\_display\_test(defaults, eps\_and\_exs\_counts[3])
474 
475         \textcolor{comment}{# 5.}
476         del defaults[\textcolor{stringliteral}{'task'}]
477         defaults[\textcolor{stringliteral}{'pytorch\_teacher\_dataset'}] = \textcolor{stringliteral}{'\{\},\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(dataset1, dataset2)
478         run\_display\_test(defaults, eps\_and\_exs\_counts[4])
479 
480 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_ad9d9065300215a4afeb0589192b5ba05}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_ad9d9065300215a4afeb0589192b5ba05}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pyt\+\_\+preprocess@{test\+\_\+pyt\+\_\+preprocess}}
\index{test\+\_\+pyt\+\_\+preprocess@{test\+\_\+pyt\+\_\+preprocess}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pyt\+\_\+preprocess()}{test\_pyt\_preprocess()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pyt\+\_\+preprocess (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Test that the preprocess functionality works with the PytorchDataTeacher with a
sample TorchAgent (here, the Seq2seq model).

This tests whether the action provided by the preprocessed teacher is equivalent
to the agent's observation after the agent processes it.
\end{DoxyVerb}
 

Definition at line 108 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
108     \textcolor{keyword}{def }test\_pyt\_preprocess(self):
109         \textcolor{stringliteral}{"""}
110 \textcolor{stringliteral}{        Test that the preprocess functionality works with the PytorchDataTeacher with a}
111 \textcolor{stringliteral}{        sample TorchAgent (here, the Seq2seq model).}
112 \textcolor{stringliteral}{}
113 \textcolor{stringliteral}{        This tests whether the action provided by the preprocessed teacher is equivalent}
114 \textcolor{stringliteral}{        to the agent's observation after the agent processes it.}
115 \textcolor{stringliteral}{        """}
116 
117         \textcolor{keyword}{def }get\_teacher\_act(defaults, teacher\_processed=False, agent\_to=None):
118             parser = train\_setup\_args()
119             parser.set\_defaults(**defaults)
120             opt = parser.parse\_args()
121             \hyperlink{namespacebuild__dict}{build\_dict}(opt)
122             with testing\_utils.capture\_output() \textcolor{keyword}{as} \_:
123                 teacher = \hyperlink{namespaceparlai_1_1core_1_1agents_a76269fb567532a8fb7f29edcc20a6e47}{create\_task\_agent\_from\_taskname}(opt)[0]
124             agent = \hyperlink{namespaceparlai_1_1core_1_1agents_a00d77a7e26fb89e8bd900f7b2a02982a}{create\_agent}(opt)
125             act = teacher.act()
126             \textcolor{keywordflow}{if} teacher\_processed:
127                 \textcolor{keywordflow}{return} act, agent
128             \textcolor{keywordflow}{return} agent.observe(act), agent
129 
130         with testing\_utils.capture\_output() \textcolor{keyword}{as} \_, testing\_utils.tempdir() \textcolor{keyword}{as} tmpdir:
131             defaults = unit\_test\_parser\_defaults.copy()
132             defaults[\textcolor{stringliteral}{'batch\_size'}] = 1
133             defaults[\textcolor{stringliteral}{'datatype'}] = \textcolor{stringliteral}{'train:stream:ordered'}
134 
135             \textcolor{comment}{# Get processed act from agent}
136             defaults[\textcolor{stringliteral}{'model\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model'})
137             defaults[\textcolor{stringliteral}{'dict\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model.dict'})
138             agent\_processed\_observation, agent1 = get\_teacher\_act(defaults)
139 
140             \textcolor{comment}{# Get preprocessed act from teacher}
141             defaults[\textcolor{stringliteral}{'model\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model'})
142             defaults[\textcolor{stringliteral}{'dict\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model.dict'})
143             defaults[\textcolor{stringliteral}{'pytorch\_preprocess'}] = \textcolor{keyword}{True}
144             teacher\_processed\_act, agent2 = get\_teacher\_act(
145                 defaults, teacher\_processed=\textcolor{keyword}{True}
146             )  \textcolor{comment}{# noqa: E501}
147 
148         \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} agent\_processed\_observation:
149             val1 = agent\_processed\_observation[key]
150             val2 = teacher\_processed\_act[key]
151             \textcolor{keywordflow}{if} isinstance(val1, torch.Tensor):
152                 self.assertTrue(
153                     \hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a6fc0c9b519a36f82b65bcd398f1fbb9d}{bool}(torch.all(torch.eq(val1, val2))),
154                     \textcolor{stringliteral}{'\{\} is not equal to \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(val1, val2),
155                 )
156             \textcolor{keywordflow}{else}:
157                 self.assertEqual(val1, val2)
158 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a3ba46374c7e9068827af1b90f35c832e}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a3ba46374c7e9068827af1b90f35c832e}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pyt\+\_\+preprocess\+\_\+train@{test\+\_\+pyt\+\_\+preprocess\+\_\+train}}
\index{test\+\_\+pyt\+\_\+preprocess\+\_\+train@{test\+\_\+pyt\+\_\+preprocess\+\_\+train}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pyt\+\_\+preprocess\+\_\+train()}{test\_pyt\_preprocess\_train()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pyt\+\_\+preprocess\+\_\+train (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Test that the preprocess functionality works with the PytorchDataTeacher with a
sample TorchAgent (here, the Seq2seq model).

This tests whether an agent can train to completion with these preprocessed
examples
\end{DoxyVerb}
 

Definition at line 319 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
319     \textcolor{keyword}{def }test\_pyt\_preprocess\_train(self):
320         \textcolor{stringliteral}{"""}
321 \textcolor{stringliteral}{        Test that the preprocess functionality works with the PytorchDataTeacher with a}
322 \textcolor{stringliteral}{        sample TorchAgent (here, the Seq2seq model).}
323 \textcolor{stringliteral}{}
324 \textcolor{stringliteral}{        This tests whether an agent can train to completion with these preprocessed}
325 \textcolor{stringliteral}{        examples}
326 \textcolor{stringliteral}{        """}
327         defaults = integration\_test\_parser\_defaults.copy()
328         defaults[\textcolor{stringliteral}{'datatype'}] = \textcolor{stringliteral}{'train'}
329         defaults[\textcolor{stringliteral}{'pytorch\_preprocess'}] = \textcolor{keyword}{True}
330         str\_output, valid, test = testing\_utils.train\_model(defaults)
331         self.assertTrue(
332             \hyperlink{namespacetests_1_1test__pytorch__data__teacher_a5511223c74b5eca00f42d68488ea101e}{solved\_task}(str\_output, valid, test),
333             \textcolor{stringliteral}{'Teacher could not teach seq2seq with preprocessed obs, output: \{\}'}.
      \hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
334                 str\_output
335             ),
336         )
337 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a4321d4b1619bf66a94146e811d869185}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a4321d4b1619bf66a94146e811d869185}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pyt\+\_\+train@{test\+\_\+pyt\+\_\+train}}
\index{test\+\_\+pyt\+\_\+train@{test\+\_\+pyt\+\_\+train}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pyt\+\_\+train()}{test\_pyt\_train()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pyt\+\_\+train (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 307 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
307     \textcolor{keyword}{def }test\_pyt\_train(self):
308         self.\_pyt\_train(\textcolor{stringliteral}{'train'})
309 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a3d14342d0d8a931821b223111e383d8e}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a3d14342d0d8a931821b223111e383d8e}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pyt\+\_\+train\+\_\+stream@{test\+\_\+pyt\+\_\+train\+\_\+stream}}
\index{test\+\_\+pyt\+\_\+train\+\_\+stream@{test\+\_\+pyt\+\_\+train\+\_\+stream}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pyt\+\_\+train\+\_\+stream()}{test\_pyt\_train\_stream()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pyt\+\_\+train\+\_\+stream (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 311 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
311     \textcolor{keyword}{def }test\_pyt\_train\_stream(self):
312         self.\_pyt\_train(\textcolor{stringliteral}{'train:stream'})
313 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a1ccb0839b1de7c220c5b53e73d4f9ae1}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a1ccb0839b1de7c220c5b53e73d4f9ae1}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pyt\+\_\+train\+\_\+stream\+\_\+ordered@{test\+\_\+pyt\+\_\+train\+\_\+stream\+\_\+ordered}}
\index{test\+\_\+pyt\+\_\+train\+\_\+stream\+\_\+ordered@{test\+\_\+pyt\+\_\+train\+\_\+stream\+\_\+ordered}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pyt\+\_\+train\+\_\+stream\+\_\+ordered()}{test\_pyt\_train\_stream\_ordered()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pyt\+\_\+train\+\_\+stream\+\_\+ordered (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 315 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
315     \textcolor{keyword}{def }test\_pyt\_train\_stream\_ordered(self):
316         self.\_pyt\_train(\textcolor{stringliteral}{'train:stream:ordered'})
317 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a3ff18909bd05956b4fa7970bc3c96afb}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a3ff18909bd05956b4fa7970bc3c96afb}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+pytd\+\_\+teacher@{test\+\_\+pytd\+\_\+teacher}}
\index{test\+\_\+pytd\+\_\+teacher@{test\+\_\+pytd\+\_\+teacher}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+pytd\+\_\+teacher()}{test\_pytd\_teacher()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+pytd\+\_\+teacher (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Test that the pytorch teacher works with given Pytorch Datasets as well.
\end{DoxyVerb}
 

Definition at line 372 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
372     \textcolor{keyword}{def }test\_pytd\_teacher(self):
373         \textcolor{stringliteral}{"""}
374 \textcolor{stringliteral}{        Test that the pytorch teacher works with given Pytorch Datasets as well.}
375 \textcolor{stringliteral}{        """}
376         defaults = integration\_test\_parser\_defaults.copy()
377         defaults[\textcolor{stringliteral}{'datatype'}] = \textcolor{stringliteral}{'train:stream'}
378         defaults[\textcolor{stringliteral}{'image\_mode'}] = \textcolor{stringliteral}{'ascii'}
379 
380         with testing\_utils.capture\_output():
381             \textcolor{comment}{# Get processed act from agent}
382             parser = display\_setup\_args()
383             defaults[\textcolor{stringliteral}{'pytorch\_teacher\_dataset'}] = \textcolor{stringliteral}{'integration\_tests'}
384             del defaults[\textcolor{stringliteral}{'pytorch\_teacher\_task'}]
385             parser.set\_defaults(**defaults)
386             opt = parser.parse\_args()
387             teacher = \hyperlink{namespaceparlai_1_1core_1_1agents_a76269fb567532a8fb7f29edcc20a6e47}{create\_task\_agent\_from\_taskname}(opt)[0]
388             pytorch\_teacher\_act = teacher.act()
389 
390             parser = display\_setup\_args()
391             defaults[\textcolor{stringliteral}{'task'}] = \textcolor{stringliteral}{'integration\_tests'}
392             del defaults[\textcolor{stringliteral}{'pytorch\_teacher\_dataset'}]
393             parser.set\_defaults(**defaults)
394             opt = parser.parse\_args()
395             teacher = \hyperlink{namespaceparlai_1_1core_1_1agents_a76269fb567532a8fb7f29edcc20a6e47}{create\_task\_agent\_from\_taskname}(opt)[0]
396             regular\_teacher\_act = teacher.act()
397 
398         keys = set(pytorch\_teacher\_act.keys()).intersection(
399             set(regular\_teacher\_act.keys())
400         )
401         self.assertTrue(len(keys) != 0)
402         \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} keys:
403             self.assertTrue(
404                 pytorch\_teacher\_act[key] == regular\_teacher\_act[key],
405                 \textcolor{stringliteral}{'PytorchDataTeacher does not have the same value '}
406                 \textcolor{stringliteral}{'as regular teacher for act key: \{\}. '}
407                 \textcolor{stringliteral}{'Values: \{\}; \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
408                     key, pytorch\_teacher\_act[key], regular\_teacher\_act[key]
409                 ),
410             )
411 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_aaecd01e211d3e5b0c87f58da6c9b3def}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_aaecd01e211d3e5b0c87f58da6c9b3def}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+shuffle@{test\+\_\+shuffle}}
\index{test\+\_\+shuffle@{test\+\_\+shuffle}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+shuffle()}{test\_shuffle()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+shuffle (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Simple test to ensure that dataloader is initialized with correct data sampler.
\end{DoxyVerb}
 

Definition at line 69 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
69     \textcolor{keyword}{def }test\_shuffle(self):
70         \textcolor{stringliteral}{"""}
71 \textcolor{stringliteral}{        Simple test to ensure that dataloader is initialized with correct data sampler.}
72 \textcolor{stringliteral}{        """}
73         dts = [\textcolor{stringliteral}{'train'}, \textcolor{stringliteral}{'valid'}, \textcolor{stringliteral}{'test'}]
74         exts = [\textcolor{stringliteral}{''}, \textcolor{stringliteral}{':stream'}, \textcolor{stringliteral}{':ordered'}, \textcolor{stringliteral}{':stream:ordered'}]
75         shuffle\_opts = [\textcolor{keyword}{False}, \textcolor{keyword}{True}]
76         task = \textcolor{stringliteral}{'babi:task1k:1'}
77         \textcolor{keywordflow}{for} dt \textcolor{keywordflow}{in} dts:
78             \textcolor{keywordflow}{for} ext \textcolor{keywordflow}{in} exts:
79                 datatype = dt + ext
80                 \textcolor{keywordflow}{for} shuffle \textcolor{keywordflow}{in} shuffle\_opts:
81                     opt\_defaults = \{
82                         \textcolor{stringliteral}{'pytorch\_teacher\_task'}: task,
83                         \textcolor{stringliteral}{'datatype'}: datatype,
84                         \textcolor{stringliteral}{'shuffle'}: shuffle,
85                     \}
86                     with testing\_utils.capture\_output() \textcolor{keyword}{as} \_:
87                         parser = display\_setup\_args()
88                         parser.set\_defaults(**opt\_defaults)
89                         opt = parser.parse\_args()
90                         teacher = \hyperlink{namespaceparlai_1_1core_1_1agents_a76269fb567532a8fb7f29edcc20a6e47}{create\_task\_agent\_from\_taskname}(opt)[0]
91                         \textcolor{keywordflow}{if} (
92                             \textcolor{stringliteral}{'ordered'} \textcolor{keywordflow}{in} datatype
93                             \textcolor{keywordflow}{or} (\textcolor{stringliteral}{'stream'} \textcolor{keywordflow}{in} datatype \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} opt.get(\textcolor{stringliteral}{'shuffle'}))
94                             \textcolor{keywordflow}{or} \textcolor{stringliteral}{'train'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} datatype
95                         ):
96                             self.assertIsInstance(
97                                 teacher.pytorch\_dataloader.sampler,
98                                 Sequential,
99                                 \textcolor{stringliteral}{'PytorchDataTeacher failed with args: \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(opt),
100                             )
101                         \textcolor{keywordflow}{else}:
102                             self.assertIsInstance(
103                                 teacher.pytorch\_dataloader.sampler,
104                                 RandomSampler,
105                                 \textcolor{stringliteral}{'PytorchDataTeacher failed with args: \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(opt),
106                             )
107 
\end{DoxyCode}
\mbox{\Hypertarget{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a2c83da3833b551a1e15e6cec4a8589eb}\label{classtests_1_1test__pytorch__data__teacher_1_1TestPytorchDataTeacher_a2c83da3833b551a1e15e6cec4a8589eb}} 
\index{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}!test\+\_\+valid\+\_\+pyt\+\_\+batchsort@{test\+\_\+valid\+\_\+pyt\+\_\+batchsort}}
\index{test\+\_\+valid\+\_\+pyt\+\_\+batchsort@{test\+\_\+valid\+\_\+pyt\+\_\+batchsort}!tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher@{tests\+::test\+\_\+pytorch\+\_\+data\+\_\+teacher\+::\+Test\+Pytorch\+Data\+Teacher}}
\subsubsection{\texorpdfstring{test\+\_\+valid\+\_\+pyt\+\_\+batchsort()}{test\_valid\_pyt\_batchsort()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+Test\+Pytorch\+Data\+Teacher.\+test\+\_\+valid\+\_\+pyt\+\_\+batchsort (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Tests that batchsort *works* for two epochs; that is, that every example is seen
both epochs.
\end{DoxyVerb}
 

Definition at line 159 of file test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py.


\begin{DoxyCode}
159     \textcolor{keyword}{def }test\_valid\_pyt\_batchsort(self):
160         \textcolor{stringliteral}{"""}
161 \textcolor{stringliteral}{        Tests that batchsort *works* for two epochs; that is, that every example is seen}
162 \textcolor{stringliteral}{        both epochs.}
163 \textcolor{stringliteral}{        """}
164         parser = train\_setup\_args()
165 
166         \textcolor{keyword}{def }get\_acts\_epochs\_1\_and\_2(defaults):
167             parser.set\_defaults(**defaults)
168             opt = parser.parse\_args()
169             \hyperlink{namespacebuild__dict}{build\_dict}(opt)
170             agent = \hyperlink{namespaceparlai_1_1core_1_1agents_a00d77a7e26fb89e8bd900f7b2a02982a}{create\_agent}(opt)
171             world\_data = \hyperlink{namespaceparlai_1_1core_1_1worlds_a79969c7ba76d4b3c500f5bb776444dc6}{create\_task}(opt, agent)
172             acts\_epoch\_1 = []
173             acts\_epoch\_2 = []
174             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world\_data.epoch\_done():
175                 world\_data.parley()
176                 acts\_epoch\_1.append(world\_data.acts[0])
177             world\_data.reset()
178             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world\_data.epoch\_done():
179                 world\_data.parley()
180                 acts\_epoch\_2.append(world\_data.acts[0])
181             acts\_epoch\_1 = [bb \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} acts\_epoch\_1 \textcolor{keywordflow}{for} bb \textcolor{keywordflow}{in} b]
182             acts\_epoch\_1 = sorted(
183                 [b \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} acts\_epoch\_1 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'text'} \textcolor{keywordflow}{in} b], key=\textcolor{keyword}{lambda} x: x.get(\textcolor{stringliteral}{'text'})
184             )
185             acts\_epoch\_2 = [bb \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} acts\_epoch\_2 \textcolor{keywordflow}{for} bb \textcolor{keywordflow}{in} b]
186             acts\_epoch\_2 = sorted(
187                 [b \textcolor{keywordflow}{for} b \textcolor{keywordflow}{in} acts\_epoch\_2 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'text'} \textcolor{keywordflow}{in} b], key=\textcolor{keyword}{lambda} x: x.get(\textcolor{stringliteral}{'text'})
188             )
189             world\_data.shutdown()
190             \textcolor{keywordflow}{return} acts\_epoch\_1, acts\_epoch\_2
191 
192         \textcolor{keyword}{def }check\_equal\_act\_lists(acts1, acts2):
193             \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range(len(acts1)):
194                 act1 = acts1[idx]
195                 act2 = acts2[idx]
196                 \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} act1:
197                     val1 = act1[key]
198                     val2 = act2[key]
199                     \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(val1) \textcolor{keywordflow}{is} torch.Tensor:
200                         self.assertTrue(\hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a6fc0c9b519a36f82b65bcd398f1fbb9d}{bool}(torch.all(torch.eq(val1, val2))))
201                     \textcolor{keywordflow}{else}:
202                         self.assertEqual(val1, val2)
203 
204         \textcolor{comment}{# First, check that batchsort itself works}
205         defaults = unit\_test\_parser\_defaults.copy()
206         defaults[\textcolor{stringliteral}{'datatype'}] = \textcolor{stringliteral}{'train:stream:ordered'}
207         defaults[\textcolor{stringliteral}{'pytorch\_teacher\_batch\_sort'}] = \textcolor{keyword}{True}
208 
209         with testing\_utils.capture\_output() \textcolor{keyword}{as} \_, testing\_utils.tempdir() \textcolor{keyword}{as} tmpdir:
210             \textcolor{comment}{# Get processed act from agent}
211             defaults[\textcolor{stringliteral}{'pytorch\_teacher\_task'}] = \textcolor{stringliteral}{'babi:task1k:1'}
212             defaults[\textcolor{stringliteral}{'batch\_sort\_cache\_type'}] = \textcolor{stringliteral}{'index'}
213             defaults[\textcolor{stringliteral}{'batchsize'}] = 50
214             defaults[\textcolor{stringliteral}{'model\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model'})
215             defaults[\textcolor{stringliteral}{'dict\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model.dict'})
216             bsrt\_acts\_ep1, bsrt\_acts\_ep2 = get\_acts\_epochs\_1\_and\_2(defaults)
217 
218             defaults[\textcolor{stringliteral}{'pytorch\_teacher\_batch\_sort'}] = \textcolor{keyword}{False}
219             defaults[\textcolor{stringliteral}{'model\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model'})
220             defaults[\textcolor{stringliteral}{'dict\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model.dict'})
221             no\_bsrt\_acts\_ep1, no\_bsrt\_acts\_ep2 = get\_acts\_epochs\_1\_and\_2(defaults)
222 
223         check\_equal\_act\_lists(bsrt\_acts\_ep1, no\_bsrt\_acts\_ep1)
224         check\_equal\_act\_lists(bsrt\_acts\_ep2, no\_bsrt\_acts\_ep2)
225 
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
tests/\hyperlink{test__pytorch__data__teacher_8py}{test\+\_\+pytorch\+\_\+data\+\_\+teacher.\+py}\end{DoxyCompactItemize}
