\hypertarget{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent}{}\section{projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Object\+Checklist\+Model\+Agent Class Reference}
\label{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent}\index{projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Object\+Checklist\+Model\+Agent@{projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Object\+Checklist\+Model\+Agent}}


Inheritance diagram for projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Object\+Checklist\+Model\+Agent\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=287pt]{d8/d37/classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Object\+Checklist\+Model\+Agent\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=287pt]{d9/d96/classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent_aa54d6ccd6b88786071d941fa4ba2a1dc}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classparlai_1_1core_1_1agents_1_1Agent_ab3b45d2754244608c75d4068b90cd051}{opt}, shared=None, \hyperlink{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ModelAgentBase_a229b7901e20dced7e3b3c3e2d381d2ce}{data\+\_\+agent}=None)
\item 
def \hyperlink{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent_ac00137901ca02a46981f5f336118cc57}{batch\+\_\+act} (self, observations)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent_aa4c50088e9793fe54328db6884d0ce9b}{model}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 541 of file agents.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent_aa54d6ccd6b88786071d941fa4ba2a1dc}\label{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent_aa54d6ccd6b88786071d941fa4ba2a1dc}} 
\index{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Object\+Checklist\+Model\+Agent.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None},  }\item[{}]{data\+\_\+agent = {\ttfamily None} }\end{DoxyParamCaption})}



Definition at line 542 of file agents.\+py.


\begin{DoxyCode}
542     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None, data\_agent=None):
543         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} shared:
544             self.model = ObjectChecklistModel(opt, data\_agent)
545         super().\_\_init\_\_(opt, shared, data\_agent)
546 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent_ac00137901ca02a46981f5f336118cc57}\label{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent_ac00137901ca02a46981f5f336118cc57}} 
\index{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent}!batch\+\_\+act@{batch\+\_\+act}}
\index{batch\+\_\+act@{batch\+\_\+act}!projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent}}
\subsubsection{\texorpdfstring{batch\+\_\+act()}{batch\_act()}}
{\footnotesize\ttfamily def projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Object\+Checklist\+Model\+Agent.\+batch\+\_\+act (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observations }\end{DoxyParamCaption})}



Definition at line 547 of file agents.\+py.


\begin{DoxyCode}
547     \textcolor{keyword}{def }batch\_act(self, observations):
548         ori\_len = len(observations)
549         observations = [obv \textcolor{keywordflow}{for} obv \textcolor{keywordflow}{in} observations \textcolor{keywordflow}{if} \textcolor{stringliteral}{'text'} \textcolor{keywordflow}{in} obv]
550         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'datatype'}] == \textcolor{stringliteral}{'train'} \textcolor{keywordflow}{or} self.opt[\textcolor{stringliteral}{'datatype'}] == \textcolor{stringliteral}{'pretrain'}:
551             (
552                 x,
553                 action\_key,
554                 second\_action\_key,
555                 action\_type,
556                 current\_room,
557                 checked,
558                 y,
559                 y\_mask,
560                 counter\_feat,
561             ) = self.data\_agent.get\_data(observations)
562             (
563                 x,
564                 action\_key,
565                 second\_action\_key,
566                 action\_type,
567                 current\_room,
568                 checked,
569                 y,
570                 y\_mask,
571                 counter\_feat,
572             ) = (
573                 self.\_get\_variable(x),
574                 self.\_get\_variable(action\_key),
575                 self.\_get\_variable(second\_action\_key),
576                 self.\_get\_variable(action\_type),
577                 self.\_get\_variable(current\_room),
578                 self.\_get\_variable(checked),
579                 self.\_get\_variable(y),
580                 self.\_get\_variable(y\_mask),
581                 self.\_get\_variable(counter\_feat),
582             )
583 
584             loss = self.model.forward\_loss(
585                 x,
586                 action\_key,
587                 second\_action\_key,
588                 action\_type,
589                 current\_room,
590                 checked,
591                 y,
592                 y\_mask,
593                 counter\_feat,
594             )
595             self.optimizer.zero\_grad()
596             loss.backward()
597             self.optimizer.step()
598 
599             reply = [\{\textcolor{stringliteral}{'loss'}: loss.data[0]\} \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(ori\_len)]
600             \textcolor{keywordflow}{return} reply
601         \textcolor{keywordflow}{else}:
602             (
603                 x,
604                 action\_key,
605                 second\_action\_key,
606                 action\_type,
607                 current\_room,
608                 checked,
609                 y,
610                 y\_mask,
611                 counter\_feat,
612             ) = self.data\_agent.get\_data(observations, \textcolor{stringliteral}{'valid'})
613             (
614                 x,
615                 action\_key,
616                 second\_action\_key,
617                 action\_type,
618                 current\_room,
619                 checked,
620                 y,
621                 y\_mask,
622                 counter\_feat,
623             ) = (
624                 self.\_get\_variable(x, \textcolor{keyword}{True}),
625                 self.\_get\_variable(action\_key, \textcolor{keyword}{True}),
626                 self.\_get\_variable(second\_action\_key, \textcolor{keyword}{True}),
627                 self.\_get\_variable(action\_type, \textcolor{keyword}{True}),
628                 self.\_get\_variable(current\_room, \textcolor{keyword}{True}),
629                 self.\_get\_variable(checked, \textcolor{keyword}{True}),
630                 self.\_get\_variable(y, \textcolor{keyword}{True}),
631                 self.\_get\_variable(y\_mask, \textcolor{keyword}{True}),
632                 self.\_get\_variable(counter\_feat),
633             )
634 
635             loss = self.model.forward\_loss(
636                 x,
637                 action\_key,
638                 second\_action\_key,
639                 action\_type,
640                 current\_room,
641                 checked,
642                 y,
643                 y\_mask,
644                 counter\_feat,
645                 \textcolor{keyword}{False},
646             )
647             reply = [
648                 \{
649                     \textcolor{stringliteral}{'loss'}: 0.0,
650                     \textcolor{stringliteral}{'cnt'}: 0.0,
651                     \textcolor{stringliteral}{'acc'}: 0,
652                     \textcolor{stringliteral}{'len'}: 0,
653                     \textcolor{stringliteral}{'f1'}: 0,
654                     \textcolor{stringliteral}{'correct\_data'}: [],
655                     \textcolor{stringliteral}{'wrong\_data'}: [],
656                 \}
657                 \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(ori\_len)
658             ]
659 
660             check\_mapping = self.data\_agent.get\_check\_mapping()
661             check\_mapping = self.\_get\_variable(check\_mapping, \textcolor{keyword}{True})
662             text\_out = self.model.forward\_predict(
663                 x,
664                 action\_key,
665                 second\_action\_key,
666                 action\_type,
667                 check\_mapping,
668                 checked,
669                 [obv[\textcolor{stringliteral}{'graph'}] \textcolor{keywordflow}{for} obv \textcolor{keywordflow}{in} observations],
670                 self.data\_agent,
671             )
672 
673             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(observations)):
674                 data\_rep = \textcolor{stringliteral}{'\{\} ||| \{\} ||| \{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
675                     observations[i][\textcolor{stringliteral}{'actions'}],
676                     \textcolor{stringliteral}{' '}.join(text\_out[i][:-1]),
677                     observations[i][\textcolor{stringliteral}{'text'}],
678                 )
679 
680                 graph\_a, graph\_b = (
681                     observations[i][\textcolor{stringliteral}{'graph'}].copy(),
682                     observations[i][\textcolor{stringliteral}{'graph'}].copy(),
683                 )
684                 graph\_a.parse\_exec(observations[i][\textcolor{stringliteral}{'actions'}])
685                 graph\_b.parse\_exec(\textcolor{stringliteral}{' '}.join(text\_out[i][:-1]))
686                 \textcolor{keywordflow}{if} graph\_a == graph\_b:
687                     reply[i][\textcolor{stringliteral}{'acc'}] = 1.0
688                     reply[i][\textcolor{stringliteral}{'correct\_data'}].append(data\_rep)
689                 \textcolor{keywordflow}{else}:
690                     reply[i][\textcolor{stringliteral}{'wrong\_data'}].append(data\_rep)
691 
692                 inst, symb\_points = observations[i][\textcolor{stringliteral}{'graph'}].parse(
693                     observations[i][\textcolor{stringliteral}{'actions'}]
694                 )
695                 text\_gt = []
696                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(len(symb\_points) - 1):
697                     k, l = symb\_points[j], symb\_points[j + 1]
698                     text\_gt.append(\textcolor{stringliteral}{' '}.join(inst[k:l]))
699                 reply[i][\textcolor{stringliteral}{'f1'}] = self.\_get\_f1(text\_gt, text\_out[i])
700 
701                 reply[i][\textcolor{stringliteral}{'loss'}] = loss.data[0]
702                 reply[i][\textcolor{stringliteral}{'cnt'}] = observations[i][\textcolor{stringliteral}{'weight'}]
703                 reply[i][\textcolor{stringliteral}{'len'}] = len(text\_gt)
704 
705             \textcolor{keywordflow}{return} reply
706 
707 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent_aa4c50088e9793fe54328db6884d0ce9b}\label{classprojects_1_1mastering__the__dungeon_1_1agents_1_1graph__world2_1_1agents_1_1ObjectChecklistModelAgent_aa4c50088e9793fe54328db6884d0ce9b}} 
\index{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent}!model@{model}}
\index{model@{model}!projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent@{projects\+::mastering\+\_\+the\+\_\+dungeon\+::agents\+::graph\+\_\+world2\+::agents\+::\+Object\+Checklist\+Model\+Agent}}
\subsubsection{\texorpdfstring{model}{model}}
{\footnotesize\ttfamily projects.\+mastering\+\_\+the\+\_\+dungeon.\+agents.\+graph\+\_\+world2.\+agents.\+Object\+Checklist\+Model\+Agent.\+model}



Definition at line 544 of file agents.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
projects/mastering\+\_\+the\+\_\+dungeon/agents/graph\+\_\+world2/\hyperlink{projects_2mastering__the__dungeon_2agents_2graph__world2_2agents_8py}{agents.\+py}\end{DoxyCompactItemize}
