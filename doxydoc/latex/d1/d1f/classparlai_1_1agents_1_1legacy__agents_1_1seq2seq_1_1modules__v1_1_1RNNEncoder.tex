\hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder}{}\section{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder Class Reference}
\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder}\index{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder@{parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder}}


Inheritance diagram for parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=211pt]{de/d13/classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=211pt]{d9/d70/classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_aafb69318c92833972f488753adef1744}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, num\+\_\+features, embeddingsize, hiddensize, padding\+\_\+idx=0, rnn\+\_\+class=\textquotesingle{}lstm\textquotesingle{}, numlayers=2, \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ad59badf670e68ba07b45c64ebfe37e60}{dropout}=0.\+1, bidirectional=False, shared\+\_\+lt=None, shared\+\_\+rnn=None, \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a664f83de3352bde9174536d1110aadc2}{input\+\_\+dropout}=0, unknown\+\_\+idx=None, sparse=False)
\item 
def \hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ab9ab650f24d8ba6407261418f480a8f5}{forward} (self, xs)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ad59badf670e68ba07b45c64ebfe37e60}{dropout}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a8cbcdf6992bb7896b731109864175b71}{layers}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ada15894988a4d904594a3ae557bb16a2}{dirs}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a8af3653af51cd62f0013179b1aa36f7e}{hsz}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a664f83de3352bde9174536d1110aadc2}{input\+\_\+dropout}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ad77068933e13b30b42ebd337d3f62495}{lt}
\item 
\hyperlink{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a7316b7df38ef0e139b65407ff201e7ba}{rnn}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}RNN Encoder.
\end{DoxyVerb}
 

Definition at line 412 of file modules\+\_\+v1.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_aafb69318c92833972f488753adef1744}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_aafb69318c92833972f488753adef1744}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{num\+\_\+features,  }\item[{}]{embeddingsize,  }\item[{}]{hiddensize,  }\item[{}]{padding\+\_\+idx = {\ttfamily 0},  }\item[{}]{rnn\+\_\+class = {\ttfamily \textquotesingle{}lstm\textquotesingle{}},  }\item[{}]{numlayers = {\ttfamily 2},  }\item[{}]{dropout = {\ttfamily 0.1},  }\item[{}]{bidirectional = {\ttfamily False},  }\item[{}]{shared\+\_\+lt = {\ttfamily None},  }\item[{}]{shared\+\_\+rnn = {\ttfamily None},  }\item[{}]{input\+\_\+dropout = {\ttfamily 0},  }\item[{}]{unknown\+\_\+idx = {\ttfamily None},  }\item[{}]{sparse = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Initialize recurrent encoder.
\end{DoxyVerb}
 

Definition at line 432 of file modules\+\_\+v1.\+py.


\begin{DoxyCode}
432     ):
433         \textcolor{stringliteral}{"""}
434 \textcolor{stringliteral}{        Initialize recurrent encoder.}
435 \textcolor{stringliteral}{        """}
436         super().\_\_init\_\_()
437 
438         self.dropout = nn.Dropout(p=dropout)
439         self.layers = numlayers
440         self.dirs = 2 \textcolor{keywordflow}{if} bidirectional \textcolor{keywordflow}{else} 1
441         self.hsz = hiddensize
442 
443         \textcolor{keywordflow}{if} input\_dropout > 0 \textcolor{keywordflow}{and} unknown\_idx \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
444             \textcolor{keywordflow}{raise} RuntimeError(\textcolor{stringliteral}{'input\_dropout > 0 but unknown\_idx not set'})
445         self.input\_dropout = UnknownDropout(unknown\_idx, input\_dropout)
446 
447         \textcolor{keywordflow}{if} shared\_lt \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
448             self.lt = nn.Embedding(
449                 num\_features, embeddingsize, padding\_idx=padding\_idx, sparse=sparse
450             )
451         \textcolor{keywordflow}{else}:
452             self.lt = shared\_lt
453 
454         \textcolor{keywordflow}{if} shared\_rnn \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
455             self.rnn = \hyperlink{namespaceseq2seq_1_1train_a1b062073c766f1d34a67f572ef256ba0}{rnn\_class}(
456                 embeddingsize,
457                 hiddensize,
458                 numlayers,
459                 dropout=dropout \textcolor{keywordflow}{if} numlayers > 1 \textcolor{keywordflow}{else} 0,
460                 batch\_first=\textcolor{keyword}{True},
461                 bidirectional=bidirectional,
462             )
463         \textcolor{keywordflow}{elif} bidirectional:
464             \textcolor{keywordflow}{raise} RuntimeError(\textcolor{stringliteral}{'Cannot share decoder with bidir encoder.'})
465         \textcolor{keywordflow}{else}:
466             self.rnn = shared\_rnn
467 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ab9ab650f24d8ba6407261418f480a8f5}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ab9ab650f24d8ba6407261418f480a8f5}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}!forward@{forward}}
\index{forward@{forward}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{forward()}{forward()}}
{\footnotesize\ttfamily def parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder.\+forward (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{xs }\end{DoxyParamCaption})}

\begin{DoxyVerb}Encode sequence.

:param xs: (bsz x seqlen) LongTensor of input token indices

:returns: encoder outputs, hidden state, attention mask
    encoder outputs are the output state at each step of the encoding.
    the hidden state is the final hidden state of the encoder.
    the attention mask is a mask of which input values are nonzero.
\end{DoxyVerb}
 

Definition at line 468 of file modules\+\_\+v1.\+py.


\begin{DoxyCode}
468     \textcolor{keyword}{def }forward(self, xs):
469         \textcolor{stringliteral}{"""}
470 \textcolor{stringliteral}{        Encode sequence.}
471 \textcolor{stringliteral}{}
472 \textcolor{stringliteral}{        :param xs: (bsz x seqlen) LongTensor of input token indices}
473 \textcolor{stringliteral}{}
474 \textcolor{stringliteral}{        :returns: encoder outputs, hidden state, attention mask}
475 \textcolor{stringliteral}{            encoder outputs are the output state at each step of the encoding.}
476 \textcolor{stringliteral}{            the hidden state is the final hidden state of the encoder.}
477 \textcolor{stringliteral}{            the attention mask is a mask of which input values are nonzero.}
478 \textcolor{stringliteral}{        """}
479         bsz = len(xs)
480 
481         \textcolor{comment}{# embed input tokens}
482         xs = self.input\_dropout(xs)
483         xes = self.dropout(self.lt(xs))
484         attn\_mask = xs.ne(0)
485         \textcolor{keywordflow}{try}:
486             x\_lens = torch.sum(attn\_mask.int(), dim=1)
487             xes = pack\_padded\_sequence(xes, x\_lens, batch\_first=\textcolor{keyword}{True})
488             packed = \textcolor{keyword}{True}
489         \textcolor{keywordflow}{except} ValueError:
490             \textcolor{comment}{# packing failed, don't pack then}
491             packed = \textcolor{keyword}{False}
492 
493         encoder\_output, hidden = self.rnn(xes)
494         \textcolor{keywordflow}{if} packed:
495             encoder\_output, \_ = pad\_packed\_sequence(encoder\_output, batch\_first=\textcolor{keyword}{True})
496         \textcolor{keywordflow}{if} self.dirs > 1:
497             \textcolor{comment}{# project to decoder dimension by taking sum of forward and back}
498             \textcolor{keywordflow}{if} isinstance(self.rnn, nn.LSTM):
499                 hidden = (
500                     hidden[0].view(-1, self.dirs, bsz, self.hsz).sum(1),
501                     hidden[1].view(-1, self.dirs, bsz, self.hsz).sum(1),
502                 )
503             \textcolor{keywordflow}{else}:
504                 hidden = hidden.view(-1, self.dirs, bsz, self.hsz).sum(1)
505 
506         \textcolor{keywordflow}{return} encoder\_output, hidden, attn\_mask
507 
508 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ada15894988a4d904594a3ae557bb16a2}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ada15894988a4d904594a3ae557bb16a2}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}!dirs@{dirs}}
\index{dirs@{dirs}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{dirs}{dirs}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder.\+dirs}



Definition at line 440 of file modules\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ad59badf670e68ba07b45c64ebfe37e60}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ad59badf670e68ba07b45c64ebfe37e60}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}!dropout@{dropout}}
\index{dropout@{dropout}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{dropout}{dropout}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder.\+dropout}



Definition at line 438 of file modules\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a8af3653af51cd62f0013179b1aa36f7e}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a8af3653af51cd62f0013179b1aa36f7e}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}!hsz@{hsz}}
\index{hsz@{hsz}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{hsz}{hsz}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder.\+hsz}



Definition at line 441 of file modules\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a664f83de3352bde9174536d1110aadc2}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a664f83de3352bde9174536d1110aadc2}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}!input\+\_\+dropout@{input\+\_\+dropout}}
\index{input\+\_\+dropout@{input\+\_\+dropout}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{input\+\_\+dropout}{input\_dropout}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder.\+input\+\_\+dropout}



Definition at line 445 of file modules\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a8cbcdf6992bb7896b731109864175b71}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a8cbcdf6992bb7896b731109864175b71}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}!layers@{layers}}
\index{layers@{layers}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{layers}{layers}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder.\+layers}



Definition at line 439 of file modules\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ad77068933e13b30b42ebd337d3f62495}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_ad77068933e13b30b42ebd337d3f62495}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}!lt@{lt}}
\index{lt@{lt}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{lt}{lt}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder.\+lt}



Definition at line 448 of file modules\+\_\+v1.\+py.

\mbox{\Hypertarget{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a7316b7df38ef0e139b65407ff201e7ba}\label{classparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1modules__v1_1_1RNNEncoder_a7316b7df38ef0e139b65407ff201e7ba}} 
\index{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}!rnn@{rnn}}
\index{rnn@{rnn}!parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder@{parlai\+::agents\+::legacy\+\_\+agents\+::seq2seq\+::modules\+\_\+v1\+::\+R\+N\+N\+Encoder}}
\subsubsection{\texorpdfstring{rnn}{rnn}}
{\footnotesize\ttfamily parlai.\+agents.\+legacy\+\_\+agents.\+seq2seq.\+modules\+\_\+v1.\+R\+N\+N\+Encoder.\+rnn}



Definition at line 455 of file modules\+\_\+v1.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
parlai/agents/legacy\+\_\+agents/seq2seq/\hyperlink{modules__v1_8py}{modules\+\_\+v1.\+py}\end{DoxyCompactItemize}
