\hypertarget{classtests_1_1test__tra_1_1TestPolyRanker}{}\section{tests.\+test\+\_\+tra.\+Test\+Poly\+Ranker Class Reference}
\label{classtests_1_1test__tra_1_1TestPolyRanker}\index{tests.\+test\+\_\+tra.\+Test\+Poly\+Ranker@{tests.\+test\+\_\+tra.\+Test\+Poly\+Ranker}}


Inheritance diagram for tests.\+test\+\_\+tra.\+Test\+Poly\+Ranker\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=228pt]{df/dfc/classtests_1_1test__tra_1_1TestPolyRanker__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for tests.\+test\+\_\+tra.\+Test\+Poly\+Ranker\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=228pt]{d8/d97/classtests_1_1test__tra_1_1TestPolyRanker__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classtests_1_1test__tra_1_1TestPolyRanker_ae89dfeba6d9dab6d40cfed102ff26294}{test\+\_\+eval\+\_\+fixed\+\_\+label\+\_\+not\+\_\+in\+\_\+cands} (self)
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 211 of file test\+\_\+tra.\+py.



\subsection{Member Function Documentation}
\mbox{\Hypertarget{classtests_1_1test__tra_1_1TestPolyRanker_ae89dfeba6d9dab6d40cfed102ff26294}\label{classtests_1_1test__tra_1_1TestPolyRanker_ae89dfeba6d9dab6d40cfed102ff26294}} 
\index{tests\+::test\+\_\+tra\+::\+Test\+Poly\+Ranker@{tests\+::test\+\_\+tra\+::\+Test\+Poly\+Ranker}!test\+\_\+eval\+\_\+fixed\+\_\+label\+\_\+not\+\_\+in\+\_\+cands@{test\+\_\+eval\+\_\+fixed\+\_\+label\+\_\+not\+\_\+in\+\_\+cands}}
\index{test\+\_\+eval\+\_\+fixed\+\_\+label\+\_\+not\+\_\+in\+\_\+cands@{test\+\_\+eval\+\_\+fixed\+\_\+label\+\_\+not\+\_\+in\+\_\+cands}!tests\+::test\+\_\+tra\+::\+Test\+Poly\+Ranker@{tests\+::test\+\_\+tra\+::\+Test\+Poly\+Ranker}}
\subsubsection{\texorpdfstring{test\+\_\+eval\+\_\+fixed\+\_\+label\+\_\+not\+\_\+in\+\_\+cands()}{test\_eval\_fixed\_label\_not\_in\_cands()}}
{\footnotesize\ttfamily def tests.\+test\+\_\+tra.\+Test\+Poly\+Ranker.\+test\+\_\+eval\+\_\+fixed\+\_\+label\+\_\+not\+\_\+in\+\_\+cands (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 228 of file test\+\_\+tra.\+py.


\begin{DoxyCode}
228     \textcolor{keyword}{def }test\_eval\_fixed\_label\_not\_in\_cands(self):
229         \textcolor{comment}{# test where cands during eval do not contain test label}
230         args = self.\_get\_args()
231         args[
232             \textcolor{stringliteral}{'model'}
233         ] = \textcolor{stringliteral}{'parlai.agents.transformer.polyencoder:IRFriendlyPolyencoderAgent'}
234         args[\textcolor{stringliteral}{'eval\_candidates'}] = \textcolor{stringliteral}{'fixed'}
235 
236         teacher = CandidateTeacher(\{\textcolor{stringliteral}{'datatype'}: \textcolor{stringliteral}{'train'}\})
237         all\_cands = teacher.train + teacher.val + teacher.test
238         train\_val\_cands = teacher.train + teacher.val
239         all\_cands\_str = \textcolor{stringliteral}{'\(\backslash\)n'}.join([\textcolor{stringliteral}{' '}.join(x) \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} all\_cands])
240         train\_val\_cands\_str = \textcolor{stringliteral}{'\(\backslash\)n'}.join([\textcolor{stringliteral}{' '}.join(x) \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} train\_val\_cands])
241 
242         with testing\_utils.tempdir() \textcolor{keyword}{as} tmpdir:
243             tmp\_cands\_file = os.path.join(tmpdir, \textcolor{stringliteral}{'all\_cands.text'})
244             with open(tmp\_cands\_file, \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} f:
245                 f.write(all\_cands\_str)
246             tmp\_train\_val\_cands\_file = os.path.join(tmpdir, \textcolor{stringliteral}{'train\_val\_cands.text'})
247             with open(tmp\_train\_val\_cands\_file, \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} f:
248                 f.write(train\_val\_cands\_str)
249             args[\textcolor{stringliteral}{'fixed\_candidates\_path'}] = tmp\_cands\_file
250             args[\textcolor{stringliteral}{'encode\_candidate\_vecs'}] = \textcolor{keyword}{False}  \textcolor{comment}{# don't encode before training}
251             args[\textcolor{stringliteral}{'ignore\_bad\_candidates'}] = \textcolor{keyword}{False}
252             args[\textcolor{stringliteral}{'model\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model'})
253             args[\textcolor{stringliteral}{'dict\_file'}] = os.path.join(tmpdir, \textcolor{stringliteral}{'model.dict'})
254             args[\textcolor{stringliteral}{'num\_epochs'}] = 20
255             \textcolor{comment}{# Train model where it has access to the candidate in labels}
256             stdout, valid, test = testing\_utils.train\_model(args)
257             self.assertGreaterEqual(
258                 valid[\textcolor{stringliteral}{'hits@100'}],
259                 0.0,
260                 \textcolor{stringliteral}{"valid hits@1 = \{\}\(\backslash\)nLOG:\(\backslash\)n\{\}"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(valid[\textcolor{stringliteral}{'hits@1'}], stdout),
261             )
262 
263             \textcolor{comment}{# Evaluate model where label is not in fixed candidates}
264             args[\textcolor{stringliteral}{'fixed\_candidates\_path'}] = tmp\_train\_val\_cands\_file
265 
266             \textcolor{comment}{# Will fail without appropriate arg set}
267             with self.assertRaises(RuntimeError):
268                 testing\_utils.eval\_model(args, skip\_valid=\textcolor{keyword}{True})
269 
270             args[\textcolor{stringliteral}{'add\_label\_to\_fixed\_cands'}] = \textcolor{keyword}{True}
271             stdout, valid, test = testing\_utils.eval\_model(args, skip\_valid=\textcolor{keyword}{True})
272             self.assertGreaterEqual(
273                 test[\textcolor{stringliteral}{'hits@100'}],
274                 0.0,
275                 \textcolor{stringliteral}{"test hits@1 = \{\}\(\backslash\)nLOG:\(\backslash\)n\{\}"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(test[\textcolor{stringliteral}{'hits@1'}], stdout),
276             )
277 
278 
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
tests/\hyperlink{test__tra_8py}{test\+\_\+tra.\+py}\end{DoxyCompactItemize}
