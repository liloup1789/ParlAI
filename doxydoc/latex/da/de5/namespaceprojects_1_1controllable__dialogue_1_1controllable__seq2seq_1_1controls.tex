\hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls}{}\section{projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls Namespace Reference}
\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls}\index{projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls@{projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls}}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_1_1NIDFFeats}{N\+I\+D\+F\+Feats}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aafbe257df1791349439cc63c99de8b5e}{initialize\+\_\+control\+\_\+information} (opt, build\+\_\+task=\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a2f84d3a62939c36cebd6f2ebcaec08ce}{True})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0db4b9d9584cef90aa2515a75e741774}{flatten} (list\+\_\+of\+\_\+lists)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6774bd6ac8941123de4574e69686140a}{intrep\+\_\+frac} (lst)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a24fbafb2553fb93db247bb7e2339b1e4}{extrep\+\_\+frac} (lst1, lst2)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_abf6d099074de6b0c663333470eeaa2de}{get\+\_\+ngrams} (text, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a8825ded618f6b3f758fdfc5c4a3bdc71}{n})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab562827e4a16578079aa8121ebadcda7}{matching\+\_\+ngram\+\_\+completions} (comparison\+\_\+seq, hypothesis, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a8825ded618f6b3f758fdfc5c4a3bdc71}{n})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a42b08e3d8604f6e0b7d88230323cd777}{intrep\+\_\+word\+\_\+used\+\_\+before} (dict, hypothesis, history, wt, feat, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a16bf79fe7e9cbacf6cf5792aaaee4f88}{remove\+\_\+stopwords})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a96e1d28cd5e6769d118b0b8b339213e9}{intrep\+\_\+ngram\+\_\+used\+\_\+before} (dict, hypothesis, history, wt, feat, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a8825ded618f6b3f758fdfc5c4a3bdc71}{n})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a1d20bea2946cab3a79aa8a2e77f9e09b}{extrep\+\_\+word\+\_\+used\+\_\+before} (dict, hypothesis, history, wt, feat, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a16bf79fe7e9cbacf6cf5792aaaee4f88}{remove\+\_\+stopwords}, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a852809286248c6b4113e7ca467f32eaf}{person})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a5bc41cc6c701b5da46a74b17ead0e834}{extrep\+\_\+ngram\+\_\+used\+\_\+before} (dict, hypothesis, history, wt, feat, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a8825ded618f6b3f758fdfc5c4a3bdc71}{n}, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a852809286248c6b4113e7ca467f32eaf}{person})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a27ef93e876c9c12b265bf2eefb65f058}{nidf} (dict, hypothesis, history, wt, feat)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ac09ae7183b65c9bd1f6f1469db84012b}{qn\+\_\+words} (dict, hypothesis, history, wt, feat)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afe0a10c32acfb1a7dd586ac644412589}{lastutt\+\_\+sim\+\_\+arora\+\_\+word} (dict, hypothesis, history, wt, feat)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0324491b8ecb07aaf415e47d6575cbac}{get\+\_\+wd\+\_\+features} (dict, hypothesis, history, wd\+\_\+features, wd\+\_\+weights)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6cac190e0676d3938ec8c2e5bd0c994d}{intrep\+\_\+repeated\+\_\+word\+\_\+frac} (utt, history, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a16bf79fe7e9cbacf6cf5792aaaee4f88}{remove\+\_\+stopwords})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afeb51a7c1798dbff5427d5ddec3d735c}{intrep\+\_\+repeated\+\_\+ngram\+\_\+frac} (utt, history, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a8825ded618f6b3f758fdfc5c4a3bdc71}{n})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0d42f675e7a8008b5300de33d6b393b1}{extrep\+\_\+repeated\+\_\+word\+\_\+frac} (utt, history, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a16bf79fe7e9cbacf6cf5792aaaee4f88}{remove\+\_\+stopwords}, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a852809286248c6b4113e7ca467f32eaf}{person})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_acf2eb363af8558f8f2e8afbacdc52c07}{extrep\+\_\+repeated\+\_\+ngram\+\_\+frac} (utt, history, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a8825ded618f6b3f758fdfc5c4a3bdc71}{n}, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a852809286248c6b4113e7ca467f32eaf}{person})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a962ffde4150bf72ac52327fb4f0a3c78}{avg\+\_\+nidf} (utt, history)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a9ff7f284ebe0c571ce6335d4aab2bb36}{contains\+\_\+qmark} (utt, history)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_af87f0a728f9bbb385f160b47ca033c31}{lastutt\+\_\+sim\+\_\+arora\+\_\+sent} (utt, history)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a7500dad14e58978ad3903db08a10579e}{wordlist\+\_\+frac} (utt, history, \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aff6fb7782b35c70ac746395cb4ab0ac4}{word\+\_\+list})
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afc2b447cbf1dcb4a754d080d2e611c24}{eval\+\_\+attr} (utt, history, attr)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a3a84e701c32a5fbb01d5676714d83f03}{get\+\_\+qn\+\_\+bucket\+\_\+probs} ()
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab3bad4782be153fd04645ff419024311}{bucket\+\_\+question} (ex, ctrl, num\+\_\+buckets)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a10bd268a01b2a8886d5af4358cd5e922}{sort\+\_\+into\+\_\+bucket} (val, bucket\+\_\+lbs)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a60657d8955080feedb6dcbb084e2ae13}{bucket\+\_\+contvar} (ex, ctrl, num\+\_\+buckets)
\item 
def \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a3057eb90e6aeff3fbf2c89c7e003aea0}{get\+\_\+ctrl\+\_\+vec} (exs, history, control\+\_\+settings)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_adafb0ccf56ce3359e1157210a0bbd125}{Q\+N\+\_\+\+W\+O\+R\+DS}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab369652f734d95239a5a72df4bde11e7}{word2nidf}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a39b4201071be4232cb85fc593ca0f3b4}{nidf\+\_\+feats}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_af1a8cf95077ab1de45a68b6756a3b2a5}{arora\+\_\+data}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a409b745aac572a3f7c4c345b2dbe0dd5}{sent\+\_\+embedder}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6ad1602bc0e4f0c80d406bc58d1b426e}{W\+D\+F\+E\+A\+T\+U\+R\+E2\+U\+P\+D\+A\+T\+E\+FN}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a16bf79fe7e9cbacf6cf5792aaaee4f88}{remove\+\_\+stopwords}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a8825ded618f6b3f758fdfc5c4a3bdc71}{n}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_adfe4adb42a3dfb86535ae8765bd2f3c8}{False}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a852809286248c6b4113e7ca467f32eaf}{person}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a2f84d3a62939c36cebd6f2ebcaec08ce}{True}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a7caf995b56b860f5e0de9d60935243c8}{A\+T\+T\+R2\+S\+E\+N\+T\+S\+C\+O\+R\+E\+FN}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aff6fb7782b35c70ac746395cb4ab0ac4}{word\+\_\+list}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ac2ef7a7e371448e63a7085814cf50160}{C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+E\+M\+B\+S\+I\+ZE}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aaa31ed927f83d45e619b0da333e2aeda}{C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+N\+U\+M\+B\+U\+C\+K\+E\+TS}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a06fb2f27e69d21a2d300f8f8790c2cf3}{C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+I\+N\+G\+FN}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab731f26e89bf99efc704ffdcc152d087}{A\+V\+G\+\_\+\+N\+I\+D\+F\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a9197a104df64de7dd914b128082c5f7e}{L\+A\+S\+T\+U\+T\+T\+S\+I\+M\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS}
\item 
\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a4ec61ac32d9ad15cae102ba352f4b0fd}{C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+L\+BS}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a962ffde4150bf72ac52327fb4f0a3c78}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a962ffde4150bf72ac52327fb4f0a3c78}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!avg\+\_\+nidf@{avg\+\_\+nidf}}
\index{avg\+\_\+nidf@{avg\+\_\+nidf}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{avg\+\_\+nidf()}{avg\_nidf()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+avg\+\_\+nidf (\begin{DoxyParamCaption}\item[{}]{utt,  }\item[{}]{history }\end{DoxyParamCaption})}

\begin{DoxyVerb}Sentence-level attribute function.

See explanation above. Returns the mean NIDF of the words in utt.
\end{DoxyVerb}
 

Definition at line 575 of file controls.\+py.


\begin{DoxyCode}
575 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a962ffde4150bf72ac52327fb4f0a3c78}{avg\_nidf}(utt, history):
576     \textcolor{stringliteral}{"""}
577 \textcolor{stringliteral}{    Sentence-level attribute function.}
578 \textcolor{stringliteral}{}
579 \textcolor{stringliteral}{    See explanation above. Returns the mean NIDF of the words in utt.}
580 \textcolor{stringliteral}{    """}
581     words = utt.split()
582     problem\_words = [w \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} words \textcolor{keywordflow}{if} w \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} word2nidf]
583     ok\_words = [w \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} words \textcolor{keywordflow}{if} w \textcolor{keywordflow}{in} word2nidf]
584     \textcolor{keywordflow}{if} len(ok\_words) == 0:
585         print(
586             \textcolor{stringliteral}{"WARNING: For all the words in the utterance '%s', we do not have the "}
587             \textcolor{stringliteral}{"NIDF score. Marking as avg\_nidf=1."} % utt
588         )
589         \textcolor{keywordflow}{return} 1  \textcolor{comment}{# rarest possible sentence}
590     nidfs = [word2nidf[w] \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} ok\_words]
591     avg\_nidf = sum(nidfs) / len(nidfs)
592     \textcolor{keywordflow}{if} len(problem\_words) > 0:
593         print(
594             \textcolor{stringliteral}{"WARNING: When calculating avg\_nidf for the utterance '%s', we don't "}
595             \textcolor{stringliteral}{"know NIDF for the following words: %s"} % (utt, \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(problem\_words))
596         )
597     \textcolor{keyword}{assert} avg\_nidf >= 0 \textcolor{keywordflow}{and} avg\_nidf <= 1
598     \textcolor{keywordflow}{return} avg\_nidf
599 
600 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a60657d8955080feedb6dcbb084e2ae13}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a60657d8955080feedb6dcbb084e2ae13}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!bucket\+\_\+contvar@{bucket\+\_\+contvar}}
\index{bucket\+\_\+contvar@{bucket\+\_\+contvar}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{bucket\+\_\+contvar()}{bucket\_contvar()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+bucket\+\_\+contvar (\begin{DoxyParamCaption}\item[{}]{ex,  }\item[{}]{ctrl,  }\item[{}]{num\+\_\+buckets }\end{DoxyParamCaption})}

\begin{DoxyVerb}Given ex, which contains a continuous value for a particular control variable,
return the bucketed version of that control value.

Inputs:
  ex: message dictionary. Assume it has key ctrl, mapping to the value.
  ctrl: string. The name of the CT control.
  num_buckets: int. The number of buckets for this control variable.
\end{DoxyVerb}
 

Definition at line 836 of file controls.\+py.


\begin{DoxyCode}
836 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a60657d8955080feedb6dcbb084e2ae13}{bucket\_contvar}(ex, ctrl, num\_buckets):
837     \textcolor{stringliteral}{"""}
838 \textcolor{stringliteral}{    Given ex, which contains a continuous value for a particular control variable,}
839 \textcolor{stringliteral}{    return the bucketed version of that control value.}
840 \textcolor{stringliteral}{}
841 \textcolor{stringliteral}{    Inputs:}
842 \textcolor{stringliteral}{      ex: message dictionary. Assume it has key ctrl, mapping to the value.}
843 \textcolor{stringliteral}{      ctrl: string. The name of the CT control.}
844 \textcolor{stringliteral}{      num\_buckets: int. The number of buckets for this control variable.}
845 \textcolor{stringliteral}{    """}
846     \textcolor{keywordflow}{if} ctrl \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} ex.keys():
847         \textcolor{keywordflow}{raise} ValueError(
848             \textcolor{stringliteral}{"Control %s not found in example. Available keys in "}
849             \textcolor{stringliteral}{"this example: %s"} % (ctrl, \textcolor{stringliteral}{', '}.join(ex.keys()))
850         )
851 
852     \textcolor{comment}{# Get the control variable value}
853     ctrl\_val = ex[ctrl]  \textcolor{comment}{# string. the value of the control variable for this example}
854     \textcolor{keywordflow}{if} ctrl == \textcolor{stringliteral}{'avg\_nidf'}:
855         ctrl\_val = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(ctrl\_val)
856         \textcolor{keyword}{assert} ctrl\_val >= 0
857         \textcolor{keyword}{assert} ctrl\_val <= 1
858     \textcolor{keywordflow}{elif} ctrl == \textcolor{stringliteral}{'lastuttsim'}:
859         \textcolor{keywordflow}{if} ctrl\_val == \textcolor{stringliteral}{'None'}:  \textcolor{comment}{# bot goes first in conversation}
860             \textcolor{keyword}{assert} num\_buckets == 11
861             \textcolor{keywordflow}{return} 10  \textcolor{comment}{# The last bucket is for when the bot goes first}
862         \textcolor{keywordflow}{else}:
863             ctrl\_val = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1make__control__dataset_aa2b7207688c641dbc094ab44eca27113}{float}(ctrl\_val)
864             \textcolor{keyword}{assert} ctrl\_val >= -1
865             \textcolor{keyword}{assert} ctrl\_val <= 1
866     \textcolor{keywordflow}{else}:
867         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{'Unexpected CT ctrl: %s'} % ctrl)
868 
869     \textcolor{comment}{# Get the bucket lowerbounds}
870     bucket\_lbs = CONTROL2BUCKETLBS[(ctrl, num\_buckets)]  \textcolor{comment}{# lst len num\_buckets of floats}
871     \textcolor{keywordflow}{if} ctrl == \textcolor{stringliteral}{'lastuttsim'}:
872         \textcolor{comment}{# The 'bot goes first' bucket 10 has no lower bound}
873         \textcolor{keyword}{assert} len(bucket\_lbs) == num\_buckets - 1
874     \textcolor{keywordflow}{else}:
875         \textcolor{keyword}{assert} len(bucket\_lbs) == num\_buckets
876 
877     \textcolor{comment}{# Determine the correct bucket and return the bucket id}
878     \textcolor{keywordflow}{return} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a10bd268a01b2a8886d5af4358cd5e922}{sort\_into\_bucket}(ctrl\_val, bucket\_lbs)
879 
880 
881 \textcolor{comment}{# The default embedding size for CT control variable embeddings}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab3bad4782be153fd04645ff419024311}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab3bad4782be153fd04645ff419024311}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!bucket\+\_\+question@{bucket\+\_\+question}}
\index{bucket\+\_\+question@{bucket\+\_\+question}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{bucket\+\_\+question()}{bucket\_question()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+bucket\+\_\+question (\begin{DoxyParamCaption}\item[{}]{ex,  }\item[{}]{ctrl,  }\item[{}]{num\+\_\+buckets }\end{DoxyParamCaption})}

\begin{DoxyVerb}Given an example (where the target response may or may not be a question) and its
history, probabilistically determine what question-asking CT bucket to use.

Inputs:
  ex: message dictionary containing a bool field 'question'
  ctrl: string. The name of the CT control. Should be 'question'.
  num_buckets: int. The number of question-asking CT buckets. Assumed to be 11.
Returns:
  out: int. bucket number.
\end{DoxyVerb}
 

Definition at line 793 of file controls.\+py.


\begin{DoxyCode}
793 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab3bad4782be153fd04645ff419024311}{bucket\_question}(ex, ctrl, num\_buckets):
794     \textcolor{stringliteral}{"""}
795 \textcolor{stringliteral}{    Given an example (where the target response may or may not be a question) and its}
796 \textcolor{stringliteral}{    history, probabilistically determine what question-asking CT bucket to use.}
797 \textcolor{stringliteral}{}
798 \textcolor{stringliteral}{    Inputs:}
799 \textcolor{stringliteral}{      ex: message dictionary containing a bool field 'question'}
800 \textcolor{stringliteral}{      ctrl: string. The name of the CT control. Should be 'question'.}
801 \textcolor{stringliteral}{      num\_buckets: int. The number of question-asking CT buckets. Assumed to be 11.}
802 \textcolor{stringliteral}{    Returns:}
803 \textcolor{stringliteral}{      out: int. bucket number.}
804 \textcolor{stringliteral}{    """}
805     \textcolor{keyword}{assert} num\_buckets == 11
806     is\_qn = \hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(ex[\textcolor{stringliteral}{'question'}])
807     \textcolor{keyword}{assert} is\_qn \textcolor{keywordflow}{in} [0, 1]
808     is\_qn = \hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a6fc0c9b519a36f82b65bcd398f1fbb9d}{bool}(is\_qn)
809     \textcolor{keywordflow}{if} is\_qn:  \textcolor{comment}{# Sample from P(bucket|qn=1)}
810         out = np.random.choice(range(num\_buckets), 1, p=PROB\_BUCKET\_GIVEN\_QN)
811     \textcolor{keywordflow}{else}:  \textcolor{comment}{# Sample from P(bucket|qn=0)}
812         out = np.random.choice(range(num\_buckets), 1, p=PROB\_BUCKET\_GIVEN\_NOTQN)
813     out = \hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(out[0])
814     \textcolor{keywordflow}{return} out
815 
816 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a9ff7f284ebe0c571ce6335d4aab2bb36}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a9ff7f284ebe0c571ce6335d4aab2bb36}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!contains\+\_\+qmark@{contains\+\_\+qmark}}
\index{contains\+\_\+qmark@{contains\+\_\+qmark}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{contains\+\_\+qmark()}{contains\_qmark()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+contains\+\_\+qmark (\begin{DoxyParamCaption}\item[{}]{utt,  }\item[{}]{history }\end{DoxyParamCaption})}

\begin{DoxyVerb}Sentence-level attribute function.

See explanation above. Returns 1 if utt contains a question mark, otherwise 0.
\end{DoxyVerb}
 

Definition at line 601 of file controls.\+py.


\begin{DoxyCode}
601 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a9ff7f284ebe0c571ce6335d4aab2bb36}{contains\_qmark}(utt, history):
602     \textcolor{stringliteral}{"""}
603 \textcolor{stringliteral}{    Sentence-level attribute function.}
604 \textcolor{stringliteral}{}
605 \textcolor{stringliteral}{    See explanation above. Returns 1 if utt contains a question mark, otherwise 0.}
606 \textcolor{stringliteral}{    """}
607     \textcolor{keywordflow}{return} \hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(\textcolor{stringliteral}{"?"} \textcolor{keywordflow}{in} utt)
608 
609 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afc2b447cbf1dcb4a754d080d2e611c24}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afc2b447cbf1dcb4a754d080d2e611c24}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!eval\+\_\+attr@{eval\+\_\+attr}}
\index{eval\+\_\+attr@{eval\+\_\+attr}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{eval\+\_\+attr()}{eval\_attr()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+eval\+\_\+attr (\begin{DoxyParamCaption}\item[{}]{utt,  }\item[{}]{history,  }\item[{}]{attr }\end{DoxyParamCaption})}

\begin{DoxyVerb}Given a conversational history and an utterance, compute the requested sentence-
level attribute for utt.

Inputs:
    utt: string. The utterance, tokenized and lowercase
    history: a ConvAI2History. This represents the conversation history.
    attr: string. The name of the sentence-level attribute.
Returns:
    value: float. The value of the attribute for utt.
\end{DoxyVerb}
 

Definition at line 726 of file controls.\+py.


\begin{DoxyCode}
726 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afc2b447cbf1dcb4a754d080d2e611c24}{eval\_attr}(utt, history, attr):
727     \textcolor{stringliteral}{"""}
728 \textcolor{stringliteral}{    Given a conversational history and an utterance, compute the requested sentence-}
729 \textcolor{stringliteral}{    level attribute for utt.}
730 \textcolor{stringliteral}{}
731 \textcolor{stringliteral}{    Inputs:}
732 \textcolor{stringliteral}{        utt: string. The utterance, tokenized and lowercase}
733 \textcolor{stringliteral}{        history: a ConvAI2History. This represents the conversation history.}
734 \textcolor{stringliteral}{        attr: string. The name of the sentence-level attribute.}
735 \textcolor{stringliteral}{    Returns:}
736 \textcolor{stringliteral}{        value: float. The value of the attribute for utt.}
737 \textcolor{stringliteral}{    """}
738     \textcolor{comment}{# Check everything is lowercased already}
739     \textcolor{keyword}{assert} utt == utt.lower()
740     \textcolor{keywordflow}{for} thing \textcolor{keywordflow}{in} [history.persona\_lines, history.partner\_utts, history.own\_utts]:
741         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} thing:
742             \textcolor{keywordflow}{if} line != \textcolor{stringliteral}{"\_\_SILENCE\_\_"}:
743                 \textcolor{keyword}{assert} line == line.lower()
744 
745     \textcolor{comment}{# Eval attribute}
746     \textcolor{keywordflow}{return} ATTR2SENTSCOREFN[attr]((utt, history))
747 
748 
749 \textcolor{comment}{# ========================================}
750 \textcolor{comment}{# GETTING CONTROL VARIABLE BUCKETS}
751 \textcolor{comment}{# For Conditional Training (CT) models, the code in this section allows us to determine}
752 \textcolor{comment}{# what bucket a given control variable value should go into.}
753 \textcolor{comment}{# ========================================}
754 
755 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a24fbafb2553fb93db247bb7e2339b1e4}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a24fbafb2553fb93db247bb7e2339b1e4}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!extrep\+\_\+frac@{extrep\+\_\+frac}}
\index{extrep\+\_\+frac@{extrep\+\_\+frac}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{extrep\+\_\+frac()}{extrep\_frac()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+extrep\+\_\+frac (\begin{DoxyParamCaption}\item[{}]{lst1,  }\item[{}]{lst2 }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns the fraction of items in lst1 that are in lst2.
\end{DoxyVerb}
 

Definition at line 140 of file controls.\+py.


\begin{DoxyCode}
140 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a24fbafb2553fb93db247bb7e2339b1e4}{extrep\_frac}(lst1, lst2):
141     \textcolor{stringliteral}{"""}
142 \textcolor{stringliteral}{    Returns the fraction of items in lst1 that are in lst2.}
143 \textcolor{stringliteral}{    """}
144     \textcolor{keywordflow}{if} len(lst1) == 0:
145         \textcolor{keywordflow}{return} 0
146     num\_rep = len([x \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} lst1 \textcolor{keywordflow}{if} x \textcolor{keywordflow}{in} lst2])
147     \textcolor{keywordflow}{return} num\_rep / len(lst1)
148 
149 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a5bc41cc6c701b5da46a74b17ead0e834}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a5bc41cc6c701b5da46a74b17ead0e834}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!extrep\+\_\+ngram\+\_\+used\+\_\+before@{extrep\+\_\+ngram\+\_\+used\+\_\+before}}
\index{extrep\+\_\+ngram\+\_\+used\+\_\+before@{extrep\+\_\+ngram\+\_\+used\+\_\+before}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{extrep\+\_\+ngram\+\_\+used\+\_\+before()}{extrep\_ngram\_used\_before()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+extrep\+\_\+ngram\+\_\+used\+\_\+before (\begin{DoxyParamCaption}\item[{}]{dict,  }\item[{}]{hypothesis,  }\item[{}]{history,  }\item[{}]{wt,  }\item[{}]{feat,  }\item[{}]{n,  }\item[{}]{person }\end{DoxyParamCaption})}

\begin{DoxyVerb}Weighted decoding feature function. See explanation above. This feature is 1 for
words that, if added to hypothesis, would create a n-gram that has already been used
earlier in the conversation; otherwise 0.

Additional inputs:
  n: int, the size of the n-grams considered.
  person: If 'self', identify n-grams that have already been used by self (bot).
    If 'partner', identify n-grams that have already been used by partner (human).
\end{DoxyVerb}
 

Definition at line 280 of file controls.\+py.


\begin{DoxyCode}
280 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a5bc41cc6c701b5da46a74b17ead0e834}{extrep\_ngram\_used\_before}(dict, hypothesis, history, wt, feat, n, person):
281     \textcolor{stringliteral}{"""}
282 \textcolor{stringliteral}{    Weighted decoding feature function. See explanation above. This feature is 1 for}
283 \textcolor{stringliteral}{    words that, if added to hypothesis, would create a n-gram that has already been used}
284 \textcolor{stringliteral}{    earlier in the conversation; otherwise 0.}
285 \textcolor{stringliteral}{}
286 \textcolor{stringliteral}{    Additional inputs:}
287 \textcolor{stringliteral}{      n: int, the size of the n-grams considered.}
288 \textcolor{stringliteral}{      person: If 'self', identify n-grams that have already been used by self (bot).}
289 \textcolor{stringliteral}{        If 'partner', identify n-grams that have already been used by partner (human).}
290 \textcolor{stringliteral}{    """}
291     \textcolor{keywordflow}{if} person == \textcolor{stringliteral}{'self'}:
292         prev\_utts = history.own\_utts
293     \textcolor{keywordflow}{elif} person == \textcolor{stringliteral}{'partner'}:
294         prev\_utts = history.partner\_utts
295     \textcolor{keywordflow}{else}:
296         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"person must be 'self' or 'partner', but it is: "}, person)
297     \textcolor{keywordflow}{if} len(prev\_utts) == 0:
298         \textcolor{keywordflow}{return} feat
299     \textcolor{keywordflow}{if} hypothesis \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
300         \textcolor{keywordflow}{return} feat
301     prev\_utts\_wordidx = [dict.txt2vec(utt) \textcolor{keywordflow}{for} utt \textcolor{keywordflow}{in} prev\_utts]  \textcolor{comment}{# list of list of ints}
302     bad\_words = [
303         \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab562827e4a16578079aa8121ebadcda7}{matching\_ngram\_completions}(prev\_utt, hypothesis, n)
304         \textcolor{keywordflow}{for} prev\_utt \textcolor{keywordflow}{in} prev\_utts\_wordidx
305     ]  \textcolor{comment}{# list of list of ints}
306     bad\_words = list(set(\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0db4b9d9584cef90aa2515a75e741774}{flatten}(bad\_words)))  \textcolor{comment}{# list of ints, no duplicates}
307     \textcolor{keywordflow}{if} len(bad\_words) > 0:
308         feat[bad\_words] += wt
309     \textcolor{keywordflow}{return} feat
310 
311 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_acf2eb363af8558f8f2e8afbacdc52c07}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_acf2eb363af8558f8f2e8afbacdc52c07}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!extrep\+\_\+repeated\+\_\+ngram\+\_\+frac@{extrep\+\_\+repeated\+\_\+ngram\+\_\+frac}}
\index{extrep\+\_\+repeated\+\_\+ngram\+\_\+frac@{extrep\+\_\+repeated\+\_\+ngram\+\_\+frac}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{extrep\+\_\+repeated\+\_\+ngram\+\_\+frac()}{extrep\_repeated\_ngram\_frac()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+extrep\+\_\+repeated\+\_\+ngram\+\_\+frac (\begin{DoxyParamCaption}\item[{}]{utt,  }\item[{}]{history,  }\item[{}]{n,  }\item[{}]{person }\end{DoxyParamCaption})}

\begin{DoxyVerb}Sentence-level attribute function.

See explanation above.
Returns fraction of n-grams in utt that already appeared in a previous utterance.
Additional inputs:
  n: int, the size of the n-grams considered.
  person: If 'self', identify n-grams that have already been used by self (bot).
    If 'partner', identify n-grams that have already been used by partner (human).
\end{DoxyVerb}
 

Definition at line 549 of file controls.\+py.


\begin{DoxyCode}
549 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_acf2eb363af8558f8f2e8afbacdc52c07}{extrep\_repeated\_ngram\_frac}(utt, history, n, person):
550     \textcolor{stringliteral}{"""}
551 \textcolor{stringliteral}{    Sentence-level attribute function.}
552 \textcolor{stringliteral}{}
553 \textcolor{stringliteral}{    See explanation above.}
554 \textcolor{stringliteral}{    Returns fraction of n-grams in utt that already appeared in a previous utterance.}
555 \textcolor{stringliteral}{    Additional inputs:}
556 \textcolor{stringliteral}{      n: int, the size of the n-grams considered.}
557 \textcolor{stringliteral}{      person: If 'self', identify n-grams that have already been used by self (bot).}
558 \textcolor{stringliteral}{        If 'partner', identify n-grams that have already been used by partner (human).}
559 \textcolor{stringliteral}{    """}
560     \textcolor{keyword}{assert} utt.strip() != \textcolor{stringliteral}{""}
561     \textcolor{keywordflow}{if} person == \textcolor{stringliteral}{'self'}:
562         prev\_utts = history.own\_utts  \textcolor{comment}{# should already be tokenized}
563     \textcolor{keywordflow}{elif} person == \textcolor{stringliteral}{'partner'}:
564         prev\_utts = history.partner\_utts  \textcolor{comment}{# should already be tokenized}
565     \textcolor{keywordflow}{else}:
566         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"person must be 'self' or 'partner', but it is: "}, person)
567     \textcolor{keywordflow}{if} len(prev\_utts) == 0:
568         \textcolor{keywordflow}{return} 0
569     utt\_ngrams = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_abf6d099074de6b0c663333470eeaa2de}{get\_ngrams}(utt, n)
570     prev\_ngrams = [\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_abf6d099074de6b0c663333470eeaa2de}{get\_ngrams}(prev, n) \textcolor{keywordflow}{for} prev \textcolor{keywordflow}{in} prev\_utts]  \textcolor{comment}{# list of list of strings}
571     prev\_ngrams = list(set(\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0db4b9d9584cef90aa2515a75e741774}{flatten}(prev\_ngrams)))  \textcolor{comment}{# list of strings, no duplicates}
572     \textcolor{keywordflow}{return} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a24fbafb2553fb93db247bb7e2339b1e4}{extrep\_frac}(utt\_ngrams, prev\_ngrams)
573 
574 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0d42f675e7a8008b5300de33d6b393b1}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0d42f675e7a8008b5300de33d6b393b1}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!extrep\+\_\+repeated\+\_\+word\+\_\+frac@{extrep\+\_\+repeated\+\_\+word\+\_\+frac}}
\index{extrep\+\_\+repeated\+\_\+word\+\_\+frac@{extrep\+\_\+repeated\+\_\+word\+\_\+frac}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{extrep\+\_\+repeated\+\_\+word\+\_\+frac()}{extrep\_repeated\_word\_frac()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+extrep\+\_\+repeated\+\_\+word\+\_\+frac (\begin{DoxyParamCaption}\item[{}]{utt,  }\item[{}]{history,  }\item[{}]{remove\+\_\+stopwords,  }\item[{}]{person }\end{DoxyParamCaption})}

\begin{DoxyVerb}Sentence-level attribute function.

See explanation above.
Returns the fraction of words in utt that already appeared in a previous utterance.
Additional inputs:
  remove_stopwords: bool. If True, stopwords are removed from utt before counting
    repetition.
  person: If 'self', identify words that have already been used by self (bot).
    If 'partner', identify words that have already been used by partner (human).
\end{DoxyVerb}
 

Definition at line 520 of file controls.\+py.


\begin{DoxyCode}
520 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0d42f675e7a8008b5300de33d6b393b1}{extrep\_repeated\_word\_frac}(utt, history, remove\_stopwords, person):
521     \textcolor{stringliteral}{"""}
522 \textcolor{stringliteral}{    Sentence-level attribute function.}
523 \textcolor{stringliteral}{}
524 \textcolor{stringliteral}{    See explanation above.}
525 \textcolor{stringliteral}{    Returns the fraction of words in utt that already appeared in a previous utterance.}
526 \textcolor{stringliteral}{    Additional inputs:}
527 \textcolor{stringliteral}{      remove\_stopwords: bool. If True, stopwords are removed from utt before counting}
528 \textcolor{stringliteral}{        repetition.}
529 \textcolor{stringliteral}{      person: If 'self', identify words that have already been used by self (bot).}
530 \textcolor{stringliteral}{        If 'partner', identify words that have already been used by partner (human).}
531 \textcolor{stringliteral}{    """}
532     \textcolor{keyword}{assert} utt.strip() != \textcolor{stringliteral}{""}
533     \textcolor{keywordflow}{if} person == \textcolor{stringliteral}{'self'}:
534         prev\_utts = history.own\_utts  \textcolor{comment}{# should already be tokenized}
535     \textcolor{keywordflow}{elif} person == \textcolor{stringliteral}{'partner'}:
536         prev\_utts = history.partner\_utts  \textcolor{comment}{# should already be tokenized}
537     \textcolor{keywordflow}{else}:
538         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"person must be 'self' or 'partner', but it is: "}, person)
539     \textcolor{keywordflow}{if} len(prev\_utts) == 0:
540         \textcolor{keywordflow}{return} 0
541     tokens = utt.split()  \textcolor{comment}{# list of strings}
542     \textcolor{keywordflow}{if} remove\_stopwords:  \textcolor{comment}{# remove stopwords from utt}
543         tokens = [t \textcolor{keywordflow}{for} t \textcolor{keywordflow}{in} tokens \textcolor{keywordflow}{if} t \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} STOPWORDS]
544     prev\_words = [s.split() \textcolor{keywordflow}{for} s \textcolor{keywordflow}{in} prev\_utts]  \textcolor{comment}{# list of list of ints}
545     prev\_words = list(set(\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0db4b9d9584cef90aa2515a75e741774}{flatten}(prev\_words)))  \textcolor{comment}{# list of ints, no duplicates}
546     \textcolor{keywordflow}{return} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a24fbafb2553fb93db247bb7e2339b1e4}{extrep\_frac}(tokens, prev\_words)
547 
548 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a1d20bea2946cab3a79aa8a2e77f9e09b}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a1d20bea2946cab3a79aa8a2e77f9e09b}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!extrep\+\_\+word\+\_\+used\+\_\+before@{extrep\+\_\+word\+\_\+used\+\_\+before}}
\index{extrep\+\_\+word\+\_\+used\+\_\+before@{extrep\+\_\+word\+\_\+used\+\_\+before}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{extrep\+\_\+word\+\_\+used\+\_\+before()}{extrep\_word\_used\_before()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+extrep\+\_\+word\+\_\+used\+\_\+before (\begin{DoxyParamCaption}\item[{}]{dict,  }\item[{}]{hypothesis,  }\item[{}]{history,  }\item[{}]{wt,  }\item[{}]{feat,  }\item[{}]{remove\+\_\+stopwords,  }\item[{}]{person }\end{DoxyParamCaption})}

\begin{DoxyVerb}Weighted decoding feature function. See explanation above. This feature is 1 for
words that have already been used earlier in the conversation; otherwise 0.

Additional inputs:
  remove_stopwords: bool. If True, stopwords are not included when identifying words
    that have already appeared.
  person: If 'self', identify words that have already been used by self (bot).
    If 'partner', identify words that have already been used by partner (human).
\end{DoxyVerb}
 

Definition at line 252 of file controls.\+py.


\begin{DoxyCode}
252 ):
253     \textcolor{stringliteral}{"""}
254 \textcolor{stringliteral}{    Weighted decoding feature function. See explanation above. This feature is 1 for}
255 \textcolor{stringliteral}{    words that have already been used earlier in the conversation; otherwise 0.}
256 \textcolor{stringliteral}{}
257 \textcolor{stringliteral}{    Additional inputs:}
258 \textcolor{stringliteral}{      remove\_stopwords: bool. If True, stopwords are not included when identifying words}
259 \textcolor{stringliteral}{        that have already appeared.}
260 \textcolor{stringliteral}{      person: If 'self', identify words that have already been used by self (bot).}
261 \textcolor{stringliteral}{        If 'partner', identify words that have already been used by partner (human).}
262 \textcolor{stringliteral}{    """}
263     \textcolor{keywordflow}{if} person == \textcolor{stringliteral}{'self'}:
264         prev\_utts = history.own\_utts
265     \textcolor{keywordflow}{elif} person == \textcolor{stringliteral}{'partner'}:
266         prev\_utts = history.partner\_utts
267     \textcolor{keywordflow}{else}:
268         \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"person must be 'self' or 'partner', but it is: "}, person)
269     \textcolor{keywordflow}{if} len(prev\_utts) == 0:
270         \textcolor{keywordflow}{return} feat
271     prev\_words = [dict.txt2vec(utt) \textcolor{keywordflow}{for} utt \textcolor{keywordflow}{in} prev\_utts]  \textcolor{comment}{# list of list of ints}
272     prev\_words = list(set(\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0db4b9d9584cef90aa2515a75e741774}{flatten}(prev\_words)))  \textcolor{comment}{# list of ints, no duplicates}
273     \textcolor{keywordflow}{if} remove\_stopwords:
274         prev\_words = [idx \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} prev\_words \textcolor{keywordflow}{if} dict[idx] \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} STOPWORDS]
275     \textcolor{keywordflow}{if} len(prev\_words) > 0:
276         feat[prev\_words] += wt
277     \textcolor{keywordflow}{return} feat
278 
279 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0db4b9d9584cef90aa2515a75e741774}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0db4b9d9584cef90aa2515a75e741774}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!flatten@{flatten}}
\index{flatten@{flatten}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{flatten()}{flatten()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+flatten (\begin{DoxyParamCaption}\item[{}]{list\+\_\+of\+\_\+lists }\end{DoxyParamCaption})}

\begin{DoxyVerb}Flatten a list of lists.
\end{DoxyVerb}
 

Definition at line 120 of file controls.\+py.


\begin{DoxyCode}
120 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0db4b9d9584cef90aa2515a75e741774}{flatten}(list\_of\_lists):
121     \textcolor{stringliteral}{"""}
122 \textcolor{stringliteral}{    Flatten a list of lists.}
123 \textcolor{stringliteral}{    """}
124     \textcolor{keywordflow}{return} [item \textcolor{keywordflow}{for} sublist \textcolor{keywordflow}{in} list\_of\_lists \textcolor{keywordflow}{for} item \textcolor{keywordflow}{in} sublist]
125 
126 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a3057eb90e6aeff3fbf2c89c7e003aea0}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a3057eb90e6aeff3fbf2c89c7e003aea0}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!get\+\_\+ctrl\+\_\+vec@{get\+\_\+ctrl\+\_\+vec}}
\index{get\+\_\+ctrl\+\_\+vec@{get\+\_\+ctrl\+\_\+vec}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{get\+\_\+ctrl\+\_\+vec()}{get\_ctrl\_vec()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+get\+\_\+ctrl\+\_\+vec (\begin{DoxyParamCaption}\item[{}]{exs,  }\item[{}]{history,  }\item[{}]{control\+\_\+settings }\end{DoxyParamCaption})}

\begin{DoxyVerb}Given a batch of examples with given history, return the bucketed CT control values.
This is used both when training and evaluating CT systems.

Inputs:
  exs: list length batch_size of message dictionaries. Each dictionary contains
    a 'text' field, and a field for each CT control we're using, along with the
    value of the CT control variable.
  history: list length batch_size of ConvAI2History objects. These represent the
    conversation history.
  control_settings: dictionary containing info about CT controls.
    See ControllableSeq2seqAgent.control_settings.

Returns:
  ctrl_vec: torch Tensor shape (batch_size, num_controls), with the bucketed values
    for the CT controls we're using. If there's no CT controls, return None.
\end{DoxyVerb}
 

Definition at line 936 of file controls.\+py.


\begin{DoxyCode}
936 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a3057eb90e6aeff3fbf2c89c7e003aea0}{get\_ctrl\_vec}(exs, history, control\_settings):
937     \textcolor{stringliteral}{"""}
938 \textcolor{stringliteral}{    Given a batch of examples with given history, return the bucketed CT control values.}
939 \textcolor{stringliteral}{    This is used both when training and evaluating CT systems.}
940 \textcolor{stringliteral}{}
941 \textcolor{stringliteral}{    Inputs:}
942 \textcolor{stringliteral}{      exs: list length batch\_size of message dictionaries. Each dictionary contains}
943 \textcolor{stringliteral}{        a 'text' field, and a field for each CT control we're using, along with the}
944 \textcolor{stringliteral}{        value of the CT control variable.}
945 \textcolor{stringliteral}{      history: list length batch\_size of ConvAI2History objects. These represent the}
946 \textcolor{stringliteral}{        conversation history.}
947 \textcolor{stringliteral}{      control\_settings: dictionary containing info about CT controls.}
948 \textcolor{stringliteral}{        See ControllableSeq2seqAgent.control\_settings.}
949 \textcolor{stringliteral}{}
950 \textcolor{stringliteral}{    Returns:}
951 \textcolor{stringliteral}{      ctrl\_vec: torch Tensor shape (batch\_size, num\_controls), with the bucketed values}
952 \textcolor{stringliteral}{        for the CT controls we're using. If there's no CT controls, return None.}
953 \textcolor{stringliteral}{    """}
954     \textcolor{keywordflow}{if} len(control\_settings) == 0:
955         \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
956 
957     \textcolor{comment}{# ctrl\_vec is shape (bsz, num\_controls) filled with -1's}
958     ctrl\_vec = -torch.ones((len(exs), len(control\_settings))).long()
959 
960     \textcolor{keywordflow}{for} batch\_idx, (ex, hist) \textcolor{keywordflow}{in} enumerate(zip(exs, history)):
961         \textcolor{keywordflow}{for} ctrl, ctrl\_info \textcolor{keywordflow}{in} control\_settings.items():
962             set\_val = ctrl\_info[\textcolor{stringliteral}{'set\_value'}]  \textcolor{comment}{# is either int or None}
963             \textcolor{keywordflow}{if} set\_val \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:  \textcolor{comment}{# if we're using some preset bucket for this ctrl}
964                 bucket = set\_val  \textcolor{comment}{# override with set\_val, an int}
965             \textcolor{keywordflow}{else}:  \textcolor{comment}{# bucket the control val given in ex}
966                 \textcolor{keywordflow}{if} ctrl \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} ex:
967                     \textcolor{keywordflow}{raise} ValueError(
968                         \textcolor{stringliteral}{"The CT control '%s' is not present as a key in "}
969                         \textcolor{stringliteral}{"the message dictionary:\(\backslash\)n%s\(\backslash\)nIf training a CT "}
970                         \textcolor{stringliteral}{"model, perhaps your training data is missing the "}
971                         \textcolor{stringliteral}{"annotations. If talking interactively, perhaps "}
972                         \textcolor{stringliteral}{"you forgot to set --set-controls."} % (ctrl, \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(ex))
973                     )
974                 num\_buckets = ctrl\_info[\textcolor{stringliteral}{'num\_buckets'}]
975                 bucketing\_fn = CONTROL2BUCKETINGFN[ctrl]  \textcolor{comment}{# bucketing fn for this ctrl}
976                 bucket = bucketing\_fn(ex, ctrl, num\_buckets)  \textcolor{comment}{# int}
977 
978             \textcolor{comment}{# If we have multiple CT controls, ctrl\_idx tells us which order they go in}
979             ctrl\_idx = ctrl\_info[\textcolor{stringliteral}{'idx'}]  \textcolor{comment}{# int}
980             ctrl\_vec[batch\_idx, ctrl\_idx] = bucket
981     \textcolor{keywordflow}{return} ctrl\_vec
982 \end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_abf6d099074de6b0c663333470eeaa2de}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_abf6d099074de6b0c663333470eeaa2de}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!get\+\_\+ngrams@{get\+\_\+ngrams}}
\index{get\+\_\+ngrams@{get\+\_\+ngrams}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{get\+\_\+ngrams()}{get\_ngrams()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+get\+\_\+ngrams (\begin{DoxyParamCaption}\item[{}]{text,  }\item[{}]{n }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns all ngrams that are in the text.

Inputs:
    text: string
    n: int
Returns:
    list of strings (each is a ngram)
\end{DoxyVerb}
 

Definition at line 150 of file controls.\+py.


\begin{DoxyCode}
150 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_abf6d099074de6b0c663333470eeaa2de}{get\_ngrams}(text, n):
151     \textcolor{stringliteral}{"""}
152 \textcolor{stringliteral}{    Returns all ngrams that are in the text.}
153 \textcolor{stringliteral}{}
154 \textcolor{stringliteral}{    Inputs:}
155 \textcolor{stringliteral}{        text: string}
156 \textcolor{stringliteral}{        n: int}
157 \textcolor{stringliteral}{    Returns:}
158 \textcolor{stringliteral}{        list of strings (each is a ngram)}
159 \textcolor{stringliteral}{    """}
160     tokens = text.split()
161     \textcolor{keywordflow}{return} [
162         \textcolor{stringliteral}{" "}.join(tokens[i : i + n]) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(tokens) - (n - 1))
163     ]  \textcolor{comment}{# list of str}
164 
165 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a3a84e701c32a5fbb01d5676714d83f03}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a3a84e701c32a5fbb01d5676714d83f03}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!get\+\_\+qn\+\_\+bucket\+\_\+probs@{get\+\_\+qn\+\_\+bucket\+\_\+probs}}
\index{get\+\_\+qn\+\_\+bucket\+\_\+probs@{get\+\_\+qn\+\_\+bucket\+\_\+probs}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{get\+\_\+qn\+\_\+bucket\+\_\+probs()}{get\_qn\_bucket\_probs()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+get\+\_\+qn\+\_\+bucket\+\_\+probs (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}Assuming we have 11 CT question buckets (0 to 10), compute P(bucket|question=1) and
P(bucket|question=0); this is needed so we can probabilistically assign incoming
training examples to buckets.

Returns:
  prob_bucket_given_qn: list of floats length 11; P(bucket|question=1)
  prob_bucket_given_notqn: list of floats length 11; P(bucket|question=0)
\end{DoxyVerb}
 

Definition at line 756 of file controls.\+py.


\begin{DoxyCode}
756 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a3a84e701c32a5fbb01d5676714d83f03}{get\_qn\_bucket\_probs}():
757     \textcolor{stringliteral}{"""}
758 \textcolor{stringliteral}{    Assuming we have 11 CT question buckets (0 to 10), compute P(bucket|question=1) and}
759 \textcolor{stringliteral}{    P(bucket|question=0); this is needed so we can probabilistically assign incoming}
760 \textcolor{stringliteral}{    training examples to buckets.}
761 \textcolor{stringliteral}{}
762 \textcolor{stringliteral}{    Returns:}
763 \textcolor{stringliteral}{      prob\_bucket\_given\_qn: list of floats length 11; P(bucket|question=1)}
764 \textcolor{stringliteral}{      prob\_bucket\_given\_notqn: list of floats length 11; P(bucket|question=0)}
765 \textcolor{stringliteral}{    """}
766     prob\_qn = 41101 / 131438  \textcolor{comment}{# P(question=1), computed across ConvAI2 dataset. ~31%}
767 
768     \textcolor{comment}{# Compute P(bucket), i.e. the total sizes of the buckets.}
769     \textcolor{comment}{# This is done by assuming that buckets 1 to 10 are equal in size, but bucket 0}
770     \textcolor{comment}{# is larger because we have more non-questions than questions. Therefore:}
771     \textcolor{comment}{# P(question=1) = P(bucket=1, question=1) + ... + P(bucket=10, question=1)}
772     \textcolor{comment}{#               = prob\_bucket\_n * 0.1 + ... + prob\_bucket\_n * 1}
773     \textcolor{comment}{#               = 5.5 * prob\_bucket\_n}
774     \textcolor{comment}{# Thus we can derive the value for prob\_bucket\_n and prob\_bucket\_0:}
775     prob\_bucket\_n = prob\_qn / 5.5  \textcolor{comment}{# P(bucket=n) for n=1,...,10}
776     prob\_bucket\_0 = 1 - 10 * prob\_bucket\_n  \textcolor{comment}{# P(bucket=0)}
777     prob\_bucket = [prob\_bucket\_0] + [prob\_bucket\_n] * 10  \textcolor{comment}{# list length 11, P(bucket)}
778 
779     \textcolor{comment}{# Compute P(bucket|qn=1) and P(bucket|qn=0) using Bayes Rule:}
780     \textcolor{comment}{# P(bucket|qn=1) = P(bucket) * P(qn=1|bucket) / P(qn=1)}
781     \textcolor{comment}{# P(bucket|qn=0) = P(bucket) * P(qn=0|bucket) / P(qn=0)}
782     prob\_bucket\_given\_qn = [pb * (i / 10) / prob\_qn \textcolor{keywordflow}{for} i, pb \textcolor{keywordflow}{in} enumerate(prob\_bucket)]
783     prob\_bucket\_given\_notqn = [
784         pb * ((10 - i) / 10) / (1 - prob\_qn) \textcolor{keywordflow}{for} i, pb \textcolor{keywordflow}{in} enumerate(prob\_bucket)
785     ]
786 
787     \textcolor{keywordflow}{return} prob\_bucket\_given\_qn, prob\_bucket\_given\_notqn
788 
789 
790 PROB\_BUCKET\_GIVEN\_QN, PROB\_BUCKET\_GIVEN\_NOTQN = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a3a84e701c32a5fbb01d5676714d83f03}{get\_qn\_bucket\_probs}()
791 
792 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0324491b8ecb07aaf415e47d6575cbac}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0324491b8ecb07aaf415e47d6575cbac}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!get\+\_\+wd\+\_\+features@{get\+\_\+wd\+\_\+features}}
\index{get\+\_\+wd\+\_\+features@{get\+\_\+wd\+\_\+features}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{get\+\_\+wd\+\_\+features()}{get\_wd\_features()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+get\+\_\+wd\+\_\+features (\begin{DoxyParamCaption}\item[{}]{dict,  }\item[{}]{hypothesis,  }\item[{}]{history,  }\item[{}]{wd\+\_\+features,  }\item[{}]{wd\+\_\+weights }\end{DoxyParamCaption})}

\begin{DoxyVerb}Given a conversational history and a hypothesis (i.e. partially generated response),
compute the Weighted Decoding features for all words in the vocabulary.

Inputs:
    dict: parlai DictionaryAgent
    hypothesis: list of ints or None
    history: a ConvAI2History. This represents the conversation history.
    wd_features: list of strings; the names of the WD features we want to use
    wd_weights: list of floats; the weights corresponding to the WD features.
Returns:
    wd_feat_vec: tensor shape (vocab_size), containing weighted sum of the feature
      functions, for each candidate continuation word
\end{DoxyVerb}
 

Definition at line 454 of file controls.\+py.


\begin{DoxyCode}
454 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a0324491b8ecb07aaf415e47d6575cbac}{get\_wd\_features}(dict, hypothesis, history, wd\_features, wd\_weights):
455     \textcolor{stringliteral}{"""}
456 \textcolor{stringliteral}{    Given a conversational history and a hypothesis (i.e. partially generated response),}
457 \textcolor{stringliteral}{    compute the Weighted Decoding features for all words in the vocabulary.}
458 \textcolor{stringliteral}{}
459 \textcolor{stringliteral}{    Inputs:}
460 \textcolor{stringliteral}{        dict: parlai DictionaryAgent}
461 \textcolor{stringliteral}{        hypothesis: list of ints or None}
462 \textcolor{stringliteral}{        history: a ConvAI2History. This represents the conversation history.}
463 \textcolor{stringliteral}{        wd\_features: list of strings; the names of the WD features we want to use}
464 \textcolor{stringliteral}{        wd\_weights: list of floats; the weights corresponding to the WD features.}
465 \textcolor{stringliteral}{    Returns:}
466 \textcolor{stringliteral}{        wd\_feat\_vec: tensor shape (vocab\_size), containing weighted sum of the feature}
467 \textcolor{stringliteral}{          functions, for each candidate continuation word}
468 \textcolor{stringliteral}{    """}
469     wd\_feat\_vec = torch.zeros((len(dict)))
470     \textcolor{keywordflow}{for} f, w \textcolor{keywordflow}{in} zip(wd\_features, wd\_weights):
471         wd\_feat\_vec = WDFEATURE2UPDATEFN[f]((dict, hypothesis, history, w, wd\_feat\_vec))
472     \textcolor{keywordflow}{return} wd\_feat\_vec
473 
474 
475 \textcolor{comment}{# ========================================}
476 \textcolor{comment}{# SENTENCE-LEVEL ATTRIBUTE FUNCTIONS}
477 \textcolor{comment}{# Given an input utterance, these functions compute the value of the controllable}
478 \textcolor{comment}{# attribute at the sentence level (more precisely, at the utterance level).}
479 \textcolor{comment}{#}
480 \textcolor{comment}{# All these functions have the following inputs and outputs:}
481 \textcolor{comment}{#}
482 \textcolor{comment}{# Inputs:}
483 \textcolor{comment}{#   utt: a string, tokenized and lowercase}
484 \textcolor{comment}{#   history: a ConvAI2History. This represents the conversation history.}
485 \textcolor{comment}{# Output:}
486 \textcolor{comment}{#   score: float. the value of the controllable attribute for utt.}
487 \textcolor{comment}{# ========================================}
488 
489 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aafbe257df1791349439cc63c99de8b5e}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aafbe257df1791349439cc63c99de8b5e}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!initialize\+\_\+control\+\_\+information@{initialize\+\_\+control\+\_\+information}}
\index{initialize\+\_\+control\+\_\+information@{initialize\+\_\+control\+\_\+information}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{initialize\+\_\+control\+\_\+information()}{initialize\_control\_information()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+initialize\+\_\+control\+\_\+information (\begin{DoxyParamCaption}\item[{}]{opt,  }\item[{}]{build\+\_\+task = {\ttfamily \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a2f84d3a62939c36cebd6f2ebcaec08ce}{True}} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Loads information from word2count.pkl, arora.pkl in data/controllable_dialogue, and
uses it to initialize objects for computing NIDF and response-relatedness controls.

By default (build_task=True) we will also build the controllable_dialogue task i.e.
download data/controllable_dialogue if necessary.
\end{DoxyVerb}
 

Definition at line 83 of file controls.\+py.


\begin{DoxyCode}
83 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aafbe257df1791349439cc63c99de8b5e}{initialize\_control\_information}(opt, build\_task=True):
84     \textcolor{stringliteral}{"""}
85 \textcolor{stringliteral}{    Loads information from word2count.pkl, arora.pkl in data/controllable\_dialogue, and}
86 \textcolor{stringliteral}{    uses it to initialize objects for computing NIDF and response-relatedness controls.}
87 \textcolor{stringliteral}{}
88 \textcolor{stringliteral}{    By default (build\_task=True) we will also build the controllable\_dialogue task i.e.}
89 \textcolor{stringliteral}{    download data/controllable\_dialogue if necessary.}
90 \textcolor{stringliteral}{    """}
91     \textcolor{keyword}{global} word2nidf, nidf\_feats, arora\_data, sent\_embedder
92 
93     \textcolor{keywordflow}{if} word2nidf \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
94         \textcolor{comment}{# already loaded, no need to do anything}
95         \textcolor{keywordflow}{return}
96 
97     \textcolor{keywordflow}{if} build\_task:
98         \hyperlink{namespaceparlai_1_1mturk_1_1tasks_1_1talkthewalk_1_1download_a8c0fbb9b6dfe127cb8c1bd6e7c4e33fd}{build}(opt)
99 
100     print(\textcolor{stringliteral}{"Loading up controllable features..."})
101     word2nidf = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1nidf_a2f882ed55572a6f2f7558732a6a692ee}{load\_word2nidf}(opt)  \textcolor{comment}{# get word2nidf dict}
102     nidf\_feats = NIDFFeats()  \textcolor{comment}{# init the NIDFFeats object}
103     \textcolor{comment}{# load info for arora sentence embeddings}
104     arora\_data = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1arora_aaea3eb10fd28246497bb20a148a26da8}{load\_arora}(opt)
105     sent\_embedder = SentenceEmbedder(
106         arora\_data[\textcolor{stringliteral}{'word2prob'}],
107         arora\_data[\textcolor{stringliteral}{'arora\_a'}],
108         arora\_data[\textcolor{stringliteral}{'glove\_name'}],
109         arora\_data[\textcolor{stringliteral}{'glove\_dim'}],
110         arora\_data[\textcolor{stringliteral}{'first\_sv'}],
111         glove\_cache=\hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_a5fbd3301b67f00d6d146fb01c7cd7626}{modelzoo\_path}(opt[\textcolor{stringliteral}{'datapath'}], \textcolor{stringliteral}{'models:glove\_vectors'}),
112     )
113 
114 
115 \textcolor{comment}{# ========================================}
116 \textcolor{comment}{# UTIL}
117 \textcolor{comment}{# ========================================}
118 
119 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6774bd6ac8941123de4574e69686140a}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6774bd6ac8941123de4574e69686140a}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!intrep\+\_\+frac@{intrep\+\_\+frac}}
\index{intrep\+\_\+frac@{intrep\+\_\+frac}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{intrep\+\_\+frac()}{intrep\_frac()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+intrep\+\_\+frac (\begin{DoxyParamCaption}\item[{}]{lst }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns the fraction of items in the list that are repeated.
\end{DoxyVerb}
 

Definition at line 127 of file controls.\+py.


\begin{DoxyCode}
127 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6774bd6ac8941123de4574e69686140a}{intrep\_frac}(lst):
128     \textcolor{stringliteral}{"""}
129 \textcolor{stringliteral}{    Returns the fraction of items in the list that are repeated.}
130 \textcolor{stringliteral}{    """}
131     \textcolor{keywordflow}{if} len(lst) == 0:
132         \textcolor{keywordflow}{return} 0
133     num\_rep = 0
134     \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range(len(lst)):
135         \textcolor{keywordflow}{if} lst[idx] \textcolor{keywordflow}{in} lst[:idx]:
136             num\_rep += 1
137     \textcolor{keywordflow}{return} num\_rep / len(lst)
138 
139 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a96e1d28cd5e6769d118b0b8b339213e9}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a96e1d28cd5e6769d118b0b8b339213e9}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!intrep\+\_\+ngram\+\_\+used\+\_\+before@{intrep\+\_\+ngram\+\_\+used\+\_\+before}}
\index{intrep\+\_\+ngram\+\_\+used\+\_\+before@{intrep\+\_\+ngram\+\_\+used\+\_\+before}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{intrep\+\_\+ngram\+\_\+used\+\_\+before()}{intrep\_ngram\_used\_before()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+intrep\+\_\+ngram\+\_\+used\+\_\+before (\begin{DoxyParamCaption}\item[{}]{dict,  }\item[{}]{hypothesis,  }\item[{}]{history,  }\item[{}]{wt,  }\item[{}]{feat,  }\item[{}]{n }\end{DoxyParamCaption})}

\begin{DoxyVerb}Weighted decoding feature function. See explanation above. This feature is 1 for
words that, if added to the hypothesis, will create a n-gram that has already
appeared in the hypothesis; otherwise 0.

Additional inputs:
  n: int, the size of the n-grams considered.
\end{DoxyVerb}
 

Definition at line 234 of file controls.\+py.


\begin{DoxyCode}
234 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a96e1d28cd5e6769d118b0b8b339213e9}{intrep\_ngram\_used\_before}(dict, hypothesis, history, wt, feat, n):
235     \textcolor{stringliteral}{"""}
236 \textcolor{stringliteral}{    Weighted decoding feature function. See explanation above. This feature is 1 for}
237 \textcolor{stringliteral}{    words that, if added to the hypothesis, will create a n-gram that has already}
238 \textcolor{stringliteral}{    appeared in the hypothesis; otherwise 0.}
239 \textcolor{stringliteral}{}
240 \textcolor{stringliteral}{    Additional inputs:}
241 \textcolor{stringliteral}{      n: int, the size of the n-grams considered.}
242 \textcolor{stringliteral}{    """}
243     \textcolor{keywordflow}{if} hypothesis \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
244         bad\_words = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab562827e4a16578079aa8121ebadcda7}{matching\_ngram\_completions}(hypothesis, hypothesis, n)
245         \textcolor{keywordflow}{if} len(bad\_words) > 0:
246             feat[bad\_words] += wt
247     \textcolor{keywordflow}{return} feat
248 
249 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afeb51a7c1798dbff5427d5ddec3d735c}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afeb51a7c1798dbff5427d5ddec3d735c}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!intrep\+\_\+repeated\+\_\+ngram\+\_\+frac@{intrep\+\_\+repeated\+\_\+ngram\+\_\+frac}}
\index{intrep\+\_\+repeated\+\_\+ngram\+\_\+frac@{intrep\+\_\+repeated\+\_\+ngram\+\_\+frac}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{intrep\+\_\+repeated\+\_\+ngram\+\_\+frac()}{intrep\_repeated\_ngram\_frac()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+intrep\+\_\+repeated\+\_\+ngram\+\_\+frac (\begin{DoxyParamCaption}\item[{}]{utt,  }\item[{}]{history,  }\item[{}]{n }\end{DoxyParamCaption})}

\begin{DoxyVerb}Sentence-level attribute function.

See explanation above.
Returns the fraction of n-grams in utt that are repeated.
Additional inputs:
  n: int, the size of the n-grams considered.
\end{DoxyVerb}
 

Definition at line 506 of file controls.\+py.


\begin{DoxyCode}
506 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afeb51a7c1798dbff5427d5ddec3d735c}{intrep\_repeated\_ngram\_frac}(utt, history, n):
507     \textcolor{stringliteral}{"""}
508 \textcolor{stringliteral}{    Sentence-level attribute function.}
509 \textcolor{stringliteral}{}
510 \textcolor{stringliteral}{    See explanation above.}
511 \textcolor{stringliteral}{    Returns the fraction of n-grams in utt that are repeated.}
512 \textcolor{stringliteral}{    Additional inputs:}
513 \textcolor{stringliteral}{      n: int, the size of the n-grams considered.}
514 \textcolor{stringliteral}{    """}
515     \textcolor{keyword}{assert} utt.strip() != \textcolor{stringliteral}{""}
516     ngrams = \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_abf6d099074de6b0c663333470eeaa2de}{get\_ngrams}(utt, n)
517     \textcolor{keywordflow}{return} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6774bd6ac8941123de4574e69686140a}{intrep\_frac}(ngrams)
518 
519 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6cac190e0676d3938ec8c2e5bd0c994d}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6cac190e0676d3938ec8c2e5bd0c994d}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!intrep\+\_\+repeated\+\_\+word\+\_\+frac@{intrep\+\_\+repeated\+\_\+word\+\_\+frac}}
\index{intrep\+\_\+repeated\+\_\+word\+\_\+frac@{intrep\+\_\+repeated\+\_\+word\+\_\+frac}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{intrep\+\_\+repeated\+\_\+word\+\_\+frac()}{intrep\_repeated\_word\_frac()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+intrep\+\_\+repeated\+\_\+word\+\_\+frac (\begin{DoxyParamCaption}\item[{}]{utt,  }\item[{}]{history,  }\item[{}]{remove\+\_\+stopwords }\end{DoxyParamCaption})}

\begin{DoxyVerb}Sentence-level attribute function.

See explanation above.
Returns the fraction of words in utt that are repeated.
Additional inputs:
  remove_stopwords: bool. If True, stopwords are removed before counting repetition.
\end{DoxyVerb}
 

Definition at line 490 of file controls.\+py.


\begin{DoxyCode}
490 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6cac190e0676d3938ec8c2e5bd0c994d}{intrep\_repeated\_word\_frac}(utt, history, remove\_stopwords):
491     \textcolor{stringliteral}{"""}
492 \textcolor{stringliteral}{    Sentence-level attribute function.}
493 \textcolor{stringliteral}{}
494 \textcolor{stringliteral}{    See explanation above.}
495 \textcolor{stringliteral}{    Returns the fraction of words in utt that are repeated.}
496 \textcolor{stringliteral}{    Additional inputs:}
497 \textcolor{stringliteral}{      remove\_stopwords: bool. If True, stopwords are removed before counting repetition.}
498 \textcolor{stringliteral}{    """}
499     \textcolor{keyword}{assert} utt.strip() != \textcolor{stringliteral}{""}
500     tokens = utt.split()
501     \textcolor{keywordflow}{if} remove\_stopwords:
502         tokens = [t \textcolor{keywordflow}{for} t \textcolor{keywordflow}{in} tokens \textcolor{keywordflow}{if} t \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} STOPWORDS]
503     \textcolor{keywordflow}{return} \hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6774bd6ac8941123de4574e69686140a}{intrep\_frac}(tokens)
504 
505 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a42b08e3d8604f6e0b7d88230323cd777}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a42b08e3d8604f6e0b7d88230323cd777}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!intrep\+\_\+word\+\_\+used\+\_\+before@{intrep\+\_\+word\+\_\+used\+\_\+before}}
\index{intrep\+\_\+word\+\_\+used\+\_\+before@{intrep\+\_\+word\+\_\+used\+\_\+before}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{intrep\+\_\+word\+\_\+used\+\_\+before()}{intrep\_word\_used\_before()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+intrep\+\_\+word\+\_\+used\+\_\+before (\begin{DoxyParamCaption}\item[{}]{dict,  }\item[{}]{hypothesis,  }\item[{}]{history,  }\item[{}]{wt,  }\item[{}]{feat,  }\item[{}]{remove\+\_\+stopwords }\end{DoxyParamCaption})}

\begin{DoxyVerb}Weighted decoding feature function. See explanation above. This feature is 1 for
words that have already appeared within the hypothesis, 0 otherwise.

Additional inputs:
  remove_stopwords: bool. If True, stopwords are not included when identifying words
    that have already appeared.
\end{DoxyVerb}
 

Definition at line 217 of file controls.\+py.


\begin{DoxyCode}
217 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a42b08e3d8604f6e0b7d88230323cd777}{intrep\_word\_used\_before}(dict, hypothesis, history, wt, feat, remove\_stopwords):
218     \textcolor{stringliteral}{"""}
219 \textcolor{stringliteral}{    Weighted decoding feature function. See explanation above. This feature is 1 for}
220 \textcolor{stringliteral}{    words that have already appeared within the hypothesis, 0 otherwise.}
221 \textcolor{stringliteral}{}
222 \textcolor{stringliteral}{    Additional inputs:}
223 \textcolor{stringliteral}{      remove\_stopwords: bool. If True, stopwords are not included when identifying words}
224 \textcolor{stringliteral}{        that have already appeared.}
225 \textcolor{stringliteral}{    """}
226     \textcolor{keywordflow}{if} hypothesis \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
227         \textcolor{keywordflow}{if} remove\_stopwords:
228             hypothesis = [idx \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} hypothesis \textcolor{keywordflow}{if} dict[idx] \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} STOPWORDS]
229         \textcolor{keywordflow}{if} len(hypothesis) > 0:
230             feat[hypothesis] += wt
231     \textcolor{keywordflow}{return} feat
232 
233 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_af87f0a728f9bbb385f160b47ca033c31}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_af87f0a728f9bbb385f160b47ca033c31}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!lastutt\+\_\+sim\+\_\+arora\+\_\+sent@{lastutt\+\_\+sim\+\_\+arora\+\_\+sent}}
\index{lastutt\+\_\+sim\+\_\+arora\+\_\+sent@{lastutt\+\_\+sim\+\_\+arora\+\_\+sent}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{lastutt\+\_\+sim\+\_\+arora\+\_\+sent()}{lastutt\_sim\_arora\_sent()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+lastutt\+\_\+sim\+\_\+arora\+\_\+sent (\begin{DoxyParamCaption}\item[{}]{utt,  }\item[{}]{history }\end{DoxyParamCaption})}

\begin{DoxyVerb}Sentence-level attribute function. See explanation above.

Returns
  cos_sim(sent_emb(last_utt), sent_emb(utt))
the cosine similarity of the Arora-style sentence embeddings for the current
response (utt) and the partner's last utterance (last_utt, which is in history).

- If there is no last_utt (i.e. utt is the first utterance of the conversation),
  returns None.
- If one or both of utt and last_utt are all-OOV; thus we can't compute sentence
  embeddings, return the string 'oov'.
\end{DoxyVerb}
 

Definition at line 610 of file controls.\+py.


\begin{DoxyCode}
610 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_af87f0a728f9bbb385f160b47ca033c31}{lastutt\_sim\_arora\_sent}(utt, history):
611     \textcolor{stringliteral}{"""}
612 \textcolor{stringliteral}{    Sentence-level attribute function. See explanation above.}
613 \textcolor{stringliteral}{}
614 \textcolor{stringliteral}{    Returns}
615 \textcolor{stringliteral}{      cos\_sim(sent\_emb(last\_utt), sent\_emb(utt))}
616 \textcolor{stringliteral}{    the cosine similarity of the Arora-style sentence embeddings for the current}
617 \textcolor{stringliteral}{    response (utt) and the partner's last utterance (last\_utt, which is in history).}
618 \textcolor{stringliteral}{}
619 \textcolor{stringliteral}{    - If there is no last\_utt (i.e. utt is the first utterance of the conversation),}
620 \textcolor{stringliteral}{      returns None.}
621 \textcolor{stringliteral}{    - If one or both of utt and last\_utt are all-OOV; thus we can't compute sentence}
622 \textcolor{stringliteral}{      embeddings, return the string 'oov'.}
623 \textcolor{stringliteral}{    """}
624     partner\_utts = history.partner\_utts
625     \textcolor{keywordflow}{if} len(partner\_utts) == 0:
626         \textcolor{comment}{# print('WARNING: returning lastuttsim = None because bot goes first')}
627         \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
628     last\_utt = partner\_utts[-1]  \textcolor{comment}{# string}
629     \textcolor{keywordflow}{if} \textcolor{stringliteral}{"\_\_SILENCE\_\_"} \textcolor{keywordflow}{in} last\_utt:
630         \textcolor{keyword}{assert} last\_utt.strip() == \textcolor{stringliteral}{"\_\_SILENCE\_\_"}
631         \textcolor{comment}{# print('WARNING: returning lastuttsim = None because bot goes first')}
632         \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
633 
634     \textcolor{comment}{# Get sentence embeddings. Here we're naively splitting last\_utt and utt; this is}
635     \textcolor{comment}{# fine given that we assume both utt and history are lowercase and tokenized.}
636     \textcolor{comment}{# Both last\_utt\_emb and response\_emb are tensors length glove\_dim (or None)}
637     last\_utt\_emb = sent\_embedder.embed\_sent(last\_utt.split())
638     response\_emb = sent\_embedder.embed\_sent(utt.split())
639     \textcolor{keywordflow}{if} last\_utt\_emb \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} response\_emb \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
640         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'oov'}
641 
642     sim = torch.nn.functional.cosine\_similarity(last\_utt\_emb, response\_emb, dim=0)
643     \textcolor{keywordflow}{return} sim.item()
644 
645 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afe0a10c32acfb1a7dd586ac644412589}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afe0a10c32acfb1a7dd586ac644412589}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!lastutt\+\_\+sim\+\_\+arora\+\_\+word@{lastutt\+\_\+sim\+\_\+arora\+\_\+word}}
\index{lastutt\+\_\+sim\+\_\+arora\+\_\+word@{lastutt\+\_\+sim\+\_\+arora\+\_\+word}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{lastutt\+\_\+sim\+\_\+arora\+\_\+word()}{lastutt\_sim\_arora\_word()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+lastutt\+\_\+sim\+\_\+arora\+\_\+word (\begin{DoxyParamCaption}\item[{}]{dict,  }\item[{}]{hypothesis,  }\item[{}]{history,  }\item[{}]{wt,  }\item[{}]{feat }\end{DoxyParamCaption})}

\begin{DoxyVerb}Weighted decoding feature function.

See explanation above. Given a word w, this feature is equal to cos_sim(word_emb(w),
sent_emb(l)) the cosine similarity between the GloVe vector for word w, and the
Arora-style sentence embedding for the partner's last utterance l.
\end{DoxyVerb}
 

Definition at line 334 of file controls.\+py.


\begin{DoxyCode}
334 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_afe0a10c32acfb1a7dd586ac644412589}{lastutt\_sim\_arora\_word}(dict, hypothesis, history, wt, feat):
335     \textcolor{stringliteral}{"""}
336 \textcolor{stringliteral}{    Weighted decoding feature function.}
337 \textcolor{stringliteral}{}
338 \textcolor{stringliteral}{    See explanation above. Given a word w, this feature is equal to cos\_sim(word\_emb(w),}
339 \textcolor{stringliteral}{    sent\_emb(l)) the cosine similarity between the GloVe vector for word w, and the}
340 \textcolor{stringliteral}{    Arora-style sentence embedding for the partner's last utterance l.}
341 \textcolor{stringliteral}{    """}
342     partner\_utts = history.partner\_utts
343     \textcolor{keywordflow}{if} len(partner\_utts) == 0:  \textcolor{comment}{# if bot goes first then do nothing}
344         \textcolor{keywordflow}{return} feat
345     last\_utt = partner\_utts[-1]  \textcolor{comment}{# string}
346     \textcolor{keywordflow}{if} last\_utt.strip().lower() == \textcolor{stringliteral}{"\_\_silence\_\_"}:  \textcolor{comment}{# if bot goes first then do nothing}
347         \textcolor{keywordflow}{return} feat
348 
349     \textcolor{comment}{# Get last\_utt\_emb, which is a tensor shape (glove\_dim)}
350     last\_utt\_emb = sent\_embedder.embed\_sent(dict.tokenize(last\_utt))
351     \textcolor{keywordflow}{if} last\_utt\_emb \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
352         \textcolor{keywordflow}{return} feat
353 
354     \textcolor{comment}{# Get cosine similarities, which is a tensor shape (vocab\_size)}
355     sims = sent\_embedder.get\_word\_sims(last\_utt, last\_utt\_emb, dict)
356 
357     feat += wt * sims
358     \textcolor{keywordflow}{return} feat
359 
360 
361 \textcolor{comment}{# In this dictionary, the keys are the names of the WD features, and the values are}
362 \textcolor{comment}{# functions with inputs (dict, hypothesis, history, wt, feat), that update the feature}
363 \textcolor{comment}{# vector feat.}
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab562827e4a16578079aa8121ebadcda7}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab562827e4a16578079aa8121ebadcda7}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!matching\+\_\+ngram\+\_\+completions@{matching\+\_\+ngram\+\_\+completions}}
\index{matching\+\_\+ngram\+\_\+completions@{matching\+\_\+ngram\+\_\+completions}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{matching\+\_\+ngram\+\_\+completions()}{matching\_ngram\_completions()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+matching\+\_\+ngram\+\_\+completions (\begin{DoxyParamCaption}\item[{}]{comparison\+\_\+seq,  }\item[{}]{hypothesis,  }\item[{}]{n }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return the list of words that if appended to hypothesis, would create a n-gram that
already exists in comparison_seq. For efficiency, this function represents words as
integers not strings.

Inputs:
    comparison_seq: list of integers
    hypothesis: list of integers or None
    n: integer

Output:
    bad_words: list of integers
\end{DoxyVerb}
 

Definition at line 166 of file controls.\+py.


\begin{DoxyCode}
166 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab562827e4a16578079aa8121ebadcda7}{matching\_ngram\_completions}(comparison\_seq, hypothesis, n):
167     \textcolor{stringliteral}{"""}
168 \textcolor{stringliteral}{    Return the list of words that if appended to hypothesis, would create a n-gram that}
169 \textcolor{stringliteral}{    already exists in comparison\_seq. For efficiency, this function represents words as}
170 \textcolor{stringliteral}{    integers not strings.}
171 \textcolor{stringliteral}{}
172 \textcolor{stringliteral}{    Inputs:}
173 \textcolor{stringliteral}{        comparison\_seq: list of integers}
174 \textcolor{stringliteral}{        hypothesis: list of integers or None}
175 \textcolor{stringliteral}{        n: integer}
176 \textcolor{stringliteral}{}
177 \textcolor{stringliteral}{    Output:}
178 \textcolor{stringliteral}{        bad\_words: list of integers}
179 \textcolor{stringliteral}{    """}
180     \textcolor{keywordflow}{if} hypothesis \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} len(hypothesis) < n - 1 \textcolor{keywordflow}{or} len(comparison\_seq) < n:
181         \textcolor{keywordflow}{return} []
182     hypothesis = [\hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(i) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} hypothesis]  \textcolor{comment}{# cast to list of ints}
183     comparison\_seq = [\hyperlink{namespacelanguage__model_1_1eval__ppl_a7d12ee00479673c5c8d1f6d01faa272a}{int}(i) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} comparison\_seq]  \textcolor{comment}{# cast to list of ints}
184     n\_minus\_1\_gram = hypothesis[-(n - 1) :]  \textcolor{comment}{# list of ints length n-1}
185     bad\_words = [
186         comparison\_seq[i]
187         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(n - 1, len(comparison\_seq))
188         \textcolor{keywordflow}{if} comparison\_seq[i - (n - 1) : i] == n\_minus\_1\_gram
189     ]  \textcolor{comment}{# list of ints}
190     \textcolor{keywordflow}{return} bad\_words
191 
192 
193 \textcolor{comment}{# ========================================}
194 \textcolor{comment}{# WEIGHTED DECODING FEATURE FUNCTIONS}
195 \textcolor{comment}{# These functions compute the decoding features for weighted decoding.}
196 \textcolor{comment}{#}
197 \textcolor{comment}{# Given a conversational history and a hypothesis (i.e. a partially generated response),}
198 \textcolor{comment}{# these functions update the weighted decoding feature vector (of length vocab\_size) by}
199 \textcolor{comment}{# adding the new decoding feature, multiplied by its corresponding weight.}
200 \textcolor{comment}{#}
201 \textcolor{comment}{# All these functions have the following inputs and outputs:}
202 \textcolor{comment}{#}
203 \textcolor{comment}{# Inputs:}
204 \textcolor{comment}{#   dict: parlai DictionaryAgent}
205 \textcolor{comment}{#   hypothesis: a list of integers. This is the partially generated response,}
206 \textcolor{comment}{#     represented via word indices.}
207 \textcolor{comment}{#   history: a ConvAI2History. This represents the conversation history.}
208 \textcolor{comment}{#   wt: a float. This is the weight for the weighted decoding feature.}
209 \textcolor{comment}{#   feat: a vector length vocab\_size. This will ultimately contain the sum of all the}
210 \textcolor{comment}{#     weighted decoding features.}
211 \textcolor{comment}{# Output:}
212 \textcolor{comment}{#   feat: a vector length vocab\_size. This is the feature vector, now with the new}
213 \textcolor{comment}{#     weighted decoding feature added (multiplied by wt).}
214 \textcolor{comment}{# ========================================}
215 
216 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a27ef93e876c9c12b265bf2eefb65f058}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a27ef93e876c9c12b265bf2eefb65f058}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!nidf@{nidf}}
\index{nidf@{nidf}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{nidf()}{nidf()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+nidf (\begin{DoxyParamCaption}\item[{}]{dict,  }\item[{}]{hypothesis,  }\item[{}]{history,  }\item[{}]{wt,  }\item[{}]{feat }\end{DoxyParamCaption})}

\begin{DoxyVerb}Weighted decoding feature function.

See explanation above. This feature is equal to the NIDF (normalized inverse
document frequency) score for each word. The score is always between 0 and 1.
\end{DoxyVerb}
 

Definition at line 312 of file controls.\+py.


\begin{DoxyCode}
312 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a27ef93e876c9c12b265bf2eefb65f058}{nidf}(dict, hypothesis, history, wt, feat):
313     \textcolor{stringliteral}{"""}
314 \textcolor{stringliteral}{    Weighted decoding feature function.}
315 \textcolor{stringliteral}{}
316 \textcolor{stringliteral}{    See explanation above. This feature is equal to the NIDF (normalized inverse}
317 \textcolor{stringliteral}{    document frequency) score for each word. The score is always between 0 and 1.}
318 \textcolor{stringliteral}{    """}
319     feat += wt * nidf\_feats.get\_feat\_vec(dict)
320     \textcolor{keywordflow}{return} feat
321 
322 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ac09ae7183b65c9bd1f6f1469db84012b}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ac09ae7183b65c9bd1f6f1469db84012b}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!qn\+\_\+words@{qn\+\_\+words}}
\index{qn\+\_\+words@{qn\+\_\+words}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{qn\+\_\+words()}{qn\_words()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+qn\+\_\+words (\begin{DoxyParamCaption}\item[{}]{dict,  }\item[{}]{hypothesis,  }\item[{}]{history,  }\item[{}]{wt,  }\item[{}]{feat }\end{DoxyParamCaption})}

\begin{DoxyVerb}Weighted decoding feature function.

See explanation above. This feature is 1 for 'interrogative words', 0 otherwise.
\end{DoxyVerb}
 

Definition at line 323 of file controls.\+py.


\begin{DoxyCode}
323 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ac09ae7183b65c9bd1f6f1469db84012b}{qn\_words}(dict, hypothesis, history, wt, feat):
324     \textcolor{stringliteral}{"""}
325 \textcolor{stringliteral}{    Weighted decoding feature function.}
326 \textcolor{stringliteral}{}
327 \textcolor{stringliteral}{    See explanation above. This feature is 1 for 'interrogative words', 0 otherwise.}
328 \textcolor{stringliteral}{    """}
329     qn\_indices = [dict[w] \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} QN\_WORDS]
330     feat[qn\_indices] += wt
331     \textcolor{keywordflow}{return} feat
332 
333 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a10bd268a01b2a8886d5af4358cd5e922}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a10bd268a01b2a8886d5af4358cd5e922}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!sort\+\_\+into\+\_\+bucket@{sort\+\_\+into\+\_\+bucket}}
\index{sort\+\_\+into\+\_\+bucket@{sort\+\_\+into\+\_\+bucket}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{sort\+\_\+into\+\_\+bucket()}{sort\_into\_bucket()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+sort\+\_\+into\+\_\+bucket (\begin{DoxyParamCaption}\item[{}]{val,  }\item[{}]{bucket\+\_\+lbs }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns the highest bucket such that val >= lower bound for that bucket.

Inputs:
  val: float. The value to be sorted into a bucket.
  bucket_lbs: list of floats, sorted ascending.

Returns:
  bucket_id: int in range(num_buckets); the bucket that val belongs to.
\end{DoxyVerb}
 

Definition at line 817 of file controls.\+py.


\begin{DoxyCode}
817 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a10bd268a01b2a8886d5af4358cd5e922}{sort\_into\_bucket}(val, bucket\_lbs):
818     \textcolor{stringliteral}{"""}
819 \textcolor{stringliteral}{    Returns the highest bucket such that val >= lower bound for that bucket.}
820 \textcolor{stringliteral}{}
821 \textcolor{stringliteral}{    Inputs:}
822 \textcolor{stringliteral}{      val: float. The value to be sorted into a bucket.}
823 \textcolor{stringliteral}{      bucket\_lbs: list of floats, sorted ascending.}
824 \textcolor{stringliteral}{}
825 \textcolor{stringliteral}{    Returns:}
826 \textcolor{stringliteral}{      bucket\_id: int in range(num\_buckets); the bucket that val belongs to.}
827 \textcolor{stringliteral}{    """}
828     num\_buckets = len(bucket\_lbs)
829     \textcolor{keywordflow}{for} bucket\_id \textcolor{keywordflow}{in} range(num\_buckets - 1, -1, -1):  \textcolor{comment}{# iterate descending}
830         lb = bucket\_lbs[bucket\_id]
831         \textcolor{keywordflow}{if} val >= lb:
832             \textcolor{keywordflow}{return} bucket\_id
833     \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{'val %f is not >= any of the lower bounds: %s'} % (val, bucket\_lbs))
834 
835 
\end{DoxyCode}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a7500dad14e58978ad3903db08a10579e}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a7500dad14e58978ad3903db08a10579e}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!wordlist\+\_\+frac@{wordlist\+\_\+frac}}
\index{wordlist\+\_\+frac@{wordlist\+\_\+frac}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{wordlist\+\_\+frac()}{wordlist\_frac()}}
{\footnotesize\ttfamily def projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+wordlist\+\_\+frac (\begin{DoxyParamCaption}\item[{}]{utt,  }\item[{}]{history,  }\item[{}]{word\+\_\+list }\end{DoxyParamCaption})}

\begin{DoxyVerb}Sentence-level attribute function.

See explanation above.
Returns the fraction of words in utt that are in word_list.
Additional inputs:
  word_list: list of strings.
\end{DoxyVerb}
 

Definition at line 646 of file controls.\+py.


\begin{DoxyCode}
646 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a7500dad14e58978ad3903db08a10579e}{wordlist\_frac}(utt, history, word\_list):
647     \textcolor{stringliteral}{"""}
648 \textcolor{stringliteral}{    Sentence-level attribute function.}
649 \textcolor{stringliteral}{}
650 \textcolor{stringliteral}{    See explanation above.}
651 \textcolor{stringliteral}{    Returns the fraction of words in utt that are in word\_list.}
652 \textcolor{stringliteral}{    Additional inputs:}
653 \textcolor{stringliteral}{      word\_list: list of strings.}
654 \textcolor{stringliteral}{    """}
655     words = utt.split()
656     num\_in\_list = len([w \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} words \textcolor{keywordflow}{if} w \textcolor{keywordflow}{in} word\_list])
657     \textcolor{keywordflow}{return} num\_in\_list / len(words)
658 
659 
660 \textcolor{comment}{# In this dict, the keys are the names of the sentence-level attributes, and the values}
661 \textcolor{comment}{# are functions with input (utt, history), returning the attribute value measured on utt}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_af1a8cf95077ab1de45a68b6756a3b2a5}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_af1a8cf95077ab1de45a68b6756a3b2a5}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!arora\+\_\+data@{arora\+\_\+data}}
\index{arora\+\_\+data@{arora\+\_\+data}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{arora\+\_\+data}{arora\_data}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+arora\+\_\+data}



Definition at line 79 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a7caf995b56b860f5e0de9d60935243c8}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a7caf995b56b860f5e0de9d60935243c8}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!A\+T\+T\+R2\+S\+E\+N\+T\+S\+C\+O\+R\+E\+FN@{A\+T\+T\+R2\+S\+E\+N\+T\+S\+C\+O\+R\+E\+FN}}
\index{A\+T\+T\+R2\+S\+E\+N\+T\+S\+C\+O\+R\+E\+FN@{A\+T\+T\+R2\+S\+E\+N\+T\+S\+C\+O\+R\+E\+FN}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{A\+T\+T\+R2\+S\+E\+N\+T\+S\+C\+O\+R\+E\+FN}{ATTR2SENTSCOREFN}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+A\+T\+T\+R2\+S\+E\+N\+T\+S\+C\+O\+R\+E\+FN}



Definition at line 662 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab731f26e89bf99efc704ffdcc152d087}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab731f26e89bf99efc704ffdcc152d087}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!A\+V\+G\+\_\+\+N\+I\+D\+F\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS@{A\+V\+G\+\_\+\+N\+I\+D\+F\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS}}
\index{A\+V\+G\+\_\+\+N\+I\+D\+F\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS@{A\+V\+G\+\_\+\+N\+I\+D\+F\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{A\+V\+G\+\_\+\+N\+I\+D\+F\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS}{AVG\_NIDF\_10BUCKET\_LBS}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+A\+V\+G\+\_\+\+N\+I\+D\+F\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS}



Definition at line 901 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a06fb2f27e69d21a2d300f8f8790c2cf3}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a06fb2f27e69d21a2d300f8f8790c2cf3}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+I\+N\+G\+FN@{C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+I\+N\+G\+FN}}
\index{C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+I\+N\+G\+FN@{C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+I\+N\+G\+FN}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+I\+N\+G\+FN}{CONTROL2BUCKETINGFN}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+I\+N\+G\+FN}



Definition at line 894 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a4ec61ac32d9ad15cae102ba352f4b0fd}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a4ec61ac32d9ad15cae102ba352f4b0fd}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+L\+BS@{C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+L\+BS}}
\index{C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+L\+BS@{C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+L\+BS}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+L\+BS}{CONTROL2BUCKETLBS}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+C\+O\+N\+T\+R\+O\+L2\+B\+U\+C\+K\+E\+T\+L\+BS}



Definition at line 928 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ac2ef7a7e371448e63a7085814cf50160}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ac2ef7a7e371448e63a7085814cf50160}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+E\+M\+B\+S\+I\+ZE@{C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+E\+M\+B\+S\+I\+ZE}}
\index{C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+E\+M\+B\+S\+I\+ZE@{C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+E\+M\+B\+S\+I\+ZE}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+E\+M\+B\+S\+I\+ZE}{CONTROL2DEFAULTEMBSIZE}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+E\+M\+B\+S\+I\+ZE}



Definition at line 882 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aaa31ed927f83d45e619b0da333e2aeda}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aaa31ed927f83d45e619b0da333e2aeda}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+N\+U\+M\+B\+U\+C\+K\+E\+TS@{C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+N\+U\+M\+B\+U\+C\+K\+E\+TS}}
\index{C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+N\+U\+M\+B\+U\+C\+K\+E\+TS@{C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+N\+U\+M\+B\+U\+C\+K\+E\+TS}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+N\+U\+M\+B\+U\+C\+K\+E\+TS}{CONTROL2DEFAULTNUMBUCKETS}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+C\+O\+N\+T\+R\+O\+L2\+D\+E\+F\+A\+U\+L\+T\+N\+U\+M\+B\+U\+C\+K\+E\+TS}



Definition at line 885 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_adfe4adb42a3dfb86535ae8765bd2f3c8}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_adfe4adb42a3dfb86535ae8765bd2f3c8}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!False@{False}}
\index{False@{False}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{False}{False}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+False}



Definition at line 389 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a9197a104df64de7dd914b128082c5f7e}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a9197a104df64de7dd914b128082c5f7e}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!L\+A\+S\+T\+U\+T\+T\+S\+I\+M\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS@{L\+A\+S\+T\+U\+T\+T\+S\+I\+M\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS}}
\index{L\+A\+S\+T\+U\+T\+T\+S\+I\+M\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS@{L\+A\+S\+T\+U\+T\+T\+S\+I\+M\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{L\+A\+S\+T\+U\+T\+T\+S\+I\+M\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS}{LASTUTTSIM\_10BUCKET\_LBS}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+L\+A\+S\+T\+U\+T\+T\+S\+I\+M\+\_\+10\+B\+U\+C\+K\+E\+T\+\_\+\+L\+BS}



Definition at line 913 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a8825ded618f6b3f758fdfc5c4a3bdc71}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a8825ded618f6b3f758fdfc5c4a3bdc71}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!n@{n}}
\index{n@{n}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{n}{n}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+n}



Definition at line 379 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a39b4201071be4232cb85fc593ca0f3b4}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a39b4201071be4232cb85fc593ca0f3b4}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!nidf\+\_\+feats@{nidf\+\_\+feats}}
\index{nidf\+\_\+feats@{nidf\+\_\+feats}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{nidf\+\_\+feats}{nidf\_feats}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+nidf\+\_\+feats}



Definition at line 78 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a852809286248c6b4113e7ca467f32eaf}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a852809286248c6b4113e7ca467f32eaf}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!person@{person}}
\index{person@{person}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{person}{person}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+person}



Definition at line 389 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_adafb0ccf56ce3359e1157210a0bbd125}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_adafb0ccf56ce3359e1157210a0bbd125}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!Q\+N\+\_\+\+W\+O\+R\+DS@{Q\+N\+\_\+\+W\+O\+R\+DS}}
\index{Q\+N\+\_\+\+W\+O\+R\+DS@{Q\+N\+\_\+\+W\+O\+R\+DS}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{Q\+N\+\_\+\+W\+O\+R\+DS}{QN\_WORDS}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+Q\+N\+\_\+\+W\+O\+R\+DS}



Definition at line 22 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a16bf79fe7e9cbacf6cf5792aaaee4f88}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a16bf79fe7e9cbacf6cf5792aaaee4f88}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!remove\+\_\+stopwords@{remove\+\_\+stopwords}}
\index{remove\+\_\+stopwords@{remove\+\_\+stopwords}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{remove\+\_\+stopwords}{remove\_stopwords}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+remove\+\_\+stopwords}



Definition at line 368 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a409b745aac572a3f7c4c345b2dbe0dd5}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a409b745aac572a3f7c4c345b2dbe0dd5}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!sent\+\_\+embedder@{sent\+\_\+embedder}}
\index{sent\+\_\+embedder@{sent\+\_\+embedder}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{sent\+\_\+embedder}{sent\_embedder}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+sent\+\_\+embedder}



Definition at line 80 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a2f84d3a62939c36cebd6f2ebcaec08ce}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a2f84d3a62939c36cebd6f2ebcaec08ce}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!True@{True}}
\index{True@{True}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{True}{True}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+True}



Definition at line 396 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6ad1602bc0e4f0c80d406bc58d1b426e}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_a6ad1602bc0e4f0c80d406bc58d1b426e}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!W\+D\+F\+E\+A\+T\+U\+R\+E2\+U\+P\+D\+A\+T\+E\+FN@{W\+D\+F\+E\+A\+T\+U\+R\+E2\+U\+P\+D\+A\+T\+E\+FN}}
\index{W\+D\+F\+E\+A\+T\+U\+R\+E2\+U\+P\+D\+A\+T\+E\+FN@{W\+D\+F\+E\+A\+T\+U\+R\+E2\+U\+P\+D\+A\+T\+E\+FN}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{W\+D\+F\+E\+A\+T\+U\+R\+E2\+U\+P\+D\+A\+T\+E\+FN}{WDFEATURE2UPDATEFN}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+W\+D\+F\+E\+A\+T\+U\+R\+E2\+U\+P\+D\+A\+T\+E\+FN}



Definition at line 364 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab369652f734d95239a5a72df4bde11e7}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_ab369652f734d95239a5a72df4bde11e7}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!word2nidf@{word2nidf}}
\index{word2nidf@{word2nidf}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{word2nidf}{word2nidf}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+word2nidf}



Definition at line 77 of file controls.\+py.

\mbox{\Hypertarget{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aff6fb7782b35c70ac746395cb4ab0ac4}\label{namespaceprojects_1_1controllable__dialogue_1_1controllable__seq2seq_1_1controls_aff6fb7782b35c70ac746395cb4ab0ac4}} 
\index{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}!word\+\_\+list@{word\+\_\+list}}
\index{word\+\_\+list@{word\+\_\+list}!projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls@{projects\+::controllable\+\_\+dialogue\+::controllable\+\_\+seq2seq\+::controls}}
\subsubsection{\texorpdfstring{word\+\_\+list}{word\_list}}
{\footnotesize\ttfamily projects.\+controllable\+\_\+dialogue.\+controllable\+\_\+seq2seq.\+controls.\+word\+\_\+list}



Definition at line 720 of file controls.\+py.

