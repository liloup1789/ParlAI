\hypertarget{namespaceigc__evals_1_1run}{}\section{igc\+\_\+evals.\+run Namespace Reference}
\label{namespaceigc__evals_1_1run}\index{igc\+\_\+evals.\+run@{igc\+\_\+evals.\+run}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespaceigc__evals_1_1run_ac45cf85723a667c904378dacaee81ed7}{main} ()
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespaceigc__evals_1_1run_a8d800bb89949fff41662851f88503919}{round\+\_\+choices}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespaceigc__evals_1_1run_ac45cf85723a667c904378dacaee81ed7}\label{namespaceigc__evals_1_1run_ac45cf85723a667c904378dacaee81ed7}} 
\index{igc\+\_\+evals\+::run@{igc\+\_\+evals\+::run}!main@{main}}
\index{main@{main}!igc\+\_\+evals\+::run@{igc\+\_\+evals\+::run}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def igc\+\_\+evals.\+run.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}IGC Human Evaluation.

Specify the `--eval-data-path` to load examples for evaluation.

The data in `--eval-data-path` should be formatted as a dictionary
mapping IGC image ids to dicts with the following fields:
{
    'questions': list of (<generator_name>, <generated_question>) tuples,
    'responses': list of (<generator_name>, <generated_response>) tuples,
    'question': question to use when evaluating responses,
    'context': context for the image
}

If not data path specified, loads a demo_example specified in worlds.py

Specify `--image-path` for the path to the IGC images, where each example
is saved as <image_id>.jpg


NOTE: You can download the IGC Test Set from
    https://www.microsoft.com/en-us/download/details.aspx?id=55324

And you can use the `download_igc_images.py` script to download the images
(please put the IGC_crowd_test.csv file in this directory to use the script)
\end{DoxyVerb}
 

Definition at line 16 of file run.\+py.


\begin{DoxyCode}
16 \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1mturk__evaluation__task_1_1run_ad3ab2c71f8083c3112815c0b363d316b}{main}():
17     \textcolor{stringliteral}{"""}
18 \textcolor{stringliteral}{    IGC Human Evaluation.}
19 \textcolor{stringliteral}{}
20 \textcolor{stringliteral}{    Specify the `--eval-data-path` to load examples for evaluation.}
21 \textcolor{stringliteral}{}
22 \textcolor{stringliteral}{    The data in `--eval-data-path` should be formatted as a dictionary}
23 \textcolor{stringliteral}{    mapping IGC image ids to dicts with the following fields:}
24 \textcolor{stringliteral}{    \{}
25 \textcolor{stringliteral}{        'questions': list of (<generator\_name>, <generated\_question>) tuples,}
26 \textcolor{stringliteral}{        'responses': list of (<generator\_name>, <generated\_response>) tuples,}
27 \textcolor{stringliteral}{        'question': question to use when evaluating responses,}
28 \textcolor{stringliteral}{        'context': context for the image}
29 \textcolor{stringliteral}{    \}}
30 \textcolor{stringliteral}{}
31 \textcolor{stringliteral}{    If not data path specified, loads a demo\_example specified in worlds.py}
32 \textcolor{stringliteral}{}
33 \textcolor{stringliteral}{    Specify `--image-path` for the path to the IGC images, where each example}
34 \textcolor{stringliteral}{    is saved as <image\_id>.jpg}
35 \textcolor{stringliteral}{}
36 \textcolor{stringliteral}{}
37 \textcolor{stringliteral}{    NOTE: You can download the IGC Test Set from}
38 \textcolor{stringliteral}{        https://www.microsoft.com/en-us/download/details.aspx?id=55324}
39 \textcolor{stringliteral}{}
40 \textcolor{stringliteral}{    And you can use the `download\_igc\_images.py` script to download the images}
41 \textcolor{stringliteral}{    (please put the IGC\_crowd\_test.csv file in this directory to use the script)}
42 \textcolor{stringliteral}{    """}
43     argparser = ParlaiParser(\textcolor{keyword}{False}, \textcolor{keyword}{False})
44     argparser.add\_parlai\_data\_path()
45     argparser.add\_mturk\_args()
46     argparser.add\_argument(
47         \textcolor{stringliteral}{'-min\_t'}, \textcolor{stringliteral}{'--min\_turns'}, default=3, type=int, help=\textcolor{stringliteral}{'minimum number of turns'}
48     )
49     argparser.add\_argument(
50         \textcolor{stringliteral}{'-mt'}, \textcolor{stringliteral}{'--max\_turns'}, default=5, type=int, help=\textcolor{stringliteral}{'maximal number of chat turns'}
51     )
52     argparser.add\_argument(
53         \textcolor{stringliteral}{'-mx\_rsp\_time'},
54         \textcolor{stringliteral}{'--max\_resp\_time'},
55         default=1800,
56         type=int,
57         help=\textcolor{stringliteral}{'time limit for entering a dialog message'},
58     )
59     argparser.add\_argument(
60         \textcolor{stringliteral}{'-mx\_onb\_time'},
61         \textcolor{stringliteral}{'--max\_onboard\_time'},
62         type=int,
63         default=300,
64         help=\textcolor{stringliteral}{'time limit for turker'} \textcolor{stringliteral}{'in onboarding'},
65     )
66     argparser.add\_argument(
67         \textcolor{stringliteral}{'-ni'},
68         \textcolor{stringliteral}{'--num\_images'},
69         type=int,
70         default=5,
71         help=\textcolor{stringliteral}{'number of images to show \(\backslash\)}
72 \textcolor{stringliteral}{                           to turker'},
73     )
74     argparser.add\_argument(
75         \textcolor{stringliteral}{'--auto-approve-delay'},
76         type=int,
77         default=3600 * 24,
78         help=\textcolor{stringliteral}{'how long to wait for  \(\backslash\)}
79 \textcolor{stringliteral}{                           auto approval'},
80     )
81     argparser.add\_argument(
82         \textcolor{stringliteral}{'--data-path'}, type=str, default=\textcolor{stringliteral}{''}, help=\textcolor{stringliteral}{'where to save data'}
83     )
84     argparser.add\_argument(
85         \textcolor{stringliteral}{'--eval-data-path'},
86         type=str,
87         default=\textcolor{stringliteral}{''},
88         help=\textcolor{stringliteral}{'path to file with candidates to '} \textcolor{stringliteral}{'evaluate'},
89     )
90     argparser.add\_argument(
91         \textcolor{stringliteral}{'--image-path'}, type=str, default=\textcolor{stringliteral}{''}, help=\textcolor{stringliteral}{'path to IGC images'}
92     )
93     argparser.add\_argument(
94         \textcolor{stringliteral}{'-rnd'},
95         \textcolor{stringliteral}{'--dialog-round'},
96         type=str,
97         default=\textcolor{stringliteral}{'questions'},
98         choices=round\_choices,
99         help=\textcolor{stringliteral}{'which dialog round to show'},
100     )
101 
102     opt = argparser.parse\_args()
103     directory\_path = os.path.dirname(os.path.abspath(\_\_file\_\_))
104     opt[\textcolor{stringliteral}{'task'}] = os.path.basename(directory\_path)
105     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'data\_path'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt \textcolor{keywordflow}{or} opt[\textcolor{stringliteral}{'data\_path'}] == \textcolor{stringliteral}{''}:
106         opt[\textcolor{stringliteral}{'data\_path'}] = \textcolor{stringliteral}{"\{\}/data/\{\}\_evals"}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(os.getcwd(), opt[\textcolor{stringliteral}{'dialog\_round'}])
107     opt[\textcolor{stringliteral}{'task\_dir'}] = os.getcwd()
108     \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'dialog\_round'}] == \textcolor{stringliteral}{'questions'}:
109         opt.update(tc\_questions)
110     \textcolor{keywordflow}{else}:
111         opt.update(tc\_responses)
112 
113     mturk\_agent\_ids = [RATER]
114     mturk\_manager = MTurkManager(opt=opt, mturk\_agent\_ids=mturk\_agent\_ids)
115 
116     example\_generator = IGCExampleGenerator(opt)
117     mturk\_manager.setup\_server(task\_directory\_path=directory\_path)
118 
119     \textcolor{keywordflow}{try}:
120         mturk\_manager.start\_new\_run()
121 
122         \textcolor{keyword}{def }run\_onboard(worker):
123             worker.example\_generator = example\_generator
124             world = RoleOnboardWorld(opt, worker)
125             world.parley()
126             world.shutdown()
127 
128         mturk\_manager.set\_onboard\_function(onboard\_function=run\_onboard)
129         mturk\_manager.ready\_to\_accept\_workers()
130         mturk\_manager.create\_hits()
131 
132         \textcolor{keyword}{def }check\_worker\_eligibility(worker):
133             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
134 
135         \textcolor{keyword}{def }assign\_worker\_roles(workers):
136             \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} workers:
137                 w.id = mturk\_agent\_ids[0]
138 
139         \textcolor{keyword}{def }run\_conversation(mturk\_manager, opt, workers):
140             agents = workers[:]
141             conv\_idx = mturk\_manager.conversation\_index
142             world = MTurkIGCEvalWorld(
143                 opt, agents=agents, world\_tag=\textcolor{stringliteral}{'conversation t\_\{\}'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(conv\_idx)
144             )
145             \textcolor{keywordflow}{while} \textcolor{keywordflow}{not} world.episode\_done():
146                 world.parley()
147             world.save\_data()
148 
149             world.shutdown()
150             world.review\_work()
151 
152         mturk\_manager.start\_task(
153             eligibility\_function=check\_worker\_eligibility,
154             assign\_role\_function=assign\_worker\_roles,
155             task\_function=run\_conversation,
156         )
157 
158     \textcolor{keywordflow}{except} BaseException:
159         \textcolor{keywordflow}{raise}
160     \textcolor{keywordflow}{finally}:
161         mturk\_manager.expire\_all\_unassigned\_hits()
162         mturk\_manager.shutdown()
163 
164 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespaceigc__evals_1_1run_a8d800bb89949fff41662851f88503919}\label{namespaceigc__evals_1_1run_a8d800bb89949fff41662851f88503919}} 
\index{igc\+\_\+evals\+::run@{igc\+\_\+evals\+::run}!round\+\_\+choices@{round\+\_\+choices}}
\index{round\+\_\+choices@{round\+\_\+choices}!igc\+\_\+evals\+::run@{igc\+\_\+evals\+::run}}
\subsubsection{\texorpdfstring{round\+\_\+choices}{round\_choices}}
{\footnotesize\ttfamily igc\+\_\+evals.\+run.\+round\+\_\+choices}



Definition at line 13 of file run.\+py.

