\hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent}{}\section{projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent Class Reference}
\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent}\index{projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent@{projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent}}


Inheritance diagram for projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=282pt]{dd/dc0/classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=282pt]{d9/d90/classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ab1b2afa2c94021384b2f749e7441f588}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self, \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a4e25d0aaf32c5bcc9429c6825ba214c4}{opt}, shared=None)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aa0f3a677ef0e7d3d0f573b98bc0eed9d}{override\+\_\+opt} (self, new\+\_\+opt)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a080532403c383e18fff08420558ecccf}{parse} (self, text)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a0c38fac50edaf23833de870e37bccb97}{t2v} (self, text)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a07a7ef79c4bae6151aad5b7b765be9bc}{v2t} (self, vec)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a7c6b549658b7ee5148af60c180e803b1}{zero\+\_\+grad} (self)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a9760c8b1b1b905f09de43413ad51a69b}{update\+\_\+params} (self)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aedce45a699479a98d38bcb78b36dd1ea}{reset} (self)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a713175baa1cbbcb147c34ec1bac8f77a}{share} (self)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_af64ed055aff5efbdea21ce93c18c221a}{observe} (self, \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_afd7921cc7a7e9aa7a8d3a454cf6d6176}{observation})
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a4b5b1dd2efa6f00f39f773f0b48edfc7}{report2} (self)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ad4f013360fde46e2974fcf0f65a99e3d}{reset\+\_\+metrics} (self, keep\+\_\+total=False)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ac64d59e43aa1ca2b874c7e736bd3a93d}{compute\+\_\+metrics} (self, loss, scores, mlp\+\_\+time, non\+\_\+mlp\+\_\+time)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a1b9834569393e1e53821567503fc6383}{same} (self, y1, y2)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a09465d37d783449e34b969287abb1a0c}{get\+\_\+negs} (self, xs, ys)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ab8a2b71536cfafcf4ed74a7a172ed81c}{dict\+\_\+neighbors} (self, word, use\+R\+HS=False)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a40a3b9f66a331d05394869c709d4a02a}{predict} (self, xs, ys=None, \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a7f13d1272a33cdc7d0d6de07eaf67db8}{cands}=None, cands\+\_\+txt=None, obs=None)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ab5ea8fd94b0871ae14c7fafe41aa7af2}{batchify} (self, observations)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_acdb68ad3ee78406e564655bfe27b2ef2}{add\+\_\+to\+\_\+ys\+\_\+cache} (self, ys)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_afded126c755a6cf5401a99f88f0799f9}{batch\+\_\+act} (self, observations)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ace2d3cdd13cde1b41690ed55066a0d10}{act} (self)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a1e8a1089e7ecea911029c96d95f8b62a}{shutdown} (self)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a739a619a844360c3bf8a6e6b8879c341}{save} (self, path=None)
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a925938f3ecf2972ba0d35f0a915afdaf}{load} (self, path)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a5b97a313aca270ad38c6ff48b1e9695a}{dictionary\+\_\+class} ()
\item 
def \hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a2428cf6a8e0a0e5adcdc7ba261e305b5}{add\+\_\+cmdline\+\_\+args} (argparser)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a2653501d48cf8661f1029da9b40615aa}{id}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a735511597db72af2e4e13d26c4295415}{N\+U\+L\+L\+\_\+\+I\+DX}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a9897f8ce9952e909e3381cb9626d3c3f}{start2}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a7f13d1272a33cdc7d0d6de07eaf67db8}{cands}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aa697cc9113a1b4894ce83b3a0e65de68}{ys\+\_\+cache}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a9c5c9281c032bbe9e028230700e51006}{ys\+\_\+cache\+\_\+sz}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ac98593d77b62bcff6980f46fcd2afb25}{truncate}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ae2986233a39d3af2c0a9a02e563e33eb}{history}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_abefa2913cd8ba218e8a46723c1b4cafd}{threadindex}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a3cc3e3a4ad7a3c00db24dc14fa4a707f}{dict}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ad1f6d5ed2b9f885f74d4fb36dc36a378}{model}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ae0828c6c5229d640f49e76415ee6a980}{fixedX}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a3735e269f0968c3a23a946e01ef8d05c}{fixed\+Cands}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_afcf4c52a9f37ba1f70114c8c935f99fe}{fixed\+Cands\+\_\+txt}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_abf77c5e5fcd5202978f9a880ff41b4d1}{fixed\+Cands2}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a1f97013332930c41aa8839be4fc78b40}{fixed\+Cands\+\_\+txt2}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a8a124eccb81be3ce6c44ccb3974acc68}{criterion}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a197c4ee11a4536d738a632f46847cc89}{take\+\_\+next\+\_\+utt}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a4e00699d90d4efcc4c7565877a3d2adc}{cands\+\_\+done}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aad3af91663688393121d6475cadec9cc}{interactive\+Mode}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_afd7921cc7a7e9aa7a8d3a454cf6d6176}{observation}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a6026c6d8fc17ff4dd51536087fce18b5}{episode\+\_\+done}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ae9a0118914d6d1c9be4ecc428934b537}{optimizer}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aca0257f35b72dc504f9edc52a7de433e}{metrics}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a18725fe3d8fafd7f7bb77375d9746243}{start}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_abfdc212a6bfaa2af3eafcff11734d05c}{twohoputt}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a17cc75d3ddbb3859ad5bee04542acd53}{tricks}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a4e25d0aaf32c5bcc9429c6825ba214c4}{opt}
\end{DoxyCompactItemize}
\subsection*{Static Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a0e510a2935777fbec0fb930628377415}{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}Simple implementation of the memnn algorithm with 1 hop.
\end{DoxyVerb}
 

Definition at line 139 of file kvmemnn.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ab1b2afa2c94021384b2f749e7441f588}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ab1b2afa2c94021384b2f749e7441f588}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{opt,  }\item[{}]{shared = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Set up model if shared params not set, otherwise no work to do.
\end{DoxyVerb}
 

Definition at line 289 of file kvmemnn.\+py.


\begin{DoxyCode}
289     \textcolor{keyword}{def }\_\_init\_\_(self, opt, shared=None):
290         \textcolor{stringliteral}{"""}
291 \textcolor{stringliteral}{        Set up model if shared params not set, otherwise no work to do.}
292 \textcolor{stringliteral}{        """}
293         super().\_\_init\_\_(opt, shared)
294         opt = self.opt
295         \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'batchsize'}, 1) > 1:
296             \textcolor{keywordflow}{raise} RuntimeError(
297                 \textcolor{stringliteral}{'Kvmemnn model does not support batchsize > 1, '}
298                 \textcolor{stringliteral}{'try training with numthreads > 1 instead.'}
299             )
300         self.reset\_metrics()
301         \textcolor{comment}{# all instances needs truncate param}
302         self.id = \textcolor{stringliteral}{'Kvmemnn'}
303         self.NULL\_IDX = 0
304         self.start2 = 99
305         \textcolor{comment}{# set up tensors once}
306         self.cands = torch.LongTensor(1, 1, 1)
307         self.ys\_cache = []
308         self.ys\_cache\_sz = opt[\textcolor{stringliteral}{'cache\_size'}]
309         self.truncate = opt[\textcolor{stringliteral}{'truncate'}] \textcolor{keywordflow}{if} opt[\textcolor{stringliteral}{'truncate'}] > 0 \textcolor{keywordflow}{else} \textcolor{keywordtype}{None}
310         self.history = \{\}
311         \textcolor{keywordflow}{if} shared:
312             torch.set\_num\_threads(1)
313             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'threadindex'} \textcolor{keywordflow}{in} shared:
314                 self.threadindex = shared[\textcolor{stringliteral}{'threadindex'}]
315             \textcolor{keywordflow}{else}:
316                 self.threadindex = 1
317             \textcolor{comment}{# set up shared properties}
318             self.dict = shared[\textcolor{stringliteral}{'dict'}]
319             \textcolor{comment}{# answers contains a batch\_size list of the last answer produced}
320             self.model = shared[\textcolor{stringliteral}{'model'}]  \textcolor{comment}{# Kvmemnn(opt, len(self.dict))}
321             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'fixedX'} \textcolor{keywordflow}{in} shared:
322                 self.fixedX = shared[\textcolor{stringliteral}{'fixedX'}]
323                 self.fixedCands = shared[\textcolor{stringliteral}{'fixedCands'}]
324                 self.fixedCands\_txt = shared[\textcolor{stringliteral}{'fixedCands\_txt'}]
325                 self.fixedCands2 = shared[\textcolor{stringliteral}{'fixedCands2'}]
326                 self.fixedCands\_txt2 = shared[\textcolor{stringliteral}{'fixedCands\_txt2'}]
327         \textcolor{keywordflow}{else}:
328             print(\textcolor{stringliteral}{"[ creating KvmemnnAgent ]"})
329             \textcolor{comment}{# this is not a shared instance of this class, so do full init}
330             self.threadindex = -1
331             torch.set\_num\_threads(1)
332 
333             \textcolor{keywordflow}{if} (opt[\textcolor{stringliteral}{'dict\_file'}] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{and} opt.get(\textcolor{stringliteral}{'model\_file'})) \textcolor{keywordflow}{or} os.path.isfile(
334                 opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'.dict'}
335             ):
336                 \textcolor{comment}{# set default dict-file if not set}
337                 opt[\textcolor{stringliteral}{'dict\_file'}] = opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'.dict'}
338             \textcolor{comment}{# load dictionary and basic tokens & vectors}
339             self.dict = DictionaryAgent(opt)
340             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'loss'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} opt:
341                 opt[\textcolor{stringliteral}{'loss'}] = \textcolor{stringliteral}{'cosine'}
342             self.model = Kvmemnn(opt, len(self.dict), self.dict)
343             \textcolor{keywordflow}{if} opt.get(\textcolor{stringliteral}{'model\_file'}) \textcolor{keywordflow}{and} os.path.isfile(opt[\textcolor{stringliteral}{'model\_file'}]):
344                 self.load(opt[\textcolor{stringliteral}{'model\_file'}])
345             self.model.share\_memory()
346 
347             self.fixedCands = \textcolor{keyword}{False}
348             self.fixedX = \textcolor{keywordtype}{None}
349             path = opt[\textcolor{stringliteral}{'model\_file'}] + \textcolor{stringliteral}{'.candspair'}
350             \textcolor{keywordflow}{if} os.path.isfile(path) \textcolor{keywordflow}{and} opt.get(\textcolor{stringliteral}{'loadcands'}) \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keyword}{False}:
351                 print(\textcolor{stringliteral}{"[loading candidates: "} + path + \textcolor{stringliteral}{"*]"})
352                 fc = \hyperlink{namespaceprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_a7f44d8ff34857c26b87223a668c43724}{load\_cands}(path)
353                 fcs = []
354                 \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} fc:
355                     fcs.append(Variable(torch.LongTensor(self.parse(c)).unsqueeze(0)))
356                 self.fixedCands = fcs
357                 self.fixedCands\_txt = fc
358                 fc2 = \hyperlink{namespaceprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_a7f44d8ff34857c26b87223a668c43724}{load\_cands}(path + \textcolor{stringliteral}{"2"})
359                 fcs2 = []
360                 \textcolor{keywordflow}{for} c2 \textcolor{keywordflow}{in} fc2:
361                     fcs2.append(Variable(torch.LongTensor(self.parse(c2)).unsqueeze(0)))
362                 self.fixedCands2 = fcs2
363                 self.fixedCands\_txt2 = fc2
364                 print(\textcolor{stringliteral}{"[caching..]"})
365                 xsq = Variable(torch.LongTensor([self.parse(\textcolor{stringliteral}{'nothing'})]))
366                 xe, ye = self.model(xsq, [], \textcolor{keywordtype}{None}, self.fixedCands)
367                 self.fixedX = ye
368             print(\textcolor{stringliteral}{"=init done="})
369 
370         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'loss'}] == \textcolor{stringliteral}{'cosine'}:
371             self.criterion = torch.nn.CosineEmbeddingLoss(
372                 margin=opt[\textcolor{stringliteral}{'margin'}], size\_average=\textcolor{keyword}{False}
373             )
374         \textcolor{keywordflow}{elif} self.opt[\textcolor{stringliteral}{'loss'}] == \textcolor{stringliteral}{'nll'}:
375             self.criterion = nn.CrossEntropyLoss(ignore\_index=-100)
376         \textcolor{keywordflow}{else}:
377             \textcolor{keywordflow}{raise} RuntimeError(\textcolor{stringliteral}{'unspecified loss'})
378         \textcolor{comment}{# self.criterion = torch.nn.MultiMarginLoss(p=1, margin=0.1)}
379         self.reset()
380         \textcolor{comment}{# can be used to look at embeddings:}
381         \textcolor{comment}{# self.dict\_neighbors('coffee')}
382         self.take\_next\_utt = \textcolor{keyword}{True}
383         self.cands\_done = []
384         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'interactive\_mode'} \textcolor{keywordflow}{in} opt:
385             self.interactiveMode = self.opt[\textcolor{stringliteral}{'interactive\_mode'}]
386         \textcolor{keywordflow}{else}:
387             self.interactiveMode = \textcolor{keyword}{False}
388         \textcolor{keywordflow}{if} self.interactiveMode:
389             print(\textcolor{stringliteral}{"[ Interactive mode ]"})
390 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ace2d3cdd13cde1b41690ed55066a0d10}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ace2d3cdd13cde1b41690ed55066a0d10}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!act@{act}}
\index{act@{act}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{act()}{act()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+act (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 907 of file kvmemnn.\+py.


\begin{DoxyCode}
907     \textcolor{keyword}{def }act(self):
908         \textcolor{comment}{# call batch\_act with this batch of one}
909         \textcolor{keywordflow}{return} self.batch\_act([self.observation])[0]
910 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a2428cf6a8e0a0e5adcdc7ba261e305b5}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a2428cf6a8e0a0e5adcdc7ba261e305b5}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}}
\index{add\+\_\+cmdline\+\_\+args@{add\+\_\+cmdline\+\_\+args}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+cmdline\+\_\+args()}{add\_cmdline\_args()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+add\+\_\+cmdline\+\_\+args (\begin{DoxyParamCaption}\item[{}]{argparser }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\begin{DoxyVerb}Add command-line arguments specifically for this agent.
\end{DoxyVerb}
 

Definition at line 161 of file kvmemnn.\+py.


\begin{DoxyCode}
161     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(argparser):
162         \textcolor{stringliteral}{"""}
163 \textcolor{stringliteral}{        Add command-line arguments specifically for this agent.}
164 \textcolor{stringliteral}{        """}
165         KvmemnnAgent.dictionary\_class().\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1config_a62fdd5554f1da6be0cba185271058320}{add\_cmdline\_args}(argparser)
166         agent = argparser.add\_argument\_group(\textcolor{stringliteral}{'Kvmemnn Arguments'})
167         agent.add\_argument(\textcolor{stringliteral}{'--hops'}, type=int, default=1, help=\textcolor{stringliteral}{'num hops'})
168         agent.add\_argument(
169             \textcolor{stringliteral}{'--lins'}, type=int, default=0, help=\textcolor{stringliteral}{'num lins projecting after hops'}
170         )
171         agent.add\_argument(
172             \textcolor{stringliteral}{'-esz'},
173             \textcolor{stringliteral}{'--embeddingsize'},
174             type=int,
175             default=128,
176             help=\textcolor{stringliteral}{'size of the token embeddings'},
177         )
178         agent.add\_argument(
179             \textcolor{stringliteral}{'-enorm'},
180             \textcolor{stringliteral}{'--embeddingnorm'},
181             type=float,
182             default=10,
183             help=\textcolor{stringliteral}{'max norm of word embeddings'},
184         )
185         agent.add\_argument(
186             \textcolor{stringliteral}{'-shareEmb'},
187             \textcolor{stringliteral}{'--share-embeddings'},
188             type=\textcolor{stringliteral}{'bool'},
189             default=\textcolor{keyword}{True},
190             help=\textcolor{stringliteral}{'whether LHS and RHS share embeddings'},
191         )
192         agent.add\_argument(
193             \textcolor{stringliteral}{'-lr'}, \textcolor{stringliteral}{'--learningrate'}, type=float, default=0.005, help=\textcolor{stringliteral}{'learning rate'}
194         )
195         agent.add\_argument(
196             \textcolor{stringliteral}{'-margin'}, \textcolor{stringliteral}{'--margin'}, type=float, default=0.3, help=\textcolor{stringliteral}{'margin'}
197         )
198         agent.add\_argument(
199             \textcolor{stringliteral}{'-loss'}, \textcolor{stringliteral}{'--loss'}, default=\textcolor{stringliteral}{'cosine'}, choices=\{\textcolor{stringliteral}{'cosine'}, \textcolor{stringliteral}{'nll'}\}
200         )
201         agent.add\_argument(
202             \textcolor{stringliteral}{'-opt'},
203             \textcolor{stringliteral}{'--optimizer'},
204             default=\textcolor{stringliteral}{'sgd'},
205             choices=KvmemnnAgent.OPTIM\_OPTS.keys(),
206             help=\textcolor{stringliteral}{'Choose between pytorch optimizers. '}
207             \textcolor{stringliteral}{'Any member of torch.optim is valid and will '}
208             \textcolor{stringliteral}{'be used with default params except learning '}
209             \textcolor{stringliteral}{'rate (as specified by -lr).'},
210         )
211         agent.add\_argument(
212             \textcolor{stringliteral}{'-tr'},
213             \textcolor{stringliteral}{'--truncate'},
214             type=int,
215             default=-1,
216             help=\textcolor{stringliteral}{'truncate input & output lengths to speed up '}
217             \textcolor{stringliteral}{'training (may reduce accuracy). This fixes all '}
218             \textcolor{stringliteral}{'input and output to have a maximum length.'},
219         )
220         agent.add\_argument(
221             \textcolor{stringliteral}{'-k'},
222             \textcolor{stringliteral}{'--neg-samples'},
223             type=int,
224             default=10,
225             help=\textcolor{stringliteral}{'number k of negative samples per example'},
226         )
227         agent.add\_argument(
228             \textcolor{stringliteral}{'--parrot-neg'}, type=int, default=0, help=\textcolor{stringliteral}{'include query as a negative'}
229         )
230         agent.add\_argument(
231             \textcolor{stringliteral}{'--take-next-utt'}, type=\textcolor{stringliteral}{'bool'}, default=\textcolor{keyword}{False}, help=\textcolor{stringliteral}{'take next utt'}
232         )
233         agent.add\_argument(
234             \textcolor{stringliteral}{'--twohop-range'},
235             type=int,
236             default=100,
237             help=\textcolor{stringliteral}{'2 hop range constraint for num rescored utterances'},
238         )
239         agent.add\_argument(
240             \textcolor{stringliteral}{'--twohop-blend'},
241             type=float,
242             default=0,
243             help=\textcolor{stringliteral}{'2 hop blend in the first hop scores if > 0'},
244         )
245         agent.add\_argument(
246             \textcolor{stringliteral}{'--kvmemnn-debug'},
247             type=\textcolor{stringliteral}{'bool'},
248             default=\textcolor{keyword}{False},
249             help=\textcolor{stringliteral}{'print debug information'},
250         )
251         agent.add\_argument(
252             \textcolor{stringliteral}{'--tfidf'},
253             type=\textcolor{stringliteral}{'bool'},
254             default=\textcolor{keyword}{False},
255             help=\textcolor{stringliteral}{'Use frequency based normalization for embeddings.'},
256         )
257         agent.add\_argument(
258             \textcolor{stringliteral}{'-cs'},
259             \textcolor{stringliteral}{'--cache-size'},
260             type=int,
261             default=1000,
262             help=\textcolor{stringliteral}{'size of negative sample cache to draw from'},
263         )
264         agent.add\_argument(
265             \textcolor{stringliteral}{'-hist'},
266             \textcolor{stringliteral}{'--history-length'},
267             default=100,
268             type=int,
269             help=\textcolor{stringliteral}{'Number of past tokens to remember. '},
270         )
271         agent.add\_argument(
272             \textcolor{stringliteral}{'-histr'},
273             \textcolor{stringliteral}{'--history-replies'},
274             default=\textcolor{stringliteral}{'label'},
275             type=str,
276             choices=[\textcolor{stringliteral}{'none'}, \textcolor{stringliteral}{'model'}, \textcolor{stringliteral}{'label'}],
277             help=\textcolor{stringliteral}{'Keep replies in the history, or not.'},
278         )
279         agent.add\_argument(
280             \textcolor{stringliteral}{'--interactive-mode'}, default=\textcolor{keyword}{False}, type=\textcolor{stringliteral}{'bool'}, choices=[\textcolor{keyword}{True}, \textcolor{keyword}{False}]
281         )
282         agent.add\_argument(
283             \textcolor{stringliteral}{'--loadcands'},
284             type=\textcolor{stringliteral}{'bool'},
285             default=\textcolor{keyword}{True},
286             help=\textcolor{stringliteral}{'Load candidates to rank from .candspair files, or not.'},
287         )
288 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_acdb68ad3ee78406e564655bfe27b2ef2}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_acdb68ad3ee78406e564655bfe27b2ef2}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!add\+\_\+to\+\_\+ys\+\_\+cache@{add\+\_\+to\+\_\+ys\+\_\+cache}}
\index{add\+\_\+to\+\_\+ys\+\_\+cache@{add\+\_\+to\+\_\+ys\+\_\+cache}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{add\+\_\+to\+\_\+ys\+\_\+cache()}{add\_to\_ys\_cache()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+add\+\_\+to\+\_\+ys\+\_\+cache (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{ys }\end{DoxyParamCaption})}



Definition at line 881 of file kvmemnn.\+py.


\begin{DoxyCode}
881     \textcolor{keyword}{def }add\_to\_ys\_cache(self, ys):
882         \textcolor{keywordflow}{if} ys \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} len(ys) == 0:
883             \textcolor{keywordflow}{return}
884         \textcolor{keywordflow}{if} len(self.ys\_cache) < self.ys\_cache\_sz:
885             self.ys\_cache.append(copy.deepcopy(ys))
886         \textcolor{keywordflow}{else}:
887             ind = random.randint(0, self.ys\_cache\_sz - 1)
888             self.ys\_cache[ind] = copy.deepcopy(ys)
889 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_afded126c755a6cf5401a99f88f0799f9}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_afded126c755a6cf5401a99f88f0799f9}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!batch\+\_\+act@{batch\+\_\+act}}
\index{batch\+\_\+act@{batch\+\_\+act}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{batch\+\_\+act()}{batch\_act()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+batch\+\_\+act (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observations }\end{DoxyParamCaption})}



Definition at line 890 of file kvmemnn.\+py.


\begin{DoxyCode}
890     \textcolor{keyword}{def }batch\_act(self, observations):
891         batchsize = len(observations)
892         \textcolor{comment}{# initialize a table of replies with this agent's id}
893         batch\_reply = [\{\textcolor{stringliteral}{'id'}: self.getID()\} \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(batchsize)]
894 
895         \textcolor{keywordflow}{if} batchsize == 0 \textcolor{keywordflow}{or} \textcolor{stringliteral}{'text'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} observations[0]:
896             \textcolor{keywordflow}{return} [\{\textcolor{stringliteral}{'text'}: \textcolor{stringliteral}{'dunno'}\}]
897 
898         \textcolor{comment}{# convert the observations into batches of inputs and targets}
899         \textcolor{comment}{# valid\_inds tells us the indices of all valid examples}
900         \textcolor{comment}{# e.g. for input [\{\}, \{'text': 'hello'\}, \{\}, \{\}], valid\_inds is [1]}
901         \textcolor{comment}{# since the other three elements had no 'text' field}
902         xs, ys, cands, cands\_txt = self.batchify(observations)
903         batch\_reply = self.predict(xs, ys, cands, cands\_txt, observations)
904         self.add\_to\_ys\_cache(ys)
905         \textcolor{keywordflow}{return} batch\_reply
906 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ab5ea8fd94b0871ae14c7fafe41aa7af2}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ab5ea8fd94b0871ae14c7fafe41aa7af2}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!batchify@{batchify}}
\index{batchify@{batchify}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{batchify()}{batchify()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+batchify (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observations }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert a list of observations into input & target tensors.
\end{DoxyVerb}
 

Definition at line 806 of file kvmemnn.\+py.


\begin{DoxyCode}
806     \textcolor{keyword}{def }\hyperlink{namespaceparlai_1_1agents_1_1drqa_1_1utils_aca22dd97c5b6dcda2a7479c1cb22ef1e}{batchify}(self, observations):
807         \textcolor{stringliteral}{"""}
808 \textcolor{stringliteral}{        Convert a list of observations into input & target tensors.}
809 \textcolor{stringliteral}{        """}
810 
811         \textcolor{keyword}{def }valid(obs):
812             \textcolor{comment}{# check if this is an example our model should actually process}
813             \textcolor{keywordflow}{return} \textcolor{stringliteral}{'query'} \textcolor{keywordflow}{in} obs \textcolor{keywordflow}{and} len(obs[\textcolor{stringliteral}{'query'}]) > 0
814 
815         \textcolor{keywordflow}{try}:
816             \textcolor{comment}{# valid examples and their indices}
817             valid\_inds, exs = zip(
818                 *[(i, ex) \textcolor{keywordflow}{for} i, ex \textcolor{keywordflow}{in} enumerate(observations) \textcolor{keywordflow}{if} valid(ex)]
819             )
820         \textcolor{keywordflow}{except} ValueError:
821             \textcolor{comment}{# zero examples to process in this batch, so zip failed to unpack}
822             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}
823 
824         \textcolor{comment}{# `x` text is already tokenized and truncated}
825         \textcolor{comment}{# sort by length so we can use pack\_padded}
826         parsed\_x = [ex[\textcolor{stringliteral}{'query'}] \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
827         x\_lens = [len(x) \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} parsed\_x]
828         ind\_sorted = sorted(range(len(x\_lens)), key=\textcolor{keyword}{lambda} k: -x\_lens[k])
829 
830         exs = [exs[k] \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} ind\_sorted]
831         valid\_inds = [valid\_inds[k] \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} ind\_sorted]
832         parsed\_x = [parsed\_x[k] \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} ind\_sorted]
833 
834         labels\_avail = any([\textcolor{stringliteral}{'labels'} \textcolor{keywordflow}{in} ex \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs])
835 
836         max\_x\_len = max([len(x) \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} parsed\_x])
837         \textcolor{keywordflow}{for} x \textcolor{keywordflow}{in} parsed\_x:
838             x += [self.NULL\_IDX] * (max\_x\_len - len(x))
839         xs = torch.LongTensor(parsed\_x)
840         xs = Variable(xs)
841 
842         \textcolor{comment}{# set up the target tensors}
843         ys = \textcolor{keywordtype}{None}
844         labels = \textcolor{keywordtype}{None}
845         \textcolor{keywordflow}{if} labels\_avail:
846             \textcolor{comment}{# randomly select one of the labels to update on, if multiple}
847             labels = [random.choice(ex.get(\textcolor{stringliteral}{'labels'}, [\textcolor{stringliteral}{''}])) \textcolor{keywordflow}{for} ex \textcolor{keywordflow}{in} exs]
848             \textcolor{comment}{# parse each label and append END}
849             parsed\_y = [deque(maxlen=self.truncate) \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} labels]
850             \textcolor{keywordflow}{for} dq, y \textcolor{keywordflow}{in} zip(parsed\_y, labels):
851                 dq.extendleft(reversed(self.parse(y)))
852             max\_y\_len = max(len(y) \textcolor{keywordflow}{for} y \textcolor{keywordflow}{in} parsed\_y)
853             \textcolor{keywordflow}{for} y \textcolor{keywordflow}{in} parsed\_y:
854                 y += [self.NULL\_IDX] * (max\_y\_len - len(y))
855             \textcolor{keywordflow}{if} len(parsed\_y[0]) == 0:
856                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}, \textcolor{keywordtype}{None}
857             \textcolor{keywordflow}{else}:
858                 ys = torch.LongTensor(parsed\_y)
859                 ys = Variable(ys)
860 
861         cands = []
862         cands\_txt = []
863         \textcolor{keywordflow}{if} ys \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
864             \textcolor{comment}{# only build candidates in eval mode.}
865             \textcolor{keywordflow}{for} o \textcolor{keywordflow}{in} observations:
866                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'label\_candidates'} \textcolor{keywordflow}{in} o \textcolor{keywordflow}{and} o[\textcolor{stringliteral}{'label\_candidates'}] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
867                     cs = []
868                     ct = []
869                     \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} o[\textcolor{stringliteral}{'label\_candidates'}]:
870                         cs.append(
871                             Variable(torch.LongTensor(self.parse(c)).unsqueeze(0))
872                         )
873                         ct.append(c)
874                     cands.append(cs)
875                     cands\_txt.append(ct)
876                 \textcolor{keywordflow}{else}:
877                     cands.append(\textcolor{keywordtype}{None})
878                     cands\_txt.append(\textcolor{keywordtype}{None})
879         \textcolor{keywordflow}{return} xs, ys, cands, cands\_txt
880 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ac64d59e43aa1ca2b874c7e736bd3a93d}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ac64d59e43aa1ca2b874c7e736bd3a93d}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!compute\+\_\+metrics@{compute\+\_\+metrics}}
\index{compute\+\_\+metrics@{compute\+\_\+metrics}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{compute\+\_\+metrics()}{compute\_metrics()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+compute\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{loss,  }\item[{}]{scores,  }\item[{}]{mlp\+\_\+time,  }\item[{}]{non\+\_\+mlp\+\_\+time }\end{DoxyParamCaption})}



Definition at line 559 of file kvmemnn.\+py.


\begin{DoxyCode}
559     \textcolor{keyword}{def }compute\_metrics(self, loss, scores, mlp\_time, non\_mlp\_time):
560         metrics = \{\}
561         pos = scores[0]
562         cnt = 0
563         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, len(scores)):
564             \textcolor{keywordflow}{if} scores[i] >= pos:
565                 cnt += 1
566         metrics[\textcolor{stringliteral}{'mean\_rank'}] = cnt
567         metrics[\textcolor{stringliteral}{'loss'}] = loss
568         metrics[\textcolor{stringliteral}{'tot\_time'}] = mlp\_time + non\_mlp\_time
569         metrics[\textcolor{stringliteral}{'mlp\_time'}] = mlp\_time
570         \textcolor{keywordflow}{return} metrics
571 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ab8a2b71536cfafcf4ed74a7a172ed81c}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ab8a2b71536cfafcf4ed74a7a172ed81c}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!dict\+\_\+neighbors@{dict\+\_\+neighbors}}
\index{dict\+\_\+neighbors@{dict\+\_\+neighbors}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{dict\+\_\+neighbors()}{dict\_neighbors()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+dict\+\_\+neighbors (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{word,  }\item[{}]{use\+R\+HS = {\ttfamily False} }\end{DoxyParamCaption})}



Definition at line 603 of file kvmemnn.\+py.


\begin{DoxyCode}
603     \textcolor{keyword}{def }dict\_neighbors(self, word, useRHS=False):
604         input = self.t2v(word)
605         W = self.model.encoder.lt.weight
606         q = W[input[0].item()]
607         \textcolor{keywordflow}{if} useRHS:
608             W = self.model.encoder2.lt.weight
609         score = torch.Tensor(W.size(0))
610         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(W.size(0)):
611             score[i] = torch.nn.functional.cosine\_similarity(q, W[i], dim=0)[0].item()
612         val, ind = score.sort(descending=\textcolor{keyword}{True})
613         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(20):
614             print(
615                 \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(ind[i])
616                 + \textcolor{stringliteral}{" ["}
617                 + \hyperlink{namespacegenerate__task__READMEs_a5b88452ffb87b78c8c85ececebafc09f}{str}(val[i])
618                 + \textcolor{stringliteral}{"]: "}
619                 + self.v2t(torch.Tensor([ind[i]]))
620             )
621 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a5b97a313aca270ad38c6ff48b1e9695a}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a5b97a313aca270ad38c6ff48b1e9695a}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!dictionary\+\_\+class@{dictionary\+\_\+class}}
\index{dictionary\+\_\+class@{dictionary\+\_\+class}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{dictionary\+\_\+class()}{dictionary\_class()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+dictionary\+\_\+class (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 157 of file kvmemnn.\+py.


\begin{DoxyCode}
157     \textcolor{keyword}{def }dictionary\_class():
158         \textcolor{keywordflow}{return} DictionaryAgent
159 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a09465d37d783449e34b969287abb1a0c}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a09465d37d783449e34b969287abb1a0c}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!get\+\_\+negs@{get\+\_\+negs}}
\index{get\+\_\+negs@{get\+\_\+negs}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{get\+\_\+negs()}{get\_negs()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+get\+\_\+negs (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{xs,  }\item[{}]{ys }\end{DoxyParamCaption})}



Definition at line 582 of file kvmemnn.\+py.


\begin{DoxyCode}
582     \textcolor{keyword}{def }get\_negs(self, xs, ys):
583         negs = []
584         \textcolor{comment}{# for neg in self.ys\_cache:}
585         cache\_sz = len(self.ys\_cache) - 1
586         \textcolor{keywordflow}{if} cache\_sz < 1:
587             \textcolor{keywordflow}{return} negs
588         k = self.opt[\textcolor{stringliteral}{'neg\_samples'}]
589         \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(1, k * 3):
590             index = random.randint(0, cache\_sz)
591             neg = self.ys\_cache[index]
592             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.same(ys.squeeze(0), neg.squeeze(0)):
593                 negs.append(neg)
594                 \textcolor{keywordflow}{if} len(negs) >= k:
595                     \textcolor{keywordflow}{break}
596         \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'parrot\_neg'}] > 0:
597             utt = self.history[\textcolor{stringliteral}{'last\_utterance'}]
598             \textcolor{keywordflow}{if} len(utt) > 2:
599                 query = Variable(torch.LongTensor(utt).unsqueeze(0))
600                 negs.append(query)
601         \textcolor{keywordflow}{return} negs
602 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a925938f3ecf2972ba0d35f0a915afdaf}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a925938f3ecf2972ba0d35f0a915afdaf}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!load@{load}}
\index{load@{load}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{load()}{load()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+load (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Return opt and model states.
\end{DoxyVerb}
 

Definition at line 930 of file kvmemnn.\+py.


\begin{DoxyCode}
930     \textcolor{keyword}{def }load(self, path):
931         \textcolor{stringliteral}{"""}
932 \textcolor{stringliteral}{        Return opt and model states.}
933 \textcolor{stringliteral}{        """}
934         with open(path, \textcolor{stringliteral}{'rb'}) \textcolor{keyword}{as} read:
935             print(\textcolor{stringliteral}{'Loading existing model params from '} + path)
936             data = torch.load(read)
937             self.model.load\_state\_dict(data[\textcolor{stringliteral}{'model'}])
938             self.reset()
939             self.optimizer.load\_state\_dict(data[\textcolor{stringliteral}{'optimizer'}])
940             self.opt = self.override\_opt(data[\textcolor{stringliteral}{'opt'}])
941 \end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_af64ed055aff5efbdea21ce93c18c221a}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_af64ed055aff5efbdea21ce93c18c221a}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!observe@{observe}}
\index{observe@{observe}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{observe()}{observe()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+observe (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{observation }\end{DoxyParamCaption})}



Definition at line 496 of file kvmemnn.\+py.


\begin{DoxyCode}
496     \textcolor{keyword}{def }observe(self, observation):
497         self.episode\_done = observation[\textcolor{stringliteral}{'episode\_done'}]
498         \textcolor{comment}{# shallow copy observation (deep copy can be expensive)}
499         obs = observation.copy()
500         obs[\textcolor{stringliteral}{'query'}], obs[\textcolor{stringliteral}{'mem'}] = \hyperlink{namespaceprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_afe498b578d5df47bf521e2b38dd61605}{maintain\_dialog\_history}(
501             self.history,
502             obs,
503             historyLength=self.opt[\textcolor{stringliteral}{'history\_length'}],
504             useReplies=self.opt[\textcolor{stringliteral}{'history\_replies'}],
505             dict=self.dict,
506             useStartEndIndices=\textcolor{keyword}{False},
507         )
508         self.observation = obs
509         \textcolor{keywordflow}{return} obs
510 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aa0f3a677ef0e7d3d0f573b98bc0eed9d}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aa0f3a677ef0e7d3d0f573b98bc0eed9d}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!override\+\_\+opt@{override\+\_\+opt}}
\index{override\+\_\+opt@{override\+\_\+opt}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{override\+\_\+opt()}{override\_opt()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+override\+\_\+opt (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{new\+\_\+opt }\end{DoxyParamCaption})}

\begin{DoxyVerb}Set overridable opts from loaded opt file.

Print out each added key and each overriden key. Only override args specific to
the model.
\end{DoxyVerb}
 

Definition at line 391 of file kvmemnn.\+py.


\begin{DoxyCode}
391     \textcolor{keyword}{def }override\_opt(self, new\_opt):
392         \textcolor{stringliteral}{"""}
393 \textcolor{stringliteral}{        Set overridable opts from loaded opt file.}
394 \textcolor{stringliteral}{}
395 \textcolor{stringliteral}{        Print out each added key and each overriden key. Only override args specific to}
396 \textcolor{stringliteral}{        the model.}
397 \textcolor{stringliteral}{        """}
398         model\_args = \{
399             \textcolor{stringliteral}{'hiddensize'},
400             \textcolor{stringliteral}{'embeddingsize'},
401             \textcolor{stringliteral}{'numlayers'},
402             \textcolor{stringliteral}{'optimizer'},
403             \textcolor{stringliteral}{'encoder'},
404             \textcolor{stringliteral}{'decoder'},
405             \textcolor{stringliteral}{'lookuptable'},
406             \textcolor{stringliteral}{'attention'},
407             \textcolor{stringliteral}{'attention\_length'},
408             \textcolor{stringliteral}{'fixed\_candidates\_file'},
409         \}
410         \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} new\_opt.items():
411             \textcolor{keywordflow}{if} k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} model\_args:
412                 \textcolor{comment}{# skip non-model args}
413                 \textcolor{keywordflow}{continue}
414             \textcolor{keywordflow}{if} k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.opt:
415                 print(\textcolor{stringliteral}{'Adding new option [ \{k\}: \{v\} ]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(k=k, v=v))
416             \textcolor{keywordflow}{elif} self.opt[k] != v:
417                 print(
418                     \textcolor{stringliteral}{'Overriding option [ \{k\}: \{old\} => \{v\}]'}.\hyperlink{namespaceparlai_1_1chat__service_1_1services_1_1messenger_1_1shared__utils_a32e2e2022b824fbaf80c747160b52a76}{format}(
419                         k=k, old=self.opt[k], v=v
420                     )
421                 )
422             self.opt[k] = v
423         \textcolor{keywordflow}{return} self.opt
424 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a080532403c383e18fff08420558ecccf}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a080532403c383e18fff08420558ecccf}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!parse@{parse}}
\index{parse@{parse}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{parse()}{parse()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+parse (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{text }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert string to token indices.
\end{DoxyVerb}
 

Definition at line 425 of file kvmemnn.\+py.


\begin{DoxyCode}
425     \textcolor{keyword}{def }parse(self, text):
426         \textcolor{stringliteral}{"""}
427 \textcolor{stringliteral}{        Convert string to token indices.}
428 \textcolor{stringliteral}{        """}
429         text = text.lower()
430         text = text.replace(\textcolor{stringliteral}{"n't"}, \textcolor{stringliteral}{" not"})
431         vec = self.dict.txt2vec(text)
432         \textcolor{keywordflow}{if} vec == []:
433             vec = [self.dict[self.dict.null\_token]]
434         \textcolor{keywordflow}{return} vec
435 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a40a3b9f66a331d05394869c709d4a02a}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a40a3b9f66a331d05394869c709d4a02a}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!predict@{predict}}
\index{predict@{predict}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{predict()}{predict()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+predict (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{xs,  }\item[{}]{ys = {\ttfamily None},  }\item[{}]{cands = {\ttfamily None},  }\item[{}]{cands\+\_\+txt = {\ttfamily None},  }\item[{}]{obs = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Produce a prediction from our model.

Update the model using the targets if available, otherwise rank candidates as
well if they are available and param is set.
\end{DoxyVerb}
 

Definition at line 622 of file kvmemnn.\+py.


\begin{DoxyCode}
622     \textcolor{keyword}{def }predict(self, xs, ys=None, cands=None, cands\_txt=None, obs=None):
623         \textcolor{stringliteral}{"""}
624 \textcolor{stringliteral}{        Produce a prediction from our model.}
625 \textcolor{stringliteral}{}
626 \textcolor{stringliteral}{        Update the model using the targets if available, otherwise rank candidates as}
627 \textcolor{stringliteral}{        well if they are available and param is set.}
628 \textcolor{stringliteral}{        """}
629         self.start = time.time()
630         \textcolor{keywordflow}{if} xs \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
631             \textcolor{keywordflow}{return} [\{\}]
632         is\_training = ys \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}
633         \textcolor{keywordflow}{if} is\_training:  \textcolor{comment}{#}
634             negs = self.get\_negs(xs, ys)
635             \textcolor{keywordflow}{if} len(negs) > 0:
636                 self.model.\hyperlink{namespaceprojects_1_1mastering__the__dungeon_1_1mturk_1_1tasks_1_1MTD_1_1run_a36a5f4f6f9df0611a6818610518d2cf0}{train}()
637                 self.zero\_grad()
638                 \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'loss'}] == \textcolor{stringliteral}{'cosine'}:
639                     xe, ye = self.model(xs, obs[0][\textcolor{stringliteral}{'mem'}], ys, negs)
640                     y = Variable(-torch.ones(xe.size(0)))
641                     y[0] = 1
642                     loss = self.criterion(xe, ye, y)
643                 \textcolor{keywordflow}{else}:
644                     x = self.model(xs, obs[0][\textcolor{stringliteral}{'mem'}], ys, negs)
645                     y = Variable(torch.LongTensor([0]))
646                     loss = self.criterion(x.unsqueeze(0), y)
647                 loss.backward()
648                 self.update\_params()
649                 rest = 0
650                 \textcolor{keywordflow}{if} self.start2 != 99:
651                     rest = self.start - self.start2
652                 self.start2 = time.time()
653                 \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'loss'}] == \textcolor{stringliteral}{'cosine'}:
654                     pred = nn.CosineSimilarity().forward(xe, ye)
655                 \textcolor{keywordflow}{else}:
656                     pred = x
657                 metrics = self.compute\_metrics(
658                     loss.item(), pred.squeeze(0), self.start2 - self.start, rest
659                 )
660                 \textcolor{keywordflow}{return} [\{\textcolor{stringliteral}{'metrics'}: metrics\}]
661         \textcolor{keywordflow}{else}:
662             fixed = \textcolor{keyword}{False}
663             \textcolor{keywordflow}{if} hasattr(self, \textcolor{stringliteral}{'fixedCands'}) \textcolor{keywordflow}{and} self.fixedCands:
664                 self.take\_next\_utt = \textcolor{keyword}{True}
665                 self.twohoputt = \textcolor{keyword}{True}
666                 self.tricks = \textcolor{keyword}{True}
667             \textcolor{keywordflow}{else}:
668                 self.take\_next\_utt = \textcolor{keyword}{False}
669                 self.twohoputt = \textcolor{keyword}{False}
670                 self.tricks = \textcolor{keyword}{False}
671             \textcolor{keywordflow}{if} cands \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} cands[0] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{or} self.take\_next\_utt:
672                 \textcolor{comment}{# cannot predict without candidates.}
673                 \textcolor{keywordflow}{if} self.fixedCands \textcolor{keywordflow}{or} self.take\_next\_utt:
674                     cands\_txt2 = [self.fixedCands\_txt2]
675                     fixed = \textcolor{keyword}{True}
676                 \textcolor{keywordflow}{else}:
677                     \textcolor{keywordflow}{return} [\{\}]
678             \textcolor{comment}{# test set prediction uses candidates}
679             self.model.eval()
680             \textcolor{keywordflow}{if} fixed:
681                 \textcolor{keywordflow}{if} obs[0][\textcolor{stringliteral}{'episode\_done'}]:
682                     self.cands\_done = []
683 
684                 \textcolor{keywordflow}{if} xs \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
685                     xs = Variable(torch.LongTensor([self.parse(\textcolor{stringliteral}{'nothing'})]))
686                 xs = xs.clone()
687                 \textcolor{keywordflow}{if} self.tricks:
688                     vv = self.history[\textcolor{stringliteral}{'last\_utterance'}]
689                     \textcolor{keywordflow}{if} len(vv) == 0:
690                         xsq = Variable(torch.LongTensor([self.parse(\textcolor{stringliteral}{'nothing'})]))
691                     \textcolor{keywordflow}{else}:
692                         xsq = Variable(torch.LongTensor([vv]))
693                 \textcolor{keywordflow}{else}:
694                     xsq = xs
695                 mems = obs[0][\textcolor{stringliteral}{'mem'}]
696                 \textcolor{keywordflow}{if} self.tricks:
697                     mems = []
698                 \textcolor{keywordflow}{if} self.fixedX \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
699                     xe, ye = self.model(xsq, mems, ys, self.fixedCands)
700                     self.fixedX = ye
701                 \textcolor{keywordflow}{else}:
702                     \textcolor{comment}{# fixed cand embed vectors are cached, dont't recompute}
703                     blah = Variable(torch.LongTensor([1]))
704                     xe, ye = self.model(xsq, mems, ys, [blah])
705                     ye = self.fixedX
706                 pred = nn.CosineSimilarity().forward(xe, ye)
707                 origxe = xe
708                 origpred = pred
709                 val, ind = pred.sort(descending=\textcolor{keyword}{True})
710                 ypred = cands\_txt2[0][ind[0].item()]  \textcolor{comment}{# reply to match}
711                 \textcolor{keywordflow}{if} self.opt.get(\textcolor{stringliteral}{'kvmemnn\_debug'}, \textcolor{keyword}{False}):
712                     print(\textcolor{stringliteral}{"twohop-range:"}, self.opt.get(\textcolor{stringliteral}{'twohop\_range'}, 100))
713                     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(10):
714                         txt1 = self.fixedCands\_txt[ind[i].item()]
715                         txt2 = cands\_txt2[0][ind[i].item()]
716                         print(i, txt1, \textcolor{stringliteral}{'\(\backslash\)n    '}, txt2)
717                 tc = [ypred]
718                 \textcolor{keywordflow}{if} self.twohoputt:
719                     \textcolor{comment}{# now we rerank original cands against this prediction}
720                     zq = []
721                     z = []
722                     ztxt = []
723                     newwords = \{\}
724                     r = self.opt.get(\textcolor{stringliteral}{'twohop\_range'}, 100)
725                     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(r):
726                         c = self.fixedCands2[ind[i].item()]
727                         ctxt = self.fixedCands\_txt2[ind[i].item()]
728                         \textcolor{keywordflow}{if} i < 10:
729                             zq.append(c)
730                         z.append(c)
731                         ztxt.append(ctxt)
732                         \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} c[0]:
733                             newwords[w.item()] = \textcolor{keyword}{True}
734                     xs2 = torch.cat(zq, 1)
735 
736                 \textcolor{keywordflow}{if} (self.interactiveMode \textcolor{keywordflow}{and} self.twohoputt) \textcolor{keywordflow}{or} cands[0] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
737                     \textcolor{comment}{# used for nextutt alg in demo mode, get 2nd hop}
738                     blah = Variable(torch.LongTensor([1]))
739                     \textcolor{keywordflow}{if} self.tricks:
740                         xe, ye = self.model(xs2, obs[0][\textcolor{stringliteral}{'mem'}], ys, z)
741                     \textcolor{keywordflow}{else}:
742                         xe, ye = self.model(xs2, obs[0][\textcolor{stringliteral}{'mem'}], ys, [blah])
743                         ye = self.fixedX
744                     blend = self.opt.get(\textcolor{stringliteral}{'twohop\_blend'}, 0)
745                     \textcolor{keywordflow}{if} blend > 0:
746                         xe = (1 - blend) * xe + blend * origxe
747                     pred = nn.CosineSimilarity().forward(xe, ye)
748                     \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} self.cands\_done:
749                         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(ztxt)):
750                             \textcolor{keywordflow}{if} ztxt[i] == c:
751                                 \textcolor{comment}{# interactive heuristic: don't repeat yourself}
752                                 pred[i] = -1000
753                     val, ind = pred.sort(descending=\textcolor{keyword}{True})
754                     \textcolor{comment}{# predict the highest scoring candidate, and return it.}
755                     \textcolor{comment}{# print("   [query:          " + self.v2t(xsq) + "]")}
756                     ps = []
757                     \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} obs[0][\textcolor{stringliteral}{'mem'}]:
758                         ps.append(self.v2t(c))
759                     \textcolor{comment}{# print("   [persona:        " + '|'.join(ps) + "]")}
760                     \textcolor{comment}{# print("   [1st hop qmatch: " + ypredorig + "]")}
761                     \textcolor{comment}{# print("   [1st hop nextut: " + ypred + "]")}
762                     \textcolor{keywordflow}{if} self.tricks:
763                         ypred = ztxt[ind[0].item()]  \textcolor{comment}{# match}
764                         self.cands\_done.append(ypred)
765                     \textcolor{keywordflow}{else}:
766                         ypred = self.fixedCands\_txt[ind[0].item()]  \textcolor{comment}{# match}
767                         self.cands\_done.append(ind[0].item())
768                         \textcolor{comment}{# print("   [2nd hop nextut: " + ypred2 + "]")}
769                     tc = [ypred]
770                     self.history[\textcolor{stringliteral}{'labels'}] = [ypred]
771                     \textcolor{comment}{# print("   [final pred: " + ypred + "]")}
772                     ret = [\{\textcolor{stringliteral}{'text'}: ypred, \textcolor{stringliteral}{'text\_candidates'}: tc\}]
773                     \textcolor{keywordflow}{return} ret
774                 \textcolor{keywordflow}{elif} self.take\_next\_utt \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} self.interactiveMode:
775                     xe, ye = self.model(xs2, obs[0][\textcolor{stringliteral}{'mem'}], ys, cands[0])
776                     pred = nn.CosineSimilarity().forward(xe, ye)
777                     xe, ye = self.model(xs, obs[0][\textcolor{stringliteral}{'mem'}], ys, cands[0])
778                     origpred = nn.CosineSimilarity().forward(xe, ye)
779                     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'alpha'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.opt:
780                         alpha = 0.1
781                     \textcolor{keywordflow}{else}:
782                         alpha = self.opt[\textcolor{stringliteral}{'alpha'}]
783                     pred = alpha * pred + 1 * origpred
784                     val, ind = pred.sort(descending=\textcolor{keyword}{True})
785                     \textcolor{comment}{# predict the highest scoring candidate, and return it.}
786                     ypred = cands\_txt[0][ind[0].item()]  \textcolor{comment}{# match}
787                     tc = []
788                     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(ind)):
789                         tc.append(cands\_txt[0][ind[i].item()])
790             \textcolor{keywordflow}{else}:
791                 \textcolor{keywordflow}{if} self.opt[\textcolor{stringliteral}{'loss'}] == \textcolor{stringliteral}{'cosine'}:
792                     xe, ye = self.model(xs, obs[0][\textcolor{stringliteral}{'mem'}], ys, cands[0])
793                     pred = nn.CosineSimilarity().forward(xe, ye)
794                 \textcolor{keywordflow}{else}:
795                     x = self.model(xs, obs[0][\textcolor{stringliteral}{'mem'}], ys, cands[0])
796                     pred = x  \textcolor{comment}{# .squeeze()}
797                 val, ind = pred.sort(descending=\textcolor{keyword}{True})
798                 ypred = cands\_txt[0][ind[0].item()]  \textcolor{comment}{# match}
799                 tc = []
800                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(min(100, ind.size(0))):
801                     tc.append(cands\_txt[0][ind[i].item()])
802             ret = [\{\textcolor{stringliteral}{'text'}: ypred, \textcolor{stringliteral}{'text\_candidates'}: tc\}]
803             \textcolor{keywordflow}{return} ret
804         \textcolor{keywordflow}{return} [\{\}] * xs.size(0)
805 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a4b5b1dd2efa6f00f39f773f0b48edfc7}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a4b5b1dd2efa6f00f39f773f0b48edfc7}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!report2@{report2}}
\index{report2@{report2}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{report2()}{report2()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+report2 (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 511 of file kvmemnn.\+py.


\begin{DoxyCode}
511     \textcolor{keyword}{def }report2(self):
512         \textcolor{keyword}{def }\hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1generator_1_1train__end2end_ae2dca6c52aafdaa03e4b7cbf97a025ae}{clip}(f):
513             \textcolor{keywordflow}{return} \hyperlink{namespaceparlai_1_1agents_1_1legacy__agents_1_1seq2seq_1_1utils__v0_af377ec61bfc0423461e7b409ffc883b9}{round\_sigfigs}(f)
514 
515         metrics = self.metrics
516         \textcolor{keywordflow}{if} metrics[\textcolor{stringliteral}{'exs'}] == 0:
517             report = \{\textcolor{stringliteral}{'mean\_rank'}: self.opt[\textcolor{stringliteral}{'neg\_samples'}]\}
518         \textcolor{keywordflow}{else}:
519             maxn = 0
520             \textcolor{keywordflow}{for} \_ \textcolor{keywordflow}{in} range(100):
521                 n = self.model.lt.weight[5].norm(2)[0].item()
522                 \textcolor{keywordflow}{if} n > maxn:
523                     maxn = n
524 
525             report = \{
526                 \textcolor{stringliteral}{'exs'}: \hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1generator_1_1train__end2end_ae2dca6c52aafdaa03e4b7cbf97a025ae}{clip}(metrics[\textcolor{stringliteral}{'total\_total'}]),
527                 \textcolor{stringliteral}{'loss'}: \hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1generator_1_1train__end2end_ae2dca6c52aafdaa03e4b7cbf97a025ae}{clip}(metrics[\textcolor{stringliteral}{'loss'}] / metrics[\textcolor{stringliteral}{'exs'}]),
528                 \textcolor{stringliteral}{'mean\_rank'}: \hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1generator_1_1train__end2end_ae2dca6c52aafdaa03e4b7cbf97a025ae}{clip}(metrics[\textcolor{stringliteral}{'mean\_rank'}] / metrics[\textcolor{stringliteral}{'exs'}]),
529                 \textcolor{stringliteral}{'mlp\_time'}: \hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1generator_1_1train__end2end_ae2dca6c52aafdaa03e4b7cbf97a025ae}{clip}(metrics[\textcolor{stringliteral}{'mlp\_time'}] / metrics[\textcolor{stringliteral}{'exs'}]),
530                 \textcolor{stringliteral}{'tot\_time'}: \hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1generator_1_1train__end2end_ae2dca6c52aafdaa03e4b7cbf97a025ae}{clip}(metrics[\textcolor{stringliteral}{'tot\_time'}] / metrics[\textcolor{stringliteral}{'exs'}]),
531                 \textcolor{stringliteral}{'max\_norm'}: \hyperlink{namespaceprojects_1_1wizard__of__wikipedia_1_1generator_1_1train__end2end_ae2dca6c52aafdaa03e4b7cbf97a025ae}{clip}(n),
532             \}
533         \textcolor{keywordflow}{return} report
534 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aedce45a699479a98d38bcb78b36dd1ea}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aedce45a699479a98d38bcb78b36dd1ea}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!reset@{reset}}
\index{reset@{reset}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{reset()}{reset()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+reset (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Reset observation and episode_done.
\end{DoxyVerb}
 

Definition at line 467 of file kvmemnn.\+py.


\begin{DoxyCode}
467     \textcolor{keyword}{def }reset(self):
468         \textcolor{stringliteral}{"""}
469 \textcolor{stringliteral}{        Reset observation and episode\_done.}
470 \textcolor{stringliteral}{        """}
471         self.observation = \textcolor{keywordtype}{None}
472         self.episode\_done = \textcolor{keyword}{True}
473         self.cands\_done = []
474         self.history = \{\}
475         \textcolor{comment}{# set up optimizer}
476         lr = self.opt[\textcolor{stringliteral}{'learningrate'}]
477         optim\_class = KvmemnnAgent.OPTIM\_OPTS[self.opt[\textcolor{stringliteral}{'optimizer'}]]
478         kwargs = \{\textcolor{stringliteral}{'lr'}: lr\}
479         self.optimizer = optim\_class(self.model.parameters(), **kwargs)
480 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ad4f013360fde46e2974fcf0f65a99e3d}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ad4f013360fde46e2974fcf0f65a99e3d}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!reset\+\_\+metrics@{reset\+\_\+metrics}}
\index{reset\+\_\+metrics@{reset\+\_\+metrics}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{reset\+\_\+metrics()}{reset\_metrics()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+reset\+\_\+metrics (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{keep\+\_\+total = {\ttfamily False} }\end{DoxyParamCaption})}



Definition at line 535 of file kvmemnn.\+py.


\begin{DoxyCode}
535     \textcolor{keyword}{def }reset\_metrics(self, keep\_total=False):
536         \textcolor{keywordflow}{if} keep\_total:
537             self.metrics = \{
538                 \textcolor{stringliteral}{'exs'}: 0,
539                 \textcolor{stringliteral}{'mean\_rank'}: 0,
540                 \textcolor{stringliteral}{'loss'}: 0,
541                 \textcolor{stringliteral}{'total\_total'}: self.metrics[\textcolor{stringliteral}{'total\_total'}],
542                 \textcolor{stringliteral}{'mlp\_time'}: 0,
543                 \textcolor{stringliteral}{'tot\_time'}: 0,
544                 \textcolor{stringliteral}{'max\_weight'}: 0,
545                 \textcolor{stringliteral}{'mean\_weight'}: 0,
546             \}
547         \textcolor{keywordflow}{else}:
548             self.metrics = \{
549                 \textcolor{stringliteral}{'total\_total'}: 0,
550                 \textcolor{stringliteral}{'mean\_rank'}: 0,
551                 \textcolor{stringliteral}{'exs'}: 0,
552                 \textcolor{stringliteral}{'mlp\_time'}: 0,
553                 \textcolor{stringliteral}{'tot\_time'}: 0,
554                 \textcolor{stringliteral}{'loss'}: 0,
555                 \textcolor{stringliteral}{'max\_weight'}: 0,
556                 \textcolor{stringliteral}{'mean\_weight'}: 0,
557             \}
558 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a1b9834569393e1e53821567503fc6383}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a1b9834569393e1e53821567503fc6383}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!same@{same}}
\index{same@{same}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{same()}{same()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+same (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{y1,  }\item[{}]{y2 }\end{DoxyParamCaption})}

\begin{DoxyVerb}Check if two tensors are the same, within small margin of error.
\end{DoxyVerb}
 

Definition at line 572 of file kvmemnn.\+py.


\begin{DoxyCode}
572     \textcolor{keyword}{def }same(self, y1, y2):
573         \textcolor{stringliteral}{"""}
574 \textcolor{stringliteral}{        Check if two tensors are the same, within small margin of error.}
575 \textcolor{stringliteral}{        """}
576         \textcolor{keywordflow}{if} len(y1) != len(y2):
577             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
578         \textcolor{keywordflow}{if} abs((y1 - y2).sum().data.sum()) > 0.00001:
579             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
580         \textcolor{keywordflow}{return} \textcolor{keyword}{True}
581 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a739a619a844360c3bf8a6e6b8879c341}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a739a619a844360c3bf8a6e6b8879c341}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!save@{save}}
\index{save@{save}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{save()}{save()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+save (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{path = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Save model parameters if model_file is set.
\end{DoxyVerb}
 

Definition at line 915 of file kvmemnn.\+py.


\begin{DoxyCode}
915     \textcolor{keyword}{def }save(self, path=None):
916         \textcolor{stringliteral}{"""}
917 \textcolor{stringliteral}{        Save model parameters if model\_file is set.}
918 \textcolor{stringliteral}{        """}
919         path = self.opt.get(\textcolor{stringliteral}{'model\_file'}, \textcolor{keywordtype}{None}) \textcolor{keywordflow}{if} path \textcolor{keywordflow}{is} \textcolor{keywordtype}{None} \textcolor{keywordflow}{else} path
920         \textcolor{keywordflow}{if} path \textcolor{keywordflow}{and} hasattr(self, \textcolor{stringliteral}{'model'}):
921             data = \{\}
922             data[\textcolor{stringliteral}{'model'}] = self.model.state\_dict()
923             data[\textcolor{stringliteral}{'optimizer'}] = self.optimizer.state\_dict()
924             data[\textcolor{stringliteral}{'opt'}] = self.opt
925             with open(path, \textcolor{stringliteral}{'wb'}) \textcolor{keyword}{as} handle:
926                 torch.save(data, handle)
927             with open(path + \textcolor{stringliteral}{".opt"}, \textcolor{stringliteral}{'wb'}) \textcolor{keyword}{as} handle:
928                 pickle.dump(self.opt, handle, protocol=pickle.HIGHEST\_PROTOCOL)
929 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a713175baa1cbbcb147c34ec1bac8f77a}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a713175baa1cbbcb147c34ec1bac8f77a}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!share@{share}}
\index{share@{share}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{share()}{share()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+share (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Share internal states between parent and child instances.
\end{DoxyVerb}
 

Definition at line 481 of file kvmemnn.\+py.


\begin{DoxyCode}
481     \textcolor{keyword}{def }share(self):
482         \textcolor{stringliteral}{"""}
483 \textcolor{stringliteral}{        Share internal states between parent and child instances.}
484 \textcolor{stringliteral}{        """}
485         shared = super().share()
486         shared[\textcolor{stringliteral}{'dict'}] = self.dict
487         shared[\textcolor{stringliteral}{'model'}] = self.model
488         \textcolor{keywordflow}{if} self.fixedX \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
489             shared[\textcolor{stringliteral}{'fixedX'}] = self.fixedX
490             shared[\textcolor{stringliteral}{'fixedCands'}] = self.fixedCands
491             shared[\textcolor{stringliteral}{'fixedCands\_txt'}] = self.fixedCands\_txt
492             shared[\textcolor{stringliteral}{'fixedCands2'}] = self.fixedCands2
493             shared[\textcolor{stringliteral}{'fixedCands\_txt2'}] = self.fixedCands\_txt2
494         \textcolor{keywordflow}{return} shared
495 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a1e8a1089e7ecea911029c96d95f8b62a}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a1e8a1089e7ecea911029c96d95f8b62a}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!shutdown@{shutdown}}
\index{shutdown@{shutdown}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{shutdown()}{shutdown()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+shutdown (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}



Definition at line 911 of file kvmemnn.\+py.


\begin{DoxyCode}
911     \textcolor{keyword}{def }shutdown(self):
912         \textcolor{comment}{# """Save the state of the model when shutdown."""}
913         super().shutdown()
914 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a0c38fac50edaf23833de870e37bccb97}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a0c38fac50edaf23833de870e37bccb97}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!t2v@{t2v}}
\index{t2v@{t2v}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{t2v()}{t2v()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+t2v (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{text }\end{DoxyParamCaption})}



Definition at line 436 of file kvmemnn.\+py.


\begin{DoxyCode}
436     \textcolor{keyword}{def }t2v(self, text):
437         p = self.dict.txt2vec(text)
438         \textcolor{keywordflow}{return} Variable(torch.LongTensor(p).unsqueeze(1))
439 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a9760c8b1b1b905f09de43413ad51a69b}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a9760c8b1b1b905f09de43413ad51a69b}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!update\+\_\+params@{update\+\_\+params}}
\index{update\+\_\+params@{update\+\_\+params}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{update\+\_\+params()}{update\_params()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+update\+\_\+params (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Do one optimization step.
\end{DoxyVerb}
 

Definition at line 461 of file kvmemnn.\+py.


\begin{DoxyCode}
461     \textcolor{keyword}{def }update\_params(self):
462         \textcolor{stringliteral}{"""}
463 \textcolor{stringliteral}{        Do one optimization step.}
464 \textcolor{stringliteral}{        """}
465         self.optimizer.step()
466 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a07a7ef79c4bae6151aad5b7b765be9bc}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a07a7ef79c4bae6151aad5b7b765be9bc}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!v2t@{v2t}}
\index{v2t@{v2t}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{v2t()}{v2t()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+v2t (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{vec }\end{DoxyParamCaption})}

\begin{DoxyVerb}Convert token indices to string of tokens.
\end{DoxyVerb}
 

Definition at line 440 of file kvmemnn.\+py.


\begin{DoxyCode}
440     \textcolor{keyword}{def }v2t(self, vec):
441         \textcolor{stringliteral}{"""}
442 \textcolor{stringliteral}{        Convert token indices to string of tokens.}
443 \textcolor{stringliteral}{        """}
444         \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(vec) == Variable:
445             vec = vec.data
446         \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(vec) == torch.LongTensor \textcolor{keywordflow}{and} vec.dim() == 2:
447             vec = vec.squeeze(0)
448         \textcolor{keywordflow}{if} \hyperlink{namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_ad5dfae268e23f506da084a9efb72f619}{type}(vec) == torch.Tensor \textcolor{keywordflow}{and} vec.dim() == 2:
449             vec = vec.squeeze(0)
450         new\_vec = []
451         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} vec:
452             new\_vec.append(i)
453         \textcolor{keywordflow}{return} self.dict.vec2txt(new\_vec)
454 
\end{DoxyCode}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a7c6b549658b7ee5148af60c180e803b1}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a7c6b549658b7ee5148af60c180e803b1}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!zero\+\_\+grad@{zero\+\_\+grad}}
\index{zero\+\_\+grad@{zero\+\_\+grad}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{zero\+\_\+grad()}{zero\_grad()}}
{\footnotesize\ttfamily def projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+zero\+\_\+grad (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Zero out optimizer.
\end{DoxyVerb}
 

Definition at line 455 of file kvmemnn.\+py.


\begin{DoxyCode}
455     \textcolor{keyword}{def }zero\_grad(self):
456         \textcolor{stringliteral}{"""}
457 \textcolor{stringliteral}{        Zero out optimizer.}
458 \textcolor{stringliteral}{        """}
459         self.optimizer.zero\_grad()
460 
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a7f13d1272a33cdc7d0d6de07eaf67db8}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a7f13d1272a33cdc7d0d6de07eaf67db8}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!cands@{cands}}
\index{cands@{cands}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{cands}{cands}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+cands}



Definition at line 306 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a4e00699d90d4efcc4c7565877a3d2adc}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a4e00699d90d4efcc4c7565877a3d2adc}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!cands\+\_\+done@{cands\+\_\+done}}
\index{cands\+\_\+done@{cands\+\_\+done}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{cands\+\_\+done}{cands\_done}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+cands\+\_\+done}



Definition at line 383 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a8a124eccb81be3ce6c44ccb3974acc68}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a8a124eccb81be3ce6c44ccb3974acc68}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!criterion@{criterion}}
\index{criterion@{criterion}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{criterion}{criterion}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+criterion}



Definition at line 371 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a3cc3e3a4ad7a3c00db24dc14fa4a707f}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a3cc3e3a4ad7a3c00db24dc14fa4a707f}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!dict@{dict}}
\index{dict@{dict}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{dict}{dict}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+dict}



Definition at line 318 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a6026c6d8fc17ff4dd51536087fce18b5}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a6026c6d8fc17ff4dd51536087fce18b5}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!episode\+\_\+done@{episode\+\_\+done}}
\index{episode\+\_\+done@{episode\+\_\+done}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{episode\+\_\+done}{episode\_done}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+episode\+\_\+done}



Definition at line 472 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a3735e269f0968c3a23a946e01ef8d05c}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a3735e269f0968c3a23a946e01ef8d05c}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!fixed\+Cands@{fixed\+Cands}}
\index{fixed\+Cands@{fixed\+Cands}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{fixed\+Cands}{fixedCands}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+fixed\+Cands}



Definition at line 323 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_abf77c5e5fcd5202978f9a880ff41b4d1}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_abf77c5e5fcd5202978f9a880ff41b4d1}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!fixed\+Cands2@{fixed\+Cands2}}
\index{fixed\+Cands2@{fixed\+Cands2}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{fixed\+Cands2}{fixedCands2}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+fixed\+Cands2}



Definition at line 325 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_afcf4c52a9f37ba1f70114c8c935f99fe}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_afcf4c52a9f37ba1f70114c8c935f99fe}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!fixed\+Cands\+\_\+txt@{fixed\+Cands\+\_\+txt}}
\index{fixed\+Cands\+\_\+txt@{fixed\+Cands\+\_\+txt}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{fixed\+Cands\+\_\+txt}{fixedCands\_txt}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+fixed\+Cands\+\_\+txt}



Definition at line 324 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a1f97013332930c41aa8839be4fc78b40}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a1f97013332930c41aa8839be4fc78b40}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!fixed\+Cands\+\_\+txt2@{fixed\+Cands\+\_\+txt2}}
\index{fixed\+Cands\+\_\+txt2@{fixed\+Cands\+\_\+txt2}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{fixed\+Cands\+\_\+txt2}{fixedCands\_txt2}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+fixed\+Cands\+\_\+txt2}



Definition at line 326 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ae0828c6c5229d640f49e76415ee6a980}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ae0828c6c5229d640f49e76415ee6a980}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!fixedX@{fixedX}}
\index{fixedX@{fixedX}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{fixedX}{fixedX}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+fixedX}



Definition at line 322 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ae2986233a39d3af2c0a9a02e563e33eb}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ae2986233a39d3af2c0a9a02e563e33eb}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!history@{history}}
\index{history@{history}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{history}{history}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+history}



Definition at line 310 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a2653501d48cf8661f1029da9b40615aa}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a2653501d48cf8661f1029da9b40615aa}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!id@{id}}
\index{id@{id}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{id}{id}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+id}



Definition at line 302 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aad3af91663688393121d6475cadec9cc}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aad3af91663688393121d6475cadec9cc}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!interactive\+Mode@{interactive\+Mode}}
\index{interactive\+Mode@{interactive\+Mode}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{interactive\+Mode}{interactiveMode}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+interactive\+Mode}



Definition at line 385 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aca0257f35b72dc504f9edc52a7de433e}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aca0257f35b72dc504f9edc52a7de433e}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!metrics@{metrics}}
\index{metrics@{metrics}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{metrics}{metrics}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+metrics}



Definition at line 537 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ad1f6d5ed2b9f885f74d4fb36dc36a378}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ad1f6d5ed2b9f885f74d4fb36dc36a378}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!model@{model}}
\index{model@{model}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{model}{model}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+model}



Definition at line 320 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a735511597db72af2e4e13d26c4295415}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a735511597db72af2e4e13d26c4295415}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!N\+U\+L\+L\+\_\+\+I\+DX@{N\+U\+L\+L\+\_\+\+I\+DX}}
\index{N\+U\+L\+L\+\_\+\+I\+DX@{N\+U\+L\+L\+\_\+\+I\+DX}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{N\+U\+L\+L\+\_\+\+I\+DX}{NULL\_IDX}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+N\+U\+L\+L\+\_\+\+I\+DX}



Definition at line 303 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_afd7921cc7a7e9aa7a8d3a454cf6d6176}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_afd7921cc7a7e9aa7a8d3a454cf6d6176}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!observation@{observation}}
\index{observation@{observation}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{observation}{observation}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+observation}



Definition at line 471 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a4e25d0aaf32c5bcc9429c6825ba214c4}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a4e25d0aaf32c5bcc9429c6825ba214c4}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!opt@{opt}}
\index{opt@{opt}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{opt}{opt}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+opt}



Definition at line 940 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a0e510a2935777fbec0fb930628377415}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a0e510a2935777fbec0fb930628377415}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!O\+P\+T\+I\+M\+\_\+\+O\+P\+TS@{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}}
\index{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS@{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{O\+P\+T\+I\+M\+\_\+\+O\+P\+TS}{OPTIM\_OPTS}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+O\+P\+T\+I\+M\+\_\+\+O\+P\+TS\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 144 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ae9a0118914d6d1c9be4ecc428934b537}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ae9a0118914d6d1c9be4ecc428934b537}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!optimizer@{optimizer}}
\index{optimizer@{optimizer}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{optimizer}{optimizer}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+optimizer}



Definition at line 479 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a18725fe3d8fafd7f7bb77375d9746243}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a18725fe3d8fafd7f7bb77375d9746243}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!start@{start}}
\index{start@{start}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{start}{start}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+start}



Definition at line 629 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a9897f8ce9952e909e3381cb9626d3c3f}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a9897f8ce9952e909e3381cb9626d3c3f}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!start2@{start2}}
\index{start2@{start2}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{start2}{start2}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+start2}



Definition at line 304 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a197c4ee11a4536d738a632f46847cc89}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a197c4ee11a4536d738a632f46847cc89}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!take\+\_\+next\+\_\+utt@{take\+\_\+next\+\_\+utt}}
\index{take\+\_\+next\+\_\+utt@{take\+\_\+next\+\_\+utt}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{take\+\_\+next\+\_\+utt}{take\_next\_utt}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+take\+\_\+next\+\_\+utt}



Definition at line 382 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_abefa2913cd8ba218e8a46723c1b4cafd}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_abefa2913cd8ba218e8a46723c1b4cafd}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!threadindex@{threadindex}}
\index{threadindex@{threadindex}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{threadindex}{threadindex}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+threadindex}



Definition at line 314 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a17cc75d3ddbb3859ad5bee04542acd53}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a17cc75d3ddbb3859ad5bee04542acd53}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!tricks@{tricks}}
\index{tricks@{tricks}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{tricks}{tricks}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+tricks}



Definition at line 666 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ac98593d77b62bcff6980f46fcd2afb25}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_ac98593d77b62bcff6980f46fcd2afb25}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!truncate@{truncate}}
\index{truncate@{truncate}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{truncate}{truncate}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+truncate}



Definition at line 309 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_abfdc212a6bfaa2af3eafcff11734d05c}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_abfdc212a6bfaa2af3eafcff11734d05c}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!twohoputt@{twohoputt}}
\index{twohoputt@{twohoputt}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{twohoputt}{twohoputt}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+twohoputt}



Definition at line 665 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aa697cc9113a1b4894ce83b3a0e65de68}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_aa697cc9113a1b4894ce83b3a0e65de68}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!ys\+\_\+cache@{ys\+\_\+cache}}
\index{ys\+\_\+cache@{ys\+\_\+cache}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{ys\+\_\+cache}{ys\_cache}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+ys\+\_\+cache}



Definition at line 307 of file kvmemnn.\+py.

\mbox{\Hypertarget{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a9c5c9281c032bbe9e028230700e51006}\label{classprojects_1_1personachat_1_1kvmemnn_1_1kvmemnn_1_1KvmemnnAgent_a9c5c9281c032bbe9e028230700e51006}} 
\index{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}!ys\+\_\+cache\+\_\+sz@{ys\+\_\+cache\+\_\+sz}}
\index{ys\+\_\+cache\+\_\+sz@{ys\+\_\+cache\+\_\+sz}!projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent@{projects\+::personachat\+::kvmemnn\+::kvmemnn\+::\+Kvmemnn\+Agent}}
\subsubsection{\texorpdfstring{ys\+\_\+cache\+\_\+sz}{ys\_cache\_sz}}
{\footnotesize\ttfamily projects.\+personachat.\+kvmemnn.\+kvmemnn.\+Kvmemnn\+Agent.\+ys\+\_\+cache\+\_\+sz}



Definition at line 308 of file kvmemnn.\+py.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
projects/personachat/kvmemnn/\hyperlink{projects_2personachat_2kvmemnn_2kvmemnn_8py}{kvmemnn.\+py}\end{DoxyCompactItemize}
